软件 学报 JOURNALOFSOFTWARE 年 第期 No 基于 矢量 斜率 的 分段 线性 拟合 王明 江唐 璞 山 　 　 摘要 　 介绍 了 用 统计 矢量 斜率 进行 平面 数据 点 分段 线性 拟合 的 算法 对于 欲 拟合 的 一系列 平面 数据 点 一般 是 有 先后顺序 的 首先 给出 了 矢量 斜率 的 定义 然后 计算 每个 平面 数据 点 的 统计 矢量 斜率 根据 各点 矢量 斜率 值 接近 的 情况 将 数据 点 分割 成组 拟合 各组 数据 形成 线段 把 各 线段 首尾 连接起来 就 得到 了 平面 数据 点 的 分段 线性 拟合 定义 的 矢量 斜率 包含 大小 和 方向 两 方面 信息 主值 区间 为 （ － ～ ＋ ） 它 在 主值 区间 的 变化 与 角度 在 （ － ° ～ ° ） 区间 中 的 变化 一一对应 且 它们 的 关系 曲线 有 很 好 的 线性 度 使用 传统 斜率 进行 分段 线性 拟合 存在 斜率 值 与 角度 的 关系 曲线 线性 度差 、 斜率 取值 有时 趋向 无穷 等 问题 这些 问题 影响 了 拟合 的 精度 并 限制 了 算法 的 使用 范围 矢量 斜率 克服 了 上述 问题 从而 提供 了 拟合 曲线 的 质量 且 算法 可 适用 于 任意 曲线 算法 时间 复杂度 为 线性 　 　 关键词 　 特征提取 分段 线性 拟合 形状 分析 轮廓 分析 边缘 检测 　 　 中图法 分类号 　 TPAPiecewiseLinearApproximationBasedonVectorSlopeWANGMingjiangTANGPushan 　 　 Abstract 　 ApiecewiselinearapproximationbasedonvectorslopeispresentedinthispaperGivenasetofplanardatapointsgenerallythesepointshavesequenceThevectorslopedefinitionisintroducedatfirstinthispaperTheslopeofeverypointsinsetGiscomputedThepointsclusterinagroupwherevectorslopeofthesepointsareverynearFittingeverygrouptoalineandlinkingtheselinesafittingcurvecanbeattainedThevectorslopedefinationhasthemessageofsizeanddirectionbasicintervalis ～ Thevaringofvectorslopeinbasicintervalwithangle ° ～ ° isinonetoonecorrespondenceandtherelationcurvehasgoodlinearityApiecewiselinearapproximationbasedonconventionalslopehassomeproblemsthattheslopevalueisinfiniteinsomecasesandtherelationcurvewithanglehasbadlinearityAlltheseveryeffectthequalityoffittingcurveandconfinetheapplicationrangeThisalgorithmovercometheseproblemssotheauthorscanobtainahighqualityfittingcurveandthealgorithmcanbeusedineverygraphThetimecomplexityislinear 　 　 Keywords 　 Featureextractionpiecewiselinearapproximationshapeanalysiscontouranalysisedgedetection 　 　 在 图纸 图像 自动 读入 及 识别 、 PCB 版图 图像 验证 以及 集成电路 的 逆向 设计 中 所 处理 的 图像 物体 一般 都 是 由 水平 、 垂直 和 ° 等 线段 构成 的 在 这些 处理 中 最后 都 需要 将 提取 的 物体 由 图像 表示 转化成 图形 表示 一般 方法 是 求出 图像 物体 的 边缘 或 骨骼 线 将 它们 拟 合成 图形图像 物体 的 边缘 及 骨骼 线 都 是 由 一系列 有 先后顺序 的 图像 像素 坐标 数据链 构成 的 所以 将 其拟 合成 图形 就 相当于 将 平面 上 的 一系列 有 先后顺序 的 数据 点拟 合成 曲线 的 问题 由 图像 物体 的 特征 可以 考虑 用 一些 简单 的 曲线 （ 如 线段 、 圆弧 等 ） 来 近似 表示 这些 数据 点 其中 最 简单 的 就是 分段 线性 表示 即将 数据 点 分成 若干 部分 用 线段 来 表示 其中 的 每 一部分 本文 提出 的 算法 就是 分段 地 线性 拟合 平面 上 的 一系列 数据 点 　 　 Tomex ［ ］ 吴 立德 ［ ］ Hakimi ［ ］ 和 Hiroshi ［ ］ 等 人 都 分别 提出 了 用 分段 线性 表示 平面 中 的 一系列 点 的 算法 Tomex 算法 是 搜索 包含 在 两条 平行 切线 间 的 最长 曲线 段 它 的 计算 复杂度 是 线性 的 其 性能 有时 不 理想 而 改进 时 需要 显著 地 增加 成本 Hakimi 的 算法 与 Tomex 的 算法 基本 相似 吴 立德 基于 统计 模型 的 算法 其 基本 思想 是 先 将 数据 点 进行 分组 然后 用 最小 二 乘法 计算 各组 的 拟合 直线 的 斜率 将 斜率 发生 剧烈 变化 处 定为 断点 由此 将 组合 并 为 段 再 计算 各段 的 最小 二 乘方 的 直线 拟合 即得 所求 的 线段 若 要求 连续 即 在 各 断点 处取 平均 以 形成 顶点 用 这些 顶点 构成 一个 连续 分段 性 的 逼近 　 　 吴 立德 的 算法 思想 简单 算法 复杂度 为 线性 但 吴 立德 的 算法 在 实际 应用 中 存在 下面 几个 问题 　 　 吴 立德 的 算法 是 建立 在 x ＜ x ＜ ＜ xi ＜ ＜ xN 的 条件 xi 为 给定 数据 点 的 x 坐标 之上 的 对于 闭合 曲线 需要 按 上述 条件 分段 然后 进行 拟合 对于 图 的 情况 则 会 出现 dydx 为 ∞ 的 情况 　 　 吴 立德 的 算法 是 用 斜率 值 dydx 求取 分割 点 的 把 通过 点 xy 的 曲线 切线 与 X 轴 的 交角 记 为 α α 的 变化 准确 地 反映 了 曲线 的 变化 当 α 较 小时 dydx 与 α 的 变化 基本 成 线性 当 α 接近 ° 时 角度 的 很小 变化 会 带来 dydx 的 很大 变化 故 在 整个 斜率 变化 范围 内 算法 的 一致性 是 很 差 的 本文 提出 的 基于 矢量 斜率 的 分段 线性 拟合 算法 有效 地 解决 了 吴 立德 的 算法 存在 的 问题 算法 思想 简单 可 适用 于 任意 图形 图 矢量 斜率 的 定义 　 　 我们 知道 直线 斜率 是 没有 方向 信息 的 它 只是 直线 与 X 轴 交角 的 正切 值其 微分 定义 为 dydx 取值 范围 为 ∞ ～ ∞ 直线 斜率 与 角度 不是 一一对应 的 以上 这些 为 计算机程序 处理 带来 一些 不便 本文 所 定义 的 矢量 斜率 考虑 了 直线 斜率 的 特点 是 对 直线 斜率 定义 的 修正 和 补充 下面 给出 矢量 斜率 的 定义 　 　 参考 图 我们 将 平面 分割 成个 区域 在 每个 区域 中 定义 矢量 斜率 如下 　 　 在 区域 中 角度 范围 ° ～ ° ｜ dydx ｜ ≤ 矢量 的 斜率 值 定义 为 KCdydx 　 　 在 区域 中 角度 范围 ° ～ ° ｜ dydx ｜ ＞ 矢量 的 斜率 值 定义 为 KCdydx 　 　 在 区域 中 角度 范围 ° ～ ° ｜ dydx ｜ ≤ 矢量 的 斜率 值 定义 为 KCdydx 　 　 在 区域 中 角度 范围 ° ～ ° ｜ dydx ｜ ＞ 矢量 的 斜率 值 定义 为 KCdydx 　 　 KC 为 系数 K 可以 取 任意 整数 值 C 在 、 区域 中 取值 在 、 区域 中 取值 可 将 矢量 斜率 定义 写成 统一 的 形式 KACB 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 KC 取值 与 上述 相同 A 在 区域 ～ 中 分别 取 、 、 、 B 在 区域 、 中为 dydx 在 区域 、 中为 dydx 图 　 矢量 斜率 定义 区间 的 划分 　 　 与 角度 （ ° ～ ° ） 区间 定义 为主 值 区间 类似 定义 （ ～ ） 为 矢量 斜率 的 主值 区间 　 　 由 上述 定义 可知 矢量 斜率 值 V 与 VK 对应 于 同一 角度 值 定义 V 与 VK 是 等价 的 且 在 本文 算法 中 可 进行 任意 替换 主值 区间 的 矢量 斜率 值 与 主值 区间 的 角度 是 一一对应 的 当 主值 区间 的 矢量 斜率 值 确定 后 对应 的 主值 区间 的 角度 就 确定 了 从而 方向 也 确定 了 另外 当 ｜ dydx ｜ 时取 dydx 值来 定义 矢量 斜率 的 B 值 从而 避免 了 取值 趋向 无穷的 情况 图 a 为 矢量 斜率 与 角度 的 关系 图 b 为 直线 斜率 与 角度 的 关系 从图 可以 看到 矢量 斜率 与 角度 （ 度 ） 的 线性 度 比 直线 斜率 好得多 这为 本文 算法 的 计算机 处理 的 一致性 和 精度 的 提高 带来 很大 好处 　 　 　 　 　 　 　 　 a 　 矢量 斜率 与 角度 的 关系 曲线 　 　 　 　 　 　 　 b 　 直线 斜率 与 角度 的 关系 曲线图 矢量 斜率 、 直线 斜率 与 角度 关系 的 对比 　 　 虽然 上述 定义 在 数学 形式 上 比 直线 斜率 定义 复杂 些 但是 由于 矢量 斜率 的 处理 主要 是 由 计算机 来 完成 的 所以 上述 定义 并 没有 带来 多大 影响 并且 由于 矢量 斜率 主值 区间 为 （ ～ ） 避免 了 溢出 的 发生 所以 从 另一方面 也 简化 了 程序 的 处理 平面 数据 点 分段 线性 拟合 的 算法 步骤 　 　 本节 用 矢量 斜率 来 研究 平面 数据 点 的 分段 线性 拟合 的 问题 平面 数据 点 都 是 按 一定 的 顺序 记录 和 存储 的 对于 数据 中 的 各点 可以 从 其 前面 和 后面 各取 一定 数目 的 点 组成 一个 邻域 用 最小 二 乘法 求得 数据 点 矢量 斜率 的 统计 值取 当前 点 前面 数据 点 的 重心 位置 以及 后面 数据 点 的 重心 位置 由 前面 重心 位置 和 后面 的 重心 位置 可 求得 数据 点 局部 发展 方向 由 这 一 方向 和 矢量 斜率 的 统计 值 即可 求得 当前 点 的 矢量 斜率 值求 出 每个 点 的 斜率 值后 将 斜率 值 接近 的 点 聚合 到 一起 拟 合成 线段 将 线段 连接起来 就 构成 了 数据 点 的 分段 线性 表示 下面 我们 给出 具体 的 算法 步骤 　 　 步骤 求 各 数据 点 的 矢量 斜率 值 选取 一个 奇数 M × m ≤ N 对于 数据链 中 的 每 一个点 抽取 其 前面 的 m 个点 、 后面 的 m 个点 和 当前 点 组成 一个 邻域 集合 记为 SYiSYixijyijm ≤ j ≤ m ≤ i ＜ N 　 　 　 　 　 　 　 　 　 　 （ ） 求取 下面 各式 的 值 　 　 fxxxijxifyyyIJyi 　 　 iffxx ≥ fyy 　 　 　 Biyjyij ／ fxx 　 　 　 xbxj ／ mxexj ／ m 　 　 　 ifxe ＞ xb 　 　 　 　 矢量 在 区域 其 矢量 斜率 值为 Biy 　 　 　 else 　 　 　 　 矢量 在 区域 其 矢量 斜率 值为 Biy 　 　 else 　 　 　 Bixjxij ／ fyy 　 　 　 ybyj ／ myeyi ／ m 　 　 　 ifye ＞ yb 　 　 　 　 矢量 在 区域 其 矢量 斜率 值为 Bix 　 　 　 else 　 　 　 　 矢量 在 区域 其 矢量 斜率 值为 Bix 　 　 由 矢量 斜率 定义 通过 对 求得 的 矢量 斜率 值加 或 减 的 操作 将 其值 调整 到 主值 区间 内 实际上 Biy 为 矢量 斜率 值 定义 中 的 、 区域 中 的 B 值 Bix 为 、 区域 中 的 B 值 xbyb 为 前面 的 （ m ＋ ） 个点 的 重心 位置 xeye 为 后面 的 （ m ＋ ） 个点 的 重心 位置 对于 数据 开始 和 结尾处 的 一些 点 所 形成 的 SYi 集合 其点 的 数目 小于 M 可不 考虑 这些 点将 Bi 加入 到 数据链 得到 一个 新 的 数据链 SxiyiBim ≤ i ＜ Nm 　 　 　 　 　 　 　 　 　 　 　 　 （ ） 　 　 步骤 根据 预先 给定 的 偏差 E 选取 一个 门 限值 T ＞ 对 数据链 式 （ ） 中 每 一个点 可求 出 由 其 邻近 点 所 形成 的 子集 Si 在 这个 最大 子 集中 每 一个点 都 满足 以下 两个 条件 　 　 （ ） ｜ BjBi ｜ ＜ TBj ∈ Sij ≠ i 　 　 （ ） 子 集中 的 每 一点 与 当前 点 相连 　 　 找到 数据链 式 （ ） 中 的 最大 邻域 子集 记为 S 并 将 其 所 包含 的 数据 点 从 数据链 中 分割 出去 然后 在 剩余 的 数据链 中 继续 寻找 最大 的 邻域 子集 记为 S 将 其 包含 的 数据 从 数据链 中 分割 出去 重复 以上 操作 直到 数据链 中 的 所有 数据 都 被 分割 出去 这样 我们 就 获得 了 一个 新 的 集合 SSS 且 S ∪ S ∪ S ∪ SSi ∩ Sjj ≠ i 　 　 　 　 　 （ ） 　 　 步骤 将 链表 （ ） 中 的 各 数据 段 按 路径 S 的 顺序 重新 进行 排序 删掉 点数 小于 × m 的 数据 段 对于 每个 数据 段头 、 尾 各 去掉 m 个 数据 然后 对 每 一个 数据 段 对 xy 坐标 点用 最小 二 乘法 进行 线性 拟合 将 拟合 所得 的 直线 按 每 对 相邻 直线 相交 求得 顶点 用 起点 坐标 和 终点 坐标 对 相应 直线 作 垂直线 求得 交点 作为 线段 的 两个 端点 将 端点 和 顶点 连接起来 就 构成 了 分段 线性 拟合 算法 分析 　 　 本文 算法 的 基本 思想 就是 通过 曲线 的 斜率 值 的 变化 将 数据 分割 成 数据 段 对 每段 数据 用 最小 二 乘法 做 （ xy ） 的 线性 拟合 连接 所得 的 线段 就 得到 了 最后 的 结果 算法 思想 简单 容易 实现 下面 就 几种 图形 来 对 算法 的 特点 作 一些 分析 　 　 图 a 为 以 矩形 图形 形成 的 函数 图 b 为 矩形 函数 各段 的 矢量 斜率 与 路径 S 的 关系 曲线 从此 例 可以 看到 本 算法 可 应用 于 传统 斜率 为 零 的 场合 　 　 　 　 　 　 　 　 　 a 　 函数 矩形 图形 　 　 　 　 　 　 　 b 　 矩形 各边 的 矢量 斜率 与 路径 S 的 关系 曲线 方向 ABCDA 图 　 矩形 图形 的 拟合 　 　 下面 使用 图 所示 的 函数 来 分析 算法 的 精度 对图 的 函数 作 了 噪声 水平 为 的 实验 来 比较 本文 算法 与 吴 立德 的 算法 ［ ］ 的 精度 情况 取 N 个 数据 点 对 给定 的 数据 点 xiyi 加入 干扰 ε i 其中 ε i ≤ i ≤ N 是 独立 的 N δ 分布 的 随机变量 其中 干扰 是 按 直线 法向 方向 加入 的 即 x ′ ixi ε icos θ y ′ iyi ε isin θ 其中 x ′ iy ′ i 为 加入 干扰 后 的 数据 点 θ 为 法线 与 x 轴 的 交角 取 δ 分别 用 吴 立德 的 算法 和 本文 提出 的 算法 进行 拟合 求取 顶点 结果 如表 所示 从表 可以 看到 本文 的 算法 较之 吴 立德 的 算法 精度 有 很大 的 改进 图 　 函数 方向 ABCD 表 真实 值 xy 吴 立德 的 算法 δ TMxy 本文 的 算法 δ TMxy 　 　 从 以上 分析 中 看到 本文 算法 有 以下 特点 （ ） 使用 的 斜率 值 范围 是 （ ～ ） （ ） 斜率 值 与 角度 α 基本 成 线性关系 （ ） 可 应用 于 任意 图形 （ ） 算法 精度 较 好 　 　 最后 给出 一个 具体 实例 它 是 我们 在 开发 集成电路 图像 版图 提取 系统 过程 中 遇到 的 一个 有源 区 边缘 图像 图 a 是 一个 分离出来 的 二值 有源 区 边缘 图像 图 b 是 其 细化 后 的 图像 图 c 为 拟合 后 的 多边形 图形 　 　 　 　 　 　 　 　 　 a 分离出来 的 多边形 图像 　 　 　 　 b 细化 后 的 图像 图形 　 　 　 　 　 　 　 c 拟合 图形 图 　 实例 参数 选取 及 算法 复杂度 分析 　 　 算法 中有 两个 参数 M 和 T ［ ］ 它们 选择 的 好坏 直接 影响 算法 的 精度 非常 重要 参数 M 的 选取 与 噪声 干扰 和 运算 速度 有关 M 选取 较大 在 一定 程度 内 可抑制 噪声 但 将 花费 更 多 的 机时 同时 M 选取 较大 会 抑制 拐角处 点 斜率 的 变化 M 选取 较 小 运算 速度 可 提高 但 对 噪声 的 抑制 将 降低 使用 时 可 根据 具体情况 来 设定 一般 可 在 、 、 、 等 较 小 的 值 中 选取 T 的 选取 与 最后 的 拟合 精度 有 很大 的 关系 T 选 取得 小 精度 可 提高 但 线段 的 数目 将 增加 而 T 较大 线段 的 数目 虽然 可以 减少 但 精度 却会 下降 所以 T 值 的 选择 可视 具体情况 来 决定 　 　 本 算法 采用 最大 邻域 聚类 的 方法 进行 分组 提高 了 拟合 精度 下面 分析 本文 算法 的 时间 杂度 设 N 为 总 的 数据 点数 由 第节 算法 步骤 可 求得 步骤 的 运算 复杂度 为 CNC 是 与 M 有关 的 常数 在 步骤 中当 计算 当前 点 的 最大 邻域 时 可 完成 其 相邻 点 的 最大 邻域 的 部分 搜索 例如 假设 S 点 与 T 点 相邻 当 S 点 向 T 点 方向 搜索 时 它 在 这 一 方向 所 包含 的 最大 邻域 点 除去 T 点 之外 均 包含 在 T 点 在 这个 方向 的 最大 邻域 中当 搜索 T 点 在 这个 方向 的 邻域 时 只 需 在 前 一次 基础 上 搜索 即可 这样 时间 复杂度 得到 大幅度 下降 其 时间 复杂度 可 近似 为 CNC 为 常数 步骤 中 的 排序 和 删除 可 同时 进行 即先 找到 一个 最大 集 然后 将 剩下 点中 包含 于 最大 集中 的 点 全部 删除 然后 对 剩下 的 点 重复 上述 操作 其 时间 复杂度 为 CNC 与 线段 个数 有关 可 看作 常数 故此 总 的 时间 复杂度 为 CCCN 算法 时间 复杂度 为 线性 结论 　 　 本文 介绍 了 一种 基于 矢量 斜率 和 统计 模型 的 平面 数据 点 分段 线性 拟合 算法 它 与 以前 此类 算法 相比 算法 的 精度 有 很大 的 提高 可 适用 于 任意 图形 算法 思想 简单 时间 复杂度 为 线性 且 程序 容易 实现 这一 算法 已 被 用于 我们 所 设计 的 集成电路 图像 版图 计算机辅助 识别系统 中 并 取得 了 满意 的 效果 作者 介绍 ： 王明 江年生 博士生 主要 研究 领域 为 图像 理解 集成电路 逆向 设计 系统 的 开发 　 　 　 　 　 唐璞山 年生 教授 博士生 导师 主要 研究 领域 为 集成电路 布局 布线 本文 通讯联系 人 王明 江 ， 上海复旦大学 电子 工程系 CAD 室 作者 单位 ： 王明 江唐 璞 山 　 复旦大学 电子 工程系 上海 参考文献 　 ［ ］ ArelliCMassarottiAOntheparallelgenerationofstraightdigitallinesComputerVisionGraphicsandImageProcessing ～ 　 ［ ］ 吴 立德 计算机 视觉 上海复旦大学 出版社 WuLideComputerVisionShanghaiFudanUniversityPress 　 ［ ］ HakimiSLFittingpolygonalfunctionstoasetofpointsintheplaneGraphicalModelsandImageProcessing ～ 　 ［ ］ HiroshiAoyamaMasahiroKawagoeApiecewiselinearapproximationmethodpreservingvisualfeaturepointsoforiginalfiguresGraphicalModelsandImageProcessingSept ～ 本文 收到 原稿 收到 修改稿