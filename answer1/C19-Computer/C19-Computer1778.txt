软件 学报 JOURNALOFSOFTWARE 年 第期 第卷 VolNo 支票 容错 识别系统 预处理 的 设计 与 实现 赵斌 马赓 坚夏绍 玮 　 　 摘要 　 文章 在 支票 容错 识别系统 的 基础 上 介绍 了 预处理 算法 的 设计 与 实现 包括 软件 定位 、 各 单元 子图 的 提取 与 背景 去除 、 倾斜 校正 处理 、 方格 去除 和 字符串 分割 等 其中 的 重点 是 软件 定位 和 倾斜 校正 两个 预处理 算法 　 　 关键词 　 预处理 模式识别 表格 处理 文档 分析 　 　 中图法 分类号 　 TP 　 DesignandImplementationofPreprocessinginFaulttolerantBankcheckRecognitionSystemZHAOBinMAGengjianXIAShaoweiDepartmentofAutomationTsinghuaUniversityBeijing 　 　 Abstract 　 BasedonthefaulttolerantbankcheckrecognitionsystemFBRSdesignandimplementationofthepreprocessingmethodsareproposedinthispaperwhichincludesoftwarelocatingalgorithmextractinganderasingbackgroundofeachsubimageskewcorrectionofeachsubimagedeletingrestrictingrectangleframeofsomesubimagesandsegmentationofcharactersstringAmongthemthesoftwarelocatingalgorithmandskewcorrectionarediscussedindetail 　 　 Keywords 　 Preprocessingpatternrecognitionformprocessingdocumentanalysis 　 　 支票 的 自动识别 与 处理 是 银行 自动化 的 一个 重要 研究课题 它 不仅 技术含量 高 而且 具有 重大 的 实用 意义 与 商业价值 国内外 不少 研究者 已经 建立 了 一些 支票 处理 系统对 支票 的 识别 已 获得 一定 的 成果 ［ ］ 　 　 图是 带有 动态 密码 的 银行 支票 样张 通常 有个 部分 需要 进行 处理 图 带有 动态 密码 的 银行 支票 样张 　 　 针对 带有 动态 密码 的 银行 支票 我们 设计 了 能 自动 处理 银行 支票 的 支票 容错 识别系统 （ faulttolerantbankcheckrecognitionsystem 简称 FBRS ） 系统 由预 处理器 、 字符识别 器 和 后 处理器 组成 其中 预 处理器 处于 系统 最 前端 它 对 字符识别 器 的 影响 很大 其 重要性 是 显而易见 的 　 　 我们 已经 实现 可以 处理 支票 日期 、 数字 金额 和 密码 个 部分 的 FBRS 原型 系统 ［ ］ 本文 将 基于 原型 系统 研究 预处理 算法 的 设计 与 实现 首先 对 FBRS 的 预 处理器 进行 总体 介绍 然后 重点 叙述 预处理 算法 中 软件 定位 和 图像 倾斜 校正 两个 部分 最后 是 一个 预处理 实例 与 结论 FBRS 的 预 处理器 　 　 FBRS 的 预 处理器 由 软件 定位 、 各 单元 子图 提取 及 背景 去除 、 倾斜 校正 、 方格 去除 、 灰度 子图 二值化 、 子图 字符串 分割 等 模块 组成 ［ ］ 如图所示 图 　 FBRS 的 预处 是 器 构成 软件 定位 　 　 尽管 系统 在 硬件 基础 上 进行 了 特定 处理 使 录入 的 整张 支票 图像 具有 大体一致 的 扫描 区域 和 位置 但 很多 后续 算法 对 各 部分 图像 位置 很 敏感 在 进行 其他 处理 前 必须 对 图像 进行 精确 到 像素 级 的 定位 处理 各 单元 子图 提取 及 背景 去除 　 　 根据 支票 上 每个 待处理 部分 在 整张 支票 图像 中 的 区域 将 各 部分 图像 提取 出来 去除 背景噪声 和 干扰 形成 各自 区域 的 级 灰度 图像 称为 子 图设 所 提取 子图 的 矩形 点阵 大小 为 W × HW 为 点阵 宽度 （ 列数 ） H 为 点阵 高度 （ 行 数 ） 设 每个 像素点 元素 为 Dij 其中 i 为 像素点 的 水平 坐标 j 为 垂直 坐标 满足 ≤ Dij ≤ iWjH 各 单元 子图 的 倾斜 校正 　 　 扫描 录入 的 图像 难免 有 一定 的 倾斜度 系统 对于 特别 小 的 倾斜度 大约 在 ± ° 以内 可以 自动 适应 无需 校正 处理 一般而言 对于 倾斜度 在 ± ° 范围 内 就要 系统 进行 倾斜 校正 处理 了 对 更 大 的 倾斜度 由于 倾斜 校正 运算量 大会 产生 较大 的 误差 和 失真 建议 将 支票 图像 重新 扫描 录入 数字 金额 子图 和 密码子 图 的 方格 去除 　 　 支票 上 的 数字 金额 和 密码 都 书写 在 一定 大小 和 数目 的 方格 串里 FBRS 要 把 数字 金额 和 密码子 图 的 限制 方格 去掉 经过 倾斜 校正 的 图像 直接 利用 它 的 垂直 投影 和 水平 投影 轮廓线 就 可以 得到 方格 线 的 位置 和 粗细 在 提取 的 单元 子图 上 按照 方格 的 位置 和 大小 把 方格 线 去掉 便 得到 删除 了 方格 的 支票 金额 和 密码 图像 灰度 子图 二值化 　 　 二值化 处理 是 把 灰度 图像 信号 变换 成二值 （ 、 ） 的 数字信号 点阵 像素 经过 二值化 处理 后 为 Bij 其中 iWjHW 为 点阵 图像 宽 H 为 点阵 图像 高 　 　 二值化 方法 通常 有 整体 阈值 法和自 适应 的 动态 阈值 法 ［ ］ 实际 处理 的 图像 比较复杂 如 从 银行 支票 上 提取 手写 字符 时 需要 抑制 污点 和 噪声 背景 为了 能够 更好 地 适应 书写 质量 差 或 背景 情况 复杂 的 图像 我们 使用 了 动态 阈值 法子 图 字符串 分割 　 　 子图 字符串 分割 是 把 各个 单元 子图 中 的 字符串 分成 单 字符 图像 的 处理过程 支票 的 金额 子图 和 密码子 图 经过 方格 去除 处理 后 和 日期 的 子 图 一样 可以 运用 字符 数目 未知 的 无约束 手写体 数字 的 分割 算法 来 进行 字符串 分割 字符串 分割 的 算法 比较复杂 这里 不 详细 介绍 可 参见 文献 ［ ］ 软件 定位 基本概念 　 　 在 整张 支票 图像 中 （ 如图所示 ） 支票 数字 金额 和 汉字 金额 被 几乎 横贯 整张 支票 的 矩形 方格 框起来 该 矩形 称为 定位 矩形 这是 整张 支票 图像 中 最为 突出 的 标志 之一 定位 矩形 的 左上角 顶点 称为 左 上 定位点 定位 矩形 的 右上角 顶点 称为 右 上 定位点 　 　 分别 找到 定位 矩形 的 左上 定位点 和 右 上 定位点 再 根据 对 该 类型 支票 上 定位 矩形 和 其他 各个 待处理 部分 相互 的 几何 位置 关系 把 其他 部分 的 区域 推算出来 就 可 完成 整张 支票 图像 的 定位 为此 我们 分别 构造 了 如图所示 大小 为 × K × × K 的 定位 模板 T 和 定位 模板 T 　 　 　 　 　 定位 模板 T 　 　 　 　 　 　 　 　 　 　 　 　 定位 模板 T 图 　 定位 模板 定义 　 　 设 模板 中 的 元素 为 TijiKKjKK 其中 i 为 水平 坐标 j 为 垂直 坐标 定位 模板 T 中 各个 元素 取值 定义 如下 　 　 类似 定位 模板 对于 定位 模板 T 的 各 元素 ， 有 　 　 定义 在 模板 中 相应 于 ij 的 元素 称为 该 模板 的 模板 中心点 左 上 定位点 的 基本 算法 　 　 在 整张 支票 图像 上 初始化 一个 包含 左 上 定位点 的 搜索 区域 Ds 该 区域 大小 为 W × HW 和 H 分别 为 搜索 区域 Ds 的 宽度 和 高度 如果 从 左上 定位点 出发 分别 沿 水平 和 垂直 方向 各作 两条 方向 相反 的 射线 形成 水平 和 垂直 交叉 的 “ ” 字 形状 的 条 射线 在 这条 射线 上 被 左方 和 上方 这 两条 射线 所 覆盖 的 图像 点 绝大部分 由 背景 点 构成 而 右方 和 下方 这 两条 射线 上 所 覆盖 的 图像 点 绝大部分 由 矩形 方框 前 景点 构成 据此 构造 并 定义 量化 指标 qxy 　 　 对 在 所 初始化 的 搜索 区域 内 的 每个 像素点 Pxy 进行 遍历 先 让 模板 中心点 与 该点 P 重合 然后 在 搜索 范围 内 应用 T 按式 进行 卷积 运算 得到 点 Pxy 的 量化 指标 qxy 搜索 区域 内 具有 最大 量化 指标 q 的 像素点 Pxy 就是 我们 所 要 寻找 的 左上 定位点 设点 P 的 横坐标 为 x 纵坐标 为 y 量化 指标 为 整个 搜索 区域 中 的 最大 量化 指标 q 则 遍历 搜索算法 可以 表示 为 改进 算法 　 　 定位 矩形 在 整张 支票 图像 中 所 具有 的 全局 特性 不会 因为 图像 分辨率 的 改变 而 发生 较大 的 改变 由此 得到 提示 在 搜索算法 中 采用 隔点 采样 可以 使 数据量 和 运算量 大大减少 同时 提高 计算速度 　 　 对 基本 算法 的 改进 分成 两个 部分 首先 对 量化 指标 qxy 的 计算 进行 改进 其中 K ′ ［ K ］ 符号 ［ ］ 表示 取 整数 运算 改进 后 计算 量 将 减少 一半 　 　 搜索算法 也 同样 需要 进行 改进 其中 x ′ ［ x ］ y ′ ［ y ］ 改进 后 的 运算量 将 减少 为 原来 的 四分之一 　 　 参考 图 的 改进 算法 定位 模板 T ′ 相应 于 T ′ 量化 指标 qxy 计算公式 为 其中 K ′ 的 定义 同式 图 　 改进 算法 的 定位 模板 T ＇ 算法 分析 　 　 由于 右 上 定位点 与 左上 定位点 有 相似 特征 前述 对 左上 定位点 的 分析 说明 对右 上 定位点 也 有 类似 结论 而且 对右 上 定位点 的 基本 算法 也 可以 类似 地 加以改进 　 　 文献 ［ ］ 中 简单 综述 了 文档 处理 中类 常用 的 图像 倾斜 检测 和 校正 的 算法 运用 投影 轮廓 的 方法 使用 Hough 变换 技术 基于 Fourier 变换 的 方法 用 最近 邻 分类 用 相关性 的 方法 上述 种 算法 一般 从 整幅 文本 图像 中 定位 一条 直线 来 达到 定位 的 目的 有 的 方法 对 噪声 特别 敏感 有的是 从 图像 的 全局 特征 出发 因而 抗干扰性 能 好 但是 运算量 通常 很大 比较而言 我们 提供 的 定位 算法 具有 计算 量 小 、 运算 速度 快 、 定位 准确 等 优点 各 单元 子图 的 倾斜 校正 　 　 左 上 定位点 和 右 上 定位点 所 形成 的 直线 的 倾斜 程度 代表 了 整张 支票 图像 的 倾斜度 系统 按照 这个 倾斜 角度 对 各个 子图 进行 倾斜 校正 处理 　 　 首先 介绍 计算机 图形学 中 平移 和 旋转变换 的 基础知识 ［ ］ 平移 把 平面 直角坐标 系上 的 点 Axy 平移 到 点 A ′ x ′ y ′ 如图 a 所示 用 笛卡尔 坐标 表示 为 旋转 把 平面 直角坐标 系上 的 点 Axy 绕 原点 O 逆时针 旋转 θ 角变 到 A ′ x ′ y ′ 如图 b 所示 用 笛卡尔 坐标 表示 为 　 　 　 a 平移变换 　 　 　 　 　 　 　 b 旋转变换 图 　 平移 和 旋转变换 图示 算法 介绍 　 　 文献 ［ ］ 介绍 了 对 任意 倾斜 角度 的 校正 方法 校正 后 的 图像 质量 很 高 但 不足之处 是 时间 开销 较大 对于 小 角度 倾斜 图像 可以 使用 下面 介绍 的 近似算法 来 完成 校正 功能 设 定位 算法 找到 的 左上 定位点 和 右 上 定位点 的 坐标 分别 为 Pxy 和 Pxy 则 整幅 支票 图像 的 倾斜角 为 对于 比较 小 的 倾斜 角度 θ 有式 中 整数 K ［ tan θ ］ ［ ］ 表示 取整 运算 所以 有 展开 得 　 　 以 K 为 步长 来 等 分 图像 则 原 图像 将 被 分成 ［ WK ］ ［ HK ］ 个 大小 为 KK 的 正方形 和 在 边缘 上 数目 不定 的 小 矩形 如图所示 假设 某个 正方形 （ 或者 矩形 ） 的 图像 块 左下角 点 坐标 为 AaKbK 其中 a 的 取值 范围 是 ［ WK ］ b 的 取值 范围 是 ［ HK ］ 该 图像 块 中 任意 一点 坐标 设为 PaKubKv ＜ u ＜ K ＜ v ＜ K 代入 式 并 取整 得 图 　 录入 图像 的 等 分 示意图 　 　 对比 式 对于 图像 块 中 的 每个 点 图像 旋转 相当于 把 它 的 坐标 按式 进行 平移变换 这样 就 把 旋转变换 转化成 平移变换 对 同一个 图像 块 中 的 所有 像素点 公式 中 的 变量 a 和 b 都 是 相同 的 所以 直接 对 正方形 （ 或 矩形 ） 小 图像 块 进行 整体 平移 本 算法 的 不足之处 是 平移 处理 会 使 相邻 图像 块 的 交接处 出现 一个 像素 的 错位 在 实际 支票 图像 中 这种 仅仅 在 一个 像素 范围 内 的 错位 对系统 几乎 没有 任何 影响 　 　 对于 倾斜 角度 θ 在 ° ～ ° 范围 内 的 图像 ， 可以 用 上述 小 倾斜 角度 的 改进 算法 予以 校正 大量 实验 表明 ， 对于 FBRS 提取 和 识别 支票 填写 的 内容 来说 这种 方法 已经 能 满足 实用化 的 要求 实例 及 结论 　 　 我们 以图 的 银行 支票 样张 作为 实例 来 总结 本文 所 介绍 的 预处理 内容 和 方法 图 所示 是 软件 定位 处理结果 图是 对 日期 子图 的 提取 与 分割 图是 对 金额 和 密码子 图 的 预处理 过程 图 软件 定位 　 图 　 日期 子图 的 提取 与 分割 图 　 对 支票 密码 和 支票 金额 的 预处理 　 　 通过 文中 介绍 的 预处理 方法 完成 对 支票 图像 的 软件 定位 、 各 单元 子图 的 提取 和 背景 去除 、 倾斜 校正 、 方格 去除 、 二值化 和 数字串 分割 可以 得到 单个 数字 字符 的 图像 点阵 直接 送入 单 字符识别 器 进行 识别 在 预 处理器 的 基础 上 加上 其他 必要 的 识别 功能 构件 就 构成 FBRS 的 原型 系统 这项 工作 在 国家自然科学基金 的 支持 下 已经 基本 完成 致谢 本文 的 研究 工作 得到 国家自然科学基金 资助 ， 此 项目编号 为 　 本文 研究 得到 国家自然科学基金 资助 作者简介 　 赵斌 年生 博士生 主要 研究 领域 为 模式识别 人工神经网络 图像处理 系统工程 　 　 　 　 　 马赓 坚年生 博士生 ， 主要 研究 领域 为 模式识别 人工神经网络 系统工程 　 　 　 　 　 夏绍玮 女年生 教授 博士生 导师 主要 研究 领域 为 神经网络 模式识别 决策支持系统 系统 科学 ， 系统工程 本文 通讯联系 人 赵斌 ， 北京 清华大学 自动化系 作者 单位 ： 清华大学 自动化系 　 北京 　 参考文献 ImpedovoSWangPSPBunkeHAutomaticBankcheckProcessingSingaporeWorldScientificWangSongZhaoBinMaFengetalAfaulttolerantChinesebankcheckrecognitionsystemInProceedingsofIEEEInternationalConferenceonIntelligenceProcessingSystemsNewYorkIEEEInc ～ 胡家 忠 计算机 文字 识别 技术 北京 气象 出版社 HuJiazhongComputerCharacterRecognitionTechnologiesBeijingWeatherPressZhaoBinSuHuiXiaShaoweiAnewmethodforsegmentingunconstrainedhandwrittennumeralstringInProceedingsofthethInternationalConferenceonDocumentAnalysisandRecognitionLosAlamitosIEEEComputerSocietyPress ～ SunChangmingSiDeyiSkewandslantcorrectionfordocumentimagesusinggradientdirectionInProceedingsofthethInternationalConferenceonDocumentAnalysisandRecognitionLosAlamitosIEEEComputerSocietyPress ～ 卢传贤 等 实用 计算机 图形学 峨眉山 西南 交通 大学 出版社 LuChuanxianetalPracticalComputerGraphicsEmeishanSouthwestCommunicationUniversityPress 本文 收到 原稿 收到 修改稿