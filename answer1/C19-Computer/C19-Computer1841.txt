微型机 与 应用 MICROCOMPUTERITSAPPLICATIONSVolNoP 工商企业 IC卡 的 技术开发 易智雄 摘要 ： IC卡 的 基础知识 及 读写 IC卡 的 编程 方法 ， 以 工商企业 IC卡 系统 为例 ， 介绍 了 IC卡 管理系统 的 开发 。 关键词 ： IC卡 数据库 IC卡 读写 　 　 IC卡 年 诞生 于 法国 ， 多 年间 ， 其 应用领域 不断扩大 。 国际标准化组织 从 年 开始 ， 相继 制定 和 颁布 了 IC卡 的 国际标准 ： ISO ， － ， － ， － ， － ， 为 IC卡 的 进一步 发展 普及 创造 了 条件 。 　 　 IC卡 是 一种 集成电路 卡 ， 它 是 随着 半导体技术 的 发展 以及 社会 对 信息 的 安全性 和 存储容量 要求 的 日益 提高 应运而生 的 。 它 将 具有 微处理器 及 大容量 存储器 的 集成 芯片 嵌装于 塑料 基片 上 ， 它 的 外形 与 普通 的 信用卡 完全相同 。 按 其 内部 封装 的 芯片 的 种类 和 功能 可 分为 智能卡 （ SMARTCARD ） 和 存储卡 （ MEMORYCARD ） 。 存储卡 和 智能卡 的 区别 就 在于 存储器 内不含 微处理器 CPU ， 只 具有 一般 的 或 带有 逻辑 控制 的 存储 数据 信息 的 功能 。 　 　 IC卡 保密性 强 ， 安全性 高 。 它 具有 硬件安全 策略 ， 如果 试图 解密 将 造成 卡 的 自锁 或 自毁 。 IC卡 还有 存储量 大 、 使用方便 、 抗干扰 强 、 网络 要求 不 高等 特点 。 因此 虽然 IC卡 诞生 时间 不 长 ， 其 市场 就 已经 遍布 世界各地 ， 而 其 应用领域 也 从 最初 的 银行 信用卡 单一 领域 ， 渗透 于 包括 工商 、 税务 、 社会保险 、 医疗 、 电信 、 交通 、 企业 管理 等 领域 。 　 　 为 改善 行政 执行 手段 ， 实现 工商企业 信息 的 自动化 处理 、 传递 、 共享 和 交流 ， 年 ， 国家工商局 决定 进行 发行 工商企业 IC卡 的 试点工作 ， 制定 IC卡 全国 统一标准 ， 将 企业 登记注册 的 基本 资料 、 年检 信息 、 违法 违章 情况 写入 IC卡 中 ， 由 企业 自己 持有 。 因为 IC卡 具有 不可 伪造 的 特点 ， 并且 此 卡 全国 通用 ， 所以 可以 为 企业 提供 具有 防伪 功能 的 “ 电子 身份证 照 ” ， 有效 地 防止 伪造 营业执照 签订合同 的 经济 犯罪活动 ， 保护 企业 自身 利益 ， 同时 也 有利于 工商行政 管理 、 税务 、 银行 、 海关 、 技术 监督 等 部门 进行 检查 监管 工作 。 IC卡 的 读写 程序开发 ． IC卡 的 开发 环境 　 　 读 或 写 IC卡 所 需 的 硬件 配置 为 台 PC 电脑 ， 台 IC卡 读写 机 。 IC卡 读写 机 分为 内置式 和 外置式 种 。 外置式 IC卡 读写 机外 接 V 电源 ， 通过 RS － 串口 与 PC机 连接 。 内置式 读写 机 ， 外形尺寸 如 软驱 一样 ， 安装 于 PC机 软驱 支架 上 ， 使用 PC机 箱 电源 。 软件 配置 为 DOS 、 Windows ／ ， WindowsNT 等 操作系统 和 IC卡 读写 机 的 接口函数 库 。 IC卡 读写 机 的 制造厂 家 一般 提供 C 、 VB 、 Delphi ， Foxpro 、 Powerbuilder 等 语言 的 接口函数 库 。 ． IC卡 的 存储 区 及其 密码 　 　 一般而言 ， IC卡 的 存储 区分 为 若干个 应用 区 ， 或 称页 。 这些 应用 区 的 容量 可 相等 也 可不 相等 。 整个 IC卡 有个 卡 安全 密码 ， 称 为主 密码 。 必须 在 核对 此 密码 正确 后 ， 才能 读 或 写 IC卡 内 的 各 应用 区 。 每个 应用 区 都 有 个 读 密码 和 写 密码 。 当读 某 应用 区 的 存储 内容 时 ， 必须 验证 读 密码 正确 。 而 将 内容 写入 某 应用 区时 ， 必须 验证 读 密码 和 写 密码 都 正确 。 因此 ， 如果 某类 IC卡 内有 个 应用 区 ， 则 共有 个 密码 。 一般 地 ， 对于 有些 重要 应用 区 的 密码 ， IC卡 内 设有 对应 的 错误 计数器 ， 每 核对 密码 错误 一次 ， 计数器 自动 加 ， 如果 错误 次数 达到 IC卡 的 限定值 ， 例如 次 ， 则 此 卡片 以后 就 不能 再 使用 了 。 当 错误 次数 未 达到 限定值 ， 而 输入 了 正确 的 密码 后 ， 则 错误 计数器 自动 清零 。 　 　 IC卡 正式 交付使用 前 ， 还 必须 进行 熔断 操作 。 IC卡 经 熔断 后 ， 读写 密码 只能 进行 验证 ， 不能 再 读出来 显示 。 ． IC卡 读卡 编程 　 　 要 读出 IC卡 存储 的 内容 ， 需要 通过 调用 接口函数 库 提供 的 相应 函数 ， 依照 下列 步骤 进行 操作 ： 定义 引用 的 外部 函数 ， 检查 串口 是否 联好 ， 检查 是否 插卡 ， 给 卡上 电 ， 核对 卡 安全 密码 ， 核对 所 选区 的 读 密码 ， 读卡 ， 给 卡下 电 。 　 　 下面 以 VB ． forWin ／ 为例 给出 示范 程序 的 主要 语句 ， 为 简单 起 见 ， 我们 假设 每个 检测 都 成功 ， 以便 继续 下 一步 操作 。 ． IC卡 写卡 编程 　 　 写 IC卡 编程 ， 依照 以下 步骤 进行 操作 ： 　 　 定义 引用 的 外部 函数 ， 检查 串口 是否 联好 ， 检查 是否 插卡 ， 给 卡上 电 ， 初始化 各区 及其 密码 或 核对 卡主 安全 密码 ， 核对 所 选区 的 读 密码 、 写 密码 ， 写卡 ， 熔断 ， 给 卡下 电 。 　 　 程序 参照 读卡 部分 ， 个别 有所不同 ， 如 ： 　 　 写卡 ： dd ＝ icc ＿ write （ com ， ″ 企业 名称 ″ ， ， ） 　 　 熔断 为 ： dd ＝ blown ＿ fuse （ com ） 工商企业 IC卡 系统 开发 　 　 工商企业 IC卡 系统 是 以 IC卡 技术 为 核心 ， 以 工商行政 管理 数据库 和 计算机网络 为 基础 ， 面向 工商行政 管理 部门 的 一项 信息 自动化 处理 工程 。 以 广州市 工商企业 IC卡 系统 为例 ， 我们 建立 起以 台 双 CPU 的 Dell 机作 服务器 ， 台 微机 作 工作站 的 基于 Client ／ Server 模式 的 计算机网络 系统 ， 网络操作系统 选用 WindowsNT ． ， 数据库 管理系统 选用 MSSQLServer ． ／ ． ， 开发工具 采用 VisualBasic ， VisualFoxpro 等 。 工作站 使用 Windows ／ 。 ． 数据库 设计 　 　 我们 在 SQLServer 上 建立 了 个 数据库 ： 企业 资料库 和 制卡 数据库 。 企业 数据库 中 建立 内资 企业 、 外资企业 、 私营企业 、 行业 代码 表 、 企业 类型 代码 表等 十多张 表 。 制卡 数据库 中 建立 了 制卡 信息 表 、 用户组 表 、 用户 表 、 用户 权限 表等 。 其中 制卡 信息 表 存储 制卡 的 信息 ， 如制 卡 日期 、 数目 、 制卡人 等 。 　 　 在 数据库 中 建立 存储 过程 ， 供 前台 调用 。 下面 是 存储 过程 的 个 例子 ， 此 过程 用于 取某 卡号 的 信息 。 ． 系统 功能设计 　 　 前台 使用 VB 、 VisualFoxpro 编程 ， 通过 调 后台 存储 过程 和 数据库 实现 各项 功能 。 该 系统 设计 了 如下 功能 ： 　 　 数据 转换 ： 将 实时 的 Foxpro ． 企业 资料 数据库 转到 SQLServer 中 。 　 　 制卡 ： 通过 注册号 、 企业 名称 等 项目 从 后台 数据库 检索 出 企业 ， 将 此 企业 注册 资料 等 信息 写入 IC卡 。 　 　 读卡 ： 核对 密码 后 ， 读出 IC卡 信息 并 显示 出来 。 　 　 领卡 ： 企业 来领 IC卡 ， 读卡 并 在 后台 数据库 作 登记 。 　 　 查卡 ： 查 某个 企业 是否 已制 卡 、 已 领卡 。 　 　 人员 管理 ： 设置 操作 人员 权限 。 　 　 统计 ： 按 企业 类型 、 时间 范围 、 操作 人员 等 类别 对 制卡 信息 进行 统计 。 　 　 IC卡 的 安全 可靠性 和 大容量 的 特点 ， 使 其 在 应用 中 对 计算机网络 的 要求 不高 ， 有利于 在 未 联网 的 环境 中 使用 ， 其 应用领域 也 将 越来越 广 。 广州市 工商企业 IC卡 系统 的 投入使用 ， 完成 了 对 全市 的 内资 、 外资 、 私营企业 发行 IC卡 的 工作 ， 加强 了 工商企业 的 监督管理 力度 ， 取得 较 好 的 社会效益 。 易智雄 （ 广州市 工商局 经济 信息中心 ） 参考文献 ， JerkeN ． VisualBasic 开发人员 指南 ． 北京 ： 机械 工业 出版社 ， ， Microsoft ． MicrosoftSQLServer ． 管理员 指南 ． 北京 ： 科学出版社 ， 收稿 日期 ： － －