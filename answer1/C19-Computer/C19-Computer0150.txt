微型 电脑 应用 MICROCOMPUTERAPPLICATIONS 　 Vol 　 No 　 PWEB 站点 中 电子 论坛 的 实现 徐萍 摘 　 要 ： 本文 利用 微软 的 IIS 中 提供 的 IDC 技术 ， 将 Web 服务器 与 数据库系统 连接 ， 较 详细 地 叙述 了 在 Web 站点 中 实现 完全 从 底层 架构 起来 的 电子 论坛 的 程序实现 ， 以 使 浏览器 用户 实时 地 互相 交流信息 。 关键词 ： Internet 　 Internet 数据库 连接器 　 电子 论坛 SQL 语句 Abstract ： ThispaperdescribestheconnectionofaWebserverwithadatabasesystemusingtheIDCtechnologyofMicrosoftInternetInformationServerIISItpresentsindetailtheprogrammingmethodofcompletebottomupimplementationofelectronicforumsonWebsitesUserscanexchangeinformationinrealtimeonthebrowserinsuchasystemKeywords ： Internet 　 Internetdatabaseconnection 　 electronicforumSQLstatement ▲ 一 、 引言 　 　 WWW 技术 的 问世 ， 给 Internet 带来 了 新 的 活力 ， 使 Internet 的 用户数 有 了 爆炸性 的 增长 ， 各 企业 纷纷 建立 企业 内部网 ， 拥有 了 自己 的 WEB 站点 。 电子 公告牌 系统 BBS 一直 是 Internet 上 最为 主要 的 一项 服务 ， 在 这 上面 用户 可以 张贴 文章 ， 阅读 别人 的 作品 ， 获得 网友 热心 提供 的 最新消息 ， 寻求 问题 的 解答 ， 是 网络 人 的 良师益友 。 由于 WWW 的 优异 性能 ， 产生 了 基于 WEB 站点 的 电子 公告牌 系统 WWWBBS ， 或 称为 电子 论坛 ， 对比 基于 Telnet 的 InternetBBS ， 电子 论坛 具有 访问速度 快 、 服务器 负载 小 、 表现力 丰富 、 使用方便 等 优点 ， 目前 许多 WEB 站点 都 已 提供 电子 论坛 服务 。 　 　 在 Web 服务器 中 ， Microsoft 公司 的 Internet 信息 服务器 — — IIS 是 当今 WindowsNT 操作系统 平台 上 使用 得 最 多 的 Web 服务器软件 。 IIS 提供 了 Internet 数据库 连接器 IDC ， IDC 技术 提供 了 一种 使 数据库 内容 得以 在 Internet 上 发布 并 与 用户 进行 交互 的 方法 ， 它 只要 编程 者 具有 HTML 和 SQL 结构化 查询语言 的 知识 ， 而 不 需要 任何 C 、 DLL 及 类似 的 编程语言 概念 。 构成 IDC 应用程序 的 文件 是 解释性 的 ， 提供 快速 的 开发 循环 和 反馈 。 IDC 这种 简单 高效 的 特性 ， 让 编程 者 在 相对 短 的 时间 内 建立 应用程序 ， 对于 一些 无需 进行 复杂 验证 的 应用程序 或 部门 应用程序 ， IDC 是 较 合适 的 编程 工具 。 　 　 我们 利用 IDC 技术 、 Access 数据库 管理系统 实现 了 完全 从 底层 架构 起来 的 WWWBBS ， 在 校园 Intranet 网上 开辟 了 一些 讨论 话题 以及 聊天室 等 功能 服务 。 二 、 程序 功能 简介 　 　 整个 电子 论坛 程序 具有 四大 功能 ： 　 　 用户 登录 功能 ： 允许 新 用户 随时 注册 、 已 注册 用户 登录 ， 禁止 未 授权 用户 登录 。 　 　 消息 浏览 功能 ： 将 消息 分成 几个 议题 ， 在 这些 议题 中 ， 消息 形成 线程 ， 使 在 一个 议题 的 消息 列表 中 ， 每 一条 消息 下 都 跟 随着 相关 的 反馈 消息 。 　 　 发布 新 消息 功能 ： 用户 可以 在 议题 消息 列表 中 发送 新 话题 新 话题 出现 在 议题 分层 结构 的 第一层 或 对 某 已 存在 的 消息 发布 反馈 消息 ， 反馈 消息 被列 在 被 反馈 消息 之下 ， 缩进 排列 。 　 　 主题 搜索 功能 ： 用户 可以 在 一个 议题 或 一组 议题 中 搜索 任意 的 子 字符串 ， 整个 搜索 结果 被 分成 条 消息 一组 ， 用户 可以 分组 浏览 搜索 结果 。 　 　 本 程序运行 的 服务器 环境 为 ： WindowsNTIISAccess 工作站 环境 为 ： WindowsIE ， 程序运行 良好 。 三 、 数据库 设计 　 　 用 Access 建立 数据库 netmdb 表中 各字段 作用 如下 ： 　 　 消息 表 messagesMessageid 消息 标识符 、 Messagesubject 消息 主题 、 Messagetext 消息 正文 、 Userid 消息 作者 的 用户 标识符 、 Messagets 发消息 的 时间 、 Conferenceid 消息 所属 的 议题 标识符 、 Parentmessageid 若该 消息 为 另 一 消息 的 反馈 消息 ， 则 存放 父 消息 标识符 、 Numspace 消息 的 嵌套 深度 、 Displayordering 消息 列表 中 的 排序 机制 。 　 　 议题 表 conferencesConferenceid 议题 标识符 、 Conferencename 议题 名 。 　 　 用户 表 usersUserid 用户 标识符 、 Username 用户名 、 Useremail 用户 的 Email 地址 、 Userpassword 用户 口令 。 　 　 空白 表 spaces ： Numspaces 存放 空格 字符串 中 空格 的 数量 ， 与 消息 表中 的 Numspace 对应 、 Spacestring 存放 空格 字符串 。 　 　 其中 spaces 表 主要 用于 根据 消息 的 嵌套 深度 和 排序 机制 产生 缩进 所用 的 空格 字符串 。 四 、 配置 系统 数据源 　 　 打开 WindowsNT 控制面板 中 的 ODBC 程序 。 　 　 选择 SystemDSN 标签 。 　 　 单击 Add … 按钮 ， 出现 CreateNewDataSource 对话框 。 　 　 在 列表框 中选 MicrosoftAccessDriver ， 单击 Finish 按钮 。 　 　 在 DataSourceName 文本框 中 输入 dbmessagebase 。 　 　 单击 Select … 找到 netmdb 。 　 　 单击 OK ， 完成 设置 。 　 　 将 netmdb 数据库 设置 成 数据源 dbmessagebase 后 ， 只要 在 IDC 文件 中将 datasource 域 设为 dbmessagebase 即可 对 数据库 实施 SQL 语句 操作 。 五 、 程序流程 及 实现 　 　 图为 电子 论坛 程序 流程图 ， 图中 每 一个 框 代表 一个 网页 ， 每条 弧线 代表 要 一个 IDC 文件 来 完成 前 一页 的 数据处理 ， 收集 下 一页 需 显示 的 信息 ， 虚线 代表 超级链接 。 图 程序 流程图 　 　 登录 页 显示 欢迎 用户 进入 本 电子 论坛 ， 用户 输入 用户名 和 口令 ， 若 是 新 用户 则 请 他们 先 注册 。 该页 的 HTM 文件 中 的 表单 可 将 用户 输入 的 用户名 和 口令 存入 inputuserid 和 inputuserpw 两 变量 中 ， 按 “ 确定 ” 按钮 启动 mainscreenidc 文件 。 该 IDC 文件 根据 inputuserid 和 inputuserpw 的 值 查询 users 表中 是否 有 相应 的 用户 记录 。 同时 在 conferences 表中 检索 所有 的 议题 名及 议题 标识符 ， 以供 “ 主屏 ” 页 显示 。 其 主要 语句 为 ： 　 　 templatemainscreenhtx 　 　 odbcoptionsSQLACCESSMODE 　 　 requiredparameterinputuseridinputuserpw 　 　 datasourcedbmessagebase 　 　 SQLStatementSELECTuseridusernameuseremailuserpasswordfromusers 　 　 whereusernameinputuseridanduserpasswordinputuserpw 　 　 SQLStatementSELECTconferenceidconferencenamefromconferences 　 　 执行 mainscreenidc 文件 的 结果 由 mainscreenhtx 文件 输出 ， 形成 “ 主屏 ” 页 。 该页 有 三个 特征 ： a 列出 用户 登录 全名 ， 若 登录 有误 ， 则 显示 错误信息 及 回到 登录 页 的 超级链接 。 bCombobox 组合 框 和 “ 查看 ” 按钮 允许 用户 选 议题 阅读 。 c “ 查找 ” 按钮 允许 用户 使用 程序 的 搜索 功能 。 其中 b 、 c 两项 需在 用户 登录 成功 后 才 显示 。 该页 的 HTX 文件 中 的 主要 语句 有 ： 　 　 formaction ” viemconfmessagesidc ” methodpost 　 　 begintailh 欢迎 username 朋友 henddetail 　 　 ifcurrentrecordeq 　 　 h 对不起 ， 您 的 登录 有误 ， 请 ahrefmessagebasehtm 重试 ahformelse 　 　 selectnameconferencenamesize 　 　 begindetailoptionconferencenameenddetailinputtypesubmitualue 查看 formformactionsearchidcmethodpost 　 　 h 按 标题 查找 消息 h 　 　 begindetailinputtypehiddennameuseridvalueuserid 　 　 enddetail 　 　 inputtypesubmitvalue 查找 form 　 　 在 “ 主屏 ” 页 中 ， 用户 选择 某 议题 后 单击 “ 查看 ” 按钮 执行 viewconfmessagesidc 文件 ， 该 文件 完成 在 库 中 查询 指定 议题 中 的 所有 消息 功能 ， 其 主要 语句 有 ： 　 　 Datasourcedbmessagebase 　 　 Templateviewconfmessageshtx 　 　 SQLStatementSELECTDISTINCTROWspacingspacestringmessages 　 　 messagesubjectASexprlusersusernamemessagesmessagetsmessagesmessageid 　 　 FROMconferencesinnerjoinusersINNERjoinlspacinginnerjoinmessages 　 　 onspaceingnumspacesmessagesnumspacesonusersusersidmessagesuserid 　 　 onconferencescoferenceidmessagesconferenceidwhereconferencesconferencename 　 　 conferencenameorderbymessagesdisplayordering 　 　 查询 所 得到 的 全部 消息 通过 viewconfmessageshtx 显示 出来 形成 “ 消息 列表 ” 页 。 　 　 “ 消息 列表 ” 页 有 四个 特征 ： a “ 刷新 ” 按钮 允许 用户 更新 列表 。 b “ 新 标题 ” 按钮 允许 用户 进入 “ 发送 新 消息 ” 页 。 c 每条 消息 都 有 “ 打开 ” 按钮 ， 允许 用户 进入 “ 查看 消息 ” 页 。 d 若 一屏 显示 不下 ， 页 未 出现 “ 下 一页 ” 按钮 ， 否则 显示 “ 没有 更 多 消息 了 ” 。 该页 的 HTX 文件 中 的 主要 语句 有 ： 　 　 formactionviewconfmessagesidcmethedpost 　 　 　 inputtypesubmitvalue 刷新 列表 form 　 　 formactionnewtopicidcmethedpost 　 　 　 inputtypesubmitvalue 新 标题 form 　 　 tablewidth 　 　 　 trtdcolspanaligncenterbgcolordffff 　 　 　 　 hidcconferencenamehtdtr 　 　 trth 标题 thth 作者 thth 建立 日期 thtr 　 　 begindetail 　 　 　 trtd 　 　 formactionviewmessageidcmethedpost 　 　 　 inputtypesubmitnameopenvalue 打开 form 　 　 td 　 　 tdpreexprlpretd 　 　 tdusernametdtdmessagetstdtr 　 　 ifcurrentrecordeq 　 　 formactionviewconfmessagesidcmethedpost 　 　 inputtypesubmitvalue 下 一页 form 　 　 endif 　 　 enddetail 　 　 “ 发送 新 消息 ” 页 允许 用户 输入 新 消息 的 标题 、 消息 正文 等 ， 然后 单击 该页 中 的 “ 发送 ” 按钮 启动 postnewidc 文件 ， 该 文件 将 用户 输入 的 消息 标题 、 消息 正文 连同 用户 标识符 、 所 选 议题 的 标识符 、 消息 建立 日期 等 插入 到 消息 表中 。 注意 该条 记录 的 父 消息 标识符 字 段 应为 ， 消息 嵌套 深度 字 段 应为 ， 排序 机制 字 段 应为 该字 段 中 已有 值 的 最大值 ， 同时 启动 显示 消息 列表 页 。 其 SQL 语句 如下 ： 　 　 INSERTINTOmessagesmessagesubjectuseridmessagetsconferenceidparentmessageid 　 　 numspacesmessagetextdisplayorderingselectmessagesubjectuseridnow 　 　 conferenceidmessagetextmaxdisplayorderingfrommessages 　 　 whereconfrenceidconferenceid 　 　 若 用户 在 “ 消息 列表 ” 页 中 单击 某 消息 的 “ 打开 ” 按钮 ， 则 进入 “ 查看 消息 页 ” ， 该页 有 如下 特征 ： “ 往前 ” 、 “ 往后 ” 按钮 使 用户 可以 往前 后 查看 消息 ， 而 不必 回到 “ 消息 列表 ” 页 ； “ 回馈 ” 按钮 允许 用户 对 显示 的 消息 回馈 消息 ， “ 回到 列表 ” 按钮 允许 用户 返回 “ 消息 列表 ” 页 。 　 　 “ 查看 消息 ” 页 的 IDC 文件 中 的 SQL 语句 实现 根据 messageid 检索 users 表中 所有 字 段 、 议题 名 、 消息 作者 名 、 作者 的 Email 地址 的 功能 。 　 　 查看 前 一 消息 的 IDC 文件 中 的 SQL 语句 中 ， 由 messagedisplayorderingselectdisplayorderingfrommessageswheremessageidmessageid 一句 来 确定 一条 消息 。 该 请求 可能 返回 多行 ， 由 ODBCoptionssqlmaxrows 一句 来 限制 只有 一行 中 最大 的 被 检索 。 查看 后 一 消息 的 IDC 文件 中 的 SQL 语句 与 此句 类似 。 　 　 对于 检索 到 的 某条 消息 ， 在 显示 它 时 需注意 ， 若 检索 到 作者 Email ， 作者 名 就是 一个 超级链接 ， 方便 用户 给 作者 发 Email ， 该 功能 由下 一段 代码 实现 。 　 　 ifauthoremaileq 　 　 authorname 　 　 else 　 　 ahrefmailtoauthoremail 　 　 authorname 　 　 a 　 　 endif 　 　 在 “ 查看 消息 ” 页 中 ， 若 用户 单击 “ 回馈 ” 按钮 则 进入 “ 发 反馈 消息 ” 页 ， 该页 有 如下 特征 ： 用户 输入 消息 表单 ， 按 “ 发送 ” 按钮 发送 消息 ， 为 正在 查看 的 消息 发 回馈 消息 ， 回到 消息 列表 页 。 其中 在 发 回馈 消息 的 IDC 文件 中要 用 SQL 语句 更新 相关 消息 的 displayordering ， 使 之 在 消息 列表 中 显示 在 该 回馈 消息 后 的 所有 消息 的 displayordering 加 。 在 相应 的 HTX 文件 中要 用到 文本框 textareatextarea 结束 标识符 应该 紧接着 开始 标识符 ， 否则 任何 开始 标识符 与 结束 标识符 之间 的 文字 都 将 作为 文本框 缺省值 。 　 　 用户 在 “ 登录 ” 页 中 单击 “ 新 成员 注册 ” 按钮 进入 “ 新 成员 注册 ” 页 ， 该页 提示 使用 本 电子 论坛 的 纪律 ， 要求 未注册 用户 输入 用户名 、 口令 、 Email 地址 等 必要 的 信息 以 注册 。 验证 用户名 是否 唯一 ， 二次 输入 的 用户 密码 是否 相同 ， 并 将 之 加入 users 表中 。 　 　 用户 在 “ 主屏 ” 中 单击 “ 查找 ” 按钮 进入 “ 查找 ” 页 ， 该页 有 四项 特征 ： 一个 列表框 ， 让 用户 选 一个组 议题 搜索 ； 一个 输入 区域 ， 用户 可以 输入 搜索 字符串 ， 在 查找 字符串 中 可用 统配 符 。 “ 查找 ” 按钮 用来 启动 查询 ； 一个 统配 符 的 说明 ， 用来 方例 用户 使用 统配 符 ， 其 主要 代码 如下 ： 　 　 selectmultiplenameseldconferences 　 　 begindetail 　 　 optionvalueconferenceidconferencename 　 　 enddetail 　 　 select 　 　 “ 查找 结果 ” 页 与 “ 消息 列表 ” 页 相似 ， 页 首有 一个 “ 新搜索 ” 按钮 ， 用户 用此 进入 “ 查找 ” 页 进行 重新 搜索 ； 接下来 是 查找 到 的 所有 消息 的 列表 ， 若本 一屏 显示 不下 ， 则 页 未 出现 “ 下 一页 ” 按钮 ， 否则 显示 “ 找 不到 了 ” ， 其中 起 过滤 和 分页 作用 的 代码 如下 ： 　 　 wheremessagesmessageidmaxmsg 　 　 andmessagesmessagesubjectlikesearchtext 　 　 andconferencesconferenceidinseldconferences 六 、 结束语 　 　 用 IDC 技术 实现 将 数据库 内容 在 Internet 、 Intranet 上 发布 的 方法 有 其 独特 的 优点 ， 国内 已有 许多 Web 站点 采用 了 该项 技术 。 程序 中 所 操作 的 数据 是 用 Access 数据库 管理系统 组织 的 ， 也 可用 任何 一种 具有 ODBC 驱动程序 的 数据库 管理系统 来 实现 ， 如 MSSQL ， SYSBASE 等 。 ■ 作者 单位 ： 徐萍 中国 纺织 大学 计算机系 无锡 参考文献 ： ［ ］ 希望 图书 创作室 　 MicrosoftSQLServer 参考手册 　 科学出版社 ［ ］ SusannNovalis 著 　 成栋 译 　 Frontpage 从 入门 到 精通 　 电子 工业 出版社 ［ ］ MarkMinasi 等者 　 邱仲 潘译 　 WindowsNTServer 从 入门 到 精通 　 电子 工业 出版社 收稿 日期 ：