计算机 应用 研究 APPLICATIONRESERCHOFCOMPUTERSVol 　 No 　 P 实时 系统 中 任务 可 调度 性 研究 舒忠梅 　 胡金 柱 　 左亚尧 摘要 讨论 了 有关 实时 调度 理论 ， 对 实时 系统 采用 了 时间 PetriNet 方法 来 建模 ， 并 运用 实时 调度 理论 对系统 中 的 任务 可 调度 性能 进行 了 全面 分析 ， 给出 了 详细 的 分析 步骤 。 关键词 实时 任务调度 时间 PetriNetl 　 引言 　 　 实时 系统 性能 的 好坏 至关重要 地 影响 到 我们 的 日常生活 ， 从 空中 的 卫星 、 雷达 系统 到 地面 的 交通 监控 系统 、 电梯 调度 系统 ， 都 是 实时 系统 的 典型 例子 。 其中 ， 任务 可 调度 性是 实时 系统 中 的 核心 。 如何 决定 某一 任务 序列 是 可 调度 的 这个 问题 至今 还 没有 一个 系统 的 方法 ， 本文 以 电梯 调度 实时 系统 为例 ， 采用 时间 Petri 网 方法 对系统 进行 建模 表示 ， 并 运用 实时 调度 理论 分析判断 任务 的 可 调度 性 。 　 背景 理论 　 　 在 实时 系统 设计 中 ， 系统 的 正确性 不仅 依赖于 它 的 结果 ， 还 依赖于 产生 结果 的 时间 。 一组 任务 如何 获悉 某个 CPU 是 可 调度 的 ， 我们 用 速率 单调 调度 理论 来 进行 分析 说明 。 　 利用率 界限 定理 　 　 对于 一个 周期 任务 ti ， 其 周期 为 Ti ， 最坏 情况 下 执行 时间 为 Ci ， 则 CPU 利用率 为 ： 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 如果 任务 在 它 期限 之前 完成 其 操作 ， 则 认为 此 任务 是 可 调度 的 。 一组 任务 中 每个 任务 都 能 满足 其 期限 ， 则 这组 任务 是 可 调度 的 。 根据 速率 单调 调度 理论 ， 几个 相互 独立 的 周期 任务 由 速率 单调 算法 来 调度 时 ， 总能 满足 它们 的 期限 ， 如果 ： 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 其中 CiTi 是 任务 Ti 的 利用率 ， 当 n 为 无限 时 ， 界限 就 为 ln 。 此 定理 是 非常 悲观 的 ， 在 实际 应用 中 ， 任务 集合 将 永远 不会 碰到 最坏 情况 。 因此 ， 即使 在 条件 不 满足 时 ， 任务 集合 可能 仍 满足 其 期限 。 　 完全 时间 定理 　 　 完全 时间 定理 可以 更 精确 地 决定 哪些 任务 是 可 调度 的 。 在 利用率 界限 定理 不起作用 时 ， 可 运用 此 定理 。 完全 时间 定理 假设 在 最坏 情况 下 ， 所有 处于 就绪 状态 的 周期 任务 都 能 同时 执行 。 此 定理 表明 ： 对于 一组 相互 独立 的 周期 任务 ， 如果 比 任务 ti 具有 更高 优先权 的 所有 任务 都 在 启动 时 ， 任务 ti 仍能 满足 其 期限 ， 则 它 在 任何 时候 总能 满足 其 期限 。 在 应用 此 定理 时 ， 不仅 要 检测 所 给定 的 任务 ， 还要 检测 所有 具有 更高 优先权 的 任务 。 即 对于 任务 tn ， 其 周期 为 Tn ， 执行 时间 为 Cn ， 假设 任务 t 到 tn 是 所有 比 tn 更高 优先权 的 任务 ， 其 周期 分别 为 T 到 Tn ， 执行 时间 分别 为 C 到 Cn ， 则 任务 tn 能 在 其 期限内 完成 它 的 操作 ， 如果 ： 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 其中 ， ITnTi 是 大于 或 等于 TnTi 的 最小 整数 。 　 概括 的 利用率 界限 定理 　 　 低 优先权 的 任务 进入 临界 区 ， 将 导致 其它 高 优先权 的 任务 不能 使用 共享资源 ， 这时 出现 优先权 的 反转 ， 为了 能 说明 速率 单调 优先权 的 反转 ， 对 速率 单调 调度 理论 进行 了 扩展 — 考虑 低 优先权 任务 的 阻塞 ， 不必 遵守 速率 单调 优先权 ， 使高 优先权 的 任务 可 被 剥夺 ， 这 就是 概括 的 利用率 界限 定理 。 　 概括 的 完全 时间 定理 　 　 如果 运用 上述 利用率 界限 定理 测试 失败 ， 可 利用 概括 的 完全 时间 定理 。 该 定理 假设 所有 的 任务 在 其 周期 开始 时 准备 执行 ， 通过 计算 这些 任务 的 结束 时间 来 决定 哪些 任务 能 完成 操作 。 这个 定理 考虑 了 高 优先权 任务 的 可 剥夺 和 低 优先权 任务 的 阻塞 。 　 实时 系统 建模 及其 可 调度 性 分析 　 　 Petri 网 PN 是 由库 所 、 变迁 、 弧及 TOKEN 组成 的 有向图 ， 它 对于 同步 系统 的 建模 非常 有用 。 目前 ， 已有 了 许多 关于 PN 模型 的 扩展 ， 如 ： 时间 Petri 网 TPN 允许 时间 信息 与 变迁 的 发生 相 联系 。 这 对于 实时 系统 建模 很 有效 ， 使得 我们 可 从 性能 的 角度 来 分析 PN 模型 ， 我们 以 电梯 控制器 的 应用 为 例来 探讨 TPN 系统 模型表示 ， 在 此基础 上来 分析 系统 中 的 任务 可 调度 性能 。 　 模型 设计 　 　 电梯 系统 主要 由 楼层 控制器 、 调度 子系统 、 电梯 控制器 等 组成 。 当 楼层 控制器 监测 到 电梯 按钮 输入 信号 时 ， 就 向 调度 子系统 发出 服务 请求 ， 调度 子系统 根据 服务 请示 进行 调度 ， 并发 调度 者 请求 给 电梯 控制器 ， 电梯 控制器 则 根据 调度 者 请求 决定 升降 状态 ， 并 启动 马达 。 由此 ， 我们 可以 抽象 出 电梯 控制器 的 状态 变迁 图 ， 用 时间 Petri 网 表示 如图所示 。 在 此基础 上 进行 分析 ， 可以 得出 此图 中 的 实时 任务 为 ： 监测 电梯 按钮 任务 、 请示 监测 任务 、 升降 状态 及 决策 任务 、 升降 控制 任务 、 监测 电梯 传感器 任务 、 状态 处理 任务 等 。 图 　 电梯 控制器 的 TPN 模型 　 性能 分析 　 　 TPN 系统 模型 的 性能 可用 实时 调度 理论 来 分析 ， 我们 总结 出其 评价 步骤 如下 。 　 　 通过 跟踪 相应 TPN 子系统 的 执行 过程 获得 系统 中 每个 同步 任务 的 时间 。 在 模型 中 可能 不止 一条 执行 路径 ， 因此 考虑 最大 执行 时间 的 最坏 情况 。 在 电梯 控制器 应用 中 ， 每个 任务 的 最坏 执行 时间 记为 CPU 时间 列举 如表 。 　 　 以 子系统 为 基础 定义 所有 的 事件 序列 ， 并 为 这些 子系统 分配 优先权 和 任务 周期 使 同一 事件 序列 中 的 任务 具有 相同 的 周期 ； 对于 非 周期 任务 ， 将 之 视为 周期 任务 ， 并 让 其 周期 为 所在 事件 序列 的 最小 到达 时间 。 电梯 控制器 实例 中 的 任务 优先权 及其 周期 如表 所示 。 表 　 电梯 控制器 的 任务调度 分析 表 任务 CPU 时间 周期 利用率 分配 的 优先权 监测 电梯 传感器 升降 控制 状态 处理 监测 电梯 按钮 请示 监测 升降 状态 及 决策 　 　 根据 公式 ， 计算 系统 中 的 所有 任务 的 利用率 。 如果 任务 是 独立 的 ， 并 保持 速率 单调 优先 如高 优先权 任务 的 周期 较 短 ， 公式 中 的 条件 成立 ， 则 系统 中 的 任务 满足 其 期限 。 否则 ， 回到 第步 。 由表 计算 出 的 所有 任务 利用率 为 ， 比 最坏 情况 下 的 界限 小 。 但是 ， 此例 中 的 所有 任务 都 具有 相同 的 周期 ， 优先权 并 不是 根据 周期 的 长度 来 分配 的 ， 速率 单调 优先权 失效 ， 因此 ， 要 进行 下 一步 的 测试 。 　 　 计算 每个 事件 序列 的 任务 利用率 。 考虑 表中 的 事件 序列 ： 监测 电梯 传感器 ， 升降 控制 ， 状态 处理器 ， 升降 状态 及 决策 。 在 最坏 情况 下 ， 该 事件 序列 的 执行 时间 为个 单位 时间 ， 其 执行 利用率 为 ： 　 　 。 　 　 计算 高 优先权 可 剥夺 任务 的 利用率 。 在 表 的 事件 序列 中 ， 监测 电梯 按钮 可 被 另 一 事件 序列 中 的 升降 控制 和 升降 状态 及 决策 剥夺 ， 这 需要 个 单位 时间 处理 电梯 按钮 异步 信号 。 另一方面 ， 升降 控制 又 可 被 升降 状态 及 决策 所 剥夺 。 这样 执行 下去 ， 只 需要 个 单位 时间 ， 故可 剥夺 利用率 为 ： 　 　 。 　 　 合计 第步 中 的 任务 利用率 和 第步 中 的 高 优先权 可 剥夺 利用率 。 如果 利用率 总和 小于 利用率 界限 定理 所 给定 的 上界 ， 根据 概括 利用率 界限 定理 ， 这个 事件 序列 是 满足 其 期限 的 。 在 表中 的 事件 序列 的 所有 利用率 为 ： ， 因此 该 事件 序列 满足 其 期限 。 　 　 为 系统 中 的 每 一 事件 序列 重复 执行 步 。 如果 概括 利用率 界限 定理 失效 ， 则 在 下 一步 运用 概括 的 完全 时间 定理 ； 否则 认为 所有 的 任务 是 可 调度 的 ， 性能 分析 就此结束 。 　 　 对于 每一 事件 序列 ， 计算 序列 中 所有 任务 的 执行 时间 和 不 在 此 序列 中 但 具有 高 优先权 任务 的 可 剥夺 时间 。 如果 总 的 时间 小于 当前 序列 的 任务 周期 ， 根据 概括 的 完全 时间 定理 ， 此 事件 序列 中 的 所有 任务 是 可 调度 的 。 　 结束语 　 　 本文 以 电梯 调度 器为例 ， 讨论 了 实时 系统 的 调度 理论 及其 TPN 建模 技术 ， 并 运用 实时 调度 理论 对 其 性能 进行 了 细致 地 分析 。 我们 认为 TPN 方法 是 建模 表示 实时 系统 的 良好 工具 ， 运用 实时 调度 理论 来 判定 任务 的 可 调度 性是 有效途径 ， 值得 我们 进一步 地 研究 和 探讨 。 注 ： 胡金 柱 同志 为 本文 第三 作者 舒忠梅 （ 华中师范大学 计 科系 武汉 ） 胡金 柱 （ 华中师范大学 计 科系 武汉 ） 左亚尧 （ 华南 师范大学 广州 ） 参考文献 PHuberKJensenRShapiroHierarchiesinColouredPetriNetsLectureNotesinComputerScienceVolAdvancesinPetriNetspp ～ HeinzOswaldAnEnvironmentforSpecifyingandExecutingHierarchicalPetriNetsProceedingsoftheInternationalConferenceonSoftwareEngineeringpp ～ SLuiRRajkumarSSSathayeGeneralizedRatemonotonicSchedulingTheoryProceedingsoftheIEEEVolpp ～ Fan 收稿 日期 ： 年月日