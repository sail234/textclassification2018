航空 计测 技术 AVIATIONMETROLOGYMEASUREMENTTEHNOLOGY 年 　 第卷 　 第期 　 Vol 　 No 　 ALPHA 系列 数据 采集器 测试 系统 的 设计 陈荔莹 摘 　 要 　 介绍 了 一个 数据 采集器 测试 系统 的 构成 及其 软件设计 ， 并 对 系统软件 的 设计 方法 、 主要 功能 和 主要 特色 进行 了 讨论 。 关键词 　 数据 采集 　 ALPHA 　 模块 　 PCB 板 DesignofSeriesALPHADataAcquisitionTestSystemChenLiyingAbstract 　 ThesystemconfigurationanditssoftwaredesignofadataacquisitiontestsystemarepresentedinthispaperThedesignmethodofthesystemsoftwaremainfunctionsandcharacteristicsarediscussedKeywords 　 DataacquisitionALPHAModulePCB 引言 　 　 ALPHA 系列 数据 采集器 能够 对 模拟信号 如 温度 、 压力 、 电阻 、 电压 、 电流 、 应变 等 和 数字信号 如 开关 状态 、 事件 捕获 、 测频 计数 等 进行 连续 、 高精度 的 测量 ， 具有 抗干扰性 强 、 通讯 速率 快 、 传输 距离远 、 智能化 程度 高 、 使用 简单 灵活 、 安装 维护 方便 等 一系列 优点 ， 因此 是 人们 对 生产 过程 和 生产 设备 进行 运行 监测 、 安全 分析 、 故障诊断 和 优化 控制 的 理想 工具 。 　 　 数据 采集器 是 生产 过程 监控 中 重要 的 一环 ， 因此 在 产品 出厂 前要 进行 严格 的 测试 。 以往 的 测试方法 ， 是 测试人员 在 Windows 的 终端 仿真 环境 下 ， 依照 测试步骤 ， 逐条 输入 测试 命令 ， 并 从 终端 屏幕 上 记录 测试数据 ， 不但 效率 低 、 可靠性 差 ， 而且 对 测试人员 的 要求 也 较 高 。 针对 上述 问题 ， 开发 了 ALPHA 系列 数据 采集器 测试 系统 ， 其 特点 是 ： 　 　 ● 友好 的 人机交互 界面 使得 测试 变得 简单 、 灵活 非专业 人员 也 很 容易 操作 。 既 免去 了 测试人员 记忆 与 查询 诸多 测试 命令 的 辛苦 ， 又 提高 了 测试 的 可靠性 。 　 　 ● 实现 测试 的 自动化 管理 ， 主机 自动记录 实时 数据 。 　 　 ● 对 合格 产品 进行 计算机 库存 管理 。 　 系统 的 硬件 结构 　 　 系统 硬件 由 ALPHA 系列 数据 采集器 、 电源 、 校准器 、 通讯 电缆 和 主机 构成 ， 见图 。 图 　 系统 硬件 结构图 　 　 ALPHA 系列 数据 采集器 是 测试 系统 的 主要 组成部分 ， 负责 完成 多路 传感器 信号 的 扫描 、 采集 、 放大 、 A ／ D 转换 、 信号 发送 等 功能 。 　 　 数据 采集器 外接 V 直流电源 ， 并 通过 通讯 电缆 与 主机 的 串行 通讯 口 相连 。 　 　 校准器 用来 为 测试 系统 提供 标准 信号 。 根据 被测 信号 的 不同 ， 校准器 可以 是 直流电 压 校准器 、 电阻箱 、 频率计 等 。 把 校准器 与 数据 采集器 的 一个 或 多个 采集 通道 相连 ， 通过 比较 系统 的 测试 结果 和 校准器 的 标称 值来 检验 产品 是否 合格 。 　 系统软件 的 功能 简化 测试 过程 　 　 根据 功能 的 不同 ， ALPHA 系列 数据 采集器 可 分为 不同 种类 的 模块 ， 每 一种 模块 出厂 前 都 必须 经过 四项 测试 ： PCB 板 测试 、 老化 测试 、 校准 测试 和 最终 测试 。 而 每一项 测试 又 分成 若干 步骤 ， 其中 每 一步 都 需要 向 模块 发 几条 命令 ， 因此 要 完成 一个 模块 的 完整 测试 ， 测试人员 需要 输入 数十条 命令 ； 对于 批量 测试 ， 这项 工作 将 更为 繁琐 ， 测试人员 须 反复 查阅 命令集 ， 输入 各项 命令 。 测试 系统 解决 了 这 一 问题 ， 各项 测试 命令 事先 被 存储 进 一组 命令 按钮 ， 测试 时 只 需 单击 各个 命令 按钮 ， 命令 便 自动 发给 模块 ， 既 方便 灵活 ， 又 提高 了 可靠性 。 同时 ， 测试 系统 采用 了 友好 的 人机交互 界面 ， 使得 非专业 人员 也 可 容易 地 进行 测试 。 自动记录 数据 　 　 测试 的 实时 数据 通常 需要 保留 ， 以供 日后 分析 使用 ， 但 由于 每种 模块 有个 数据 采集 通道 ， 测试 时多 是 所有 通道 同时 采集 ， 而且 以 连续 次测试 为 一组 ， 因此 数据量 很大 。 若 要求 测试人员 完整 地 记录 测试 结果 ， 会 占用 大量 人力 ， 而且 也 不能 保证 不 发生 错记 、 漏记 。 此外 ， 在 连续 进行 h 的 老化 测试 中 ， 要求 测试人员 时刻 监守 岗位 也 是 不 现实 的 。 测试 系统 承担 了 这 一部分 工作 ， 它 能够 实时 地 记录 数据 ， 并 存储 在 指定 的 表格 中 。 在 测试 过程 中 ， 当 数据 超标 时 ， 系统 可 自动记录 出错 信息 。 提供 查询 服务 　 　 通过 该 测试 系统 ， 可以 对 测试 过程 中 所 记录 的 数据 进行 查询 。 根据 用户 指定 的 查询 项目 对 测试 记录 进行 排序 、 筛选 ， 便于 用户 查找 所 需 数据 ， 还 可以 将 查询 结果 以 报表 形式 打印 出来 。 规范 管理 成品 　 　 在 完成 全部 测试 后 ， 合格 产品 需要 进行 入库 管理 。 成品 管理 能够 对 模块 的 入库 、 出库 以及 维修 情况 进行 登记 、 查询 和 统计 管理 。 　 系统软件 的 设计 　 　 系统软件 用 VisualFoxPro 编写 。 根据 测试 任务 ， 分为 以下 几 大 功能模块 ， 如图所示 。 图 　 系统软件 结构 框图 系统 设置 模块 　 　 完成 测试项目 、 测试 模块 类型 和 测试 设备 的 设置 。 需要 指出 的 是 ， 在 系统 设置 中 ， 不可 缺少 的 是 由 测试人员 输入 被测 模块 的 产品 的 序列号 ， 这个 序列号 在 测试 记录 中 被 视 为主 索引 。 测试 记录 模块 根据 相应 的 测试项目 ， 设置 所 需 的 试验 参数 ， 选择 测试步骤 、 测试 量程 、 需 采集 的 通道 ， 向 模块 发 测试 命令 ， 进行 实时 采集 与 显示 ， 采集 结束 后 进行 数据 整理 、 结果 评定 。 　 　 模块 通讯 是 测试 系统 的 核心 部分 ， 也 是 程序设计 的 难点 ， 如图所示 。 测试 系统 装入 了 FoxPro 图 　 模块 通讯 流程图 中 的 FOXTOOLSFLL 程序库 文件 ， 它 是 Windows 的 一种 动态链接库 ， 利用 这个 库中 的 RegFn 及 CallFn 例程 便 可 调用 Windows 中 的 USEREXEGDIEXE 及 KRNL ／ KRNLEXE 这个 最大 的 动态链接库 中 的 例程 。 在位 Windows 中 ， 对 串口 的 操作 有 其 特定 的 函数 ： OpenCommCloseCommReadCommWriteCommGetCommStateSetCommState 　 　 它们 都 属于 USEREXE 程序库 。 在 VisualFoxPro 中要 调用 其它 动态链接库 中 的 例程 必须 先 “ 注册 ” ， 在 取得 一个 例程 句柄 后 ， 再 利用 此 句柄 进行 调用 。 测试 系统 先用 RegFn 例程 对 OpenComm 等 函数 进行 注册 ， 然后 再用 CallFn 例程 调用 上述 通讯 函数 打开 通讯 口 ， 对 通讯 口 进行 初始化 ， 例如 ： 波特率 的 允许值 、 数据 位数 、 停止 位 的 个数 以及 奇偶校验 方法 等 。 通过 WriteComm 函数 把 测试 命令 以 字符串 的 形式 写 到 串行口 ， 并 调用 ReadComm 函数 把 数据 采集 模块 的 响应 读入 缓冲区 。 测试 系统 创建 了 一个 dat 数据文件 来 保存 模块 的 响应 。 由于 每 一次 响应 含有 个 通道 的 数据 ， 而 当 各 通道 所测 的 信号 不 同时 ， 其 数据位 的 长度 也 不同 ， 为 保证 数据文件 中 的 数据 能 正确 地 映射 到 数据 表格 中 ， 需 将 数据文件 中 数据 格式化 ， 把 原先 的 空格 分隔符 改为 逗号 分隔符 ， 从而 避免 了 多余 空格 造成 的 数据 错位 ， 然后 调用 FoxPro 中 的 APPENDFROM 命令 将 数据文件 中 的 数据 映射 到 数据 表格 中 。 数据 表格 包括 产品 序列号 、 模块 类型 、 测试 日期 、 测试人员 、 测试项目 及 测试数据 等 字 段 ， 以便 进行 查询 与 管理 。 　 　 数据 表格 中 的 实时 数据 还 需要 经过 一系列 综合 处理 ， 计算 出 每组 测试数据 的 最大值 、 最小值 、 平均值 等 ， 为 测试 结果 的 评定 做好 准备 。 　 　 测试 结果 的 自动 评定 使 测试人员 不必 记忆 测试 结果 的 上 下限 合格 值 ， 提高 了 测试 的 速度 与 准确性 。 当 测试数据 超出 规定 的 范围 时 ， 系统 会 在 不 合格 的 数据 旁标 以 醒目 的 标记 “ ” ， 向 测试人员 报警 ， 并 在 数据文件 的 备注栏 中 记录 下 此时 的 故障 情况 ， 以供 日后 分析 查询 。 查询 检索 模块 　 　 系统 设计 一个 表单 作为 查询 记录 的 专用 窗口 。 按照 用户 输入 的 查询 索引 ， 如 ： 产品 序列号 、 测试 日期 、 测试人员 等 ， 对 当前目录 下 的 所有 数据 表格 进行 检索 ， 查到 的 记录 除了 可以 刷新 屏幕 外 ， 还 可以 直接 送到 打印机 打印 。 成品 管理 模块 　 　 完成 合格 产品 的 入库 登记 、 出库 登记 、 维修 登记 、 查询 和 统计 。 　 　 入库 登记 需要 录入 产品 序列号 、 模块 类型 、 生产日期 。 批量 入库 时 ， 同 一种 模块 的 序列号 通常 是 连续 的 ， 为了 避免 反复 输入 这些 参数 ， 每 完成 一个 模块 的 登记 ， 序列号 自动 加 ， 而 模块 类型 以及 生产日期 保持 不变 。 在 入库 时 ， 系统 自动 检验 产品 序列号 的 唯一性 ， 当所 输入 的 序列号 在 成品 数据库 中 已 存在 时 ， 系统 会 发出 警告 ， 提示 用户 重新 输入 。 　 　 出库 登记 需要 录入 出厂日期 及 代理商 。 批量 出库 时 ， 对于 同一 代理商 ， 可以 在 成品 数据库 中用 Shift ＋ 鼠标 左键 进行 多项 选择 ， 一起 出库 。 　 　 查询 可以 按 模块 序列号 、 模块 类型 、 生产日期 、 出厂日期 以及 代理商 对 成品 数据库 进行 检索 ， 并 可 打印 查询 结果 。 　 　 成品 管理 还 可 按 年 、 月 统计 模块 的 生产量 、 销售量 以及 库存量 ， 并 计算 出 销售 给 每个 代理商 的 每种 模块 的 数量 及 总和 ， 统计 结果 可以 打印 。 　 结束语 　 　 本 系统 已经 过 一年 多 的 测试 应用 ， 实践证明 该 系统 使用方便 、 可靠性 高 ， 较 好 地 满足 了 数据 采集器 系统 的 测试 要求 ， 也 为 日后 开发 其它 产品 的 测试 系统 打下 了 基础 。 作者简介 ： ＋ 岁 　 女 　 助理 工程师 作者 单位 ： 希蒙 电子 国际 有限公司 ， 北京市 ， 收稿 日期 ： － － 收稿