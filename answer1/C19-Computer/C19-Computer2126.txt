计算机 工程 COMPUTERENGINEERING 年 第卷 第期 volNo 视景 音响 模拟系统 研究 谢 　 建 　 黄 海滨 　 杜文正 　 　 怎样 将 现代 高新技术 成果 应用 于 军事 设备 模拟训练 系统 的 研制 一直 是 研究 军事训练 方法 的 一大 课题 ， 视景 音响 模拟 就是 其中 的 方法 之一 ， 在 大型 设备 的 视景 音响 模拟 中有 很多 实现 技术 和 方法 值得 探讨 。 系统 的 技术 原理 　 　 视景 音响 模拟系统 的 硬件 组成 有个 方面 的 含义 ： 对于 系统 的 研制开发 阶段 ， 主要 由 计算机 、 MF － 声卡 、 DCPlus 视频 采集 回放 卡 、 录象机 、 扫描仪 、 扬声器 、 摄象机 、 Epson 投影设备 等 组成 ； 对于 研制成功 后 的 系统 ， 主要 由 计算机 、 MF － 、 扬声器 、 Epson 投影设备 等 组成 。 　 　 如图所示 ， 音频 数据 的 采集 、 压缩 与 处理 在 计算机控制 下 ， 通过 MF － 卡对 录象机 、 麦克风 输入 的 音频 信号 进行 采集 、 压缩 ， 通过 DCPlus 卡对 录象机 和 摄象机 输出 的 视频信号 进行 采集 、 压缩 。 对于 静态 图形 图象 ， 通过 扫描仪 将 这些 图形 图象 录入 计算机 ， 存入 硬盘 中 ， 然后 在 编辑 软件 AdobePhotoshopV 中 进行 初步 的 编辑 ， 以 TIF 文件格式 压缩 ， 存放 在 硬盘 中 。 在 设备 工作 过程 中 ， 包括 了 各种 仪器设备 的 状态 显示 ， 其中 有的是 设备 内部 的 状态 显示 ， 采用 计算机 动画 的 形式 ， 通过 动画 模拟出 这些 状态 的 变化 。 图 视景 音响 模拟系统 原理 示意图 　 　 软件 制作 是 在 计算机 上 对 采集 来 的 各种 数据文件 进行 编辑 。 软件 制作 的 操作 平台 是 AdobePremiere 。 制作 完毕 后 的 数据文件 ， 即 视频 图象 片段 ， 以 AVI 格式 存放 。 AVI 格式 的 文件 占用 的 存储空间 非常 巨大 ， 在 该 系统 中 ， 仅仅 是 AVI 文件 就 占用 了 近 GB 的 硬盘空间 ， 由于 模拟系统 要 代替 实装 进行 长时间 的 使用 ， 计算机硬盘 就 必须 长时间 工作 ， 这 对于 硬盘 的 工作 可靠性 、 寿命 是 很 不利 的 。 为了 提高 系统 工作 的 可靠性 和 使用寿命 ， 将 AVI 格式 的 文件 用 VideoPackV 视频 转换 工具软件 进行 二次 压缩 ， 将 其 转换成 MPEG 格式 ， 使 原来 的 数据量 减小 为 MB ， 然后 ， 将 这些 数据文件 刻写 在 一张 光盘 上 ， 避免 了 计算机硬盘 工作 时 的 频繁 读取数据 。 同时 ， 由于 在 MPEG 格式 的 文件 播放 时 是 软件 解压 、 播放 ， 不 需要 价格昂贵 的 DCPlus 视频卡 ， 因此 ， 在 提高 系统可靠性 、 延长 使用寿命 的 同时 ， 还 节约 了 经费 。 　 　 当 软件 制作 完毕 后 ， 在 Windows 环境 中 开发 的 应用程序 的 管理 下 播放 出来 。 其中 ， 音频 信号 由 MF － 驱动 扬声器 播放 。 视频信号 的 播放 可以 通过 监视器 或 EPSON 投影设备 播放 出来 。 软件结构 　 　 软件 的 关键问题 在于 如何 组织 大量 的 图形 、 图象 、 声音 、 文字 等 多媒体 数据 ， 才能 更好 地 实现 操作 模拟 和 人员培训 的 功能 。 围绕 这一 问题 ， 该 软件系统 的 层次结构 可以 分为 层 ： 应用层 、 描述 层 和 数据 层 。 如图所示 。 图 软件系统 的 体系结构 数据 层 　 　 该 软件系统 的 数据 层 是 指 用于 模拟 操作 现场 环境 的 视景 图象 、 声音 及 用于 提高 训练 效果 的 辅助性 文字 、 图形 等 多媒体 数据 的 集合 。 数据 层 就 像 一个 多媒体 数据 的 仓库 ， 它 仅 是 存储 数据 ， 而 不 涉及 数据 的 应用 。 数据 层 具有 物理 独立性 和 逻辑 独立性 。 　 　 数据 的 物理 独立性 是 指 多媒体 数据 的 物理 存储 结构 、 存取方法 与 数据 的 逻辑 定义 分离 ， 当 数据 的 物理 存储设备 、 物理 存储 结构 和 存取方法 发生变化 时 ， 数据 的 逻辑 结构 和 定义 可以 不 改变 ， 因此 应用程序 也 可以 不 改变 。 　 　 数据 的 逻辑 独立性 是 指 多媒体 数据 与 多媒体 应用程序 的 相互 独立性 。 多媒体 应用程序 对 多媒体 数据 的 存储 、 检索 等 操作 与 数据 的 逻辑 结构 无关 。 数据 改变 后 ， 应用程序 可以 不用 修改 仍然 正常 运行 。 数据 的 独立性 不仅 可以 使 数据 被 多个 应用程序 共享 ， 而且 对于 提高 应用程序 的 可靠性 可 可维护性 有 很大 的 好处 。 描述 层 　 　 描述 层 是 对 数据 层 的 抽象 ， 是 对 数据 层中 各种 多媒体 数据 对象 之间 关系 的 全面 描述 。 对于 常规 的 格式化 数据 及 数据 间 的 相互 关系 可以 用表 和 字 段 来 描述 。 而 对于 非 格式化 的 图形 、 图象 、 声音 等 多媒体 数据 ， 就要 根据 多媒体系统 的 特点 来 决定 其 描述 方法 。 因为 这些 多媒体 数据 之间 存在 着 自然 的 关联 ， 包括 时序 关系 如 多媒体 对象 在 表达 时 必须 保持 时间 上 的 同步性 和 空间 关联 如 必须 把 相关 媒体 信息 集成 在 一个 合理布局 的 空间 内 的 特性 。 在 建立 对 这些 多媒体 数据 的 描述 时 必须 充分考虑 它们 的 这些 特点 。 　 　 在 该 软件系统 中 ， 建立 描述 层 的 依据 就是 要 模拟 设备 的 操作规程 。 它 不仅 描述 了 操作过程 中 每 一个 工步 的 操作 动作 ， 还 描述 了 各个 工步 应该 对应 的 视景 图象 、 声音 、 执行 元件 的 工作 状态 等 信息 。 　 　 在 软件 的 体系结构 中 ， 描述 层 是 应用层 与 数据 层 之间 的 接口 ， 为 应用程序 对 多媒体 数据 进行 操作 提供 了 依据 。 在 软件 运行 过程 中 ， 它 所 提供 的 描述 信息 是 包含 在 软件 的 执行 代码 中 的 。 应用层 　 　 应用层 是 软件 功能 的 实现 者 。 它 包括 软件 的 各个 功能模块 和 用户界面 。 软件 的 各个 功能模块 分别 负责 对外部 模拟 设备 状态 的 检测 与 控制 、 依据 描述 层 提供 的 信息 对 各种 多媒体 数据 进行 有机 组合 。 用户界面 有 两个 作用 ： 一是 为 用户 提供 选择 和 设置 操作程序 的 途径 ； 二是 将 经过 软件 功能模块 集成 的 多媒体信息 展示 在 操作者 面前 。 视景 模拟 中 的 几个 问题 设备 的 全 视景 与 辅助 说明 的 叠加 　 　 在 设备 操作 的 素材 中 ， 有 从 扫描仪 来 的 静态 图象 ， 有 从 DCPlus 来 的 视频 图象 ， 也 有 通过 计算机 动画 制作 而成 的 动画 。 其中 ， 操作 的 主线 由 视频 图象 来 表现 ， 它 贯穿 于 该项 操作 的 始终 。 但是 ， 仅仅 以 活动 视频 图象 来 表现 整个 视景 内容 是 不够 的 。 为了 解决 这个 问题 ， 用 静态 图形 模拟 某些 设备 内部 视场 状态 ， 同时 ， 用 闪烁 的 光标 和 文字 符号 以 在线 帮助 的 形式 提示 操作手 。 在 播放 操作 动作 、 过程 的 同时 ， 将 某些 仪器 的 内部 视场 与 活动 画面 在 计算机屏幕 上 同屏 显示 出来 。 有 的 重点 、 难点 内容 和 操作手 容易 出现 失误 的 地方 ， 我们 都 用 文字 、 符号 、 光标 闪烁 、 不同 的 颜色 等 手段 进行 了 强调 和 说明 。 　 　 对于 用 计算机 生成 的 图形 图象 、 动画 、 文字 等 辅助 说明 内容 ， 通过 软件 中 同步 进程 控制 模块 ， 检索 相应 视频 帧 的 位置 ， 将 其 叠加 在 表示 设备 全 视景 的 视频 画面 中 相应 位置 。 如图所示 。 图帧 计数 同步控制 方法 实现 面板 状态 更新 和 辅助 说明 的 叠加 　 　 对于 用 机构 细节 的 视频 画面 表示 的 辅助 说明 ， 画面 以 同一 背景 下 的 该 设备 全景 为主 ， 利用 AdobePremiere 的 过渡 功能 Transitions ， 在 进行 图象 片段 的 编辑 时 ， 就 将 辅助 说明 叠加 在 全 视景 画面 上 ， 使 整个 设备 的 动作 与 局部 动作 同时 展现 在 用户 面前 。 多媒体 事件 进程同步 控制 　 　 在 设备 的 视景 模拟 过程 中 ， 以下 两类 多媒体 事件 应 保持 同步 ： 设备 运动 机构 到位 一个 工步 结束 与 操作 面板 状态 发生 相应 变化 之间 应 同步进行 ； 用 文字 、 图形 图象 、 动画 等 表示 的 辅助 说明 与 设备 全 视景 画面 相应 帧 之间 应 同步 出现 。 这 两类 事件 的 同步 由 软件 的 进程 控制 模块 保证 。 为了 在 一个 工步 结束 、 下 一工步 开始 时 准确 同步 地 更新 面板 显示 状态 ， 采用 了 帧 计数 同步 法 。 在 编辑 好 的 视频 图象 片段 中 ， 每 一幅 画面 都 有 相应 的 帧 号 fi ， 根据 实际操作 过程 中 ， 设备 实际 状态 与 操作 面板 状态 、 设备 全 视景 与 需要 进行 辅助 说明 的 内容 之间 的 对应 关系 ， 确定 视频 图象 片段 中 的 特征 帧 S 帧 代号 ， 当 程序 的 同步 进程 控制 模块 计数 到 fiS 时 ， 特征 帧 S 触发 同步 进程 控制 模块 ， 同步 更新 面板 状态 或者 向 全 视景 画面 叠加 辅助 说明 。 示意图 如图所示 。 音响 模拟 中 的 几个 问题 循环式 音响 模拟 　 　 在 该 设备 工作 过程 中 ， 现场 音响 主要 包括 柴油 发电机组 和 电动机 的 声音 。 柴油 发电机组 正常 运行 时 声音 比较 单一 ， 而且 其 持续时间 取决于 操作手 的 操作 ， 其 运转 与否 具有 相对 独立性 。 若 将 从 柴油机 启动 到 操作 结束 的 全过程 声音 采集 在 一个 文件 里 ， 不仅 会 占据 大量 的 硬盘空间 ， 也 不能 满足 人机交互 时 音响 模拟 的 实时性 要求 。 为此 ， 将 柴油机 启动 、 正常 工作 、 停止 运转 的 声音 分别 采集 成个 单独 的 文件 ， 其中 柴油机 正常 工作 的 声音文件 只是 柴油机 正常 工作 时 的 一个 很 短 的 声音 片段 。 当 系统 检测 到 柴油机 启动 信号 时 ， 先 播放 机组 启动 的 声音文件 ， 然后 循环 播放 机组 正常 工作 的 声音文件 。 当 检测 到 柴油机 停止 运转 时 ， 先 停止 循环 播放 ， 再 播放 机组 停止 运转 的 声音文件 。 多个 音响 进程 的 模拟 　 　 在 操作过程 中 ， 限动器 等 执行机构 动作 时需 启动 电动机 。 而且 由于 其 随机性 ， 不 可能 预先 将 此 声音 编辑 进 柴油机 正常 工作 的 声音 中 ， 而 必须 采用 独立 的 声音 叠加 进去 ， 但是 Windows 的 多媒体 声音 设备 在 同一 时刻 只能 播放 一个 声音文件 ， 为了 在 不 中断 柴油机 声音 的 条件 下 使 系统 能 发出 电动机 启动 的 声音 ， 制作 了 一个 模仿 电动机 声音 的 MIDI 文件 ， 当某 一工步 启动 电动机 时 便 播放 该 文件 ， 这样 系统 便 能够 同时 发出 柴油机 运转 和 电机 启动 的 声音 。 多 音响 进程 的 控制 如图所示 。 图 音响 模拟 中 的 同步 进程 控制 结论 　 　 该 系统 采用 先进 的 视景 音响 模拟 技术 ， 对 设备 的 工作 过程 进行 模拟 ， 克服 了 实装 训练 中 的 不足 ， 为 设备 的 训练 和 教学 提供 了 一种 科学 、 合理 的 手段 。 开发 的 应用软件 人机界面 良好 ， 工作 可靠 ， 能够 很 好 地 对 实现 操作 面板 检测 、 视景 音响 回放 控制 、 多 进程同步 控制 与 人机交互 的 需要 ， 并 具有 良好 的 可维护性 。 作者 单位 ： 第二炮兵 工程学院 ， 西安 参考文献 SteinmetzRNahrstedtKMultimediaComputingCommunicationandApplicationBeijingTsinghuaUniversityPress ， AdobePremiereUserGuideAdobeSystemsIncorporated 刘甘娜 IBM － PC 微机 原理 及 接口技术 西安 ： 西安交通大学 出版社 ， 杨学良 多媒体计算机 技术 及其 应用 北京 ： 电子 工业 出版社