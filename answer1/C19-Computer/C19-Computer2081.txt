计算机 工程 ComputerEngineering 年 　 第卷 　 第期 　 VolNo 集散 式 热处理 控制软件 设计 段隆振 　 江泽 涛 　 　 摘 　 要 　 阐述 了 集散 式 热处理 系统 的 工作 原理 ， 介绍 了 用 Delphi 开发 上位 机集 工业 控制 及 管理 的 软件设计 思想 及 软件结构 ， 并 对 主要 功能 进行 了 说明 ． 　 　 关键词 　 热处理 ； 工业 控制 ； 集散 式 TheSoftwareforGatheringscatteringHeatTreatmentControlSystemDuanLongzhenDepartmentofComputerScienceNanchangUniversityNanchangJiangZetaoDepartmentofComputerScienceNanchangInstituteofAviationIndustryNanchang 　 　 Abstract 　 ThispaperrepresentstheworkingprincipleofgatheringscatteringheattreatmentsystemItintroducesthedesignandstructureofthegatheringscatteringindustrycontrolandmanagementsoftwarethatisdevelopedwithDelphiandrunsontopcomputerendItalsoshowsmainfunctionsofthesoftware 　 　 Keywords 　 HottreatmentIndustrycontrolGatheringscattering 　 　 随着 科学技术 的 进步 ， 对 各种 加工 工艺 及 热处理 过程 提出 了 越来越 高 的 要求 ， 传统 的 机械 手动式 已 难于 满足 现代化 生产 的 需求 。 为此 ， 开发 出 集散 式 热处理 控制系统 软件 ， 即 一台 计算机控制 多 台下 位机 。 下位 机由 MS 单片机 为 核心 ， 以 热电偶 为 传感器 控制 可控硅 导通角 ， 从而 控制 电加热 丝 加热 过程 等 组成 下位 机 控制系统 ； 上位 机 采用 Windows 操作系统 和 Delphi 设计 ， 具有 中文 提示 的 GUI 界面 ， 操作 简单 直观 ， 深受 用户 欢迎 ； 该软件 具有 实时 数据 采集 记录 数据库 ， 实时 图形 打印 功能 ， 图形 再现 功能 ， 热处理 原始数据 记录 数据库 ， 热处理 现场 数据 记录 数据库 等 ， 大大 方便 了 质量 监测 与 跟踪 管理 ， 软件 经过 近 一年 的 时间 运行 ， 未 发生 过 一次 差错 ， 极大 地方 便 了 热处理 监控 及 质量 管理 。 　 系统 工作 原理 　 　 系统 的 构成 与 工作 原理 　 　 整个 系统 由 一 台上 位机 ， 一台 打印机 ， 一个 RS 接口 及 多 台下 位机 组成 ， 一 台上 位机 最 多 可 控制台 下位 机 ， 位机 与 下位 机 依靠 串行 通信 方式 相互 传送 信息 ， 上位 机与 下位 机 通过 地址 取得 相互 联系 ， 由 RS 分址 ， 上位 机 采用 分 时 方式 分别 控制 每一 台下 位机 ， 上位 机与 下位 机 的 最大 距离 为 m ， 下位 机 根据 设定 的 参数 及 通过 热电偶 测量 的 温度控制 热处理炉 的 电热丝 加热 过程 ， 如图所示 。 图 　 系统 工作 原理 　 　 下位 机 的 工作 方式 　 　 下位 机有 本机 工作 方式 及 通信 工作 方式 ， 当 工作 在 通信 方式 时 ， 上位 机可 对 下位 机 进行 参数 设定 及 控制 ， 当 工作 在 本机 工作 方式 时 ， 上位 机 不能 对 下位 机 进行 参数设置 及 控制 ， 但 可以 读取 下位 机 的 数据 ， 这样 即使 某一 台下 位机 坏 了 ， 但 并 不 影响 上位 机对 整个 系统 的 控制 ， 同样 即使 上位 机坏 了 ， 各 下位 机 照样 可 独立 工作 ， 这 就 使 整个 系统 的 稳定性 大大提高 。 　 　 下位 机 根据 热处理 工艺 要求 ， 可 分为 定值 控制 与 程序控制 两种 工作 方式 ， 在 定值 工作 方式 下 可 设定 热处理 温度 及 保温 时间 ； 在 程序 工作 方式 下 ， 最多 可 将 整个 热处理 过程 分为 个 程序段 ， 每个 程序段 可 设定 温度 值及 对应 的 保温 时间 ， 对 整个 程序 可 设定 起始 温度 及 循环 控制 次数 ， 这样 就 可以 满足 自动控制 各种 较 高 要求 的 热处理 过程 。 　 　 下位 机 的 参数 设定 　 　 下位 机可 在 RAM 模式 和 ROM 模式 下 工作 ， 在 ROM 模式 时 ， 系统 采集 到 的 数据 写入 EPROM ， 即便 是 突然 停电 ， 数据 仍然 得到 保存 ， 但 EPROM 可写 寿命 为 万次 ， 因此 一般 不用 ROM 模式 ； 在 RAM 模式 时 ， 系统 采集 到 的 数据 写入 RAM ， 当 突然 停电 ， 数据 不能 得到 保存 ， 重新 来电 后 从 EPROM 读入 数据 及 操作 指令 工作 ， RAM 模式 无 寿命 限制 ， RAM 模式 为 缺省 工作 模式 ， 因此 一般 的 工作 方法 是 在 不 改变 参数 及 指令 时用 RAM 模式 ， 当 需要 改变 参数 及 指令 时 ， 一次性 改用 ROM 模式 ， 将 参数 及 命令 写入 EPROM ， 然后 立即 改回 RAM 模式 ， 这样 既 可 保存 改写 的 命令 及 参数 ， 又 可延长 系统 的 使用寿命 。 下位 机可 进行 一些 高级 参数 设定 非常 有 经验 的 技术员 可 设定 P 参数 、 I 参数 、 D 参数 及 自动 整定 温度 值 ； 系统 程序 中 用 反复 迭代 运算法 可 进行 自动 整定 ， 所以 对 一般 的 操作 人员 可 利用 系统 的 自动 整定 功能 获得 PID 参数 ； 下位 机 可以 设定 控制 的 最高 温度 及 最低温度 ； 可 设定 报警 参数 ， 如超温 偏差 、 欠温 偏差 ， 报警 时间 等 。 上位 机 系统软件 设计 　 　 上位 机 采用 windows 操作系统 下 Delphi 编程 ， Delphi 不仅 是 可视 的 完全 面向对象 的 编程 方法 ， 而且 可 非常 方便 地 操纵 数据库 及 实现 各种 报表 ， 使得 编程 较 迅速 。 上位 机软件 要求 界面 优美 、 操作 简单 ， 上位 机 不仅 能 采集 下位 机 的 数据 ， 而且 可 设定 下位 机 的 参数 及 控制 下位 机 的 运行 。 由于 军工 产品 要 有 严格 的 质量 跟踪 管理 ， 因此 上位 机 不仅 是 控制系统 ， 同时 又 是 管理系统 。 考虑 以上 因素 ， 上位 机软件 具有 如下 功能 ： 　 　 密码 的 安全 管理 　 　 根据 产品质量 跟踪 管理 及 热处理 工艺 操作 要求 ， 将 上位 机 分为 三级 密码 管理 ： 一级 密码 为 操作员 掌握 ， 用于 系统 的 激活 和 一般 的 数据 监控 及 报表 管理 ； 二级 密码 为 技术员 掌握 ， 可以 更改 下位 机 的 一般 参数 设定 ， 如 工作 方式 、 运行 模式 、 报警 参数 、 极限 参数 等 ； 三级 密码 为 最高级 密码 ， 由 总工程师 或 技术 副厂长 掌握 ， 可以 修改 系统 更 高级 参数 ， 如 PID 整定 、 有权 删除 过时 数据 、 有权 修改 整个 系统 密码 等 。 由于 采用 了 权限 管理 ， 有利于 加强 质量 跟踪 及 责任 管理 。 　 　 数据 监控 及 参数 设定 　 　 上位 机可 选定 开机 炉号 ， 根据 所选 的 开机 炉 号 对 下位 机 进行 检测 及 监控 ， 上位 机 最 多 控制台 下位 机 。 为 便于管理 ， 上位 机 采用 分页 方式 管理 ， 即 每页 管 台下 位机 ， 将 屏幕 上 每页 分为 个 控制 板面 ， 每一 板面 对应 一 台下 位机 。 板面 上 有 温度 设定值 ， 温度 测量 值 ， 保温 时间 ， 工作 方式 ， 超温 、 欠温 、 时间 到 报警 状态 ， 参数 设定 ， 开 机关 机等 。 参数 殍 定 可 根据 密码 权限 对 下位 机 的 各种 参数 进行 设定 。 　 　 数据 存储 与 图形 功能 　 　 上位 机 采用 对 下位 机分 时 循环 监控 工作 方式 ， 即使 台下 位机 全开 ， 一分钟 也 可 采集 到 二次 数据 。 由于 军工 产品质量 跟踪 有 严格要求 ， 因此 每 一分钟 内 将 采集 到 的 数据 存储 一次 到 数据库 中 ， 并 以 图形 方式 实时 地画 在 屏幕 上 。 不同 的 温时 曲线 用 不同 的 颜色 加以 区分 ， 并 可 根据 需要 实时 打印 。 对 数据库 中 的 数据 可以 用 原始数据 方式 察看 ， 也 可用 图形 方式 察看 并打印 。 为 加强 对 事故责任 管理 ， 报警 记录 每 一分钟 存储 一次 到 数据库 中 ， 以便 查阅 。 考虑 到 多数 热处理 工艺 在 小时 以下 ， 每 一分钟 图形 打点 一次 ， 为此 将 图形 构件 ImageWidth 宽度 设定 为 ， 这样 利用 滚动 杠 一次 可 看到 采集 小时 数据 的 图形 ， 为了 使 操作员 能 在 屏幕 上 固定 区域 看到 最新 采集 的 数据 ， 采用 下列 过程 图 形似 在 坐标 原点 冒出 而 整个 图形 后移 。 　 　 procedureMoveRectVartReal 　 　 varrrTRect 　 　 　 rgnHrgn 　 　 　 tyInteger 　 　 begin 　 　 　 withImagedo 　 　 　 begin 　 　 　 　 CanvasBrushcolorClTeal 　 　 　 　 rRectwidthheight 　 　 　 　 rr 　 　 　 　 rgnCreaetrectrgn 　 　 　 　 scrolldccanvashandleHotGraphFormrrrgnnil 　 　 　 　 deleteobjectrgn 　 　 　 　 rrectheight 　 　 　 　 canvasfillrectr 　 　 　 end 　 　 　 canvaspixelsHeighttrunctdivClRed 　 　 end 　 　 数据报表 　 　 为 加强 质量 跟踪 管理 ， 系统 提供 了 热处理 现场 操作 原始记录 和 热处理 验收 原始记录 等 数据报表 的 输入 、 查询 、 打印 ， 表中 提供 了 零件 名称 、 零件图 号 、 批次 号 、 材料 牌号 、 加热 温度 、 保温 时间 、 冷却剂 、 淬火 温度 、 实测 硬度 、 跟踪 卡 编号 、 操作员 、 检验员 等 ， 为 分清 责任事故 ， 实现 全面 质量 跟踪 提供 了 有力 保证 。 上位 机软件 流程图 如图 。 图 上位 机软件 流程图 　 结论 　 　 集散 式 热处理 控制系统 软件 已 在 某 导弹基地 使用 了 一年 多 ， 运行 稳定 ， 未 出现 任何 差错 。 该 系统 热处理 温控 精度 达到 ± ℃ ， 时间 控制精度 可达 s ， 深得 用户 好评 。 作者简介 ： 段隆振 ～ ， 男 ， 副教授 ， 主要 从事 计算机 应用 技术 研究 作者 单位 ： 段隆振 　 南昌大学 计算机科学 系 ， 南昌 　 　 　 　 　 　 江泽 涛 　 南昌 航空工业 学院 计算机科学 系 ， 南昌 　 收稿 日期 ：