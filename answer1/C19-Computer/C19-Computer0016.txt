计算机 应用 COMPUTERAPPLICATIONS 年 第卷 第期 VolNo 板材 柔性制造系统 中 的 数据 接口技术 陈慧宝 　 程远利 　 张振龙 　 　 摘 　 要 　 本文 介绍 了 板材 柔性制造系统 中 的 数据 接口技术 。 叙述 了 CADCAPP 系统集成 技术 中 的 一些 关键问题 ， 并 提出 了 有效 的 解决 方法 。 　 　 关键词 　 钣 金 板材 CADCAPP 数据 接口 　 　 我们 为 沈阳 某 科技 公司 板材 柔性制造系统 设计 了 一套 钣 金 产品 计算机辅助 设计 加工 系统 。 该 系统 由 CAD 、 数据 接口 、 CAPP 三个 子系统 组成 。 钣 金 CAD 子系统 基于 通用 绘图 软件 AutoCAD 进行 二次开发 ； CADCAPP 数据 接口 子系统 通过 对 CAD 子系统 的 图形 信息 进行 分析 处理 后 ， 传输 给 CAPP 子系统 完成 CADCAPP 的 内部 数据 连接 ， 对 信息 联机 传递 、 实时处理 。 图 　 系统 组成 简图 　 钣 金 产品 图形 数据 特点 　 　 钣 金 产品 CAD 子系统 是 基于 参数 化 思想 而 设计 的 。 只要 输入 几个 关键 的 参数 ， 系统 自动 生成 钣 金 零件 的 三维 视图 和 展开 图 。 展开 图是 一个二维 图形 ， CADCAPP 数据 接口 对 展开 图 的 DXF 命令 组 文件 进行 处理 ， 传递信息 到 CAPP 子系统 用于 满足 板件 的 冲裁 下料 。 图 　 钣金件 设计方案 　 　 钣 金 产品 的 设计 和 加工 有 其 自身 的 结构 、 材料 和 工艺 特点 。 　 　 ） 展开 图 二维 图形 由 直线 、 圆弧 、 圆 组成 ， 所有 几何 特征 均 在 一个 平面 上 。 （ 二次 、 三次 曲线 均 由 圆弧 或 直线 插补 构成 ） 。 　 　 ） 落料 加工 的 所有 工艺 特征 ， 如 粗糙度 、 定位精度 、 直线度 等 均 由 NC 机床 保证 。 　 　 CAD 系统 的 信息 模型 是 几何学 模型 、 线架 模型 、 面架 模型 及 体素 造型 ， 对于 公差 和 技术 要求 是 按 标注 信息 进行 处理 。 CAPP 系统 要求 的 是 工艺 特征 和 制造 信息 ， 而 不是 点 、 线 、 面 的 几何 特征 。 并且 由于 钣 金 产品设计 加工 的 自身 特点 ， 以 DXF 文件 作为 数据文件 直接 作为 CAPP 子系统 的 输入 信息 存在 许多 问题 。 　 　 存在 大量 非 加工 信息 　 　 钣 金 展开 系统 是 在 AutoCAD 软件 环境 下 开发 的 ， 从 CAD 子系统 传过来 的 DXF 命令 组 文件 包含 了 标准 零件图 的 所有 信息 ， 其中 包括 尺寸 线 、 辅助线 等 非 加工 信息 ； 使得 操作 CAPP 子系统 时 ， 容易 产生 加工 环 不 清晰 ， 生成 错误 的 NC 操作 指令 。 　 　 几何 交点 不 重合 　 　 由于 DXF 文件 中 的 几何 点 信息 是 CAD 图形 通过 内部 计算 而 获得 的 ， 许多 图形 元素 的 几何 交点 实际上 是 两个 点 。 尽管 两点 之间 的 误差 很小 ， 不 影响 加工 精度 ， 但是 这样 的 图形 数据 不能 用于 CAPP 子系统 进行 自动 工艺 编程 。 　 　 无序 的 拓扑 关系 　 　 由于 在 DXF 文件 中 ， 图形 相关 数据 按 CAD 子系统 在 AutoCAD 图形界面 生成 图形 元素 的 先后顺序 而 存储 ， 因而 不能 保证 组成 零件 图形 的 各 图形 元素 之间 的 拓扑 关系 是否 具有 精确 的 逻辑关系 。 如 不能 保证 闭环 ， 更 不能 保证 组成 环 的 各 图形 元素 之间 的 拓扑 关系 。 这样 的 图形 是 不能 用于 数控 加工 的 。 　 　 缺少 方向 判定 　 　 对于 旋转 冲床 的 工艺 编程 必须 确定 冲头 的 加工 走向 ， 以便 加工 出内 轮廓 或外 轮廓 。 而 展开 图 的 DXF 文件 包含 的 有关 轮廓 信息 不能 确定 环 的 走向 ， 须 对 组环 实体 进行 分析 计算 ， 根据 数据文件 输出 要求 的 加工 走向 ， 依序 将 环中 实体 写入 数据文件 中 。 　 解决 方法 　 把 问题 消灭 在 CAD 子系统 内 　 　 在 CAD 子系统 总体设计 时 考虑 CAPP 的 要求 。 　 建立 独立 的 数据 接口 　 　 该 方法 的 思想 是 在 CAD 子系统 中 充分利用 AutoCAD 的 开发 平台 ， 暂 不 考虑 CAPP 子系统 的 要求 。 对于 CAPP 子系统 ， 做 一个 数据 接口 软件 ， 其 任务 是 对 零件 展开 图 的 DXF 文件 做 进一步 处理 ， 内容 包括 ： 剔除 非 加工 信息 （ 包括 不必要 的 工艺 信息 和 技术 说明 ） ； 修正 消除 几何 不 重合 点 ， 建立 拓扑 关系 ， 找出 加工 环 ； 按照 事先 约定 指出 加工 环 走向 。 　 设计 思想 及 算法 实现 　 　 在 钣 金 产品 CAD 子系统 中 ， 零件 展开 图先用 AutoCAD 的 EXPLODE 命令 将 图形 打碎 ， 再 生成 相应 的 DXF 文件 。 只 从 DXF 中 提取 与 工件 廓形 数据 有关 的 实体 段 信息 CIRCLE 、 LINE 、 ARC 到 程序 中 ； 进行 分析 计算 找出 图形 信息 中外 轮廓 上 一点 ， 依据 此点 找出 外 轮廓 加工 环 ； 在 余下 的 图形 信息 中 寻找 其余 的 内 轮廓 加工 环 CIRCLE 作为 一个 独立 的 加工 环 ； 判断 环向 ， 并 将 加工 环所含 图形 信息 依环 向 写入 数据 输出 文件 中 。 图 　 流程 简图 　 系统 的 数据结构 　 　 本 系统 数据结构 采用 双向 链表 结构 。 由于 钣 金 加工 特点 板材 均匀 性 ， 因此 可以 简单 按 二维 图形处理 。 而且 ， 无论是 冲孔 还是 落料 ， 其 轮廓 都 构成 闭环 它 是 由 直线 或 圆弧 首尾相连 构成 的 图形 或是 一个整 圆 。 　 　 建立 　 classARCpublicCIRCLEpublicLINE 　 　 intDirect 　 　 　 其中 ， 类 ARC 是 类 CIRCLE 、 LINE 的 子类 。 　 　 类 CIRCLE 、 LINE 中 的 成员 ： Center 代表 圆心 坐标 ； Radius 表示 半径 ； Start ， End 分别 为 直线 或 圆弧 的 起始 点 和 终止 点 坐标 ； Direct 是 ARC 中 独有 的 成员 ， 它 标示 圆弧 的 方向 ： 沿 顺时针 方向 等于 ， 圆弧 沿 逆时针 方向 等于 。 　 几何 信息提取 模块 　 　 图形 实体 经 打碎 后 成为 “ LINE ” 、 “ ARC ” 、 “ CIRCLE ” 三种 类型 经 研究 发现 ， 对 V 图形 实体 打碎 到 最后 均 为 LINE 、 ARC 、 CIRCLE ， 如 Fit 拟合 的 Pline 解碎 后 为 Arc ， Spline 拟合 的 Pline 解碎 后 为 Line 等 。 因此 程序 的 核心 以 ARC 、 LINE 、 CIRCLE 为 对象 。 程序 从 DXF 文件 的 实体 段 ENTITIES 中 调用 一个 实体 ， 判断 其是 LINE 还是 ARC 或 CIRCLE ， 分流 后 按 其 组码 提取 几何 信息 。 　 　 例如 ： 对于 直线 ， 可用 和 组码 提取 其 起点 、 终点 坐标 。 　 组环 算法 　 　 每 一个 class 中 都 有 一个 Distant 函数 ， 这个 函数 用于 寻找 每 一个 实体 上距 原点 距离 最大 点 。 比较 所有 实体 的 Distant 函数 值 ， 从中 找出 距 原点 距离 最大 点 ， 该点 对应 的 实体 N 必 在外 轮廓 上 。 　 　 如果 N 为 圆 ， 则 此 零件 外 加工 环 S 即此 圆 。 　 　 如果 N 为 直线 或 圆弧 ， 则 以 实体 N 为 基准 组环 S 外 轮廓 加工 环 。 以 N 起始 点为 环 S 的 起点 ， 以 N 终止 点为 环 的 下 一个 实体 的 起始 点 。 　 　 搜索 其余 实体 只 考虑 直线 和 圆弧 的 起止点 ， 寻找 近似 重合 点 当点 与 点 之 差距 小于 某个 很小 的 整数 ε ， 认为 是 重合 点 ， 并作 几何 交点 啮合 作为 相邻 两 基本 图形 实体 的 交点 。 该点 所在 实体 作为 环 的 第二 链 ， 继续 在 余下 的 实体 ARC 和 LINE 中 寻找 环 的 下 一链 ， 并 判断 链中 的 终止 点 是否 与 环 的 起点 近似 重合 。 不 重合 重复 此 过程 ， 否则 外 轮廓 环 S 组环 结束 。 　 　 在 余下 未 组环 的 实体 ARC 、 LINE 中 继续 组环 S 、 S 、 S 、 S … 均 为 内 轮廓 环 ， 组环 方法 同 上 。 直至 所有 实体 ARC 、 LINE 均 组入 各环中 。 　 　 读取 余下 的 实体 CIRCLE 作为 内环 。 　 数据 输出模块 　 　 在 输出 时 判断 环 的 走向 。 对于 三个 实体 组成 的 环 ， 直接 两 实体 叉 乘 ， 运用 右手定则 判断 环 的 走向 ； 对于 一般 实体 环 寻找 环内点 ， 引 直线 进行 叉 乘 计算 判断 环向 ， 再 按照 约定 格式 输出 数据 到 数据文件 中 ， 并 将 数据 文件传送 到 CAPP 子系统 。 　 　 CADCAPP 集成 实际上 是 结构设计 模块 与 加工 工艺 模块 的 结合 。 CADCAPP 数据 接口 子系统 将 CAD 模块 输出 的 图形 信息 转换成 CAPP 可以 接收 识别 的 数据格式 ， 实现 了 CAD 和 CAPP 之间 信息 的 提取 、 交换 、 共享 和 处理 。 钣 金 产品 CADCAPP 数据 接口 子系统 的 建立 ， 使 系统 更 充分利用 AutoCAD 平台 的 二次开发 功能 ， 实现 了 钣 金 产品设计 制造 的 参数 化 、 标准化 、 系列化 、 自动化 ， 缩短 新 产品 生产 周期 ， 提高 生产 效率 。 作者 单位 ： 上海大学 机械 电子 工程学院 　 上海 参考文献 ［ ］ 　 JTackettJrVisualC 面向对象 程序设计 北京 ： 清华大学出版社 ， ［ ］ 　 高元茂 等 AutoCAD 计算机辅助 设计 教程 北京 ： 电子 工业 出版社 ， ［ ］ 　 郝泳涛 等 AutoCAD 线切割 加工 指令 的 自动 编程 系统 机械 与 电子 ， ［ ］ 　 黄 　 健等集 CADCAMCNC 于 一体 的 板材 下 料 系统 机械 工业 自动化 ， 收稿 日期 修改稿