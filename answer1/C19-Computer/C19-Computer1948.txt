微型机 与 应用 MICROCOMPUTERITSAPPLICATIONS 年 第卷 第期 VolNo 一种 在 关系数据库 中图 的 表示 及 遍历 方法 邵 远升 　 　 摘 　 要 ： 针对 在 数据库 应用程序 中 经常 遇到 的 一类 查询 ， 提出 了 种 在 关系数据库 中 对 图 进行 表示 和 遍历 的 方法 ， 并 使用 MSSQLServer 的 TSQL 语言 实现 了 遍历 过程 。 　 　 关键词 ： 关系数据库 　 图 的 遍历 　 SQL 语言 　 　 目前 ， 大多数 应用程序 都 涉及 数据库 的 应用 ， 在 对 数据库 进行 查询 时 经常 会 遇到 一类 较为 复杂 的 问题 。 例如 ， 已知 各 城市 之间 的 航班 ， 现要 查出 从 某 一 城市 到达 另 一 城市 的 所有 路径 。 这 类 查询 从 本质 上 来看 涉及 求解 图 的 连通性 和 求 关键 线路 等 问题 ， 其 基础 是 对 图 的 遍历 。 对图 的 遍历 一般 要 应用 高级 语言 的 指针 和 特殊 的 数据结构 来 实现 。 这 在 大多数 数据库 应用程序 开发工具 中 实现 起来 比较 困难 。 本文 针对 这一 问题 提出 了 种 在 关系数据库 中 表示 图 的 方法 ， 以及 利用 标准 的 SQL 语言 对 其 进行 遍历 的 算法 ， 并 通过 一 实例 说明 。 　 图 的 表示 及 遍历 　 　 图 的 表示 　 　 本文 以 有向图 为例 ， 无向 图则 可以 表示 为 双向 的 有向图 。 传统 上 对 图 的 表示 一般 采用 数组 或 邻接 表等 多种 方式 ， 但 在 关系数据库 中 只能 以 二维 表 的 形式 来 存储 数据 。 因此 本文 提出 的 方法 是 将 图 表示 为个 二维 表 ， 个 是 节点 表 node ， 包括 节点 名 nodename 、 节点 信息 nodeinfo 和 是否 为根 节点 ynroot 根 节点 为 ， 其他 为 ， 无向 图 全为 个 字 段 ； 另个 是 与 弧 有关 的 弧表 arc ， 包括 起始 节点 startnode 、 终止 节点 endnode 和 与 弧 有关 的 信息 arcinfo 个 字 段 。 表 结构 如表 、 表 所示 。 表 　 node 表 结构 nodenamenodeinfoynrootcharcharint 表 　 arc 表 结构 startnodeendnodearcinfocharcharchar 　 　 图 的 遍历 　 　 以 深度 优先 搜索算法 为例 ， 给出 算法 流程图 ， 如图所示 。 其中 用到 个 临时 表 stack 和 liststack 作为 堆栈 使用 ， 临时 存放 返回 点 ， list 记录 已 访问 过 的 节点 。 stack 表中 包含 nodename 和 glevel 个 字 段 ， list 表中 包含 nodename 和 sequence 个 字 段 。 图 　 算法 流程图 　 实例 　 　 以图 中 的 有向图 为例 ， 该图 在 数据库 中 存储 为表和表 。 图 　 有 向 图表 　 node 表 nodenameynrootabcdefgh 表 　 Arc 表 startnodeendnodeabacbddgdhcfebhe 　 　 本文 采用 MSSQLServer 的 TSQL 语言 编写 过程 对图 进行 遍历 。 具体 程序 如下 ： setnocountondeclareiintjintnodenamecharcreatetablestacknodecharglevelintcreatetablelistnodecharsequenceintinsertintostackselectfromnodewhereynrootselectiselectjwhileibegin 　 　 ifexistsselectfromstackwheregleveli 　 　 　 begin 　 　 　 selectnodenamenode 　 　 　 fromstackwheregleveli 　 　 　 deletefromstackwheregleveliandnodenodename 　 　 　 ifexistsselectfromlistwherenodenodename 　 　 　 　 continue 　 　 　 　 　 insertlistvaluesnodenamej 　 　 　 selectjj 　 　 　 insertstack 　 　 　 selectendnodei 　 　 　 fromarcwherestartnodenodename 　 　 　 ifrowcount 　 　 　 　 selectii 　 　 　 end 　 　 　 else 　 　 　 　 selectiiendselectfromlist 　 　 遍历 结果 如图 ： 　 　 node 　 sequence 　 　 — — 　 — — — 　 　 a 　 　 　 　 b 　 　 　 　 d 　 　 　 　 g 　 　 　 　 h 　 　 　 　 e 　 　 　 　 c 　 　 　 　 f 　 　 图 　 遍历 结果 　 　 综上所述 ， 本 方法 使用 简单 的 数据结构 和 标准 的 SQL 语言 实现 了 对 图 的 遍历 ， 对于 解决 实际 中 遇到 的 复杂 查询 问题 有 一定 的 参考价值 。 作者 单位 ： 天津大学 管理 学院 参考文献 　 　 严蔚敏 ， 吴 伟民 数据结构 北京 ： 清华大学出版社 ， 　 　 MicrosoftCorporationMicrosoftSQLSERVERDatabaseDevelopersCompanion 收稿 日期 ：