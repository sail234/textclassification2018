计算机 应用 研究 APPLICATIONRESEARCHOFCOMPUTERS 　 Vol 　 No 　 P 基于 Java 的 VoD 系统 研究 与 设计 戴海平 　 夏雨人 摘要 描述 了 基于 Java 实现 的 一个 视频点播 系统 。 基于 数字 影音 协会 DAVIC 的 客户服务器 系统 主要 包括 一个 视频 服务器 和 一个 机顶盒 客户端 ， 重点 介绍 了 该 系统 的 客户端 应用 的 实现 方法 ， 该 系统 在 遵照 DAVIC 规范 的 同时 ， 通过 基于 Java 的 实现 提高 了 软件 的 模块化 程度 ， 实现 了 撌 輸 客户机 模型 ， 同时 允许 VoD 服务 与 Internet 环境 的 集成 。 关键词 视频点播 Java 机顶盒 DAVICDSMCC 　 　 视频点播 VoD ， VideoonDemand 允许 用户 对 视频 信息 进行 选择 ， 用户 坐在 家里 就 可以 选择 自己 想 看 的 电视节目 ， 就 像 看 录影带 或 VCD 一样 方便 。 视频点播 是 交互式 视频 的 主要 内容 之一 ， 具有 良好 的 经济效益 、 社会效益 和 广阔 的 前景 ， 除了 可以 让 用户 选择 自己 喜欢 的 电影 、 电视 和 新闻 ， 它 还 可以 发展 成为 可视电话 、 远程教学 、 远程 医疗 以及 交互式 游戏 等 多种 服务 。 　 　 Java 这一 网络 环境 下 的 编程语言 ， 相对 传统 语言 有 许多 优势 ， 实现 了 平台 独立性 ， 即 Java 应用程序 可以 在 各种 系统 平台 上 运行 ， 撘 淮 伪 嘈 矗 酱 χ 葱袛 ， 在 很大 程度 上 减少 了 软件 升级 与 维护 的 工作量 ， 降低 了 系统 的 开发成本 。 Java 的 前身 Oak 原意 是 解决 多种 电子器件 的 统一 接口 问题 ， 随着 Java 的 发展 ， 它 的 这 一 功能 进一步 增强 ， Java 应用 于 视频点播 系统 将 带来 很大 的 方便 和 好处 。 视频点播 系统 模型 　 　 数字 影音 协会 DigitalAudioVideoCouncil ， DAVIC 是 一个 开发 数字视频 应用 协议 的 国际联盟 ， 从 年 成立 至今 ， 一直 致力于 数字 交互 视频 应用 标准 的 制定 工作 ， 年 月 发布 的 DAVIC 已经 成为 ISOIECJTC 标准 的 一部分 。 　 　 DAVIC 为 包括 VoD 在内 的 交互式 服务 确定 了 一个 框架 。 如图所示 ， 系统 是 按照 参考点 和 信息流 来 描述 的 。 这个 模型 包括 节目 提供 系统 ContentProviderSystemCPS 、 服务 提供 系统 ServiceProviderSystemSPS 和 服务 使用 系统 ServiceConsumerSystemSCS ， 它们 之间 通过 传输 系统 相连接 。 对于 我们 这个 简化 的 VoD 系统 ， CPS 与 SPS 合二为一 对应 于 视频 服务器 ， 而 SCS 则 对应 于 机顶 设备 SetTopUnitSTU 。 在 服务器 与 机顶 设备 之间 定义 了 若干 参考点 如 A 与 A 和 信息流 如 S 到 S 。 信息流 实现 了 连接 和 会 话 的 建立 、 断开 SS ， 以及 控制 信息 S 和 数据 S 的 交换 ， 信息流 的 实现 是 基于 DSMCCDigitalStorageMediaCommandandControl 数字 存储 媒体 命令 与 控制协议 。 图 　 通用 DAVIC 模型 　 　 通过 DSMCC 用户 网络连接 建立 了 初始 连接 和 配置 通过 信息流 S 与 S 之后 ， DSMCC 用户 用户 连接 协议 栈 能够 通过 S 信息流 进行 可靠 的 控制 信息 交换 。 VoD 应用程序 利用 DSMCC 用户 用户 协议 提供 的 服务 从 服务器 获取信息 以供 STU 使用 。 这些 服务 包括 会话 、 文件 和 目录 服务 。 这些 服务 允许 VoD 应用程序 建立 一个 会话 ， 浏览 目录 和 从 服务区 上 获取 文件 。 这些 文件 本身 可以 被 VoD 应用程序 使用 例如 包含 用户界面 的 图象 和 位图 。 　 　 信息流 S 用来 传输 MPEG 数据 。 当 用户 选择 了 观看 某 一部 电影 时 ， S 连接 在 STU 和 VoD 服务器之间 建立 。 STU 中 的 多路 复接 解码 设备 处理 收到 的 数据 并 向 用户 显示 。 基于 Java 的 VoD 系统 　 　 Java 这一 网络 环境 下 的 编程语言 ， 刚一 问世 就 吸引 了 众人 的 目光 ， 给 开发人员 带来 了 无限 的 希望 ， 现已 成为 计算机 界 最 热门 的 课题 之一 。 Java 语言 有 许多 优势 ， 实现 了 平台 独立性 ， 在 很大 程度 上 减少 了 软件 升级 与 维护 的 工作量 ， 降低 了 系统 的 开发 运行 成本 。 　 　 所谓 Java 并 不仅仅 是 一种 计算机 语言 ， 它 包括 了 如下 的 组成部分 ： Java 语言 、 Java 虚拟机 VirtualMachine 、 Java 基本 应用 程序接口 BaseAPI 和 Java 标准 延伸 接口 StandardExtensionAPI 。 Java 源程序 经过 编译 后 产生 Java 字节 码 ByteCode ， 字节 码不随 操作系统 的 改变 而 改变 ， 可以 被 不同 操作系统 下 的 虚拟机 解释 ， 实现 了 Java 多 平台 下 运行 的 兼容性 。 一种 平台 下 开发 的 Java 程序 ， 可以 在 多种 平台 下 的 虚拟机 中 运行 ， 而 无需 像 C 那样 需要 针对 不同 的 平台 对 源程序 进行 修改 ， 运行 重新 编译 、 连接 。 　 　 从 Java 的 这 一 特点 中 ， 不难理解 为什么 互联网络 对 Java 的 成功 具有 如此 重要 的 意义 ： 只有 Java 可以 在 互联网络 的 多 平台 下 运行 。 Java 的 成功 大大 增强 了 互联网络 的 交互性 。 作为 一种 网络 开发 系统 ， Java 具有 很 宽广 的 应用 范围 和 领域 。 今天 ， 嵌入式 Java 已 成为 现实 ， 在 与 网络 有关 的 应用 中 应用 得 更是 广泛 。 Java 的 分布式 作业 机制 DistributedComputingArchitecture 使 Java 不仅 可 在 多 平台 下 运行 ， 而且 可以 与 多种语言 接口 。 　 　 点播 视频 服务器 由 一个 服务器 目录 结构 组成 ， 它 包括 视频 信息流 、 实现 用户 菜单 和 界面 的 Java 对象 以及 界面 中 用到 的 位图 和 图象 文件 。 用户 将 它们 的 STU 连接 到 服务器 的 途径 有 两种 ： 使用 Internet 浏览器 同时 启动 一个 小 程序 或是 通过 一个 小型 的 专用 Java 程序 可以 用 DSMCC 的 下载 协议 来 实现 来 获取 初始 的 应用程序 ， 这一 过程 称为 摮 跏 蓟 瘮 。 获取 的 这个 程序 可以 让 用户 通过 DSMCC 的 会 话 服务 连 上 一个 VoD 服务器 并 借助于 文件 和 目录 服务 得到 真正 的 VoD 应用程序 。 　 　 如图 中 深色 部分 所示 ， 我们 的 VoD 程序 建立 在 DSMCC 的 用户 用户服务 之上 。 上半 部分 包括 两个 组件 ： 一个 是 建立 初始 连接 的 静态 初始化 组件 Init ； 一个 是 实际 的 VoD 程序 Program 。 请 注意 在 会 话 开始 之前 只有 初始化 组件 驻留 在 客户端 。 实现 用户 菜单 的 VoD 程序 是从 服务器 动态 下载 的 ， 这 允许 服务提供者 修改 程序 而 不 对 客户端 进行 任何 改动 。 图 　 VoD 应用 结构 　 　 初始化 完成 后 ， 从 服务器 下载 的 VoD 程序 在 客户端 开始 执行 ， 并 实现 用户界面 和 与 服务器之间 的 信息 交换 。 当 用户 从 屏幕 菜单中选择 了 观看 某 一部 电影 时 ， 一个 DSMCC 的 流 服务 的 连接 在 STU 和 VoD 服务器之间 建立 ， 用来 传输 视频 数据 如 MPEG ， STU 中 的 解码 设备 处理 收到 的 数据 并 向 用户 显示 。 　 　 应用层 中 的 会 话 组件 为 初始化 提供 了 连接 和 断开 的 功能 。 这些 功能 被 直接 映射 到 DSMCC 用户 用户 协议 会话 的 调用 。 装载 程序实现 了 文件 获取 功能 ， 对类 和 数据 一样 适用 ： 类 从 服务器 上 下载 后 动态 地 加入 到 运行 环境 中 ， 位图 和 图象 等 数据文件 下载 后供 程序 使用 。 装载 程序 通过 文件 服务 获取 被 请求 的 信息 ， 同时 通过 目录 服务 打开 和 关闭 服务器 上 的 目录 ， 并 控制 一个 流 的 摿 鲾 界面 直接 位于 流 服务 之上 。 　 　 VoD 程序 的 用户界面 模块 由 一些 Java 对象 来 实现 ， Java 包含 了 一套 强大 的 图形界面 类库 ， 可 在 不同 平台 上 实现 相同 的 图形界面 。 在 Java 图形 类库 的 基础 上 ， 可 实现 一系列 基本 组件 ， VoD 程序 通过 组合 不同 的 基本 组件 ， 实现 各种各样 的 用户界面 。 　 　 VoD 程序执行 时 ， 首先 通过 得到 一个 位于 缺省 服务器 上 VODManager 对象 ， VODManager 对象 提供 给 用户 服务器 上 现有 服务 对象 的 列表 ， 经 用户 选择 之后 得到 相应 的 VODServer 对象 。 VODServer 对象 可能 位于 网络 的 任何 位置 ， 它 向 用户 提供 导航 和 控制 的 菜单 通过 调用 GetPrograms 方法 ， 一个 简单 菜单 的 例子 向 用户 展示 服务器 上 的 电影 列表 ， 用户 从中 作出 选择 ， 当 用户 选择 了 节目 之后 ， 将 通过 VODServer 对象 建立 一个 DSMCC 的 流 服务 的 连接 ， 来 将 视频 数据流 传输 至 浏览器 或 STU 。 　 　 访问 VoD 服务器 有 两种 途径 ： 通过 Web 浏览器 或 机顶 设备 STUSetTopUnit 。 若 通过 前者 只 需 简单 地 选择 这个 VoD 服务器 的 网页 就行了 ， 一个 从 网页 中 执行 的 小 程序 将 同 基于 DAVIC 的 VoD 服务器 建立 S 控制 连接 。 如果 使用 的 STU 不 具备 Internet 访问 能力 ， 而是 一个 DAVIC 兼容 的 STU ， STU 直接 与 VoD 服务器 建立 S 控制 连接 。 在 这 两种 情况 下 ， S 连接 建立 之后 ， 再 进行 下面 的 读 文件 和 目录 打开 定位 操作 已 从 VoD 服务器 上 获取 实际 的 VoD 程序 － 包括 Java 字节 码 和 图象 。 　 　 新 的 电影 或 节目 可以 通过 Internet 如 ftp 或 DSMCC 协议 添加 到 服务器 上 。 只要 添加 一些 Java 代码 就 可令 新 电影 出现 在 VoD 菜单 上 ， 提供 给 用户 电影 的 详细信息 。 系统 的 实现 　 　 视频点播 的 主要 媒介 之一 便是 有线电视 网 。 在 我国 广播电视 网有 其 独特 的 优势 ， 其一 是 覆盖面广 、 普及率 高 。 至 年底 ， 入网 户数 达到 万户 ， 且 每年 以 万户 的 速度 递增 ， 有线电视 网络 成为 入户 率 最高 的 信息网络 。 有线电视 网 的 另 一个 优势 是 入户 频带 宽 ， 适合 于 提供 宽带 功能 业务 ， 其 数据 传输速率 是 现在 公共 电话网 的 百倍 以上 。 因此 我国 当前 十分 适合 于 发展 基于 有线电视 网 的 视频点播 应用 ， 相信 在 不远 的 将来 数字视频 服务 将 成为 主要 的 市场份额 之一 。 　 　 机顶盒 作为 视频点播 系统 的 关键 部分 ， 是 一个 嵌入式 的 网络 用户 设备 ， 它 的 设计 是 实现 交互 视频 的 关键环节 之一 。 它 处于 电视 或 电脑 与 数字视频 网络 之间 ， 功能 包括 网络连接 ， 视频 解码 和 提供 一个 可 交互 执行 的 软件 。 一个 机顶盒 将 包括 CPU 、 网络接口 设备 、 视音频 解码 与 输出 和 其它 一些 部件 ， 目前 IDT 、 MIPS 以及 SUN 等 公司 都 将 向 机顶盒 提供 自己 的 芯片 ， 来 争夺 这一 市场 的 份额 。 我们 在 设计 中 面临 的 主要矛盾 是 ： 用户 对 网络应用 要求 正 日趋 多样化 和 不断 地 增长 ； 而 机顶盒 作为 应用 装置 ， 又 必须 考虑 其 实用性 、 可行性 和 经济性 。 在 机顶盒 设计 过程 中 ， 我们 必须 考虑 的 几个 主要 问题 是 ： 　 　 首先 ， 机顶盒 作为 一种 专用设备 ， 其 对 OS 的 要求 有 其 特殊性 ， 只要 能 运行 其 应用软件 就 可以 了 。 相比之下 ， JavaOS 就是 一个 很 好 的 选择 。 Java 的 平台 无关 性 使得 编写 的 应用程序 不 限制 于 一定 的 硬件平台 ， 只要 机顶盒 芯片 能够 运行 Java 程序 即可 。 　 　 其次 ， 由于 网络 信息 服务 的 多样性 ， 不 可能 在 一个 小小的 机顶盒 里 集成 所有 的 应用 ， 即使 能 做到 ， 网络应用 的 迅速 变化 也 不 允许 这样 做 。 也就是说 ， 机顶盒 所 提供 的 服务 必须 是 支持 动态 更新 的 。 使用 Java 不但 能 解决 服务 种类 的 多样性 以及 服务 频繁 更新 的 问题 ， 同时 由于 减少 了 应用程序 在 机顶盒 中 的 驻留 ， 实现 了 瘦 客户机 结构 ， 也 使得 机顶盒 设备 的 复杂程度 大大降低 。 　 　 最后 ， 可能 也 是 最 重要 的 一点 ， Java 使得 点播 电视 与 Internet 服务 的 集成 成为 可能 。 这样 ， 机顶盒 除了 访问 专门 的 视频 服务器 之外 ， 还 能 通过 有线电视 网络 访问 Internet 。 　 　 用 Java 开发 的 机顶盒 将 提供 一个 支持 下载 小 应用程序 Applet 的 交互式 软件 执行 环境 。 用户界面 和 具体 服务 并不需要 存放 在 机顶盒 中 ， 驻留 在 客户端 的 只是 一段 初始化 程序 ， 机顶盒 按 需要 下载 不同 的 小 应用程序 来 完成 多样化 的 功能 。 这样 ， 当 服务商 更改 它们 的 服务 内容 时 ， 只要 修改 服务器 上 的 服务 对象 就行了 ， 用户 的 机顶盒 程序 不 需作 任何 改变 。 　 　 用户 所 得到 的 服务 由 它们 所 下载 的 小 程序 决定 ， 而 实现 点播 视频 的 小 程序 与 其它 服务 对象 如可 提供 Internet 接入 的 并 无 本质 的 区别 ， 因此 Internet 和 点播 视频 服务 之间 可以 做到 无缝 集成 。 例如 在 网络 购物 服务 中 ， 销售商 的 应用程序 下载 到 顾客 家中 来 帮助 他们 完成 挑选 与 付款 的 过程 。 　 　 在 使用 Java 的 种种 优势 和 方便 的 同时 ， 其 自身 的 局限性 也 是 我们 必须 考虑 的 。 作为 一种 解释性 语言 ， Java 执行 速度 和 效率 的 问题 是 客观存在 的 ， 如何 保证系统 的 实时性 ， 是 设计 过程 中要 重点 考虑 的 。 在 系统 实现 中 ， 将 采取 各种 技术 使 系统 的 实时性 来得 更好 ， 如 点播 视频 服务 中 计算 量 最大 的 视频 解码 任务 ， 将 由 专门 的 硬件 完成 ， 同时 即时 编译器 JustInTimeCompiler 的 运用 也 将 提高 Java 的 运行 速度 。 结束语 　 　 本文 描述 了 基于 Java 实现 的 一个 视频点播 应用 。 基于 数字 影音 协会 DAVIC 的 客户服务器 系统 主要 包括 一个 视频 服务器 和 一个 机顶盒 客户端 ， 本文 主要 介绍 了 这个 系统 的 客户端 应用 的 实现 。 这个 系统 在 遵照 DAVIC 规范 的 同时 ， 也 实现 了 允许 DAVIC 服务 与 Internet 环境 的 集成 。 　 　 采用 基于 Java 体系 的 实现 VoD 应用 带来 了 一些 好处 。 首先 是 Java 的 平台 无关 性 使得 应用软件 可 在 二进制 代码 级 实现 重用 ， 提高 了 软件 的 模块化 程度 ； 其次 是 用 JavaCORBA 实现 允许 向 运行 环境 动态 添加 对象 ， 实现 了 客户端 应用程序 与 具体 服务 无关 ， 让 客户端 可 随时 反映 出 服务器 的 最新 信息 ， 降低 了 对 STU 的 资源 要求 ， 实现 了 撌 輸 客户端 模型 ； 最后 ， 同时 也许 是 最 重要 的 一点 ， 还 提供 了 一种 途径 将 DAVIC 服务 与 当前 十分 热门 并 还 在 不断 扩展 的 Internet 集成 。 戴海平 （ 上海交通大学 计算机科学 与 工程系 上海 ） 夏雨人 （ 上海交通大学 计算机科学 与 工程系 上海 ） 参考文献 ， DigitalAudioVisualCouncilDAVICSpecificationSep ， CORBAtheCommonObjectRequestBrokerArchitectureandSpecificationRevisionObjectManagementGroupOMGJulyl ， InformationTechnologyGenericCodingofMovingPicturesandAssociatedAudioDigitalStorageMediaCommandandControlISOIECInternationalStandardISOIECJTCSCWGMPEGNpJulyl ， PeterVarholJavainEmbeddedsystemsDesignComputerDesignMarchp ， AIexDeJongKarenHsingandDavidSuAVoDApplicationImplementedinJavaMultimediaToolsandApplicationVnSeplp ， KiyoshiKohiyamaetalArchitectureofMPEGDigitalSettopboxforCATVVoDSystemIEEETransactionsonConsumerElectronicsVAuglp ， PeterVarholDesigningComponentsforSettopBoxesComputerDesignAugp ， WinstonWilliamHodge 著钟 玉琢 乔秉新 等 译 交互式 电视 技术 棗 多媒体技术 综合 指南 北京 电子 工业 出版社 年 月 ， SuleimanSamLalniKrisJamsaPhD 著扬 武杰 等 译 Java 编程 与 实例 北京 电子 工业 出版社 年 月 收稿 日期 ： 年月日