软件 学报 JOURNALOFSOFTWARE 年 第期 No 一种 基于 模式 的 圆 的 识别 算法 李伟青 　 彭 群生 　 　 摘要 　 在 工程图纸 计算机 输入 识别 和 理解 系统 中圆 和 圆弧 的 识别 转换 是 一个 尚未 彻底解决 的 难题 文章 介绍 了 整体 识别方法 的 主要 概念 和 图段 数据结构 在 此基础 上 提出 了 圆 的 识别 算法 算法 首先 将 图段 与 圆 的 两类 模式 进行 匹配 从而 确定 圆 的 种子 图段 然后 通过 对 其他 图段 实施 跟踪 最终 获得 圆 和 圆弧 的 图形 表示 最后 给出 了 实例 结果表明 该 识别 算法 较 好地解决 了 图纸 识别 中 的 一个 关键问题 具有 适应性 强 、 高效 可靠 的 特点 　 　 关键词 　 整体 识别 矢量化 细化 　 　 中图法 分类号 　 TPAPatternBasedCircularArcRecognitionAlgorithmLIWeiqingPENGQunsheng 　 　 Abstract 　 CirculararcrecognitionisadifficultproblemthatisnotentirelysolvedinengineeringdrawingrecognitionandunderstandingresearchfieldInthispapersomeconceptsofglobalrecognitionmethodandpatchstructureareintroducedandacirculararcrecognitionalgorithmisprovidedThealgorithmmatchesseveralpatcheswithtwopatternstodecidetheseedsandthenbytracingtheotherpatchesitconvertsthesepatchesintocirculararcsExamplesaregivenwhichshowthatthealgorithmhaseffectivelysolvedakeyproblemofrecognizingdrawingsaregiven 　 　 Keywords 　 Globalrecognitionvectorizationthinning 　 　 在 工程图纸 矢量 转换 的 众多 问题 中圆 的 识别 是 目前 尚未 解决 的 关键问题 之一 细化 方法 ［ ］ 用 模板 与 像素 进行 匹配 找出 中心 骨架 像素 并用 短 折线 拟合 该 方法 简单易行 但 图像 中 的 缺陷 对 最终 结果 的 影响 较大 轮廓 匹配 方法 ［ ］ 通过 跟踪 轮廓 像素 和 匹配 轮廓 矢量 得到 图线 的 中间 骨架 矢量 该 方法 有效 地 避免 了 缺陷 的 不利 影响 但 匹配 过程 复杂 正确性 难以 保证 两种 方法 直接 在 像素 层次 上 操作 并用 一系列 直线 段 去 逼近 圆 和 圆弧 因而 难以获得 圆 的 图形 表达形式 　 　 整体 识别方法 ［ ］ 力求 从 整体 上 把握 图纸 中 各种 线型 及其 关系 它 将 图像 组织 成图 段 数据结构 据此 求取 线型 的 参数 并 进行 跟踪 最终 提取 各类 线型 该 方法 不 拘泥于 图像 的 局部 像素 细节 因此 图像 中 的 缺陷 对 最终 结果 的 影响 较 小 在 图像编码 过程 中 线型 之间 的 拓扑 关系 已能 在 图段 数据结构 中 得到 体现 在 矢量 转换 过程 中 拓扑 结构 始终 得到 保证 因而 有利于 对 图纸 进行 图形 重建 　 　 文献 ［ ］ 对 直线 段 的 识别 提供 了 较 好 的 算法 但是 对 圆 的 识别 问题 却 未作 深入 的 研究 文献 ［ ］ 利用 整体 识别方法 识别 圆 和 圆弧 时先 将 图段 转换成 直线 段 在 直线 段 数目 超过 时才 可 确定 圆 的 几何 参数 这 就 使得 原有 的 图像 信息 在 圆 的 转换 过程 中 没能 充分 得到 利用 该 方法 对于 图纸 中 半径 较 小 的 圆则 无能为力 　 　 本文 提出 的 圆 的 识别 算法 将 图段 与 圆 的 两类 模式 进行 匹配 来 确定 种子 图段 通过 对 其他 图段 实施 跟踪 从而 获得 圆 和 圆弧 的 图形 表示 下面 首先 介绍 有关 概念 和 图段 结构 然后 给出 图段 的 分割 方法 并 提出 圆 的 两类 模式 和 基于 模式 的 圆 的 识别 算法 最后 对 算法 进行 讨论 并 给出 了 实验 结果 整体 识别方法 的 概念 和 数据结构 扫描 段 　 　 在 同 一条 扫描线 上 由 多个 连续 的 黑 像素 组成 的 像素 的 集合 称为 扫描 段用 sij 或 （ xijxij ） 表示 第 i 行 扫描线 上 的 第 j 条 扫描 段 重叠 关系 　 　 对于 扫描 段 sij 和 sik 如果 满足 xij ≤ xik ≤ xij 或 xik ≤ xij ≤ xik 则 称 它们 具有 重叠 关系 如果 sij 和 sik 具有 重叠 关系 sij 和 第 il 行 扫描线 上 的 其他 扫描 段 都 没有 重叠 关系 同时 sik 和 第 i 行 扫描线 上 的 其他 扫描 段 也 都 没有 重叠 关系 那么 称 sij 和 sik 为 一对一 重叠 图段 　 　 具有 一对一 重叠 关系 的 所有 扫描 段 组成 的 集合 称为 一个 图段 图 表示 了 个 不同 的 图段 图 　 个 不同 的 图段 父子关系 　 　 如果 图段 p 的 最后 一条 扫描 段 与 图段 q 的 第条 扫描 段 有 重叠 关系 那么 称图 段 p 和 图段 q 为 父子关系 图中 图段 p 与 图段 q 、 图段 p 与 图段 r 都 属于 父子关系 兄弟 关系 　 　 如果 图段 q 的 第条 （ 或 最后 条 ） 扫描 段 与 图段 r 的 第条 （ 或 最后 条 ） 扫描 段 处于 同 一条 扫描线 上且 它们 都 与 图段 p 构成 父子关系 那么 称图 段 q 和 图段 r 为 兄弟 关系 （ 如图所示 ） 　 　 扫描 段 数据结构 为 　 　 typedefstruct 　 　 　 　 intxstartxend 扫描 段 两个 端点 的 x 坐标值 　 　 SCANSEG 　 　 图段 数据结构 为 　 　 typedefstruct 　 　 　 　 intystartyend 图段 中 第条 和 最后 一条 扫描 段 的 y 坐标值 　 　 　 　 inttopbottom 连接 与 图段 存在 父子 、 兄弟 关系 的 其他 图段 　 　 　 　 SCANSEGseg 指向 图段 所 包含 的 扫描 段 数组 的 指针 　 　 PATCH 圆 的 识别 算法 图段 分割 　 　 如果 图段 经过 采样 求得 参数 后能 完全 确定 其 属性 那么 该 图段 为 简单 图段 如果 图段 既 不 属于 直线 段 也 不 属于 圆 那么 该 图段 为 复杂 图段 　 　 对 复杂 图段 必须 进行 分割 从中 分离 出 各个 简单 图段 复杂 图段 通常 有类 直线 与 直线 相接 、 圆 与 圆 相接 以及 直线 与 圆 相接 投影 分割 算法 ［ ］ 能 较 好 地 处理 直线 与 直线 相接 的 复杂 图段 此处 着重 解决 后 两类 情况 　 　 理想 状态 下 直线 图段 每 一点 处 的 二阶 差 分为 零而圆 图段 的 每 一点 处 的 二阶 差分 均 不 相同 由此 可以 计算 出 复杂 图段 中 各点 处 的 二阶 差分 并 对 二阶 差分 进行 累加 直线 的 二阶 差分 累加 和 可用 水平线 来 拟合 圆 的 二阶 差分 累加 和 可用 斜率 非零 的 直线 来 拟合 图 表示 了 圆弧 段 与 圆弧 段 、 圆弧 段 与 直线 段 相 联结 的 二阶 差分 累加 和 曲线 点 p 为 两 线型 的 连接点 图 　 二阶 差分 和 曲线 圆 的 两个 模式 　 　 图段 数据结构 以 扫描 段 形式 保存 原始 图像 数据 如果 扫描 段 sij 的 长度 xijxij 大于 一个 给定 的 阈值 可以 断定 该 扫描 段 属于 一条 水平线 因此 在 矢量 转换 过程 的 开始 可以 首先 处理 水平线 然后 再 转换 圆 　 　 根据 制图 规则 在 绘制 圆 或 圆弧 时 通常 应 将 它们 的 对称中心 线 一并 画出 对称中心 线 通常 由 一条 水平线 和 一条 竖 直线 构成 如果 水平线 能 被 正确 识别 可 由此 入手 寻找 圆 的 种子 图段 另一方面 半径 较大 的 圆 的 顶部 或 底部 的 图段 也 会 因为 存在 较长 的 扫描 段 而 被 识别 成 水平线 这 也 可 成为 寻找 种子 图段 的 入口 　 　 针对 上述 情形 我们 引入 了 圆 的 两个 模式 分别 如图 、 所示 其中 h 为 水平线 阴影 区域 为 图段 显然 它们 都 可能 会 有 一些 变化 形式 种子 图段 的 确定 　 　 对于 模式 求 初始 几何 参数 时 的 点 取法 为 第点 取自 图段 的 处 第点 取自 水平线 h 第点 取自 图段 的 处点 分别 如图 中 的 pq 和 r 所示 图 　 模式 　 　 对于 模式 求 初始 几何 参数 时 的 点 取法 为 第点 取自 图段 的 处 第点 取自 水平线 h 第点 取自 图段 的 处点 分别 如图 中 的 pq 和 r 所示 图 　 模式 　 　 由 水平线 出发 寻找 符合 上述 模式 的 图段 选取 个点 求得 初始 参数 后 应对 这些 图段 的 合法性 作 进一步 检查 即 检查 模式 中 的 图段 、 和 模式 中 的 图段 、 以 决定 它们 是否 确实 能 共圆 如果 图段 是 一个 合法 的 圆弧 图段 则 可 将 它们 作为 种子 图段 图段 跟踪 　 　 从 一个 种子 图段 出发 根据 图段 之间 的 相互 关系 按 一定 的 规则 往前 跟踪 找出 下 一个 属于 同一 圆 的 图段 这 就是 图段 的 跟踪 过程 刚 开始 跟踪 时 的 初始 图段 被 分别 标识 为 起始 图段 和 终止 图段 每 跟踪 出 一个 图段 便 把 新 的 图段 作为 起始 图段 每次 跟踪 时 记录 下 一个 图段 所处 的 位置 （ 是 左 半圆 还是 右 半圆 ） 、 跟踪 方向 （ 向上 或 向下 跟踪 ） 、 走势 （ 顺时针 或 逆时针 ） 　 　 在 图段 的 跟踪 方向 上 可能 会 有 多个 图段 与 之 相连接 此时 需要 考虑 下列 种 情况 　 　 　 如果 某一图 段 p 的 每 一条 扫描 段 （ 在 允许 的 误差 范围 内 ） 均 被 已 求得 的 圆 穿过 表明 p 正是 要 找 的 图段 如果 图段 p 的 扫描 段数 超过 一个 给定 的 阈值 那么 必须 重新 调整 圆 的 几何 参数 　 　 　 如果 不 存在 上述 类型 的 图段 那么 需要 判断 一下 当前 被 跟踪 的 图段 p 是否 为 圆 的 顶部 （ 或 底部 ） 图段 若 是 则 从 该 图段 出发 改变 下一图 段 所处 位置 （ 左 半圆 改为 右 半圆 反之亦然 ） 、 跟踪 方向 （ 向上 跟踪 改为 向下 跟踪 反之亦然 ） 同时 将 图段 p 标记 为 起始 图段 　 　 　 如果 排除 了 上述 两种 情形 那么 应 考虑 是否 满足 下列 任何 一条 终止 条件 以 决定 是否 要 继续 跟踪 ① 在 跟踪 方向 上 不再 有 图段 ② 在 跟踪 方向 上 的 图段 不 属于 该 圆 ③ 在 跟踪 方向 上 的 图段 为 终止 图段 　 　 对于 条件 ③ 而言 从 起始 图段 向前 跟踪 最终 找到 了 终止 图段 （ 如 模式 中 从 图段 出发 按 顺时针 方向 跟踪 最终 到达 图段 ） 表明 一个整 圆 被 成功 提取 否则 因 条件 ① 、 ② 而 终止 时 必须 互换 起始 图段 和 终止 图段 从 新 的 起始 图段 （ 原先 的 终止 图段 ） 及 新 的 图段 位置 、 跟踪 方向 和 走势 向前 跟踪 讨论 和 实例 　 　 基于 图段 结构 的 整体 识别方法 已经 在 浙江大学 CADCG 国家 重点 实验室 研制 的 “ 工程图纸 扫描 输入 、 识别系统 ” 中 予以 实现 图 、 图 分别 给出 了 两个 实例 它们 已经 过 图像处理 和 字符 的 分离 过程 图 、 图 分别 为 矢量化 结果 由 结果 可以 看出 基于 整体 识别方法 的 圆 的 识别 算法 具有 很强 的 识别 能力 能 处理 绝大部分 的 圆 而且 最终 识别 的 结果 与 原有 图纸 吻合 得 比较 好 　 　 　 　 　 　 　 　 　 　 　 　 　 　 图 　 图纸 的 图像 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 图 　 矢量 转换 结果 　 　 　 　 　 　 　 　 　 　 　 　 　 　 图 　 图纸 的 图像 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 图 　 矢量 转换 结果 　 　 从 图例 中 能够 看出 识别 一些 短小 的 圆弧 段时 仍会 遇到 一些 困难 原因 是 这些 圆弧 段 所能 提供 的 有效 信息 过少 以至于 难以 将 它们 与 小 直线 段 区分 开 　 　 整体 识别方法 还有 许多 值得 完善 的 地方 它 最 困难 之处 是 短小 线型 的 转换 的 正确性 不高 这 还 有待于 进一步 的 研究 作者 介绍 ： 李伟 青年 生 博士 讲师 主要 研究 领域 为 工程图纸 扫描 识别 三维 几何 造型 　 　 　 　 　 彭 群生 年生 博士 教授 ， 博士生 导师 主要 研究 领域 为 计算机 图形学 产品 信息 模型 工程图 扫描 识别 等 本文 通讯联系 人 彭 群生 ， 杭州 浙江大学 CADCG 国家 重点 实验室 作者 单位 ： 李伟青 　 彭 群生 　 浙江大学 CADCG 国家 重点 实验室 杭州 　 参考文献 　 ［ ］ SmithRWComputerprocessingoflineimagesasurveyPatternRecognition ～ 　 ［ ］ ShaoxingZNishiharaSEliminatingshapedistortionsinthinningofengineeringdrawingsInStaudhammerJPengQunshengedsProceedingsofCADGraphicsHangzhou ～ 　 ［ ］ YangLiruiZhouJiContourshapeanalysisdirectedvectorizationofengineeringdrawingsInYangSZhouJiLiCedsProceedingsoftheCADGraphicsWuhan ～ 　 ［ ］ JiangHuaetalKnowledgebasedmechanicaldrawinginterpretationInYangSZhouJiLiCedsProceedingsoftheCADGraphicsWuhanInternationalAcademicPublishers ～ 　 ［ ］ 谭建荣 工程图纸 扫描 图像 的 整体 识别 及 图形 重建 研究 ［ 博士学位 论文 ］ 浙江大学 TanJianrongResearchonglobalrecognitionandgraphreconstructionofscannedimageofengineeringdrawings ［ PhDThesis ］ ZhejiangUniversity 　 ［ ］ 谭建荣 彭 群生 基于 图形 约束 的 工程图 扫描 图像 直线 整体 识别方法 计算机 学报 ～ TanJianrongPengQunshengAgloballinerecognitionapproachtoscannedimageofengineeringdrawingsbasedongraphicsconstraintChineseJournalofComputers ～ 　 ［ ］ 陈勇 朱林常明 机械 图纸 中 直线 圆弧 的 整体 识别方法 计算机辅助 设计 与 图形学 学报 增刊 ～ ChenYongZhuLinChangMingAgloballineandarcrecognitionapproachtoscannedimageofmechanicaldrawingsJournalofComputerAidedDesignandComputerGraphicssupplement ～ 本文 收到 原稿 收到 修改稿