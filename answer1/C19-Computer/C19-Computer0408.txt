信息 与 控制 InformationandControl 年 　 第卷 　 第期 　 Vol 　 No 　 虚拟 轴 数控机床 刀具 运动 状态 的 实时 规划 周 　 凯 　 　 摘 　 要 ： 提出 了 虚拟 轴 数控机床 的 递阶控制 方法 并 着重 介绍 了 递阶控制 的 第一级 — — 刀具 运动 状态 实时 规划 所 涉及 的 切削 路径 生成 、 刀具 运动 路径 计算 和 刀具 运动 姿态 规划 三个 关键问题 的 求解 过程 为 虚拟 轴 机床 数控系统 的 研究 开发 奠定 了 必要 的 理论 与 技术 基础 ． 　 　 关键词 ： 虚拟 轴 机床 ， 数控 ， 路径 ， 姿态 ， 实时 规划 　 　 中 图 分类号 ： TH 　 　 　 　 　 　 文献 标识码 ： BREALTIMEPLANNINGOFTOOLMOTIONSTATEFORVIRTUALAXISNCMACHINETOOLSZHOUKaiDeptofPrecisionMachineryTsinghuaUniversityBeijingAbstractThehierarchicalcontrolmethodofvirtualaxisNCmachinetoolsispresentedandthefirstlevelofthehierarchicalcontrolsystemisemphaticallydiscussedThisleveldealswiththetaskofrealtimeplanningoftoolmotionstateandinvolvesthreekeyproblemswhicharecuttingpathgenerationtoolpathcalculationandtoolattitudeplanningThesolvingprocessesofthethreeproblemsaregivenTheseresultslayafoundationfortheresearchanddevelopmentofthenumericalcontrolsystemofvirtualaxismachinetoolsKeywordsvirtualaxismachinetoolnumericalcontrolpathattituderealtimeplanning 　 前言 　 　 年 月 芝加哥 IMTS 国际 展览会 上 美国 GiddingsLewis 公司 推出 了 费时 年 研制成功 的 虚拟 轴 数控机床 — — VARIAX 加工 中心 ， 受到 举世瞩目 ． 这种 新型 机床 完全 打破 了 传统 机床 结构 的 概念 ， 抛弃 了 固定 导轨 刀具 导向 方式 ， 转而 采用 由 六 可变 长度 杆 驱动 主轴 作多 自由度 运动 的 并联 闭链 结构 ， 因而 不仅 加工 的 自由度 增加 ， 可以 加工 更为 复杂 的 零件 ， 而且 更为重要 的 是 ， 这种 新型 机床 的 刚度 比 传统 机床 提高 五倍 以上 ［ ］ ， 使 加工 精度 和 加工 质量 大为 提高 ， 此外 在 加工 速度 上 也 比 常规 机床 提高 数倍 以上 ， 从而 满足 了 正在 发展 的 高速 加工 的 需要 ． 鉴于 虚拟 轴 机床 具有 上述 众多 优点 ， 并 对 推动 机床 、 制造 以及 相关 学科 和 产业 的 发展 具有 重要 意义 ， 它 的 研究 与 开发 得到 了 世界 各国 的 广泛 重视 ， 已 成为 国际 上 机床 研究 领域 的 一个 热点 ［ ］ ． 　 　 通过 对 虚拟 轴 机床 的 分析 可以 看到 这种 机床 的 最大 特点 是 机械 结构 简单 而 控制 复杂 ． 因此 ， 要 结合 国情 研究 开发 具有 中国 特色 的 虚拟 轴 数控机床 产品 ， 必须 首先 解决 其 控制 问题 ， 研究 开发 出 高性能 的 虚拟 轴 机床 数控系统 ． 　 　 考虑 到 虚拟 轴 机床 控制 的 复杂性 本文 提出 一种 解决 其 控制 问题 的 递阶控制 方法 ， 并 着重 介绍 了 递阶控制 的 第一级 — — 刀具 运动 状态 实时 规划 所 涉及 的 切削 路径 实时 生成 、 刀具 运动 路径 计算 和 刀具 运动 姿态 规划 三个 关键问题 的 求解 过程 为 虚拟 轴 机床 数控系统 的 研究 开发 奠定 了 必要 的 理论 与 技术 基础 ． 　 虚拟 轴 机床 控制 的 基本原理 　 　 虚拟 轴 机床 的 典型 结构 为 六杆 平台 结构 ， 即 由 六根 可变 长度 杆 驱动 一 活动 平台 （ 其上 装有 主轴 单元 ） ， 六 驱动 杆 的 另一端 固定 于 基础 框架 （ 静 平台 ） 上 ． 调节 六 驱动 杆 的 长度 ， 可 使 主轴 和 刀具 作六 自由度 运动 ． 　 　 那么 应 如何 控制 这 六根 驱动 杆 的 长度 才能 使 刀具 的 运动 状态 轨迹 和 姿态 满足 加工 要求 这 便是 虚拟 轴 机床 控制 的 核心 问题 ． 解决 这一 问题 的 基本思路 是 分 两步走 第一步 先 根据 输入 信息 对 刀具 的 运动 状态 进行 实时 规划 即 求解 出 各 虚拟 轴 的 希望 运动量 第二步 再 将 虚拟 轴 的 希望 运动量 转换 为 六 驱动 杆 的 运动 指令 值 并 据此 对 各杆 的 长度 进行 实时控制 ． 通过 这一 由 规划 与 控制 实现 的 虚 到 实 的 变换 ， 以及 由 机床 结构 隐含 实现 的 实到 虚 的 逆变换 即可 得到 所 要求 的 刀具 运动 姿态 和 轨迹 ． 根据上述 思路 ， 本文 提出 一种 两级 递阶控制 方案 ， 其 基本原理 可 通过 图 进行 说明 ． 图 虚拟 轴 机床 递阶控制 原理 框图 　 　 由图 可见 ， 递阶控制 的 第一级 为 刀具 运动 状态 实时 规划 其 主要 任务 是 根据 输入 给 控制系统 的 被 加工 零件 的 几何 工艺 信息 ， 对 刀具 的 希望 运动 状态 进行 实时 规划 ， 产生 虚拟 轴 X 、 Y 、 Z 、 A 、 B 、 C 的 运动 指令 ． 完成 这一 任务 包括 三个 步骤 第一步 由 切削 路径 生成 模块 根据 输入 信息 实时 生成 被 加工 表面 上 的 切削 路径 ， 即 刀具 与 加工 表面 接触点 的 移动 路径 ． 第二步 由 刀具 运动 路径 计算 模块 对 线性 虚拟 轴 X 、 Y 、 Z 的 运动量 进行 计算 主要 内容 是 计算 切削 路径 上 各 离散 点处 的 法线 矢量 ， 并 根据 刀具 尺寸 在 各 离散 点处 沿 法线 方向 求得 所 希望 的 刀具 球心 坐标 位置 ． 第三步 由 刀具 姿态 求解 模块 对 转动 虚拟 轴 A 、 B 、 C 的 运动 进行 规划 主要 内容 是 根据 所 要求 的 刀具 轴线 与 切削 点 法线 间 的 关系 以及 允许 的 主轴 姿态 空间 求解 出 最优 或 可行 的 刀具 运动 姿态 ． 　 　 递阶控制 的 第二级 为 刀具 运动 状态 实时控制 主要 任务 是 按进 给 速度 要求 将 刀具 希望 状态 转换 为 各 采样 周期 驱动 杆 的 给定 长度 并 据此 对 实轴 进行 联动 控制 以 使 刀具 的 实际 运动 状态 与 规划 的 运动 状态 相符合 ． 第二级 的 控制 问题 在 文中 作 过 详细 介绍 ． 本文 着重 介绍 递阶控制 的 第一级 所 涉及 的 切削 路径 实时 生成 、 刀具 运动 路径 计算 和 刀具 运动 姿态 规划 三个 关键问题 的 求解 过程 ． 　 切削 路径 实时 生成 　 　 设 零件 被 加工 表面 可用 双 三次 B 样条 曲面 表示 ， 其 表达式 为 Xuv ＝ UMPxMTVT 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 Yuv ＝ UMPyMTVT 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 Zuv ＝ UMPzMTVT 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 式 中 Xuv 、 Yuv 、 Zuv — B 样条 曲面 上任 一点 的 坐标值 　 　 　 u 、 v — 参变量 ， U ＝ uuu ， V ＝ vvv 　 　 　 M — 常数 矩阵 　 　 　 Px 、 Py 、 Pz — 几何 系数 矩阵 ， 包含 了 B 样条 曲面 的 全部 几何 信息 ． 　 　 切削 路径 实时 生成 解决 如何 根据 B 样条 曲面 表达式 和 加工 工艺 信息 实时 计算 出 刀具 切削 点 移动 路径 上 各 离散 点 的 坐标值 ． 为此 ， 首先 用 相互 平行 的 切削 平面 切割 零件 加工 表面 得 希望 切削 路径 ． 显然 ， 第 k 条 希望 切削 路径 为 第 k 个 切削 平面 上 的 一条 曲线 其 uv 域 表达式 为 AkXuvBkYuvCkZuvDk ＝ 　 　 　 　 　 　 　 　 　 　 　 　 　 　 实际 控制 时 需用 直线 段 L … LiLi … 来 逼近 希望 切削 路径 逐步 得到 其上 各 离散 点 P … PiPi … 的 坐标值 ． 为此 需 建立 由 已知 点 Pi 求 Pi 的 算法 ． 下面 从求 弦 长 Li 着手 进行 讨论 ． 根据 弦 与 弧间 的 误差 关系 有 Li ／ ＝ ρ － ρ － δ 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 式 中 δ — 实际 切削 路径 弦 Li 与 希望 切削 路径 间 的 允许 误差 　 　 ρ — Pi 点处 切削 路径 的 曲率 半径 　 　 由此 求得 Pi 点 与 Pi 点间 的 弦 长 Li 其 表达式 为 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 下 一步 的 任务 是 求出 参变量 u 或 v 对弦长 L 的 变化率 ． 为此 先 让 参变量 u 取一 增量 Δ u 得 iui Δ u 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 式 中 i — Pi 点处 参变量 u 的 估计值 　 　 ui — Pi 点处 参变量 u 的 实际 取值 　 　 Δ u — 切削 点 从 Pi 移至 Pi 时 u 的 增量 然后 将 i 代入 切削 路径 的 uv 域 表达式 解出 vi 的 估计值 i ． 将 i 、 i 代入 式 得到 Pi 点 的 坐标 估计值 ． 按下式 可 计算 出 与 Δ u 相对 应 的 弦 长 增量 　 　 　 　 　 　 　 　 　 由此 得到 参变量 u 对弦长 L 的 平均 变化率 k Δ u Δ L 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 根据 上面 已 求得 的 弦 长 Li 和 参变量 u 对弦长 L 的 变化率 便 可 计算 出 Pi 点处 u 的 实际 取值 ui ＝ uikLi 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 再 将 ui 代入 式 可 解出 v 在 Pi 处 的 实际 取值 vi ． 　 　 最后 ， 将 ui 和 vi 代入 B 样条 曲面 表达式 即可 得到 Pi 点 的 坐标值 ． 　 刀具 运动 路径 计算 　 　 刀具 运动 路径 是 指 刀具 上 某 一点 如球头 中心 的 移动 路径 ． 刀具 运动 路径 的 求取 需经 两步 完成 ， 第一步 先 根据 加工 表面 几何 信息 求取 切削 点 单位 法线 矢量 Nuv 第二步 再 根据 刀具 信息 和 已 求得 的 法矢 信息 求取 与 切削 点 序列 相对 应 的 刀具 运动 路径 的 离散 点 序列 ， 即 离散 化 的 刀具 路径 ． 为求 出 单位 法矢 需先 按 下式 求出 切削 点 法线 矢量 NMuv ＝ NMxuviNMyuvjNMzuvk 　 　 　 　 　 　 　 　 式 中 i 、 j 、 k — X 、 Y 、 Z 轴 方向 的 单位 矢量 　 　 NMxuvNMyuvNMzuv — 切削 点法 矢 NMuv 在 X 、 Y 、 Z 坐标轴 上 的 分量 　 　 然后 根据 法矢 分量 求得 法矢 的 长度 　 　 　 　 　 　 　 　 　 　 　 进一步 即可 求得 单位 法矢 NuvNxuviNyuvjNzuvk 　 　 　 　 　 　 　 　 　 　 　 式 中 NxuvNyuvNzuv — — 单位 法矢 Nuv 在 X 、 Y 、 Z 坐标轴 方向 的 分量 NxuvNMxuv ／ NMuv 　 　 　 　 　 　 　 　 　 　 　 　 　 　 NyuvNMyuv ／ NMuv 　 　 　 　 　 　 　 　 　 　 　 　 　 　 NzuvNMzuv ／ NMuv 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 使用 球头 铣刀 时 ， 在 求得 单位 法矢后 ， 沿法 矢 方向 偏移 刀具 半径 r 即可 得到 以 刀具 球心 坐标 表示 的 刀具 路径 Xcuv ＝ XuvrNxuv 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 Ycuv ＝ YuvrNyuv 　 　 　 　 　 　 　 　 　 　 　 　 　 Zcuv ＝ ZuvrNzuv 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 如果 使用 的 是非 球头 铣刀 ， 则 需 根据 刀具 的 具体 几何 形状 来 计算 刀具 路径 ． 　 　 最后 ， 将 Pi 点处 的 u 、 v 值 ui 、 vi 代入 式 即可 得到 刀具 路径 上 与 Pi 点相 对应点 的 坐标值 ． 　 刀具 运动 姿态 规划 　 　 为 描述 刀具 运动 姿态 ， 建立 一 原点 位于 刀具 轴线 上 某 一点 如 刀具 球心 的 刀具 坐标系 ， 其 Xt 、 Yt 、 Zt 轴 分别 与 机床 坐标系 的 X 、 Y 、 Z 轴 平行 ． 这样 ， 刀具 运动 姿态 可用 各 切削 点处 刀具 轴线 绕 Xt 轴 和 Yt 轴 的 旋转 角度 来 表示 ． 在 多 坐标 加工 时 ， 为了 保证 切削速度 恒定 ， 刀具 轴线 需 位于 以 切削 点 法线 为 中心 轴 、 刀具 球心 为 顶点 且 半 顶角 为 的 圆锥 面上 ． 对于 虚拟 轴 机床 ， 其 主轴 的 允许 姿态 空间 为 一 位于 Zt 轴 附近 且 以 刀具 球心 为 顶点 的 锥体 内 这 一 允许 空间 一般 是 随 主轴 位置 变化 的 ． 显然 ， 刀具 轴线 所在 圆锥 面 与 主轴 允许 姿态 空间 的 交即 为 可行 的 刀具 姿态 域 ． 　 　 从 可行 刀具 姿态 域 中 确定 最佳 刀具 姿态 的 过程 比较 繁琐 ， 将 另 拟 专文 介绍 ． 下面 给出 一种 求 可行 刀具 姿态 的 方法 ． 　 　 首先 过刀 心点 作一 平面 使 其 包含 Zt 轴 和 切削 点 法线 如图所示 ． 然后 在 该 平面 上过 刀 心点 作一 直线 Lt ， 并 使 该 直线 与 切削 点 法线 间 的 夹角 等于 刀具 轴线 所在 圆锥 的 半 顶角 ， 此 直线 即 为 一 可行 的 刀具 轴线 ， 其 方程 为 　 　 　 　 　 　 　 　 　 　 　 　 　 　 式 中 Xc 、 Yc 、 Zc — 刀具 球心 坐标 　 　 l 、 m 、 n — — 刀具 轴线 的 方向 数 　 图 　 可行 刀具 姿态 　 　 刀具 轴线 Lt 的 方向 数 l 、 m 、 n 即 定量 地 描述 了 刀具 的 姿态 其 具体 值 可 通过 图求 出 ． 　 　 为 便于 控制 将 刀具 姿态 以 转角 形式 表示 ． 刀具 轴线 绕 Xt 轴 的 转角 为 　 　 　 　 　 　 　 　 　 　 刀具 轴线 绕 Yt 轴 的 转角 为 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 到 此 刀具 运动 状态 规划 任务 即 已 完成 ． 　 仿真 实验 结果 　 　 为了 验证 所 提出 的 方法 的 正确性 和 可行性 进行 了 多次 仿真 实验 ． 实验 是 在 一个 Pentium 计算机系统 上 进行 的 ． 该机 采用 PIIMHzCPU ． 实时 规划 算法 以 C语言 ＋ 位 汇编语言 混合 编程 方式 实现 ． 　 　 图 所示 为 仿真 实验 之一 所用 曲面 的 三维 图形 ． 图中 ， 曲线 的 相交 点为 自由 曲面 的 型 值点 ， 供个 ． 图 所示 为经 刀具 状态 实时 规划 所 产生 的 刀具 运动 路径 和 刀具 运动 姿态 以 刀具 轴线 矢量 表示 ． 为了 显示 清楚 ， 图中 的 刀具 路径 与 姿态 是 隔行 显示 出 的 ． 图示 结果 和 数据 抽样检查 结果表明 ， 本文 所 提出 的 方法 是 正确 的 ． 　 　 　 　 　 　 　 　 图 自由 曲面 图形 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 图 刀具 路径 与 姿态 　 　 经过 测试 ， 完成 一次 实时 规划 计算 曲面 上 切削 路径 的 一个 逼近 直线 段 和 相应 的 刀具 路径 离散 点 坐标值 及 刀具 姿态 坐标值 所用 时间 约 为 毫秒 ． 这样 ， 在 一个 采样 周期 T 毫秒 内 还 剩余 毫秒 即 还有 ％ 的 机时 可用 来 完成 数控系统 的 其它 功能 ， 如 图形 显示 、 人机交互 、 信息处理 、 轨迹 控制 等 ． 这 说明 ， 这种 实时 规划 方法 完全 可以 在 基于 PC机 的 CNC 系统 中 实现 ． 　 结论 　 　 虚拟 轴 机床 的 最大 特点 是 机械 结构 简单 而 控制 复杂 ． 因此 ， 要 结合 国情 研究 开发 具有 中国 特色 的 虚拟 轴 数控机床 产品 ， 必须 首先 解决 其 控制 问题 ， 研究 开发 出 高性能 的 虚拟 轴 机床 数控系统 ． 　 　 针对 虚拟 轴 机床 控制 的 复杂性 ， 本文 提出 了 解决 其 控制 问题 的 递阶控制 方法 ， 这一 方法 包括 实时 规划 和 实时控制 两大 步骤 ． 文中 重点 介绍 了 递阶控制 的 第一级 所 涉及 的 切削 路径 实时 生成 、 刀具 运动 路径 计算 和 刀具 运动 姿态 规划 等 三个 关键问题 的 求解 过程 ． 并 给出 了 仿真 实验 结果 ． 　 　 理论 分析 和 仿真 实验 证明 ， 本文 所 提出 的 原理 和 方法 是 可行 的 ， 所得 结果 为 解决 虚拟 轴 机床 的 控制 问题 找到 了 一条 有效 的 途径 ， 为 开发 虚拟 轴 机床 数控系统 奠定 了 必要 的 理论 与 技术 基础 ． 注释 ： 基金项目 ： 国家 高技术 计划 资助 项目 作者简介 ： 周 　 凯 ， 男 ， 年月生 ， 清华大学 精密仪器 与 机械学系 副教授 ， 工学 博士 ． 主要 从事 数控技术 、 机电 控制工程 、 制造 科学 与 制造 系统 等 方面 的 研究 工作 ， 发表 有关 论文 余篇 ． 作者 单位 ： 清华大学 精仪系 机器人 室 　 北京 　 参考文献 　 言川宣 编译 机床 结构 的 重大 创新 — — VARIAX 机床 问世 世界 制造 技术 与 装备 市场 ～ 　 汪 百川 虚拟 轴 机床 数控技术 的 研究 硕士学位 论文 北京 ： 清华大学 　 中国 机床 工具 工业协会 赴 EMO 工作组 六条 腿 机床 取得 重大进展 世界 制造 技术 与 装备 市场 ～ 　 周凯 虚拟 轴 数控机床 的 虚实 映射 联动 控制 中国 机械工程 ， ～ 　 ChenYDNiJWuSMRealtimeCNCToolPathGenerationforMachiningIGESSurfacesJournalofEngineeringforIndustry ～ 收稿 日期 ：