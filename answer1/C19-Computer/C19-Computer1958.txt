微型机 与 应用 MICROCOMPUTERITSAPPLICATIONS 年 第卷 第期 VolNo 实时 Java 技术 探讨 阎慧 　 丁长霞 　 　 摘 　 要 ： 随着 Java 技术 在 实时 系统 领域 中 的 应用 ， 使 实时 Java 技术 应运而生 ， 本文 对 实时 Java 技术 的 实现 思想 和 基本 模型 以及 实现 中 的 关键技术 等 进行 了 探讨 与 分析 。 　 　 关键词 ： Java 技术 　 实时 系统 　 Java 虚拟机 　 　 实时 Java 技术 是 随着 Java 技术 在 实时 系统 中 的 应用 应运而生 的 ， 由于 Java 技术 本身 的 特点 ， 使得 能够 支持 实时 应用 的 实时 Java 技术 ， 不但 能够 简化 实时 软件 的 设计 与 开发 ， 而且 利于 各种 平台 间 的 移植 和 维护 ， 特别 是 在 分布式 实时 WWW 应用领域 和 传统 实时 应用领域 都 有着 相当 大 的 促进作用 。 　 实时 Java 技术 的 基本 思想 　 　 实时 Java 技术 实现 的 基本 思想 ， 简单 地说 就是 在 保留 一般 Java 技术 特点 的 基础 上 ， 增加 实时 系统 设计 中 的 策略 与 机制 ， 并 有机 地 结合 起来 ， 以 达到 支持 实时 应用 的 目的 。 对 已 公布 的 Java 版本 ， 基本 是 不 具备 支持 实时 应用 功能 的 ， 然而 将 Java 与 一些 实时控制 的 实现 技术 有机 结合 起来 ， 则 可以 达到 一定 程度 的 实时 可靠性 。 例如 ： 开发 个 实时 Java 类库 ， 提供 实时 应用软件 的 编程 接口 ， 并 给出 实时 应用软件 的 实时 限制 与 要求 ， 同时 要求 Java 虚拟机 或 JavaOS 提供 对 包含 实时 Java 类 的 字节 代码 进行 分析 和 判断 ， 在 解释 执行 过程 中来 保证 应用 系统 的 实时 性能 。 　 实时 Java 技术 的 实现 模型 　 　 实时 Java 技术 根据 其 适用 的 场合 和 实现 技术 的 不同 ， 存在 着 多种 实现 模型 ， 一般 有 以下 种 。 　 嵌入式 实时 Java 平台 　 　 这种 实现 模型 应用 于 家用电器 、 电子 类 消费 产品 、 个人 数字 PDA 助理 等 硬件 上见 图 。 这 是 在 硬件 上 直接 构筑 个 Java 执行 平台 ， 并 根据 其 应用 需要 和 硬件 支持 设计 相应 的 实时 性能 。 由于 这一 模型 的 应用 一般 为 某类 产品 专用 ， 将来 的 发展 是 将 它 设计 成 Java 芯片 。 图 　 嵌入式 实时 Java 平台 结构图 　 宿主 操作系统 上 的 实时 Java 平台 　 　 在 个 宿主 操作系统 上 构筑 实时 Java 平台 ， 将 从 几个 层次 来 达到 对 实时 任务 的 支持 。 这样 的 层次结构 模型 既 利于 实时 支持 环境 的 移植 ， 又 利于 实时 性能 的 提高 ， 其 结构 如图 。 RTJava 应用程序 RTJavaAPI 实时 JVM 实时 任务分析 管理 调度 类 装载 器 JAVA 类库 字节 码 验证 器 解释器 及时 编译器 Javaruntime 系统 宿主 操作系统 图 　 宿主 操作系统 上 的 实时 Java 平台 结构图 　 　 宿主 操作系统 层 　 　 宿主 操作系统 除了 必须 为 Java 平台 提供 多线程 支持 ， 内存 分配 与 管理 结构 以及 抽象 图形用户界面 的 支持 外 ， 还要 提供 支持 实时 应用 的 实现 机制 ， 例如 CPU 资源 预留 机制 、 实时 多线程 机制 等 成熟 的 实时 技术 ， 以 保证 其 上层 的 Java 虚拟机 能 得到 较强 的 实时性 保证 ， 这 在 一个 多任务 多用户 的 宿主 操作系统 环境 下 是 极为重要 的 。 　 　 实时 Java 虚拟机 层 　 　 这一 层次 是 实时 Java 技术 的 核心 部分 。 在 这 一层 ， 虚拟机 不但 要 完成 对 实时 任务 中 的 标准 Java 字节 码 进行 装入 、 分析 和 解释 执行 ， 同时 ， 要 对 实时 任务 中 的 实时 性能 予以 分析 和 保证 。 因此 ， 实时 Java 虚拟机 除去 标准 Java 虚拟机 所 具有 的 组成 与 功能 外 ， 还 具有 个 重要 的 组成部分 和 功能 ： 实时 任务分析 、 管理 和 调度 。 　 　 这一 模块 的 设计 与 实现 是 以 传统 的 实时 技术 分析 与 利用 为 基础 的 。 例如 对 实时 任务 的 实时性 分析模型 、 实时 任务 的 实时性 表示 — — 最差 情况 下 的 执行 时间 估计 ， 对 各类 实时 任务 的 调度 策略 等 。 因此 ， 在 这 一 层次 要 解决 的 问题 就是 如何 将 传统 的 实时 技术 有机 地 结合 在 Java 虚拟机 设计 中 。 　 　 一般说来 ， 应该 包括 如下 的 几个 功能 ： 　 　 对 实时 任务 的 实时性 要求 的 分析 。 例如 ， 从 代码 中 分析 出该 实时 任务 的 最差 情况 和 最 理想 情况 下 的 执行 时间 估计 ， 或 从 该 实时 任务 的 性质 来 定义 所 具有 的 实时性 要求 。 　 　 根据 实时 调度 的 需要 ， 由 实时性 要求 的 分析 结果 ， 描述 在 保证 此 任务 的 实时 需要 情况 下 ， 该 任务 的 实时 调度 指标 ： 如 最少 和 最 理想 的 内存 使用量 ， 内存 使用 和 释放 速度 ， CPU 调度 参数 执行 周期 、 每周 期内 的 执行 时间 等 。 　 　 根据 实时 任务 的 实时 调度 指标 和 当前 系统 的 负载 决定 是否 能 满足 该 实时 任务 的 运行 预算 需求 。 如 满足 则 投入 运行 ， 否则 给出 替代 的 解决 方法 。 　 　 在 实时 任务 的 执行 过程 中 监控 其实 时 性能 ， 一旦 执行 时间 超出预算 ， 则 进行 相应 处理 ， 以 保证 其 后续 实时 性能 以及 其它 实时 任务 的 正常 运行 。 　 　 实时 JavaAPI 层次 　 　 这一 层次 主要 给出 实时 应用软件 使用 Java 的 编程 接口 。 实时 开发人员 可以 方便 地 利用 编程 接口 来 设计 与 开发 可移植 的 实时 应用软件 。 　 非 宿主 操作系统 上 的 实时 Java 平台 　 　 实时 JavaOS 提供 个 独立 的 实时 Java 环境 ， 使得 在 其 平台 上 开发 的 应用程序 不必 依赖 宿主 操作系统 是否 存在 或 是否 支持 ， 其 结构 如图 。 RTJava 应用程序 RTJavaAPI 实时 JavaOSRTJava 虚拟机 窗口 、 网络 及 设备 驱动 RTJavaruntime 系统 RTJavaOS 核心 硬 　 　 件 图 　 非 宿主 操作系统 上 的 实时 Java 平台 结构图 　 　 建立 在 硬件 基础 上 的 实时 JavaOS 在 实时 任务 的 支持 上 所 采用 的 策略 和 机制 与 宿主 操作系统 中 的 情形 基本相同 ， 但 这 一 模型 有 更 明显 的 优势 。 由于 减少 了 软件结构 中 的 若干层 ， 使 其 具有 更快 的 速度 和 更 少 的 平台 依赖性 ， 节省 了 空间 。 总之 ， 这样 的 模型 将 更 有利于 实时 系统 的 应用 。 　 实时 Java 技术 实现 中 的 关键技术 　 　 实时 Java 技术 在 实现 中 涉及 许多 具体 的 技术 ， 而 如下 的 几种 技术 是 比较 关键 的 ， 因为 它 直接 影响 着实 时 Java 技术 的 实时性 、 高效性 和 稳定性 。 在 设计 过程 中 ， 这 几种 关键技术 是 应 重点 解决 的 问题 。 　 　 实时 要求 的 表示 与 分析 技术 。 在 传统 实时 系统 设计 中 ， 实时 要求 即 时间 约束条件 的 表示 与 分析 是 很 难 做到 科学 精确 的 。 在 实时 Java 技术 中 ， 需要 借鉴 传统 的 实时 要求 表示 ， 提出 更 科学合理 的 表示 ， 来 精确 预测 实时 任务 的 执行 时间 ， 并且 在 执行 过程 中 得以 正确 高效 的 分析 和 实现 。 　 　 内存 管理 技术 ， 特别 是 Java 中 的 垃圾 收集 技术 。 Java 内置 的 垃圾 收集 功能 可以 排除 “ 内存 漏洞 ” 的 出现 ， 极大 地 减轻 程序 人员 的 开发 负担 。 但 垃圾 收集 要 占用 机器 时间 ， 在 应用程序 高频率 分析 和 释放 内存 时 ， 垃圾 收集 要 占用 的 时间 可能 比 程序 自身 运行 的 时间 还要 多 。 因此 ， 在 实时 Java 中 ， 要 改进 和 优化 垃圾 收集 技术 ， 防止 不 确定 的 收集 时机 和 不定 长 的 收集 时间 严重 影响 实时 性能 。 　 　 互斥 访问 模型 和 线程 同步 问题 。 在 Java 中线 程 的 同步 ， 如 不 进行 改进 ， 则 要 占用 应用程序 大约 的 执行 时间 。 此外 ， 实时 任务 执行 过程 中 的 互斥 访问 要求 ， 需要 提供 个 合理 的 互斥 模型 ， 以 解决 多个 实时 任务 因 互斥 而 互相 阻塞 ， 个 任务 的 超时 占用 导致 一系列 的 任务 的 实时性 所 不能 保障 的 问题 。 　 　 网络 实时性 预算 与 保证 技术 。 Java 是 基于 网络 的 编程 环境 ， 实时 任务 往往 要求 网络 的 支持 。 但 网络 的 传输速度 和 稳定性 很难 精确 预测 ， 因此 ， 在 实时 Java 中 ， 如何 对 网络 的 实时性 进行 预测 并 保证 预测 实时 性能 的 实现 ， 是 相当 重要 的 技术 。 　 　 实时 Java 的 执行 效率 与 实时性 技术 。 Java 的 执行 效率 一直 是 Java 技术 着重 解决 的 问题 ， 例如 即时 编译 技术 的 应用 。 在 实时 Java 技术 中 ， 一方面 ， 要 提高 Java 本身 的 执行 效率 ； 另一方面 ， 还 需 Java 与 实时 技术 有机 结合 ， 减少 过多 的 层次 调用 ， 从 整体 上 提高 系统 的 合理 高效性 。 　 实时 Java 技术 的 发展 现状 与 应用 前景 　 　 随着 Java 技术 的 应用 和 普及 ， 实时 Java 技术 也 得到 了 一定 的 发展 。 目前 ， 国外 已有 公司 和 研究 机构 从事 这方面 的 研究 并 有 商业化 的 产品 面市 。 如 NewMonics 公司 的 实时 Java 虚拟机 ， 以及 其他 一些 嵌入式 实用 JavaOS 都 进入 了 一定 的 实用化 阶段 。 但 我国 在 这 一 领域 的 研究 和 开发 工作 还 处于 初级阶段 。 　 　 由于 实时 Java 技术 所 具有 的 优点 ， 使 它 具有 广泛 的 应用 前景 。 具体来说 有 以下 几个 方面 。 　 　 传统 的 实时 应用领域 ： 交通 导航系统 、 空中交通 控制 、 虚拟现实 环境 和 部队 防御 系统 等 。 　 　 分布式 的 WWW 实时 应用 ： 股票市场 交易系统 、 视频 游戏 和 电视会议 等 。 　 　 家用 电子产品 ： InternetTV 电视 机顶盒 装置 、 PDA 、 无线电话 和 智能卡 等 。 作者 单位 ： 怀柔 国防科工委 指挥 技术 学院 参考文献 　 　 KelvinNIssuesintheDesignandImplementationofRealTimeJavaIowastateUniversityAmesIowa 　 　 KelvinNJavaforRealTimeIowastateUniversityAmesIA 　 　 MadanyPJavaOS 一个 独立 的 Java 环境 PCWorldChina 　 　 廖春元 Java 虚拟机 技术 探讨 微型机 与 应用 ， ； 　 　 SunMicrosystemsIncTheJavaLanguageOverviewCA ： SunMicrosystemsInc 收稿 日期 ：