计算机 研究 与 发展 JOURNALOFCOMPUTERRESEARCHANDDEVELOPMENT 　 Vol 　 No 　 P 专用 集成电路 的 设计 验证 方法 及 一种 实际 的 通用 微处理器 设计 的 多级 验证 体系 杨 文华 　 罗晓沛 摘 　 要 ： 随着 专用 集成电路 制造 工艺 及 设计 方法 的 飞速发展 ， 片上 系统 可 集成 的 功能 越来越 多 ， 规模 越来越 大 ， 设计 验证 越来越 复杂 ， 只有 使用 先进 的 设计 验证 方法 充分 地 验证 其 设计 ， 才能 保证 一次 投片 成功 文中 针对 专用 集成电路 设计 验证 的 各种 方法 和 一种 实际 的 通用 微处理器 设计 的 多级 验证 体系 作 了 专门 的 描述 ， 对片 上 系统 设计者 在 构建 自己 的 设计 验证 方案 、 使 设计 得以 充分 验证 方面 能 给予 一定 的 参考 关键词 ： 专用 集成电路 ， 软件 模拟 ， 事件驱动 ， 硬件加速 ， 硬件 仿真 ， 静态 时序 分析 ， 形式 验证 分类号 ： TN ； TPASICDESIGNVERIFICATIONMETHODOLOGYANDAREALUNIVERSALMICROPROCESSORSDESIGNVERIFICATIONSYSTEMYANGWenHua ， LUOXiaoPeiMentorGraphics ， BeijingGraduateSchoolUniversityofScienceandTechnologyofChina ， BeijingAbstract ： ASICapplicationspecificintegratedcircuittechnologyanddesignmethodologiesdevelopveryrapidlyMoreandmorefunctionsandcircuitsareintegratedinaSOCsystemonchipDesignersmustuseadvancedmethodologiesandtoolstoverifytheirlargerandlargerVLSIdesignsoastoguaranteethefirstsiliconsuccessandmeetthetimetomarketHeredescribedarevariouskindsofASICverificationmethodsandarealuniversalmicroprocessorsdesignverificationsystemwhichwouldbehelpfultothosewhowanttobuildapowerfulverificationplanandmaketheirdesignadequatelyverifiedKeywords ： ASICsoftwaresimulationeventdrivenhardwareaccelerationhardwareemulationstatictimingverification ， formalverification ▲ 　 引 　 　 言 　 　 专用 集成电路 applicationspecificintegratedcircuitASIC 设计 时 的 差错 带来 的 损失 是 巨大 的 ， 由于 没有 修复 成品 ASIC 芯片 的 技术 ， 不 可能 对 ASIC 中 的 错误 部分 进行 修正 或 直接 在 上面 焊接 ， 因此 ASIC 设计 的 结果 只有 两种 可能 要么 成功 ， 要么 失败 ， 不 存在 第种 中间状态 失败 后 重新 设计 给 设计者 无疑 会 带来 巨大 的 损失 ， 因此 对于 设计者 来说 ， 要 保证 芯片 一次 投片 成功 ， 充分 的 验证 变得 至关重要 　 　 在 整个 ASIC 的 设计 过程 中 ， 设计 验证 是 最 花费 人力 、 时间 和 占用 EDA 资源 最多 的 地方 设计者 需要 对 设计 验证 方面 的 EDA 工具 有 充足 的 了解 ， 以 构建 起 一个 有效 的 验证 方案 前端 的 设计 验证 的 任务 主要 有 下列 个 方面 ［ ］ 　 　 验证 原始 设计 输入 描述 的 正确性 　 　 验证 设计 的 逻辑 功能 是否 符合 预定 的 逻辑 功能 　 　 验证 设计 结果 的 时间 关系 是否 符合 预定 的 性能指标 　 　 具有 商用 EDA 工具 的 成熟 的 设计 验证 方法 主要 有 模拟 ， 包括 事件驱动 的 软件 模拟 eventdrivensimulation 、 基于 周期 的 软件 模拟 cyclebasedsimulation 、 硬件加速 （ hardwareacceleration 、 硬件 仿真 hardwareemulation ； 静态 时序 分析 statictiminganalysis 等 方法 ， 另外 形式 验证 formalverification 是 近几年来 兴起 的 一种 验证 方法 ， 形式 验证 利用 理论 证明 的 方法 来 验证 设计 结果 的 正确性 ［ ， ］ 软件 模拟 和 硬件 仿真 主要 用来 做 功能 验证 及 有限 的 时序 分析 ， 超大规模 集成电路 设计 的 时序 分析 用 静态 时序 分析 的 方法 是 最 有效 的 本文 将 在 下面 部分 对 上述 验证 方法 及 相应 EDA 工具 加以 介绍 　 模 　 　 拟 　 　 模拟 simulation 是 指 从 电路 的 描述语言 描述 或 图形 描述 提取 模型 ， 然后 将 外部 激励 信号 或 数据 施加 于 此 模型 通过观察 该 模型 在 外部 激励 信号 作用 下 的 反应 来 判断 该 电路系统 是否 实现 了 预期 的 功能 ［ ］ 设计者 要 通过 模拟 、 精确 分析 来 有效 地 捕捉到 设计 故障模拟 可以 是 对 不同 抽象 级别 的 电路 的 模拟 ， 如 行为 级 、 寄存器 级 、 门级 或 开关 级 HDL 语言 VHDLVerilog 可以 支持 对 不同 抽象 级别 的 电路 的 描述 ， 基于 HDL 语言 的 模拟 工具 通常 也 支持 对 不同 抽象 级别 的 电路 的 模拟 而 传统 的 模拟 工具 是 基于 原理图 设计 输入 的 门级 模拟 工具 ， 它 是 传统 PCB 和 IC 设计 中 被 广泛应用 的 模拟 工具 　 　 各个 抽象 级别 的 描述 都 要 进行 模拟 ， 尤其 要 注意 整个 芯片 的 行为 级 功能 模拟 芯片 的 行为 级 功能 模拟 主要 是 为了 验证 设计 是否 满足 设计 要求 ， 它 在 整个 设计 周期 中 占 的 比率 已 逐步提高 到 以上 ， 工程 的 早期 变更 对比 晚期 的 变更 将 使 整个 设计 效率 提高 一倍 并 能 避免 设计 的 延误 　 事件驱动 模拟 和 基于 周期 的 模拟 　 　 模拟 方法 目前 最 常用 的 是 事件驱动 eventdriven 的 方法 事件驱动 模拟器 要 分析 计算 整个 电路 ， 建立 一个 事件 表 ， 模拟 过程 中 的 每 一个 变化 都 要 排列 在 事件 表中 在 模拟 进行 的 过程 中 ， 事件 表中 的 事件 被 顺序 处理 ； 每 处理 一个 事件 ， 把 该 事件 作为 当前 事件 ， 计算 当前 事件 的 值 对 整个 电路 的 影响 ， 得到 一个 新值 ； 新值 是 未来 值 ， 这个 未来 值 成为 一个 未来 事件 排 在 事件 表中 ； 当时 钟走 到 那个 时刻 后 ， 原来 的 未来 事件 就 变成 了 当前 事件 并 取得 当前 值 ［ ］ 　 　 在 事件 表中 的 某个 时间 点 可能 排列 有 若干个 事件 ， 只有 当 这些 事件 被 全部 处理 之后 ， 模拟 时间 才能 前进 一个 时间 点 ， 由此可见 ， 模拟 的 速度 完全 取决于 事件 的 多寡 与 处理 的 速度 另外 每个 单元 的 最好 、 典型 、 最坏 延时 在 事件 排列 时 可以 考虑 进去 ， 这 使得 事件驱动 模拟器 在 延时 计算 上会 很 准确 ， 但是 这 也 使得 它们 在 纯 功能 验证 时达 不到 令人满意 的 速度 　 　 基于 周期 cyclebased 的 模拟 为 纯 功能 验证 提供 一种 更 简单 、 更 快速 的 方法 ， 模拟 时 只 处理 设计 周期 中 “ 重要 事件 ” 所 引起 的 变化 ， 不 计算 准确 延时 ， 只 显示 时钟 沿上 的 信号 变化 ［ ］ 　 　 基于 周期 的 模拟器 通常 与 事件驱动 的 模拟器 是 两个 不同 的 程序 使用 时 往往 是 用 基于 周期 的 模拟 做纯 功能 验证 ， 而 传统 的 事件驱动 模拟 则 做 细致 的 功能 及 延时 验证 基于 周期 的 模拟器 往往 对 设计 有 一定 的 约束 ， 如 限制 设计 中 带有 异步 逻辑 、 用于 事件驱动 模拟器 的 激励 不能 被 直接 利用 等 　 　 目前 也 出现 有 所谓 基于 周期 的 优化 工具 ， 可以 将 普通 的 HDL 模型 转换成 优化 的 基于 周期 的 模型 ， 利用 已有 的 事件驱动 的 模拟器 ， 将 用于 事件驱动 模拟器 的 激励 作用 于 优化 后 的 模型 ［ ］ 这样 即可 利用 已有 的 事件驱动 模拟器 ， 又 可以 加速 纯 功能 的 模拟 验证 　 模拟 加速 的 另外 两种 手段 ： 硬件加速 和 硬件 仿真 　 　 微电子 技术 的 发展 ， 使得 系统集成 在 一个 芯片 上 成为 可能 ， 全 芯片 的 模拟 就是 系统 的 模拟 随着 系统 复杂度 的 提高 ， 数百万 门 的 电路 已经 开始 制造 ， 传统 的 事件驱动 软件 模拟 办法 尽管 使用 最快 的 计算机 ， 其 速度 仍然 不能 令人 忍受 需要 更 快捷 、 更 接近 设计 目标 的 模拟 方法 　 　 基于 周期 的 软件 模拟 能够 在 一定 程度 上 加速 纯 功能 验证 的 速度 ； 硬件加速 hardwareacceleration 用 实际 的 硬 芯片 代替 电路 中 的 软 模型模拟 可以 大大 地 加速 模拟 速度 ， 但 它 也 有 明显 的 两个 约束 ， 一是 被 模拟 的 系统 中 必须 是 含有 可用 硬 芯片 代替 的 CPU 或 Memory ， 另外 其 模拟 方法 还是 软件 模拟 的 方法 ， 其 速度 最终 还是 决定 于 软件 模拟器 的 速度 　 　 硬件 仿真 hardwareemulation 不是 靠 计算机 通过 运算 来 模拟 ， 而是 通过 相应 的 硬件 ， 实现 被 仿真 的 逻辑 结构 或 实际 运行 系统 功能 来 进行 仿真 ， 因而 其 速度 比 计算机软件 模拟 要 快得多 ， 硬件 仿真 目前 只 限于 进行 功能 验证 、 故障模拟 ， 以及 部分 的 时序 验证 　 　 集成电路 的 硬件 仿真技术 目前 有 两种 一种 是 以 FPGA 为 基础 的 硬件 仿真 另 一种 是 以 处理器 为 基础 的 硬件 仿真 以 处理器 为 基础 的 硬件 仿真器 对 设计 有 一定 的 约束 ， 如对 异步 逻辑 的 限制 ， 同时 它们 对 仿真 的 加速 率 不如 基于 FPGA 的 高 ［ ］ 　 　 对 仿真技术 的 基本 要求 是 精度 、 速度 和 费用 精度 是 说明 仿真 系统 能力 的 最 基本 指标 目前 数字 仿真技术 日益 成熟 ， 仿真 精度 一般 都 能 达到 要求 速度 是 第二 重要 指标 ， 特别 是 在 规模 不断 增长 的 超大规模 集成电路 的 仿真 中 ， 速度 日益 成为 仿真 的 瓶颈 另外 ， 仿真 的 目的 是 用 较 少 的 费用 来 验证 系统 的 设计 是否 达到 预定 的 要求 ， 从而 可 早期 发现 问题 ， 避免 重大损失 ， 因此 只有 仿真 费用 低于 建造 实际 系统 费用 时 ， 仿真 才 有 价值 图为 模拟 及 模拟 加速 方法 的 性能 与 成本 关系 示意图 ， 从 事件驱动 模拟 ， 到 基于 周期 模拟 ， 到 硬件 加速器 ， 最后 到 硬件 仿真器 ， 它们 的 速度 越来越快 ， 但 成本 也 越来越 高 设计者 需要 根据 自身 条件 及 需求 来 确定 适合 自己 的 模拟 或 仿真 工具 图 　 仿真 及 仿真 加速 的 方法 　 静态 时序 分析 statictiminganalysis 　 　 上面 描述 的 模拟 或 仿真 方法 都 需要 用户 输入 激励 测试 向量 ， 且 对 超大规模 集成电路 进行 模拟 时 都 相当 费时 当 ASIC 设计 的 规模 在 几十万 门 以上 时 ， 设计者 就要 面对 以 指数 级 增长 的 测试 向量 、 极长 的 模拟 时间 、 以及 所 需 的 巨大 的 硬件 支持 等 问题 因此 不得不 寻求 门级 验证 的 新 方法 以 帮助 解决 高密度 、 深亚 微米 设计 的 问题 静态 时序 分析 提供 电路 中 所有 路径 的 完全 分析 而 不 需要 测试 向量 它 只用 事件驱动 模拟 所 需 时间 的 很少 一部分 ， 却 能 提供 所有 路径 都 被 识别 的 、 更 大程度 上 的 确定性 因此 越来越 多 的 设计者 开始 同时 运用 静态 时序 分析 和 事件驱动 模拟 来 缩短 周期 ， 减小 不能 识别 问题 的 风险 对于 超大型 器件 的 设计者 来说 ， 由于 事件驱动 式 模拟 的 时间 过长 ， 结合 静态 时序 分析 后 仍然 存在 问题 ， 于是 他们 将 静态 时序 验证 和 一种 加速 的 功能 验证 工具 一起 使用 进行 功能 验证 ， 后者 包括 形式 验证 、 基于 周期 的 模拟 、 硬件加速 和 硬件 仿真 等 如图所示 日益增长 的 ASIC 复杂性 要求 设计 方法 上 的 变更 ［ ］ 图 　 日益增长 的 ASIC 复杂性 要求 设计 方法 上 的 变更 　 　 静态 时序 分析 工具 的 优点 是 减小 了 芯片 设计 的 风险 ， 快速 且 不 需要 任何 测试 向量 的 开发 然而 静态 时序 分析 的 完备 性 也 像 一把 双刃剑 ， 它 将 正常 运行 中 不会 出现 的 关键 路径 criticalpath 也 会 识别 出来 而 识别 且 截断 这些 “ 虚假 路径 falsepath ” 一直 是 许多 设计者 的 一项 重要 工作 ， 有时 它 是 非常 重要 而 繁重 的 ， 以至于 使 设计者 放弃 了 静态 时序 分析 以及 它 所 带来 的 额外 好处 此外 ， 传统 静态 时序 分析 仅仅 适用 于 那些 全 同步 、 只 具有 相当 简单 的 时钟 结构 以及 不必 大量 依靠 寄存器 的 设计 ， 由于 这些 原因 使得 静态 时序 分析 工具 被 拒于 主流 市场 之外 能否 恰当 地 解决 上述 问题 将 决定 静态 时序 分析 工具 能否 被 广泛 接受 　 形式 验证 　 　 形式 验证 是 近几年来 兴起 的 一种 验证 方法 它 提供 严密 证明 而 不是 实验 的 结果 来 验证 设计 结果 的 正确性 ［ ］ 与 模拟 不同之处 有 ［ ］ 　 　 模拟 必须 给出 对 输入 信号 的 激励 ， 而 形式 验证 则 只是 电路 描述 本身 进行 分析 从 理论 上 讲 ， 一个 电路 正确 与否 ， 仅 取决于 电路 本身 ， 而 不是 对 输入 信号 的 激励 　 　 模拟 过程 是 通过 信号 在 电路 元件 之间 动态 传播 而 实现 的 而 形式 验证 则 是 通过 静态 逻辑推理 而 实现 的 　 　 模拟 结果 本身 并 不 直接 指出 电路 是否 有错 或 指出 电路 错误 位置 ， 它 需要 用户 自己 分析 模拟 结果 ， 判断 并 找出 设计 的 错误 而 形式 验证 直接 给出 “ 正确 ” 或是 “ 错误 ” 结论 　 　 目前 ， EDA 市场 上 已 开始 出现 形式 验证 工具 它们 限于 验证 设计 在 综合 前后 或 在 加入 测试 逻辑 后 是否 发生 逻辑 功能 的 变化 即 设计 的 等价 性 检查 ［ ， ， ］ 　 一种 实际 的 通用 微处理器 的 设计 验证 　 　 这个 通用 微处理器 芯片 的 电路 规模 约 为 万门 ， 内部 逻辑 模块 包括 有 指令 译码 、 内部 系统 标识 、 主从 通信 控制 、 主从 寄存器 堆 控制 、 主从 存储器 地址 数据 、 定点 运算 、 浮点运算 及 中断 、 复位 、 时序 控制 、 边界 扫描 等 电路 模块 　 　 在 该 芯片 的 设计 中 采用 了 多级 验证 体系 ， 如图所示 模块 级 的 模拟 包括 布线 后 的 模拟 全部 采用 事件驱动 式 的 软件 模拟 工具 验证 ， 各大 模块 的 联合 模拟 及 整个 芯片 的 功能 验证 寄存器 传输 级 与 门级 使用 硬件 仿真器 ； 对于 采用 TopDown 的 设计 方法 得到 门级 网表 的 模块 ， 其 时序 分析 及 布线 后 的 时序 分析 直接 利用 逻辑 综合 工具 的 时序 分析 功能 来 完成 ， 其它 模块 则 使用 专门 的 静态 时序 分析 工具 来 做 时序 分析 如此 严密 的 验证 体系 加上 相应 先进 的 EDA 工具 使得 芯片 的 设计 得到 了 充分 验证 图 　 一种 通用 微处理器 设计 的 多级 验证 体系 　 结 　 　 语 　 　 随着 工艺技术 的 不断 发展 ， 片上 系统 SOC 可以 集成 的 规模 越来越 大 ； 设计者 使用 TopDown 设计 方法 加上 IPintellectualproperty 后 ， 其 设计 能力 已 大大提高 ， 但 同时 也 增加 了 验证 的 负担 ； 只有 在 增加 芯片 集成 规模 的 同时 ， 改善 设计 验证 的 手段 ， 才能 保证 芯片 的 一次 投片 成功 ■ 作者简介 ： 杨 文华 ， 女 ， 年月生 ， MentorGraphics 工程师 ， 中国科技大学 北京 研究生 　 　 　 　 　 　 院 计算机 学部 研究生 ， 主要 研究 方向 为 EDA 、 ASIC 、 计算机 应用 　 　 　 　 　 罗晓沛 ， 男 ， 年月生 ， 教授 ， 研究 方向 为 计算机系统 、 计算机信息 系统 作者 单位 ： 杨 文华 （ MentorGraphics 　 北京 　 ） 　 　 　 　 　 罗晓沛 （ MentorGraphics 　 北京 　 ） 　 　 　 　 　 杨 文华 （ 中国 科学技术 大学 研究生院 　 北京 　 ） 　 　 　 　 　 罗晓沛 （ 中国 科学技术 大学 研究生院 　 北京 　 ） 参考文献 ： ［ ］ HuberJPRosneckMWSuccessfulASICDesignTheFirstTimeThroughPortlandMeritorGraphicsCorporationPress ［ ］ 周祖成 王志华 专用 集成电路 和 集成系统 自动化 设计 方法 北京 ： 国防工业 出版社 ， 　 　 　 ZhouZuchengWangZhihuaASICandIntegratedSystemDesignAutomationMethodsinChineseBeijingNationalDefenseIndustryPress ［ ］ GoeringRLogicverificationBeyondSimulationEETimesDecember ［ ］ GoeringRTurmoilatAbstractSymbolizesFightforSurvivalinEquivalencyCheckingVendorsScrapsforSurvivalinFormalMarketEETimesAugust ［ ］ QuickHDLXLCUsersandRefernceMannualPortlandMentorGraphicsCorporation ［ ］ RizzattiLCelaroStateofthearthardwareemulatorMentorGraphicsCorporationTechRepCelaroWhitePaper ［ ］ ClineDPSSTvelocityTiminganalysisandverificationforhighendASICMentorGraphicsCorporationTechRepSSTVelocityWhitePaper ［ ］ MusgraveGetalUserexperiencewithhighlevelformalverificationInACMProceedingsofthethDesignAutomationConferenceSanFranciscoACM ［ ］ KeatingMBricaudPReuseMethodologyManualforSystemonaChipDesignsNorwellMassachusettsKluwerAcademicPublishers 收稿 日期 ： 修稿 日期 ：