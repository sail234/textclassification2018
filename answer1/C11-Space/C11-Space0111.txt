航空 计测 技术 AVIATIONMETROLOGYMEASUREMENTTECHNOLOGY 年 　 第卷 　 第期 　 Vol 　 No 　 软件 自动 生成 技术 在 测试 上 的 应用 陈 大港 　 陈光 　 　 摘要 　 作为 CAT 工作站 的 软件平台 ， 可视化 自动测试 环境 简称 VATE 的 应用 对 提高 测试软件 开发 效率 和 测试 系统 中 PC 资源 的 充分利用 有 不可估量 的 作用 。 本文 介绍 了 一种 在 MicrosoftWindows 平台 上 开发 测试软件 自动 生成 环境 的 方法 ， 即 通过 组建 仪器 驱动器 库 ， 利用 结构化 的 流程 设计 思想 来 实现 测试软件 的 生成 。 　 　 关键词 　 CAT 工作站 　 可视化 自动测试 环境 　 仪器 驱动器 　 流程 设计 ApplicationofSoftwareAutomaticGenerationTechniquetoTestingChenDagangChenGuangju 　 　 Abstract 　 AsthesoftwareplatformofCATworkstationtheapplicationofVisualAutomatedTestEnvironmentVATEhasinestimableeffectonheighteningthedevelopingefficiencyofthetestingsoftwareandfullyusingthePCresourceinmeasuingsystemThispaperintroducesamethodofdevelopingthetestingsoftwareautomaticgenerationenvironmentontheMicrosoftWindowsplatformThatisthroughsettinguptheinstrumentdriverdatabaseandusingconstructuralprocessdesignideatorelializethetestingsoftwaregeneration 　 　 Keywords 　 CATworkstationVATEInstrumentdriversProcessdesign 　 　 作为 计算机技术 和 自动测试 技术 发展 的 产物 ， CAT 工作站 使 计算机 在 测试 系统 中 的 作用 不再 仅仅 局限于 控制技术 的 提高 。 与 传统 的 自动测试 系统 组建 方式 不同 CAT 工作站 并非 针对 特定 的 测试 任务 ， 而是 着眼于 集成化 的 测试 与 开发 环境 。 它 主要 由以 高档 测试 控制 计算机 为主 的 硬件平台 和 基于 多窗口 管理系统 的 可视化 自动测试 环境 VATE 等 软件平台 组成 。 测试 系统 各 组成部分 可 共享 系统 的 硬件 与 软件资源 ， 因而 能够 加快 测试 过程 及 开发 速度 ， 并 方便 系统 的 组建 ， 以 完成 多 参数 的 自动测试 。 　 　 CAT 工作站 的 控制 核心 为 其 软件 部分 — — VATE ， 它 是 软件 自动 生成 技术 在 测试 上 的 具体 运用 ， 充分发挥 了 计算机 的 图形 功能 ， 将 仪器 控制 、 数据分析 、 分布式 测试 技术 等 均 用 可视化 部件 实现 ， 提高 了 开发 效率 。 目前 ， 测试软件 自动 生成 技术 有 两种 实现 方法 ： 代码生成 和 流程 设计 。 代码生成 方法 一般 以 C ＋ ＋ 语言 为 基础 ， 可 自动 生成 仪器 控制 以及 测试 结果 数据处理 、 图形 显示 等 代码 ， 并 自动 嵌入 测试软件 中 ， 编译 后 即可 运行 如 LabWindows ／ CVI 。 它 对 测试 工程师 的 编程 水平 要求 较 高 ， 但 使用 较为 灵活 。 流程 设计 方法 则 利用 可视化 功能 部件 以 流程图 的 设计 方式 完成 测试软件 的 编写 工作 ， 开发 效率 相对 较 高 ， 且 简单 易用 ， HPVEE 和 LabView 是 其中 的 代表 。 本文 采用 流程 方法 来 实现 一个 通用 的 测试软件 开发 环境 。 它 具有 以下 优点 ： 　 　 友好 的 图形界面 ； 　 　 开放 的 仪器 驱动 库 ； 　 　 编程 简单 ； 　 　 可 对 测试 结果 进行 复杂 的 数学分析 ， 并 以 各种 图形 方式 加以 直观 描述 ； 　 　 支持 远地 数据传输 。 　 系统 构架 　 　 可视化 自动测试 环境 VATE 由 虚拟仪器 驱动器 管理器 VisualInstrumentDriverManager ， 简称 VIDM 和 流程 设计 环境 FlowDesigningEnvironment ， 简称 FDE 两 大部分 组成 。 其中 IDM 是 测试 控制 的 核心 。 测试软件 依靠 它 来 完成 对 仪器 的 控制 。 作为 一个 功能完善 的 开发 和 管理工具 ， IDM 可 完成 仪器 驱动器 的 设计 和 调试 ， 并 提供 FDE 能够 辨识 的 文件格式 生成 工具 。 FDE 是 一个 图形化 的 自动测试 软件 编制 工具 ， 它 以 图形化 编程 元素 的 方式 向 测试人员 提供 编程 所 需 的 各种 虚拟 控件 ， 如 循环 、 分支 、 结果显示 、 数据传输 、 仪器 控制 等 ， 根据 既定 的 测试 任务 ， 测试 工程师 按照 测试 流程 ， 将 这些 编程 元素 组合 起来 ， 即可 生成 所 需 的 测试软件 。 除此之外 ， FDE 还 可 完成 对 测试 结果 的 各种 处理 ， 如 图形 比 对 、 测试报告 自动 生成 等 。 　 　 整个 软件平台 的 设计 是 采用 BorlandC ＋ ＋ 、 VisualBasic 以及 Access 来 实现 的 。 其中 ， 仪器 驱动器 通过 底层 的 接口 驱动 软件 GPIBDLL 来 程控 仪器 ， 有关 仪器 的 程控 信息 和 流程 设计 中 的 可视化 部件 信息 由 数据库 来 管理 。 在 运行 库函数 控制 下 ， 测试软件 按 顺序 执行 。 　 虚拟仪器 驱动器 　 　 虚拟仪器 驱动器 是 仪器 程控 代码 、 计算机软件 技术 和 测试 接口 三者 相结合 的 产物 ， 是 一个 包含 实际 仪器 使用 、 操作 信息 的 软件 模块 。 它 的 上层 是 一系列 按 功能 分组 的 主 ／ 副 软 面板 ， 每个 软 面板 又 由 一些 按键 、 旋钮 等 组合而成 ， 每个 控件 都 对应 不同 的 功能 ， 即 其 程控 代码 相异 。 它 的 底层 部分 则 基于 一组 I ／ O 函数 和 测试 接口 ， 实时 模式 下 ， 测试人员 对软 面板 上 控件 的 操作 将 直接 反映 到 真实 仪器 上 。 　 虚拟 面板 及 控件 　 　 仪器 驱动器 和 用户 直接 打交道 的 部分 是 操作 接口 即 虚拟 软 面板 和 面板 上 的 控键 。 由于 大多 仪器 功能 繁多 ， 为 便于 测试人员 操作 方便 ， 每个 虚拟仪器 驱动器 都 由 若干 虚拟 面板 构成 。 虚拟 面板 一般 包括 功能性 面板 和 描述性 面板 两类 。 功能 面板 并 不 完全 对应 仪器 的 真实 面板 ， 它 实际上 是 对 实现 仪器 功能 按键 的 重新组合 。 图 显示 了 HPA 的 一个 虚拟 面板 。 由图 可知 ， 每个 虚拟 面板 对应 Windows 的 一个 窗体 Form ， 窗体 大小 与 面板 包含 的 功能 按键 多少 有关 ， 用户 可任意 调整 其 大小 。 除 控键 外 ， 面板 还 提供 仪器 地址 、 面板 名称 等 一系列 虚拟 面板 属性 信息 。 此外 ， 描述性 面板 对 用户 也 非常 重要 ， 它 有助于 测试人员 在 组建 系统 时 有效 地 选择 仪器 。 图 　 IDM 中 生成 的 虚拟 面板 　 　 仪器 的 真实 面板 一般 由 各种 按键 、 旋钮 等 控键 组成 。 为了 给 测试人员 一个 直观 的 显示 ， 虚拟 面板 的 实现 也 采用 这种 方法 ， 其上 的 控键 则 利用计算机 的 图形 技术 生成 。 我们 按照 控键 的 功能 和 形态 将 其 总结 归纳 为种 ， 他们 分别 是 单次 按键 、 旋钮 、 二态键 、 组键 、 复选 键 、 单选 键 、 面板 控制 框 、 输入 文本框 、 标签 和 波形 显示 键 。 其中 二态键 根据 形态 的 不同 又 划分 为种 ， 面板 控制 框则 根据 功能 的 区别 划分 为 两类 。 　 　 作为 一个 优秀 的 基于 MicrosoftWindows 平台 的 可视化 软件开发 环境 ， VisualBasic 支持 面向对象 的 设计 技术 ， 如 窗体 Form 类 和 控件 Controls 类 的 继承 和 派生 等 。 这些 类 的 属性 在 VB 中 都 被 良好 封装 ， 由 它们 派生 出来 的 特定 对象 就 继承 了 其 所有 属性 ， 用户 再 对 这些 对象 的 若干 属性 加以 修改 ， 便 生成 所 需 的 虚拟 面板 及 控件 。 由于 VB 环境 中 工具箱 内 的 控件 过于 单调 ， 自身 属性 也 无法 满足 仪器 控件 的 需要 ， 例如 它们 都 不 具有 程控 代码 ， 因此 必须 在 此基础 上 对 其 进行 相应 的 扩充 ， 即以 VB 原有 控件 为 模板 ， 再 添加 更 多 的 属性 和 事件 ， 并 封装 为 虚拟仪器 驱动器 的 可视化 部件 的 基类 。 　 　 在 设计 时 ， 我们 首先 定义 好 窗体 和 控键 的 基类 ， 在 利用 VB 提供 给 类 的 组 Array 生成 技术 来 动态 生成 虚拟仪器 驱动器 的 虚拟 面板 和 虚拟 控键 。 例如 ： 设计 好 面板 和 单次 按键 基类 后 ， 利用 VB 语句 ： 　 　 GlobalVpanelsAsNewFrmDriver 　 　 GlobalPushButtonAsNewPushBtn 　 　 声明 一个 面板 和 单次 按键 的 动态 数组 ， 数组 的 每个 成员 代表 其 基类 派生 的 单个 实例 或 对象 ， 并 完全 继承 了 面板 或 单次 按键 基类 的 公共 属性 。 运行 时 ， 通过 定义 其 数组 大小 和 调用 各自 方法 Load 和 Unload ， 完成 虚拟 面板 和 控键 的 动态 装载 和 卸除 。 而且 ， 用户 可 对 它们 分别 编辑 ， 如 设置 其 名称 和 程控 代码 ： 　 　 PushButtonICaption ＝ 方波 　 　 PushButtonICode ＝ FUNCSHAPSQU 　 　 使 它们 拥有 各自 不同 的 属性 ， 完成 对 特定 面板 或 控件 的 设计 。 　 仪器 驱动器 文件 的 生成 　 　 以上 介绍 了 仪器 驱动器 软 面板 的 实现 过程 ， 事实上 ， 脱离 应用软件 开发 环境 的 仪器 驱动器 实用价值 并不大 。 仪器 驱动器 建立 的 主要 目的 是 完成 测试软件 的 生成 ， 即 利用 它 的 编程 接口 将 测试人员 在 虚拟 面板 上 的 一系列 操作 转化 为 相应 的 程控 代码 ， 并 嵌入 到 测试程序 中 ， 完成 测试软件 中 仪器 程控 部分 的 生成 。 因此 ， 如何 保存 仪器 驱动器 信息 ， 特别 是 虚拟 面板 上 控件 所 对应 的 程控 信息 ， 对 应用软件 环境 的 开发人员 来讲 十分 关键 。 通常 ， VB 中 采用 顺序 文件 来 实现 文件 的 存储 ， 同 数据库 存储技术 相比 ， 这种 技术 在 文件 数据 的 共享 方面 存在 很大 限制 。 在 这里 ， 我们 利用 VB 同 ACCESS 数据库 的 良好 接口 ， 实现 虚拟仪器 驱动器 文件 的 存储 。 　 操作 模式 　 　 IDM 环境 为 仪器 驱动器 提供 了 两种 操作 模式 ： 编辑 模式 EditMode 和 实时 模式 LiveMode 。 前者 提供 给 测试人员 一个 编辑 虚拟仪器 面板 和 虚拟 控件 的 环境 ， 后者 则 用来 与 真实 仪器 联机 调试 。 在 这里 ， 我们 设置 了 一个 标志 位 VPRunMode ， 当 环境 检测 到 面板 操作 时 ， 根据 其 属性 设置 的 不同 分别 执行 以下 操作 ： 　 　 编辑 模式 ： 在 此 模式 下 ， 测试人员 可 通过 菜单 条 与 工具栏 完成 虚拟 面板 和 虚拟 控件 的 添加 、 放缩 、 移动 、 删除 及 属性 设置 等 编辑 功能 ， 同时 将 向 仪器 库中 添加 或 删除 有关 信息 。 　 　 实时 模式 ： 此时 ， 测试人员 在 虚拟 面板 上 对 控件 的 操作 可 立即 实现 对 仪器 的 控制 ， 相当于 直接 操作 仪器 ， 这种 模式 便于 用户 检测 仪器 驱动器 编制 的 正确性 。 　 流程 设计 环境 的 实现 　 　 按照 流程 式 程序设计 环境 的 要求 ， FDE 以 控件 的 形式 提供 了 种 编程 元素 ， 用来 实现 流程 控制 、 数据 定义 等 功能 ， 作为 程序设计 的 基本 “ 语句 ” ， 测试人员 只 需用 这些 编程 元素 来 实现 测试 任务 的 流程 思想 ， 并 按 顺序 运行 即可 完成 测试 要求 。 另外 ， 作为 一个 测试软件 开发 环境 ， FDE 还 具有 强大 的 数学分析 、 运算 、 数据处理 及 图形 功能 。 数学分析 模块 可以 完成 数据 的 分析 、 运算 ， 表达式 的 处理 ， 波形 的 处理 如 FFT ， 加窗 ， 波形 的 圆滑 、 截取 、 放大 等 ， 逻辑运算 、 比较 等 功能 。 图形 显示 模块 则 利用 VB 提供 的 Graph 控件 来 完成 多达 种 不同 的 图形 样式 ， 且 每种 样式 均 有 多种 显示方式 供选择 ， 可以 把 测试 结果 数据 按照 用户 的 要求 清晰 地 绘制 出来 。 最后 ， FDE 将 自动 产生 一份 测试报告 ， 供 测试人员 对 测试软件 作 详细分析 。 　 　 编程 元素 是 流程 设计 的 基本 组成部分 ， 是 构成 测试程序 的 基本 元素 。 通过 对 测试程序 一般 组成 结构 的 分析 ， 将 流程 设计 环境 的 编程 元素 划分 成种 不同 类型 ， 分别 完成 测试 程序控制 、 数据 定义 、 数据 输入 ／ 输出 、 图形 显示 及 仪器 控制 等 功能 。 其 创建 过程 与 虚拟 面板 上 的 控件 完全 一样 ， 只是 属性 种类 不同 而已 。 利用 VB 的 面向对象 设计 技术 ， 首先 建立 了 余种 编程 元素 的 基类 ， 并 为 每 一种 元素 定制 了 一张 属性 表 ， 然后 再 根据 测试程序 的 实现 过程 ， 动态 派 生出 测试程序 的 组成 元素 。 　 　 测试软件 自动 生成 技术 的 核心 是 仪器 操作 。 在 FDE 中 ， 测试人员 可 调用 有 IDM 环境 开发 的 仪器 驱动器 ， 以 完成 测试代码 的 自动 生成 。 另外 ， 考虑 到 在 一些 测试 系统 中有 可能 用 串口 仪器 ， 还 提供 了 对 I ／ O 口 的 直接 控制 ， 利用 它 用户 还 可 对 GPIB 接口 进行 操作 ， 如 接口 清除 Clear 、 远控 Remote 、 本地 封锁 Llockout 等 ， 对 仪器 程控 代码 熟悉 的 用户 ， 也 可 通过 它 来 直接 控制 仪器 。 　 　 用户 在 FDE 中 编制 的 测试软件 由 “ 工作文件 ” 来 管理 。 它 事实上 是 一个 数据库 文件 ， 内含 张表 ， 用以 存储 测试软件 中 可视化 编程 元素 的 信息 ， 如表 所示 。 这些 表 通过 一些 公共 的 关键字 段 构成 相关 关系 ， 利用 它们 构成 的 索引 ， 可 完成 对 测试软件 组成 部件 的 定位 。 实现 流程 运行 的 过程 是 ： 运行 库函数 从 测试程序 的 组成 元素 表中 按 Turn 的 顺序 依次 选出 相应 执行 元素 注释 为 非 执行 元素 ， 再 按 每个 元素 的 具体 运行 属性 来 执行 相关 操作 ， 从而 完成 测试程序 的 执行 。 它 的 基本 设计 思想 类似 解释性 语言 开发 环境 ， 具体 如下 ： 表表 名 存储 信息 Workfiles 用户 测试软件 信息 Component 测试软件 各 组成 元素 属性 Conditions 条件 变量 的 初值 、 终值 、 步长 等 Driver 仪器 的 操作 信息 Graph 图形 的 显示 属性 Variable 用户 软件 中 的 变量 和 常量 Subs 各 组成 子程序 信息 ImportData 子程序 间 的 变量 引用 关系 Table 测试 结果 表格 属性 Waveform 数组 名称 及 各 元素 值 CWaveform 多维 数组 和 复数 的 名称 及值 Lines 指标 程序运行 的 连线 信息 　 　 运行 前先 判断 当前 测试程序 中 是否 还 嵌套 下级 子 测试程序 ， 如 有 ， 则 先 记录 关于 此 嵌套 子 测试程序 的 Subid 信息 ； 　 　 打开 GPIB 卡 ； 　 　 调用 RComponent 函数 ， 运行 当前 记录 集中 的 Turn 值 最小 的 编程 元素 ； 　 　 根据 RComponent 函数 返回值 ， 作下 一步 操作 ： 　 　 若 RComponent 函数 返回值 为 NOERROR ， 则 重复 第三步 ； 　 　 若 RComponent 函数 返回值 不 为 ， 则 表示 运行 出错 ， FDE 给出 出错 信息 后 返回 ； 　 　 若 RComponent 函数 返回值 为 FEND ， 则 表示 流程 运行 结束 ， VATE 给出 “ 正确 运行 ” 信息 后 退出 。 　 　 关于 分支 和 循环 的 实现 也 与 此 类似 ， 区别 之 处 在于 当 运行 rsp 记录集 之前 ， 环境 根据 条件 变量 的 实际 运行 值 作出 相应 处理 。 有关 运行 库函数 的 总体 流程图 如图所示 图 　 运行 库函数 流程图 　 结论 　 　 本文 实现 的 VATE 是 一个 通用 的 自动测试 软件开发 平台 。 它 利用 当今 先进 的 计算机软件 技术 ， 通过 构筑 虚拟仪器 驱动器 技术 实现 对 真实 仪器 的 控制 ， 并 采用 流程 设计 方法 ， 完成 特定 测试软件 的 可视化 生成 。 实践 表明 ： 与 传统 自动测试 系统 组建 方法 相比 ， 它 不仅 简单 易用 ， 而且 可以 缩短 开发 时间 ～ 倍 ， 因此 ， 对 自动测试 技术 的 发展 具有 积极 的 意义 。 作者简介 陈 大港 　 岁 　 男 　 博士 研究生 作者 单位 电子科技 大学 自动化系 ， 四川省 成都市 ， 参考文献 　 　 　 陈光 李为民 等 计算机辅助 测试 CAT 工作站 的 实现 电子学 报 　 　 　 顾 亚平 自动测试 软件 北京 电子 工业 出版社 　 　 　 HewlettPackardHPVEEVisualEngineeringEnvironmentTechnicalData 　 　 　 JamesTruchardJSoftwareTechnologyforAutomatedMeasurementsIEEEInstrumentandMeasurementTechConference 　 　 　 DonaldZrudskyRandJamesPicklerMVirtualInstrumentforInstantaneousPowerMeasurementIEEETransactiononInstrumentationandMeasurement 收稿