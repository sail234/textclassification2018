计算机 应用 研究 APPLICATIONRESERCHOFCOMPUTERSVol 　 No 　 P ， 植物 模拟 技术 的 研究 陈天 滋 　 李峰 摘要 提出 了 的 一个 参数 化 的 三维 植物 形态 模拟 的 模型 及其 实现 方法 ， 采用 这个 模型 可以 大大减少 植物 形态 描述 的 信息量 并 提高 其 逼真性 。 关键词 商业 CAD 参数 化 L 系统 植物 模拟 　 　 随着 计算机 图形学 的 发展 ， 人们 一直 探讨 在 计算机 上 模拟 植物 各种 形态 的 可能性 。 由于 植物 是 在 并行 方式 下 生长 的 ， 因此 并行性 应是 植物 仿真 与 模拟 过程 中 的 一个 基本 原则 。 事实 表明 ， L 系统 在 植物 结构 模拟 方面 是 比较 成功 的 。 在 商店 的 室内外 装饰 中 ， 为 增强 商店 对 顾客 的 吸引力 ， 刺激 起 顾客 的 购买欲 ， 商店 装饰 设计者 常常 会 使用 一些 自然 景物 等 非 规则 构件 来 美化 商店 的 室内外 环境 ， 如 假山 、 花草 、 树木 、 云彩 等 。 本文 主要 讨论 在 商业 设计 CAD 系统 中用 L 系统 进行 参数 化 模拟 植物 形态 的 方法 。 L 系统 的 基本原理 　 　 L 系统 实质 上 就是 一个 重写 系统 ， 是 美国 生物学家 Lindenmayer 于 年 提出 的 。 它 可以 用 形式语言 的 方法 来 描述 植物 的 生长 过程 。 下面 以 最 简单 的 DOL 系统 为 例来 说明 其 主要 思想 。 　 　 令 V 表示 字母 ， V 表示 V 上 所有 单词 的 集合 ， 一个 字符串 OL 系统 是 一个 有序 的 三元 集 GVwP ， 这里 w 是 一个 非空 单词 ， 也 是 起始 符号 元 ， 称作 公理 ， P 是 所谓 产生 式 的 有限 集合 ， 产生 式 写作 a → x ， 字母 a 和 单词 x 分别 称作 产生 式 的 前驱 和 后继 。 规定 对 任何 字母 a ∈ V ， 至少 存在 一个 非空 单词 x ， 使得 a → x 。 若 对 给定 的 前驱 a ∈ V 无 明确 解释 的 产生 式 ， 则 规定 a → a 这个 特殊 的 产生 式 属于 P 。 对 每个 a ∈ V ， 当且 仅 当 恰有 一个 非空 单词 x ， 使 a → x ， 那么 就 说 OL 系统 是 一个 确定 的 ， 记为 DOL 系统 。 依据 DOL 系统 的 原理 ， 按照 一定 的 重写 规则 ， 并 加以 参数 控制 ， 即可 模拟 植物 的 各种 形态 及其 生长 过程 。 其 结构 模型 可 通过 摰 脊 陻 过程 来 产生 。 用 L 系统模拟 植物 形态 　 　 植物 的 生长 过程 ， 总体 形态 处处 蕴含着 分形 的 性质 。 简化 植物 的 生长 过程 ， 就 像 画家 作画 一样 ， 一般 可 描述 为 ： 一个 茎杆 破土而出 ， 茎杆 向 四周 外长 出 一些 小枝 ， 长出 的 地方 称为 节 。 大多数 小树枝 上 又 长出 一些 更 小 的 嫩枝 ， 如此 反复 。 每个 植物 最终 由 一大堆 枝节 组成 。 一个 树木 上 所有 各处 都 有 相似 的 枝节 组成 。 　 　 可能 任何 一个 植物学家 对 这个 模型 都 会 嗤之以鼻 ， 他们 也 可以 举出 许多 反例 来 。 确实 ， 像 花 、 果实 、 叶子 等 在 这个 模型 中 都 没有 考虑 进去 ， 但 这个 模型 依然 对 大多数 植物 的 形态 ， 尤其 是 它们 在 视角 上 的 效果 具有 指导性 。 　 　 在 植物 形态 结构 的 模拟 中 ， 分枝 结构 或称 树结构 是 其 模拟 的 核心 。 一般 植物 的 分枝 结构 可以 用 L 系统 的 迭代 重写 过程 来 生成 。 但 由于 植物 的 形态 除了 由 其 基因型 决定 外 ， 还 受到 许多 环境因素 的 制约 ， 其 形态 在 遵循 自 相似 规律 的 同时 也 处处 隐含 着 随机 的 特征 。 如果 用 简单 的 DOL 系统 来 模拟 ， 其 结果 必然 是 呆板 和 不 真实 。 于是 笔者 在 商业 CAD 系统 的 开发 过程 中 采用 了 一种 集 随机 和 参数 化于 一体 的 L 系统 模型 ， 在 此 模型 的 支持 下 ， 可 设计 出 比较 真实 同时 模型 数据 又 比较 少 的 三维 植物 模型 。 其 L 系统 模型 可 描述 如下 ： GVwP π 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 其中 为 带 参数 的 基本 字符集 ； 　 　 wFd 为 带 参数 的 起始 符号 元 ； 　 　 P 为 生成 规则 集 ， 也 称 其 为 分枝 模型 集 ； 　 　 π 是 函数 ： P → 的 概率分布 ， 即将 生成 规则 集 映射 到 生成 规则 概率 集合 上 ， 对 V 中 的 任意 字符 ， 以 它 为 前驱 可以 有 多个 不同 的 生成 规则 ， 所有 这些 生成 规则 的 概率 之 和 为 。 　 　 式 是 对 DOL 系统 的 扩展 ， 其 摰 脊 陻 图形学 解释 可 描述 如下 ： 　 　 假设 一个 导龟态 被 定义 为 这样 一个 四元组 其中 xyz 表示 导龟 的 位置 坐标 ， α y α z 表示 导龟 的 空间 朝向 ， 且 是 单位 方向 矢量 ， 下列 符号 的 含义 可 描述 为 ： 　 　 Fd ： 向前 移动 一步 ， 步长 为 d ， 导龟态 变为 其中 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 且 从 xyz 向 xyz 画 一直 线段 　 　 δ ： 向左转 角 ， 导龟态 变为 xyz α ， 假设 正向 角是 逆时针 方向 ， 负向角 是 顺时针 方向 ； 　 　 δ ： 向右转 角 ， 导龟态 变为 xyz α ） 　 　 δ ： 向上 转角 ， 导龟态 变为 xyz α ） ； 　 　 δ ： 向下 转角 ， 导龟态 变为 xyz α ） ； 　 　 ： 将 当 前导 龟态 压入 堆栈 ， 信息 包括 导龟 所在 的 位置 和 方向 等 ； 　 　 ： 从 堆栈 中弹 出 一个 状态 作为 导龟 的 当前 状态 ， 但是 不 画线 ； 　 　 Sd ： 只作 替代 操作 用 ， 即 迭代 时 被 所 选用 的 分枝 模型 所 代替 。 当 迭代 次数 大于 上 限值 时 ， 所有 Sd 替换 为 Fd 。 　 　 图为 导龟 转向 图 ， 其中 α 在 图 中 代表 ， 于是 上述 的 α 、 α 、 α 和 α 可 通过 对 进行 旋转 运算 得到 。 图 　 导龟 转向 图 　 　 综上所述 ， 我们 可以 把 式 看成 是 一般 植物 的 基因 结构 ， 再 加上 起始 点 坐标 ， 起始 方向 矢量 ， V 中 各 参数 的 值 以及 迭代 上 限值 便 可以 生成 一 植物 的 分枝 模型 。 其 算法 流程 如图所示 。 图 　 植物 模型 生成 流程 　 　 图 植物 分枝 结构 的 生成 流程 其实 就是 一个 基于 所 选定 的 植物 基因 循环 迭代 生 成文法 串 的 过程 。 植物 分枝 模型 的 建立 还 依赖于 导龟 系统对 文法 串 的 图形学 解释 。 其导龟 解释 算法 可 描述 如下 ： voidturtlesnbpointbvectsn 分枝 级数 　 　 　 　 bpoint 起始 点 　 　 　 　 bvect 起始 方向 向量 　 　 pointplp 中间 点 变量 　 　 vectV 中间 向量 变量 　 　 charch 　 　 　 　 pbpoint 　 　 Vbvect 　 　 readacharactertoch 　 　 whilechandchNULLdo 　 　 　 　 ifchF 　 　 　 　 　 　 计算 d 、 r 和 p 　 　 　 　 　 　 画 树枝 连接 p 和 p 　 　 　 　 　 　 plp 　 　 　 　 elseifch 　 　 　 　 　 　 计算 V 　 　 　 　 elseifch 　 　 　 　 　 　 计算 V 　 　 　 　 elseifch 　 　 　 　 　 　 计算 V 　 　 　 　 elseifch 　 　 　 　 　 　 计算 V 　 　 　 　 elseifch 　 　 　 　 　 　 turtlesnpV 　 　 　 　 下面 图是 生成 的 几个 分枝 结构 模型 。 图 　 几种 分枝 结构 模型 　 　 在 进行 导龟 解释 文法 串时 ， 往往 根据 不同 植物 的 特点 构造 其枝 与 叶 的 基本 几何 造型 。 对于 枝 的 具体 构造 可 按照 下面 两条 准则 进行 ： 　 　 分枝 的 粗细 是 随 分枝 节点 到 主枝 节点 的 距离 的 增加 而 减少 。 如 采用 半径 R 来 表示 枝 的 粗细 程度 ， 可用 下式 来 模拟 。 　 　 分枝 的 长度 与 主枝 的 长度 间 的 关系 也 可 近似 地用 下述 关系 表示 。 　 　 对于 叶 的 构造 可 根据 植物 特点 用 少量 多边形 加以 模拟 。 如图 便是 几种 叶 的 多边形 模型 。 图 　 几种 叶 的 多边形 模型 结论 与 图例 　 　 基于 L 系统 的 植物 参数 模拟 已 作为 商业 CAD 系统 中 商业 非 规则 构件 造型 模块 的 一部分 研制成功 ， 经过 一段时间 的 多家 用户 试用 ， 一致 反映 良好 。 在 实现 过程 中 ， 为了 方便 用户 初始化 植物 基因 结构 ， 系统 提供 了 一个 比较 丰富 的 分枝 模型库 ， 以供 用户 挑选 使用 。 　 　 整个 系统 在 微机 环境 的 AutoCADR 平台 上 实现 ， 充分利用 了 AutoCADR 的 ADS 函数 、 Windows 资源 和 VC 混合 编程技术 ， 通过 DD E通 信 把 Windows 风格 的 用户界面 内嵌 于 AutoCAD 之中 ， 用户 操作 方便 。 图为 本 系统生成 的 植物 图例 。 本文 得到 国家 九五 重点 攻关 计划 项目 资助 陈天 滋 （ 江苏 理工大学 计算机科学 系 镇江 ） 　 李峰 （ 江苏 理工大学 计算机科学 系 镇江 ） 参考文献 ， 王来生 计算机 图形处理 技术 西安交大 出版社 ， 唐荣 锡 等 计算机 图形学 教程 科学出版社 ， 常杰 等 植物 结构 的 分形 特征 及 模拟 杭州大学 出版社 ， 王东生 等 混浊 、 分形 及其 应用 中国科技大学 出版社 ， 齐东旭 分形 及其 计算机 生成 科学出版社 ， 曾 文曲 等 分形 理论 及 分形 的 计算机 模拟 东北大学 出版社 ， 乐家龙 中 小商店 门面 装饰 精华 气象 出版社 ， 王肖生 等 商店 装饰 与 商品 陈列 金盾 出版社 ， DemkoSConstructionoffractalobjectswithinterastedfunctionsystemsACMCGVolNo ， ViennetXGCombinatorialanalysisoframifiedpatternsandcomputerimageoftreesACMCGVolNo 收稿 日期 ： 年月日