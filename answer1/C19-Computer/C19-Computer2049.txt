计算机 工程 ComputerEngineering 年 　 第卷 　 第期 　 Vol 　 No 　 基于 弹箭 系统 的 图形库 管理 设计 与 实现 杜淑幸 　 琚柏青 　 许 社教 摘 　 要 　 针对 弹箭 系统 特点 介绍 了 集 图形 查询 、 设计 于 一体 的 图形库 管理 设计 与 实现 方法 ， 对 开发 中 关键技术 ， 提出 了 可行 的 解决办法 。 关键词 　 图形库 弹箭 系统 CAD 数据库 TheDesignandImplementationofGraphicsBaseBasedonProjectileandRocketSystemDuShuxingQuBaiqingXuShejiao （ DeptofElectronicMechanicsXianElectionicTechniqueUnivXianAbstractInconnectionwiththecharacteristicsofprojectileandrocketsystemthepaperintroducedadesignandimplementationmethodformanaginggraphicsbasewhichisintrgratedwithsearchanddrawingSomepraticalmethodstosolvekeytechniquearepresentedKeywordsGraphicsbaseProjectilerocketsystemCADDatabase 　 　 由于 现代战争 日趋 立体化 ， 因而 在 军工 系统 ， 弹药 种类 五花八门 ， 除了 常规 弹药 ， 尖端 和 复合 性能 弹药 也 层出不穷 ， 这些 给 军工 产品 的 开发 研制 带来 了 严峻 的 挑战 。 现代 弹药 研制 既 要求 周期短 ， 效率高 ， 又 要求 技术 先进 、 全面 ， 因此 开发 智能 的 弹箭 CAD 系统 ， 是 提高 其精 、 高 、 深 、 快 研制 水平 的 必然 要求 和 趋势 。 本文 就是 针对 弹箭 系统 特点 提出 的 图形库 管理 设计 思想 和 实现 方法 。 　 软件 环境 　 　 创建 弹箭 图形库 的 根本 目的 ， 不 只是 对 图纸 和 图形文件 的 简单 管理 和 浏览 ， 更 重要 的 是 使 设计者 能 借助 图形库 快速 、 高效 地 进行 弹药 设计 和 开发 ， 因此 我们 采用 了 AutoCADRforWindows 为 支撑 软件 。 AutoCADR 不仅 具备 强大 的 二 、 三维 图形 绘制 与 编辑 功能 ， 其 开放 的 体系结构 ， 允许 用户 全方位 地 对 其 进行 扩充 和 修改 ， 尤其 是 提供 的 PDBProgrammableDialogueBoxes ， 使 开发者 可以 自己 设计 出 和 AutoCAD 环境 融为一体 的 应用软件 ， 以 满足 各种 特殊要求 。 因此 系统 开发 时 ， 要 保证系统 操作 的 即时性 ， 使 用户 在 图形库 操作 与 AutoCAD 原始 环境 之间 进退自如 。 　 图形库 的 管理 　 　 图形库 的 管理 就是 将 对象 的 各 相关 内容 转换 为 对 机器 存储 而言 最优 的 数据 方式 ， 其 主要 技术 包括 结构设计 和 数据 的 合理性 组织 ， 数据组织 包括 对象 存储 分配 策略 、 对象 间 的 逻辑关系 管理 及 对象 间 的 权限 管理 等 。 　 图形库 结构设计 　 　 弹箭 系统 非常 庞大 ， 自身 的 分类 方法 也 各种各样 。 就 以 炮弹 为例 ， 以 攻击 目标 分可 分为 反坦克炮 弹 、 反 工事 炮弹 ， 以 口径 分可 分为 小口径 、 中 口径 、 大 口径 炮弹 ， 还 可以 用途 、 稳定 方式 、 发射 方式 等 分类 ， 这 就 意味着 弹箭 系统 的 查询 方式 是 复杂 多样 的 ， 查询 路径 不易 唯一 确定 ， 需要 以 设计者 习惯 查询 概率 权衡 设计 ， 最终 采用 了 如图所示 的 图形库 结构 ， 实践证明 以 这种 强调 “ 用途 ” 的 分类 方法 进行 主 查询 是 合理 的 ， 符合 设计者 使用 习惯 且 查询 路径 重复 少 。 　 图形库 数据组织 　 　 由图 可以 看出 ， 具体 到 某 一 构件 ， 需要 级 查询 ， 因此 要 保证 图形库 操作 可靠 、 快速 、 方便 ， 图形库 内部 对象 间 的 数据组织 就 非常 重要 ， 为此 我们 在 数据库 结构 模型 基础 上 ， 采用 一种 扩充 型 的 关系 数据模型 。 主要 建立 了 种 数据库 式 的 数据文件 ， 这种 文件 将 数据库 的 特点 融入 数据文件 中 ， 避免 了 纯 数据库 管理 造成 的 集成性 差 、 用户 使用 不 方便 的 弊病 ， 又 具备 类似 数据库 的 快速 检索 、 查询 功能 。 图弹 箭 系统 图形库 的 基本 结构 　 　 主 查询 数据文件 danfft 　 　 它 记录 一 、 二级 查询 的 属性 信息 ， 为了 缩小 文件 容量 ， 将 界面显示 的 索引 代号 代表 某些 属性 。 用 C语言 的 结构 描述 为 ： typedefstructdan 　 　 　 　 char 　 gnoNN 　 　 代号 　 　 　 　 　 char 　 dia 　 　 口径 　 　 　 　 　 char 　 date 　 　 年代 　 　 　 　 　 short 　 iddan 　 　 炮弹 或 火箭弹 标志 　 　 　 　 　 short 　 iddan 　 　 弹 类型 标志 　 　 　 　 　 short 　 tag 　 　 删除 逻辑 标志 　 　 　 　 　 struct 　 dan 　 next 　 　 　 　 　 　 　 　 　 DAN 　 　 图库 级 查询 数据文件 pdffthjdfft 　 　 它 记录 实现 三 、 四 、 五级 查询 及 用于 驱动 参数 化 绘图 所 需 的 属性 信息 。 用 C语言 的 结构 描述 为 ： 　 　 typedefstructtuku 　 　 　 charfnameMM 零 、 部 、 组件 名称 　 　 　 chargnameLLdwgsldlspdat 文件名 　 　 　 chartagdwgdwg 文件 逻辑 代号 　 　 　 chartaglsplsp 文件 逻辑 代号 　 　 　 structtukunext 　 　 　 　 　 　 　 　 　 TUKU 　 参数 化 绘图 数据文件 dat 　 　 它 记录 用于 描述 构件 结构 、 形状 的 参数 数据 。 为 实现 数据 交互 管理 ， 其 数据 按 一定 的 格式 存储 。 　 　 除此之外 ， 还 针对 基本 图库 、 工作 图库 的 数据文件 jbfftworkfft 。 这些 数据库 式 的 文件 有机 地 管理 着 图形库 的 所有 查询 、 编辑 、 绘图 工作 ， 由于 是 分类 建立 ， 因此 查询 效率高 ， 文件 易于 管理 ， 并 具有 良好 的 开放性 。 　 图形库 的 功能 及 实现 　 　 本 系统 设计 了 大 功能模块 ， 见图 。 查询 设计 模块 DJXT ， 主要 对 炮弹 和 火箭弹 库 记录 的 各种 弹种 进行 条件 逐级 查询 ， 最终 达到 图形 浏览 、 插入 、 打开 或 参数 化 绘图 的 目的 ， 且 可 在 AutoCAD 环境 中 编辑 、 完善 或 输出 。 编辑 模块 EEDIT 主要 用于 对 炮弹 和 火箭弹 库 的 记录 进行 逻辑 删除 、 恢复 和 添加 ， 目的 是 提高 查询 速度 ， 保证系统 对 特定 用户 开放 。 工作 库 编辑 模块 WEDIT ， 是 针对 工作 库 进行 的 图形文件 删除 、 图形 插入 和 打开 ， 以 方便 用户 操作 ， 提高 工作效率 。 工作 库 存储模块 WSAVE ， 其 设计 目的 是 维护 炮弹 库 和 火箭弹 库 的 独立性 和 保密性 ， 保证 用户 工作 的 连续 、 快捷 。 图 　 图形库 功能模块 　 　 上述 的 交互 界面 ， 利用 AutoCADR 提供 的 可编程 对话框 接口 PDB 和 部分 的 菜单 方式 ， 所有 库 查询 、 检索 、 参数 数据管理 和 对话框 驱动 使用 ADS ， Autolisp 语言 用于 参数 化 绘图 ， 这样 做 使得 各种 语言 各尽其 长 。 图形库 系统 与 AutoCAD 系统 浑然一体 ， 整个 操作 包括 图形库 的 挂接 、 卸载 均 可靠 、 方便 、 快速 ， 有效 地 保证 了 弹箭 系统 操作 的 即时性 。 下面 是 ADS 实现 条件 查询 的 回调 函数 部分 程序段 ： 　 　 staticstructdancreatvoid ； 　 　 voidCALLBconditionlistadscallbackpacketcpkt 　 　 　 　 charcontTILESTRLIMITshowTILESTRLIMIT 　 　 charlistTILESTRLIMIT 　 　 intn 　 　 DANpppcheadNULL 　 　 adsgettilecpktdialogradiokeycontTILESTRLIMIT 　 　 creat 生成 用户 所 选择 弹种 的 链表 phead 为头 指针 　 　 pphead 　 　 pphead 　 　 　 　 adsstartlistcpktdialogsearchkeyLISTNEW 　 　 doifstrcmpcontgnokeystrcpyshowpgno 　 　 ifstrcmpcontdatekeystrcpyshowpdate 　 　 ifstrcmpcontdiakeystrcpyshowpdia 　 　 ifstrcmpshowcpktvalue 　 　 　 　 nn 　 　 　 　 ifnpcheadp 　 　 　 　 elsepnextp 　 　 　 　 pp 　 　 　 　 strcpylist 代号 ： 　 　 　 　 strcatlistpgno 　 　 　 　 strcatlist 　 　 　 　 strcatlistpdate 　 　 　 　 strcatlist 年 　 　 　 　 strcatlistpdia 　 　 　 　 strcatlist 毫米 　 　 　 　 adsaddlistlist 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 ppnext 　 　 whilepNULL 　 adsendlist 　 ifn 　 　 adssettilecpktdialogerror 无 符合条件 的 弹种 　 　 elsepnextNULL 　 　 　 　 adssettilecpktdialogerror 　 　 　 adsmodetilecpktdialogsearchkeyMODESETFOCUS 　 　 return 　 　 　 由此 可 看出 ， 使用 对话框 的 用户 接口 程序 编程 ， 具有 比 一般 编程 更强 的 错误 检查和 预见 功能 。 　 关键技术 　 　 查询 设计 模块 中 应用程序 间 的 通信 　 　 Autolisp 是 嵌入 AutoCAD 内部 的 解释 型 语言 ， 而 ADS 应用程序 是 一系列 经过 编译 和 连接 的 C 函数 ， 这些 函数 作为 AutoCAD 的 外部 函数 ， 由 Autolisp 控制 ， 故 ADS 应用程序 无法 调用 Autolisp 函数 。 为 解决 这种 情况 下 的 通信 问题 ， 作者 设计 了 下面 程序段 ， 即用 Autolisp 语言 作为 主调 函数 ， 使 ADS 应用程序 与 Autolisp 应用程序 有机 地 集成 在 函数 内部 ， 从而 提供 了 解决 这 类 问题 的 方法 和 思路 。 若 将 执行命令 编制 到 AutoCAD 菜单 文件 中 ， 则 运行 是 相当 简捷 方便 的 。 defunCrdjxtnewstr 　 xload “ djxtk ” ； 装入 编译 连接 成功 的 “ djxtkexe ” 　 setqnewstrCdjxt ； 调用 ADS 定义 的 外部 C 函数 djxt 　 装入 与 newstr 相关 的 Autolisp 绘图 程序 　 用 数据 驱动 Autolisp 应用程序 　 xunload “ djxtk ” ； 卸载 　 　 djxt 为 ADS 应用程序 “ djxtkexe ” 中 所 定义 的 外部 C 函数 ， ADS 要求 所有 通过 ADSLINK 与 Autolisp 通信 的 函数 ， 只能 且 必需 返回 一个整 数值 ， 即使 使用 ADSREGFUNC 注册 的 直接 与 Auolisp 通信 的 外部 函数 ， 也 只能 返回 一个 整数 RSRSLT 或 RSERR ， 如果 使用 其它 值 ， 则 可能 导致 应用程序 崩溃 ， 因此 在 设计 ADS 程序 时 ， 只能 用 ADS 提供 的 函数 adsretstrstr 将 代表 数据库 文件名 的 字符串 newstr 传给 主调 函数 ， 以 实现 对 Autolisp 应用程序 的 驱动 ， newstr 是 两种 应用程序 间通信 的 纽带 ， 这种 将 “ 数据 独立 于 程序 ” 和 “ 数据 驱动 应用程序 ” 的 技术 ， 也 是 现代 CADCAM 发展 的 要求 。 　 对 Autolisp 绘图 程序 的 驱动 问题 　 　 ADS 应用程序 将 代表 数据库 文件名 的 newstr 传给 主调 函数 ， 如何 在 程序 内部 简洁 地 实现 newstr 对 绘图 程序 的 驱动 ， 是 非常 关键 的 问题 。 本 系统 设计 了 一种 巧妙 的 办法 ， 定义 每 一个 绘图 程序 与 newstr 对应 的 文件名 相同 ， 在 所有 程序 内部 定义 相同 的 自定义 绘图 函数 名 ， 如 drvli ， 其中 li 为 数据 联结 表 ， 这样 不同 绘图 程序定义 的 相同 绘图 函数 在 不同 的 数据表 驱动 下 完成 的 功能 是 不同 的 ， 在 程序 内部 仅用 一条 语句 就 可以 解决 各种 数据 对 相应 应用程序 的 驱动 ， 这种 解决 方法 同样 适用 于 其它 语言 。 下面 为 驱动程序 段 ： 　 　 　 　 ： 　 　 setqnewstrcdjxt 　 　 ifnewstr “ ” 　 　 打开 文件 生成 数据 联结 表 li 　 　 loadnewstr 　 　 drvli 　 　 　 　 　 　 ： 参数 数据 可视化 管理 　 　 实现 参数 化 绘图 ， 必然 要 解决 参数 的 输入 和 编辑 问题 。 作者 针对 现有 参数 输入 和 AutoCADR 提供 的 ASE 接口 进行 外部 数据库 数据管理 的 缺陷 ， 特 设计 了 一个 基于 图形 绘制 的 通用 数据 交互 管理 模块 在 此 不 做 专门 介绍 。 它 使 所有 参数 可视化 ， 用户 仅 在 一个 对话框 环境 中 ， 就 可 快速 、 方便 地 实现 所有 参数 的 查询 、 编辑 和 存储 ， 并 驱动 应用程序 ， 对话框 还 设置 了 便于 用户 选择 修改 的 幻灯 模板 。 该 模块 与 弹箭 查询 模块 融为一体 ， 真正 达到 了 集 查询 、 设计 于 一体 的 目的 。 　 结论 　 　 弹箭 系统 图形库 的 设计 方法 很多 ， 实现 管理 的 技术 也 是 复杂 多样 的 ， 需要 在 长期 的 探索 中 总结 、 完善 。 目前 在 预 使用期 ， 用户 反映 良好 ， 基本上 达到 了 创建 图形库 的 目的 。 作者简介 ： 杜淑幸 　 女 ， 岁 ， 硕士 ， 主要 从事 机械 CAD ， 计算机 图形学 和 数据库 方面 的 教学 和 科研工作 作者 单位 ： 西安 电子 科学 电子机械 学院 西安 　 参考文献 　 　 BownHumancomputerInterfaceDesignGuideline 　 　 方铁 编著 AutoCAD C语言 高级 编程 北京 ： 清华大学出版社 　 　 MarcusAAndriesVDUserinterfaceDevelopmentfortheNinetiesIEEEComputer ， ， ： 　 　 KleinfeldtS ， etalDesignMethodologyManagmentProceedingoftheIEEE ， ， ： 　 　 许 社教 主编 计算机 绘图 西安 ： 西安电子科技大学 ， 　 　 现民 ， 晓志译 AutoCAD 应用 开发工具 大全 北京 ： 清华大学出版社 ， 收稿 日期