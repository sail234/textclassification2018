自动化 学报 ACTAAUTOMATICASINICA 年 　 第卷 　 第期 　 Vol 　 No 　 基于 知识 的 人脑 三维 医学 图象 自动 分析 显示 系统 谢逢 　 罗立民 　 田雪芹 　 胡刚 　 　 摘 　 要 　 设计 并 实现 了 一个 基于 知识 的 人脑 三维 医学 图象 分析 显示 系统 ， 完成 了 脑组织 的 自动 分割 及 显示 系统 包含 动态 模块 及 静态 模块 两 部分 静态 模块 即 人脑 知识库 ， 存贮 脑内 各 组织 形态 、 生理 及 图象 灰度 方面 的 知识 动态 模块 包含 全局 数据 区 、 图象处理 算 子集 和 控制 规则 集在 知识 的 指导 下 ， 运用 “ 智能 光线 跟踪 ” 方法 提取 、 显示 脑内 主要 解剖 结构 　 　 关键词 　 人工智能 、 光线 跟踪 、 图象 分割 显示 KNOWLEDGEBASEDSYSTEMFORAUTOMATICANALYSISANDDISPLAYOFBRAINMEDICALIMAGESXIEFENG 　 LUOLIMIN 　 TIANXUEQINGDeptofBiomedicalEngSoutheastUniversityNanjingHUGANGMicroelectronicsCenterSoutheastUniversityNanJingAbstractThispaperdealswiththedesignandimplementationofaknowledgebasedsystemtoanalyzetheanatomicalimagesofhumanbrainautomaticallyThesystemconsistsoftwopartstaticmoduleanddynamicmoduleThestaticmoduleisthebrainanatomicalknowledgebaseThedynamicmoduleincludessetofimageprocessingoperatorscontrolrulesandglobaldataThecontrolrulesimplementthe “ knowledgebasedraytracingalgorithm ” tofindthesurfacepointoftheinterestingorgansanddisplaythemKeywordsartificialintelligenceraytracingimagesegmentationanddisplay 　 引言 　 　 计算机 断层 医学 成像 的 各种 设备 XCT ， NMR 已 成为 获取 人体 结构 和 功能 信息 的 重要 工具 医学 图象 的 分析 与 显示 技术 为 生理 病理 研究 及 疾病 早期 诊断 提供 强有力 的 手段 ， 是 实现 手术 计划 、 模拟 解剖 教学 及 多 模式 数据 融合 的 关键 　 　 国外 于 年代 初 推出 了 实用 系统 ， 如 美国 的 ANALYZE 和 加拿大 的 ALLEGRO 等 年代 初期 AtamPDhawn 提出 基于 知识 的 腹部 CT 图象 分析 理解 系统 ［ ］ 该类 系统 缺乏 完备 有效 的 知识 模型 和 直接 处理 三维图 象 的 有效 方法 ， 处理 时间 长 ， 结果 受 人为因素 的 影响 本文 介绍 我们 实现 的 一个 基于 知识 的 人脑 三维 医学 图象 自动 分析 显示 系统 ： 提出 了 一组 特征 参量 用以 描述 人脑 主要 结构 的 解剖学 特征 和 生理功能 及 成象 特性 ， 建立 了 完整 的 适于 D 图象 分割 与 显示 需要 的 人脑 知识 模型 ； 从 多功能 光线 跟踪 显示 系统 出发 ， 将 脑内 各 主要 结构 的 知识 模型 和 体元 数据 匹配 ， 直接 从 体积 数据 中 提取 显示 人脑 主要 解剖 结构 ， 从而 构成 一个 “ 智能 光线 跟踪 ” 系统 　 系统 概况 　 系统 基本 组成 　 　 系统 总体 结构 如图所示 图 　 系统 总体 结构 　 　 静态 模块 即 人脑 知识库 ， 位于 硬盘 上 每个 解剖 结构 的 相关 知识 存于 一个 数据文件 中 动态 模块 在 程序运行 时 驻留 内存 全局 数据 区 包含 系统 状态变量 、 原始 体积 数据 、 中间 处理结果 、 最终 结果 图象处理 算 子集 可以 包含 任何 图象处理 算子 ， 如 滤波 、 插值 、 边界检测 等 控制 规则 集 实现 系统 控制策略 ， 将 图象处理 算子 集中 的 算子 按 一定 次序 有机 组合 ， 完成 某项 图象处理 任务 ； 有 选择地 将 知识库 的 某 一部分 调入 内存 ， 实现 知识库 的 搜索 策略 　 处理过程 　 　 系统 采用 “ 多功能 光线 跟踪 ” 方法 ［ ］ 完成 人脑 三维 医学 图象 的 分析 显示 系统 流程 如图 图 　 系统 处理 流程 　 　 光线 跟踪 是 一种 有效 的 体积 数据 的 分割 、 显示 方法 ， 能 产生 真实感 很强 的 图象 光线 与 物体 的 求交是 该 方法 的 关键 传统 的 光线 跟踪 方法 全局性 的 预处理 必不可少 ， 如 滤波 、 异 分辨率 体积 数据 插值 等 ， 时间 空间 复杂度 很 高 ； 各种 光线 与 物体 的 求交 运算 往往 只 利用 图象 灰度 信息 而 在 医学 图象 中 人脑 各 主要 结构 的 灰度 分布 范围 往往 相互 重叠 ， 单纯 依赖 灰度 信息 无法 将 它们 分开 　 　 我们 提出 “ 智能 光线 跟踪 ” 方法 对 之 加以改进 ： 　 　 将 全局性 的 预处理 局部 化 ， 纳入 光线 跟踪 过程 先 进行 初步 表面 检测 ， 确定 表面 点所处 位置 范围 以后 所有 的 预处理 都 局限于 表面 点 附近 　 　 初步 表面 检测 将 综合利用 知识库 中 的 几何 形态 及 图象 灰度 信息 ， 实现 光线 跟踪 智能化 　 系统 知识 　 知识 模型 　 　 所谓 知识 模型 是 一组 用于 刻画 脑 主要 结构特征 的 参量 ， 有 数字化 的 ， 如 大小 、 位置 坐标 ； 非 数字化 的 ， 如 各 结构 间 的 相对 位置 关系 建立 人脑 知识 模型 的 目的 则 是 定义 那些 对 图象 分割 与 显示 有用 的 特征 参量 ， 以 明确 获取 知识 的 范围 本文 提出 的 人脑 知识 模型 ［ ］ 包含 拓扑 结构 、 几何 形态 位置 及 图象 灰度 生理学 信息 三 方面 信息 　 　 拓扑 结构 　 即脑 内 各 组织 结构 间 的 相对 位置 关系 从 核磁共振 图象 中 我们 可 分辨 出 颅骨 、 脑膜 及 脑脊液 、 大脑 髓质 主要 是 胼胝 体 、 脑室 、 小脑 及 脑干 等 ， 从外 到 内 逐层 分布 ， 以 层次 关系 为主 ， 并列 关系 为辅 ， 如图所示 语义 树 初步 表面 检测 较 多 利用 拓扑 关系 ， 因为 它 反映 了 人脑 结构 的 本质特征 ， 不 受 外界 因素 影响 图 　 人脑 解剖 知识 模型 　 　 几何 形态 位置 知识 　 描述 脑内 各 主要 结构 的 形状 、 大小 及 位置 表皮 、 颅骨 、 脑脊液 等 呈 层状 分布 ， 包围 内部 物质 ， 可用 球壳 近似 ， 其 大小 以球壳 厚度 表示 ； 脑干 、 小脑 、 基底 核 和 脑室 ， 以 包围 盒 近似 ： 包围 盒 形状 与 各 结构 表面 形状 接近 ， 包围 盒 尺寸 反映 结构 大小 ， 包围 盒 顶点 反映 结构 在 脑内 的 大致 位置 受 个体差异 、 头部 在 体积 数据 中 的 位置 等 不定 因素 影响 ， 包围 盒 只能 反映 组织 器官 所 处 大致 范围 ， 加速 光线 跟踪 　 　 图象 灰度 及 生理 信息 　 生理 信息 包含 各 组织 器官 的 名称 、 类 属 关系 、 生理功能 等 ， 作为 知识库 检索 的 索引 ， 以 适应 不同 的 应用 需要 脑组织 在 医学 图象 中 的 灰度 分布 和 具体 成 象 机理 密切相关 ， 是 图象 分割 的 重要依据 　 知识 表示 　 　 系统 的 静态 模块 以 数据文件 方式 长期 存贮 人脑 主要 结构 的 解剖 知识 ； 动态 模块 则 以 框架 形式 表示 当前 待 匹配 结构 的 有关 知识 　 　 框架 由 许多 反映 事物 特性 的 槽 组成 ： 框架 中 的 属性 槽 可 用于 表示 结构 的 几何 信息 和 灰度 信息 ； 关系 槽 表示 相对 位置 关系 ； 控制 槽 表示 框架 的 匹配 操作 现以 大脑皮层 为例 说明 框架 的 主要 结构 ： 框架 名称 ， 最大 厚度 ， 最小 厚度 ， 平均 厚度 ， 最大 灰度 ， 最小 灰度 ， 平均 灰度 ， 父 框架 名称 ， 子 框架 名称 ， 兄弟 框架 名称 ， 生理功能 ， 框架 匹配 规则 　 　 通过 框架 的 初始化 操作 ， 将 知识库 中 相应 的 数据文件 调入 内存 ， 填充 框架 的 属性 槽 和 关系 槽 ， 完成 静态 知识 到 动态 知识 的 转变 　 知识 获取 　 　 人脑 主要 结构 的 生理 信息 及 拓扑 关系 来源于 人体 解剖学 中 对 人脑 构造 及 功能 的 描述 ； 几何 形态 知识 来源于 人脑 三维 立体 定向 图谱 ［ ］ ， 该 图谱 给出 了 不同 断面 上脑 内 各 主要 结构 的 定量 描述 ， 如 最大 、 最小 及 平均 尺寸 、 位置 等 由于 这些 数据 建立 在 大量 样本 测量 的 基础 上 ， 故 具有 一定 代表性 ； 图象 灰度 信息 来源于 我们 对 人脑 或 二维 图象 的 实际 测量 ， 主要 通过 人机交互 手段 实现 为了 避免 个体差异 带来 的 影响 ， 我们 对 几何 形态 及 灰度 信息 的 数字化 特征 参量 作 了 归一化 处理 　 知识 运用 — — 基于 知识 的 初步 表面 检测 　 　 基于 知识 的 表面 检测 由 一系列 光线 和 框架 的 匹配 操作 组成 ， 其 基本 思想 是 ： 从图 中 寻找 一条 以根 结点 为 起点 ， 以 目标 结点 为 终点 的 路径 路径 上 的 结点 代表 了 光线 到达 目标 之前 遇到 的 物体 这样 的 路径 可能 有 多条 ， 代表 从 不同 方向 射入 人脑 的 光线 可能 遇到 不同 物体 根据 框架 选择 规则 决定 当前 待 匹配 结构 ， 并 将 对应 数据文件 从 知识库 调入 内存 ， 初始化 对应 框架 然后 将 光线 上 的 体元 数据 与 框架 属性 匹配 ， 找出 属于 该 结构 的 所有 体 元 引导 光线 穿过 这些 体 元 ， 直至 到达 目标 结构 的 表面 　 系统 推理 机制 　 　 推理 是 指 从 知识库 中 选取 相应 的 知识 以 指导 图象 的 分割 和 理解 系统 推理 机制 的 实现 依赖于 动态 模块 中 的 控制 规则 集 和 系统 状态变量 　 系统 状态变量 　 　 系统 状态变量 是 一个 全局 结构 ， 结构 中 的 域 反映 了 系统 当前 状态 其 组成 可 描述 如下 ： TypeStatusRecordvolumedata 原始 体积 数据 是否 被 调入 内存 ； raydata 　 　 当前 光线 是否 初始化 ； framedata 　 　 当前 框架 是否 初始化 ； surfacefind 　 是否 找到 光线 与 体表 的 交点 ； framematch 　 　 当前 框架 是否 匹配 成功 ； End 　 　 在 系统 初始化 时 ， 各域 都 被 置 　 控制 规则 　 　 系统 的 控制 规则 以 产生 式 表示 ， 形式 为 ： IF 前提条件 ， Then 动作 前提条件 即 系统 状态变量 中 的 各个 域 ； 动作 则 是 图象处理 算子 系统 的 主要 控制 规则 有 ： 　 　 初始化 规则 — — 包括 体积 数据 初始化 将 体积 数据 调入 内存 、 光线 初始化 从 体积 数据 中 读出 当前 光线 上 的 体元 数据 和 框架 初始化 规则 　 　 框架 选择 规则 — — 该 规则 决定 知识库 中下 一待 匹配 的 结构 ， 即 实现 知识库 的 搜索 策略 系统 采用 带 回溯 机制 的 深度 优先 算法 　 　 框架 匹配 规则 — — 框架 匹配 的 前提 是 其父 框架 都 已经 匹配 成功 ， 即 光线 已 穿过 属于 这些 结构 的 体元以 大脑皮层 为例 ， 说明 框架 的 匹配 操作 ： 若 当前 体 元 灰度 值 不 在 皮层 灰度 范围 内 ， 光线 前 进一步 ， 计数器 加 ； 若 计数器 的 值 已 超过 皮层 最大 厚度 ， 则 框架 匹配 失败 ， 初始化 下 一根 光线 若 当前 体 元 灰度 值 在 皮层 灰度 范围 内 ， 则 记下 当前 点 位置 ， 并 对 以后 的 n 个体 元 进行 同样 的 检验 若 符合条件 的 体元数 超过 阈值 ， 则 认为 当前 点 即 为 表面 点 否则 ， 光线 从 当前 位置 继续 前 进一步 ， 计数器 加 　 　 图象处理 规则 — — 若 找到 物体 表面 体 元 ， 则 依次 调用 局部 插值 、 局部 边界检测 、 表面 法线 矢量 计算 、 图象合成 等 图象处理 算子 　 实验 结果 及 讨论 　 　 在 医学 应用 中 ， 从 体积 数据 中 自动 提取 显示 给定 的 某个 组织 结构 有 重要 意义 由于 病灶 情况 复杂 ， 对 病变 组织 的 自动检测 往往 很 困难 ， 采用 “ 淘汰法 ” 是 解决 该 问题 的 一条 有效途径 ： 利用 基于 知识 的 系统 先 提取 各个 已知 组织 ， 并 从 体积 图象 中 减去 ， 剩下 的 结构 往往 对应 于 病变 本 系统对 若干个 三维 脑部 CT 和 MR 图象 数据 进行 了 实验 这里 以 一个 × × 的 人脑 三维 MR 图象 为例 ， 感兴趣 结构 包括 头部 轮廓 、 大脑皮层 、 侧脑室 等 给定 某个 结构 后 ， 系统 自动 提取 并 给出 相应 结构 的 三维 显示 ， 如图所示 图 ac 显示 为 头部 轮廓 ； df 为 大脑皮层 ； gh 为 侧脑室 实验 表明 图象 分析 与 理解 的 效果 与 知识 模型 密切相关 ： 　 　 灰度 信息 对 图象 分割 影响 很大 灰度 范围 太 宽 或 太窄 均 会 导致 误 分割 ， 甚至 出现 伪象 ； 　 　 分割 的 效果 还 与 视线 方向 有关 大脑皮层 后视图 及 顶视图 的 分割 显示 效果 明显 优于 正视图 由于 知识 模型 中 尚未 包含 眼 、 鼻 、 口腔 等 面部 结构 ， 这些 结构 只能 从 正视图 中 看到 图 　 室验 结果 图象 　 　 虽然 实验 结果表明 ， 本文 提出 的 “ 智能 光线 跟踪 系统 ” 与 传统 的 三维图 象 分析 和 显示 方法 相比 运算 速度 及 自动 程度 大大提高 ， 但 知识库 和 对 其 的 运用 还 有待于 进一步 完善 作者简介 谢 　 逢 　 一九九五年 三月 于 东南大学 生物科学 与 医学 工程系 生物医学 工程硕士 ， 现为 美国 Clemson 大学 博士 研究生 　 　 罗立民 　 一九八六年 六月 于 法国 雷恩 大学 获 信息处理 博士 ， 现任 东南大学 生物科学 与 医学 工程系 教授 、 博士生 导师 和 系主任 ， 学术 兼职 有 IEEEEngineeringonBiologyandMedicineMagazineIEEEBookSeriesonEmergingTechnologiesinBiomedicalEngineering 和 InnovationTechnolgieenBiologieetMedecine 编委 ， 法国 雷恩 大学 客座教授 他 目前 的 研究 兴趣 在于 三维 医学 图象 分析 与 显示 、 三维 动态 图象 分析 、 基于 知识 和 模型 的 高维 较象 和 建模 和 分析 、 显微 医学 图象 分析 和 应用 、 立体 定向 外科 治疗 计算机 计划 系统 Emailluolistseueducn 作者 单位 谢逢 　 罗立民 　 田雪芹 　 东南大学 生命科学 与 医学 工程系 　 南京 　 　 　 　 　 　 胡刚 　 东南大学 微电子 中心 　 南京 　 参考文献 ［ ］ 　 AtamPDhawanetalKnowledgebasedanalysisandunderstandingofmedicalimagesMethodProgramsinBiomedicine — ［ ］ 　 罗立民 等 多功能 光线 跟踪 方法 东南大学 学报 ， ： — ［ ］ 　 谢逢 基于 知识 的 人脑 三维 医学 图象 的 分析 与 显示 ［ 硕士论文 ］ 南京 ： 东南大学 ， ， — ［ ］ 　 陈玉敏 等 人脑 内 主要 核团 立体 定位 解剖 图谱 北京 ： 科学出版社 收稿 日期 　