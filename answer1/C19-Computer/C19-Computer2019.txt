微型机 与 应用 MICROCOMPUTERITSAPPLICATIONS 年 第卷 第期 VolNoWindows 应用程序 的 软件测试 驱动程序 设计 毛法尧 　 兰毓华 　 曹 化工 　 　 摘 　 要 ： 一种 针对 Windows 应用程序 特点 的 测试 驱动程序 设计 方法 ， 利用 此 方法 再 结合 具体 被测 程序 特点 就 可以 很快 得到 测试 所 需 的 驱动程序 。 　 　 关键词 ： 软件测试 　 Windows 应用程序 　 驱动程序 　 　 软件测试 是 保证 软件 质量 和 可靠性 的 重要 手段 ， 其 核心 是 在 输入 域 中 选择 具有 代表性 的 输入 数据 来 驱动 被测 程序运行 ， 观察 程序 的 执行 结果 ， 做出 相应 的 判断 和 处理 。 然而 在 进行 软件测试 的 时候 ， 必须 有个 驱动程序 来 驱动 被测 程序运行 。 驱动程序 相当于 个 主程序 ， 它 接收 不同 的 测试数据 ， 并 把 这些 数据 传递 给 被 测 程序 驱动 其 运行 。 如图所示 ， 驱动程序 和 桩 块 程序 构成 个 软件测试 的 运行 环境 。 图 　 软件测试 运行 环境 　 　 以前 基于 DOS 的 应用程序 是 种 结构化程序 ， 被测 程序 可以 看作 是 个子 程序 直接 被 驱动 主程序 调用 ， 并 在 调用 时 将 测试数据 传递 给 被 测 程序 ， 然而 现在 绝大部分 应用程序 是 基于 Windows 的 面向对象 程序 ， 采用 的 是 交互式 图形界面 ， 程序 的 输入 、 输出 是 基于 图形界面 交互式 完成 。 程序 的 执行 实际上 是 执行 个 由 消息 连接起来 的 方法 序列 ， 而 这个 方法 序列 往往 是 由 外部 事件驱动 的 ， 也就是说 要 实现 把 测试数据 传递 给 被 测 程序 ， 并 驱动 其 运行 ， 要求 驱动程序 能够 启动 、 引导 、 执行 被测 程序 ， 并 在 适当 时候 将 测试数据 传给 被测 程序 。 下面 从 Windows 程序结构 特点 和 运行机制 来 探讨 实现 Windows 应用程序 的 驱动程序 设计 方法 。 　 组成 及 工作 原理 　 　 个 Windows 应用程序 是 由 WinMain 函数 、 窗口 函数 和 其它 应用 函数 组成 的 ， WinMain 函数 是 Windows 应用程序 入口 点 ， 个 应用程序 在 启动 时 ， 是 通过 调用 个 由 编辑器 提供 的 启动 例程 开始 工作 的 ， 启动 例程 在 完成 一些 必要 的 初始化 工作 后 ， 再 调用 WinMain 函数 ， 使 应用程序 开始 正常 工作 状态 ， 即 进入 消息 循环 阶段 。 在 消息 循环 阶段 ， Windows 应用程序 通过 执行 一段 称为 消息 循环 的 代码 来 轮询 应用程序 的 消息 队列 ， 从中 检索 出该 程序 要 处理 的 消息 ， 并 立即 将 检索 到 的 消息 发送到 有关 对象 上 ， 执行 相应 的 窗口 函数 完成 相应 的 工作 。 由此可见 ， 要 驱动 被测 程序运行 ， 驱动程序 首先 必须 调用 被测 程序 的 启动 例程 来 完成 必要 的 初始化 工作 ， 然后 再 调用 WinMain 函数 进入 正常 工作 状态 ， 即 需要 个 启动 模块 来 完成 启动 工作 。 又 由于 Windows 应用程序 往往 有 多个 窗口 ， 而 要 传送 的 测试数据 是 其中 某 一个 或 几个 窗口 。 因此 ， 必须 要 有 个 引导 模块 来 引导 被测 程序运行 到 要 接收 测试数据 的 窗口 ， 然后 将 测试数据 传送 给 被 测 程序 ， 并 执行 测试 过程 。 综上所述 驱动程序 应由 启动 被测 程序 、 引导 被测 程序 、 传送 测试数据 和 执行 测试 模块 组成 。 如图所示 。 图 　 驱动程序 组成 　 实现 方法 ． 　 启动 被测 程序 　 　 要 启动 个 被 测 程序 可 通过 调用 LoadModule 函数 来 实现 ， LoadModule 的 定义 如下 ： INTLoadModulelpszModuleNamelpvParamterBlockLPCSTRlpszModuleName ； 要 装载 文件名 地址 LPVOIDlpvParamterBlock ； 用于 新 模块 的 参数块 地址 ． 　 引导 被测 程序 　 　 驱动程序 要 引导 被测 程序 完成 相应 的 操作 ， 可 采用 SendMessage 函数 向 被 测 程序 消息 队列 中 发送 相关 消息 来 实现 。 SendMessage 函数 定义 如下 ： 　 　 LRESVLTSendMessagehwndumsgwparamlparam 　 　 HWNDhwnd ： 目标 窗口 句柄 ， 如此 参数 为 HWNDBROADCAST ， 则 该 消息 将 被 送到 所有 顶层 窗口 ， 包括 无效 或 不 可见 的 无主 窗口 。 　 　 UINTumsg ： 要 发送 的 消息 。 　 　 WPARAMwparam ： 第一 消息 参数 ， 说明 与 消息 有关 的 位 附加 信息 。 　 　 LPARAMlparam ： 第二 消息 参数 ， 说明 与 消息 有关 的 位 附加 信息 。 　 　 该 函数 将 指定 的 消息 发送到 指定 的 窗口 或 所有 窗口 ， 它 调用 所有 窗口 的 窗口 函数 并且 在 窗口 函数 处理 完 消息 后 才 返回 。 　 　 从 上述 定义 可以 看出 驱动程序 可 根据 被测 程序 的 结构 和 操作 顺序 ， 依次 用 SendMessage 函数 向 被 测 程序 消息 队列 中 发消息 ， 来 引导 被测 程序 到达 待 测试项目 的 所在 窗口 。 例如 ， 调用 SendMessage 函数 将 EMSETSEL 消息 发送到 多行 编辑 控制 ， 通知 它 选择 所有 的 文字 ， 接着 调用 SendMessage 函数 将 拷贝 选择 文字 的 WMCOPY 消息 发送到 裁剪 板 。 SendMessagehwndmlEMSETSELMAKELONG ； SendMessagehwndmlWMCOPY ； ． 　 传送 测试数据 　 　 根据 软件测试 的 特点 ， 测试数据 可能 是 组 数据 、 个 字符串 、 个 控制 事件 等 。 如果 要 使 测试 过程 自动 进行 ， 可 在 被 测 程序 中 加上 按 WindowsDDE 协议 设计 接收 测试数据 的 接口 ， 驱动程序 也 按 DDE 协议 将 测试数据 通过 wparam 和 lparam 参数 来 传送数据 。 在 进行 黑盒 测试 时 ， 由于 不知 被测 程序 内部 详细 结构 ， 一般 情况 下 ， 应由 测试人员 输入 测试数据 。 ． 　 执行 测试 　 　 在 给 被 测 程序 传送 了 测试数据 后 ， 可 通过 SendMessage 函数 发 执行 测试 过程 的 消息 ， 被测 程序 接收 到 消息 后 ， 执行 相应 的 窗口 函数 完成 测试 过程 。 　 结束语 　 　 本文 提出 的 测试 驱动程序 设计 方法 ， 既 适合 于 基于 结构 的 白盒 测试 ， 又 适合 于 基于 功能 的 黑盒 测试 ， 同时 它 适合 于 面向对象 的 程序 方法 级 、 类级 、 簇级 、 系统 级 测试 ［ ］ 。 当然 ， 要 得到 一个 实用 的 测试 驱动程序 还 需 软件设计 人员 提供 有关 的 信息 如 窗口 句柄 、 消息 。 作者 单位 ： 武汉 华中理工大学 计算机 学院 参考文献 　 　 杨亮 ， 万玉丹 ， 魏晋 鹏 Windows 深入 剖析 — — 内核 篇 北京 ： 清华大学出版社 ， 　 　 Microsoft 公司 MicrosoftWindows ， 程序员 参考 大全 二 — — 函数 北京 ： 清华大学出版社 ， 　 　 金凌 紫 面向对象 软件测试 技术 进展 计算机 研究 与 发展 ， ； 收稿 日期 ：