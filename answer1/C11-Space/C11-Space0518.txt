航空 计测 技术 Aviation 　 Metrology 　 　 Measurement 　 Technology 年 第卷 第期 VolNo 多通道 智能 场强 计 的 研制 朱传焕 　 　 摘 　 要 　 介绍 C 单片机 在 研制 多通道 场强 计中 的 应用 情况 以及 软件 和 硬件 的 研究 设计 。 　 　 关键词 　 单片机 　 场强 计 　 硬件 　 软件 DevelopmentofMultiChannelIntelligenceFieldIntensityMeterZhuChuanhuan 　 　 Abstract 　 TheapplicationofCsinglechipcomputerindevelopingmultichannelintelligencefieldintensitymetertheresearchanddesignofsoftwareandhardwareareintroducedinthispaper 　 　 Keywords 　 SinglechipcomputerFieldintensitymeterHardwareSoftware 　 　 随着 现代科技 与 工业 的 发展 ， 电子 、 电气设备 或 系统 得到 了 越来越 广泛 的 应用 ， 电气设备 所 产生 的 干扰 电平 在 不断 地 提高 ， 电磁干扰 对 电磁 环境 造成 越来越 严重 的 污染 ， 它们 对 电子 、 电气设备 或 系统 以及 人们 的 身体健康 、 生态环境 构成 威协 。 我们 必须 对 这些 干扰 进行 测试 评估 ， 以便 采取措施 进行 有效 地 控制 。 近区 场强仪 是 一种 测量 高电平 近区 电磁场 的 测量 设备 ， 它 可 测量 各种 漏场 、 寄生 辐射 ， 还 可 用于 电磁兼容 性 实验 。 多通道 智能 近区 场强仪 不仅 具有 这些 功能 ， 它 还 可以 多种 方位 实时 地 监测 各种 变化 的 电磁干扰 。 其 测量范围 为 ～ V ／ m ， 频率 可达 GHz ， 测量 不 确定 度为 dB ， 通道 数可达个 。 　 　 多通道 智能 近区 场强仪 将 数据 采集 、 处理 、 控制 功能集 于 一体 ， 它 包括 硬件 和 软件 两 大部分 ， 其 核心 为 C 单片机 。 系统 设计 时 ， 尽量 用 软件 的 办法 解决 ， 以 减小 硬件 开支 ， 降低成本 。 根据 要求 ， 将 其 设计 为 最小 低功耗 单片机 应用 系统 。 下面 将 硬件 和 软件 部分 设计 分别 进行 论述 。 　 硬件 设计 　 　 硬件 部分 包括 探头 电路 、 平衡 — 不 平衡 转换 电路 、 多路 转换 控制电路 、 放大 电路 、 A ／ D 转换 电路 以及 C 单片机 。 硬件 设计 原理 框图 如图 。 图 　 硬件 原理图 下面 分别 介绍 各 部分 的 设计 情况 ： 　 探头 电路 　 　 由 小 对称 振子 、 检波 管 、 高 阻线 组成 ， 它 将 高频 信号 转换 为 直流 信号 ， 平衡 输出 。 　 平衡 — 不 平衡 转换 电路 　 　 由于 探头 输出 是 平衡 的 对称 方式 ， 必须 将 它 转换 为 不 平衡 方式 ， 所以 加上 平衡 — 不 平衡 转换 电路 ， 它 提供 高 输入阻抗 ， 由 低噪声 低 漂移 精密 运算 放大器 组成 ， 如图所示 。 图 　 平衡 — 不 平衡 电路 　 多路 转换 控制电路 　 　 由 六片 AD 多路 模拟 电子 开关 组成 ， 实现 可达路 通道 转换 ， 其 控制线 由 单片机 C 的 P 口 ， 经 两片 ～ 线 译码器 译码 后 提供 ， 如图 。 图 　 多路 转换 控制电路 　 程控 放大 电路 　 　 程控 放大 电路 将 小 信号 进行 倍 放大 ， 以 提高 测量 的 灵敏度 ， 将 大于 V 的 信号 衰减 倍 ， 由 低噪声 低 漂移 精密 运算 放大器 和 一个 模拟 电子 开关 组成 ， 放 大量 由 单片机 C 的 P 口 P 和 P 控制 ， 如图 。 图 　 程控 放大 电路 　 A ／ D 转换 电路 　 　 场强 计 的 A ／ D 转换 对 转换 速度 要求 不高 ， 只是 要求 精度高 ， 输入 电压 范围 大 ， 所以 选择 MC 芯片 。 MC 是 位半 A ／ D 转换器 ， 双 积分 型 ， 转换 精度高 ， 为 ％ ± 个 字 ， 功耗 低 ， 功能 完整 ， 片内 有 自动 极性 转换 和 自动 调零 功能 ， 并 提供 有 时钟 发生 电路 ， 抗干扰能力 强 ， 易 与 单片机 接口 ， 转换 速率 为 ～ 次 ／ s 。 　 C 单片机 　 　 为了 减小 功耗 ， 采用 低功耗 的 CHMOS 器件 ， CPU 选用 C ， 液晶显示 ， 最大 静态 电流 控制 在 mA 以内 。 　 　 C 单片机 由 CCPU 、 晶振 、 八位 液晶 显示器 组成 ， 如图 。 CCP 按 其 引脚 功能 分为 三个 部分 ： 　 　 aI ／ O 口线 ： P 、 P 、 P 、 P ， 共个 位口 。 　 　 b 控制 口线 ： PSEN 片外 取指 控制 、 ALE 地址 锁存 控制 、 EA 片外 储器 选择 、 RESET 复位 控制 。 　 　 c 电源 及时 钟 ： Vcc 、 Vss 、 XTAL 、 XTAL 。 　 　 CCPU 除了 电源 ， 复位 和 时钟 外 ， 其余 管脚 都 是 为了 实现 系统 扩展 而 设置 ， 它们 构成 了 三 总线结构 ， 即 ： 　 　 a 地址总线 AB ： 宽度 位 ， 其 外部 存储器 直接 地址 范围 为 K 字节 ， 位 地址总线 由 P 口经 地址 锁 存器 提供 低 八位 地址 A ～ A 。 P 口 直接 提供 高位 地址 A ～ A ； 　 　 b 数据总线 DB ： 宽度 位 ， 由 P 口 提供 ； 　 　 c 控制 总线 CB ： 由 部分 P 口 的 第二 功能 状态 和 根 控制线 PRST 、 EA 、 ALT 、 PSEN 组成 。 　 　 由于 C 是 片 内 带 EPROM 的 单片机 ， 不带 外部 存储器 扩展 ， 将 EA 按 高电平 ， P 、 P 、 P 、 P 都 可 用作 用户 I ／ O 口 。 　 　 八位 液晶 显示器 ： 由片 具有 锁存 功能 的 BCD — 段 液晶显示 译码 ／ 驱动器 和 八位 液晶片 及 RC 振荡器 组成 。 显示 通道 数 和 场强 值 ， 如 ： “ CH ： ” ， 即 为 第八 通道 ， 场强 值为 V ／ m 。 　 A ／ D 转换器 与 C 单片机 接口 　 　 虽然 MC 输出 是 动态 分时 BCD 码 输出 ， 但 由于 C 的 P 口 可 作为 用户 I ／ O 口 ， 所以 MC 可 直接 接在 C 的 P 口上 。 　 软件设计 　 　 结合 硬件 线路 ， 用 汇编语言 编程 ， 自动 交叉 反汇编 的 方法 得到 机器码 目标程序 。 采用 自顶向下 ， 模块 分割 的 设计 方法 ， 同时 考虑 和 硬件 的 配合 问题 ， 作 相应 调整 ， 综合 考虑 ， 权衡利弊 ， 调整 到 软 、 硬件 都 能 贯通 为止 。 在 编写 软件 时 ， 需要 借助于 流程图 ， 各 功能模块 的 图 　 C 单片机 原理图 逐层 分割 ， 其实 就是 流程图 由 粗到 细 的 过程 。 利用 MC — 单片机 进行 在线 仿真 开发 ， 把 系统 安置 在 实际 环境 中 进行 现场 测试 ， 分析 查找 测试 中 的 问题 及 原因 ， 根据 问题 ， 修改 软件 和 硬件 ， 直到 设计 符合 需要 。 多通道 智能 场强仪 监控 程序 原理 框图 如图 。 图 　 监控 程序 原理图 　 　 根据 总体 结构 ， 软件 包括 ： 　 　 初始化 准备 程序 ： 完成 对 CCPU 的 复位 清零 及 初始化 ， 进行 P 、 P 、 P 、 P 口 状态 设置 。 　 　 多路 开关 控制程序 ： 根据 通道 数 设置 多路 开关 数 ， 完成 通道 的 顺序 转换 。 量程 控制程序 ： 根据 输入 信号 大小 ， 自动 地 选择 合适 增益 或 衰减 ， 完成 对 程控 放大器 的 控制 。 　 　 A ／ D 转换 程序 ： 完成 数据 的 采集 。 　 　 数据处理 程序 包括 ： 数字 处理程序 、 检波 特性 修正 程序 、 探头 校准 系数 修正 程序 等 。 　 　 a 数字 处理程序 ： 将 存储 在 HHHHH 存储 放大 或 衰减 倍数 单元 的 BCD 码 计算 为 一个 数值 并 将 此 数值 存于 HH 。 　 　 b 检波 特性 修正 程序 ： 根据 H 和 H 单元 的 数值 采用 曲线 分段 拟 合法 得到 高频 感应 电压 ， 数值 存入 HH 。 将 检波 曲线 分成 四段 ， 每 一段 采用 直线 拟合 ， 直线 方程 为 ： Y ＝ aX ＋ b ， Y 为 感应 的 高频 电压 ， X 为 检波 的 直流电 压 ， 根据 检波 曲线 ， 求得 各段 直线 拟合 方程 如下 ： X ： ～ mV ： Y ＝ X ＋ 　 　 ～ mV ： Y ＝ X ＋ 　 　 ～ mV ： Y ＝ X ＋ 　 　 ～ mV ： Y ＝ X － 　 　 　 根据 直线 方程 ， 编写程序 得到 Y 。 　 　 c 探头 校准 系数 修正 程序 ： 将 H 和 H 单元 数值 利用 查表 或 直线 拟合 方法 得到 场强 数值 E 。 显示 程序 ： 显示 通道 数 和 对应 通道 场强 值 。 　 　 以上 程序 由于 占用 篇 辐 较大 ， 程序清单 不再 列出 。 　 　 软件 和 硬件 仿真 调试 成功 后 ， 脱机 运行 ， 功能 按 设计 要求 运行 ， 这样 软件 和 硬件 的 设计 基本 成功 。 　 场强 计 测量误差 分析 　 　 关于 A ／ D 转换 精度 和 分辨率 的 问题 　 　 aA ／ D 转换器 的 分辨率 习惯 上 是 以 输出 二进制位 数 或 BCD 码 位数 表示 ， 与 一般 测量 仪表 指针式 表达方式 不同 。 对于 MC 芯片 ， 分辨率 按 BCD 码 位数 表示 ， 为位 半 ， 满度 字 为 ， 用 百分数 表示 其 分辨率 为 ／ × ％ ＝ ％ 。 A ／ D 转换 中 ， 有 一个 量化 误差 的 问题 ， 它 和 分辨率 是 统一 的 ， 是 由于 有限 数字 对 模拟 数值 进行 离散 取值 量化 而 引起 的 误差 。 量化 误差 理论 上 为 一个 单位 分辨率 ， 提高 分辨率 可 减少 量化 误差 。 　 　 b 转换 精度 反映 了 一个 实际 A ／ D 转换器 在 量化 值上 与 一个 理想 A ／ D 转换器 进行 模拟 转换 的 差值 ， 可 表示 成 绝对 精度 和 相对 精度 。 这里 ， 精度 所 对应 的 指标 不 包括 量化 误差 。 　 　 cMC 实际 转换 精度 为 ± ％ Ux ± 个 字 。 对于 三位 半 A ／ D 来说 一个 字 误差 相当于 相对误差 为 ： ％ Vm ／ Vx ， Vm 为 满量程 值 V ， VxmV ～ V 为 A ／ D 转换 输入 电压 值 ， 表为 A ／ D 转换 的 实际 相对误差 。 　 　 d 由表 可以 看出 ， A ／ D 转换 测量 小 电压 误差 大 ， 为了 保证 测量 精度 ， 在 设计 时 ， 对 小于 mV 的 信号 进行 倍 放大 ， A ／ D 倍 放大 ， A ／ D 转换 电压 为 mV ～ V 电压 ， 最大 误差 为 ％ 。 表 A ／ D 电压 相对误差 ％ mVmVmVmVmVmVVV 　 平衡 — 不 平衡 转换 和 放大器 的 误差 优于 ％ 软件设计 中 数据 取舍 误差 为 ％ 检波 特性 数据 修正 误差 为 ％ 探头 校准 系数 修正 误差 为 ％ 频率 附加 误差 为 ％ 其它 因素 影响 测量误差 ％ 场强 计总 误差 为 ： ％ ＋ ％ ＋ ％ ＋ ％ ＋ ％ ＋ ％ ＋ ％ ／ ≈ ％ 作者简介 ： 岁 　 男 　 助理 工程师 作者 单位 ： 朱传焕 　 武汉 船舶设计 研究所 ， 湖北省 武汉市 ， 参考文献 　 　 　 陈 伟人 单片微 型 计算机 原理 及其 应用 北京 清华大学出版社 　 　 　 何立民 MCS — 系列 单片机 应用 系统 设计 系统配置 与 接口技术 北京 北京航空航天大学 出版社 　 　 　 陈汝全 等 单片机 实用技术 北京 电子 工业 出版社 　 　 　 沈 德金 等 MCS — 系列 单片机 接口 电路 与 应用程序 实例 北京 北京航空航天大学 出版社 　 　 收稿 日期 ： 修改 日期 ：