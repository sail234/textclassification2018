软件 学报 JOURNALOFSOFTWARE 年 第期 第卷 VolNo 基于 脑 图谱 和 模糊 聚类 的 磁共振 图像 分割 标注 谭鸥 贾 春光 吕 旭东 段会龙 吕维雪 　 　 摘要 　 利用 TTAtlas 中 丰富 的 结构 信息 文章 提出 了 一种 自动 分割 脑 MRImagneticresonanceimage 图像 的 方法 这种 方法 可 分为 两步 首先 将 MRI 图像 和 TTAtlas 配准 通过 图像 和 医学 图谱 的 匹配 利用 图谱 中 结构 信息 的 先验 知识 就 可以 对 图像 作 初步 的 分割 标注 然后 利用 这个 预 分割 的 模板 对 MRI 图像 进行 模糊 聚类 分割 从而 提高 分割 的 精度 为了 自动 地 将 预 模板 中 的 结构 信息 用于 分割 文章 还 提出 了 一种 引入 形状 因子 的 FCM 聚类 算法 除了 在 匹配 时 需要 手工 定出 一些 点 之外 该 方法 基本上 是 自动 的 　 　 关键词 　 MRImagneticresonanceimage 自动 图像 分割 图像匹配 脑 图谱 模糊 C 均值 聚类 形状 因子 可视化 人体 数据 集 　 　 中图法 分类号 　 TP 　 SegmentationandClassificationofMRIBasedonFCMClusteringAlgorithmandComputerizedBrainAtlasTANOuJIAChunguangL － XudongDUANHuilongLWeixueDepartmentofLifeScienceandBiomedicalEngineeringZhejiangUniversityHangzhou 　 　 Abstract 　 AnautomaticsegmentationandclassificationmethodofmagneticresonanceimageofhumanbrainbasedonacomputerizedbrainatlasTTatlasisintroducedinthispaperThealgorithmcouldbedividedintotwostepsFirstlytheobjectbraindatasetisregisteredwiththeTTatlasbyaDimagematchingmethodWiththehelpofanatomystructureinformationofthecomputerizedatlasthebrainimageissegmentedandclassifiedcoarselySecondlythesegmentationresultistakenastheinputofafuzzyclustersegmentationInordertousetheanatomicstructureinformationdirectlyanewfuzzyclustermethodwithashapefactorisintroducedthemethodismostlyandautomaticallyexceptselectionofsomeintrinsicpointpairsforgloballinearmatchingmethodinthefirststep 　 　 Keywords 　 MRImagneticresonanceimageautomaticimagesegmentationimagematchingbrainatlasFCMclusteringshapefactorvisiblehumandataset 　 　 MRImagneticresonanceimage 的 分割 标注 是 指 将 MR 图像 中 属于 同一 组织 的 图元 集群 并 标为 同 一类 （ 图 元 可以 是 二维 的 即 像素 也 可以 是 三维 的 即 体素 ） 其 目的 是 为了 量化 不同 组织 类型 的 形状 尺寸 然后 显示 在 三维空间 中 可用 来 指导 手术 和 治疗 例如 对 肿瘤 的 检测 、 各种 脑部 器官 病变 的 诊断 、 放射治疗 的 计划 等 　 　 在 过去 的 十几年 中 人们 已 提出 了 许多 对脑 断层 图像 的 自动 分割 和 标注 方法 并 获得 了 一定 的 成功 ［ ～ ］ 分割 方法 一般 可 分为 两类 基于 边缘 检测 的 和 基于 区域 特征 的 虽然 边缘 检测 方法 可以 产生 封闭 的 边界 但 由于 边缘 检测 算子 对 噪声 干扰 较 敏感 对于 边界 不太 明显 的 区域 误差 较大 所以 现在 的 注意力 都 集中 在 区域 识别 上 区域 识别 包括 阈值 法 、 聚类 法 、 区域 生长 法 、 一致性 测量法 、 分开 合并 法 以及 这些 方法 的 组合 等 但是 对于 像 医学 图像 这样 精细 、 复杂 的 对象 要 纯粹 基于 图像 内容 完全 自动 地 分割 出 所有 的 组织 结构 是 非常 困难 的 图像匹配 是 分析 两 （ 多 ） 幅 图像 或 其中 一部分 的 相似性 或 一致性 的 处理过程 通过 医学 图像 和 医学 图谱 的 匹配 ， 可以 把 不同 模态 的 图像 统一 到 某个 已知 的 标准 坐标 系统 （ 空间 正规化 ） 中 从而 确定 图像 数据 集 之间 的 几何变换 关系 而且 可以 实现 在 医学 图谱 指导 下 的 医学 图像 分割 和 分类 对于 医学 图像 和 医学 图谱 之间 的 匹配 往往 采用 非 刚性 的 匹配 方法 准确 的 匹配 可以 把 来自 医学 图谱 的 语法 的 和 或 语义 的 信息 映射 到 不同 病人 个体 的 图像 上去 医学 图像 和 图谱 之间 的 匹配 算法 可以 根据 匹配 过程 中 人工干预 的 多少 分为 手工 对准 方法 、 有 指导 的 对准 方法 和 全自动 的 对准 方法 ［ ］ 　 　 典型 的 数字化 医学 图谱 有 法国 Talairach 和 Tournoux 制作 的 TalairachTournoux 脑 图谱 TTatlas ［ ］ 德国 汉堡大学 Hhne 等 人 所 做 的 VoxelMan ［ ］ 美国 国家 医学 图书馆 NLM 发起 实现 的 数字化 人体 VisibleHumanProject ［ ］ 等 　 　 FCM 算法 是 一个 有效 的 数据 聚类 方法 它 通过 最优化 一个 模糊 目标 函数 来 实现 聚类 一般 要 通过 迭代 来 求解 这 类 算法 的 特点 是 赋予 每个 数据 点 一个 置信度 用来 表明 数据 点 对 各类 的 隶属 程度 而 不是 像 “ 硬 ” 聚类 那样 ， 认为 每点 只能 属于 某一 特定 类 　 　 FCM 算法 在 图像 分割 处理 中 已 得到 广泛 的 应用 其中 美国 南 佛罗里达州 大学 的 MatthewCClark 等 人 将 无 指导 的 FCM 算法 和 知识 模型 相结合 实现 了 MRI 图像 的 二维 自动 分割 ［ ］ 但 他们 的 脑 模型 只有 个 切片 分割 主要 集中 在 灰质 、 白质 等 较大 的 结构 上 而且 分割 和 标注 是 分别 进行 的 本文 提出 了 一种 自动 分割 脑 MRI 图像 的 方法 这种 方法 可 分为 两步 首先 将 MRI 图像 和 TTAtlas 配准 通过 图像 和 医学 图谱 的 匹配 可以 把 图谱 中 存储 的 拓扑 信息 直接 映射 到 MRI 然后 对 这个 预 分割 的 模板 用 FCM 方法 进行 模糊 聚类 分割 本文 还 提出 了 一种 加权 FCM 聚类 算法 将 模板 信息 直接 反映 到 FCM 算法 的 迭代 求解 中 控制 收敛 的 方向 和 速度 本文 第节 分析 了 图谱 匹配 和 加权 FCM 聚类 分割 算法 的 原理 ， 给出 了 具体 的 方法 和 参数 的 选择 第节 和 第节 对 实验 结果 进行 了 比较 和 分析 最后 是 结论 理论 匹配 　 　 图谱 匹配 方法 的 一个 直接 的 应用 就是 实现 医学 图像 的 自动 分割 对于 像 医学 图像 这样 精细 、 复杂 的 对象 要 纯粹 基于 图像 内容 完全 自动 地 分割 出 所有 的 组织 结构 几乎 是 不 可能 的 而 通过 图像 和 医学 图谱 的 匹配 可以 把 图谱 中 存储 的 拓扑 信息 直接 映射 到 待 分割 的 图像 这 就 好比 是 借助于 专家 知识 指导 的 分割 过程 但 这个 过程 可以 实现 完全 自动化 其他 信息 包括 功能 信息 、 相对 关系 以及 层次 信息 也 都 可以 通过 匹配 映射 到 图像 中 去 　 　 我们 采用 TT 脑 图谱 作为 匹配 的 源 图像 因为 它 提供 了 一个 独立 的 参考 坐标系 并且 有 极为 丰富 的 空间 解剖 结构 信息 另外 虽然 这种 图谱 和 任何 实际 病人 的 图像 没有 直接 的 关系 但 它 在 医学 教学 领域 中 有着 极为 广泛 的 应用 　 　 匹配 方法 大体上 可 分为 线性 和 非线性 两类 对于 我们 的 要求 来说 一个 较 好 的 三维 分段 线性 匹配 就够 了 这样 做 的 好处 是 匹配 时 的 手工 标注 工作 可以 减少 　 　 用于 线形 匹配 的 参数 （ 平移 、 旋转 、 缩放 、 仿射 等 ） 通过 交互 操作 来 确定 方法 有 以下 两种 　 　 （ ） 基于 图标 的 匹配 用户 选中 一系列 的 参考点 或 平面 作为 图标 然后 系统 计算 出 匹配 变换 矩阵 首先 找到 脑中 隔面 然后 在 其 上 找到 前 联合 点 （ AC ） 和 后 联合 点 （ PC ） 最后 定出 脑 的 顶点 即 在 脑中 隔 面上 通过 AC 点 垂直于 ACPC 的 线 与 脑 皮层 顶部 的 交点 有 了 这些 参考点 我们 就 可以 利用 TT 图谱 的 坐标系 定出 线形 匹配 的 参数 这种 坐标 系统 已 被 证明 适于 脑 结构 的 定位 它 的 定义 如下 坐标 原点 是 AC 点 第个 坐标轴 由 ACPC 线 确定 第个 轴 的 方向 由脑 中 隔面 的 法线 的 方向 确定 第个 轴 垂直于 前 两个 轴 并且 方向 向上 为了 确定 水平 方向 的 缩放 尺度 我们 还 需要 定出 一些 极值 点 　 　 （ ） 基于 视觉 的 匹配 用户 通过 比较 目标 图像 和 图谱 的 结果 ， 交互 地 做 一些 线形 变换 的 操作 比如 在 处理 某些 图像 时 直接 做 水平 方向 的 缩放 比定 极值 点 更 可靠 在 实际 应用 中 往往 是 两种 方法 结合 使用 一般 是 先作 基于 图标 的 变换 再 根据 结果 作 一些 基于 视觉 的 匹配 基于 形状 因子 的 模糊 分割 　 　 对于 多 特征向量 的 图像 （ 如 彩色图像 、 MRI 的 种 频率 分量 构成 的 图像 ， 或 加上 梯度 、 纹理 特征 等 的 图像 ） 进行 分割 可以 采用 聚类 方法 将 FCM 算法 用于 这 类 图像 的 聚类 ， 除了 可以 得到 分割 图像 之外 还 可以 根据 像素 的 隶属 度 判断 该 像素 属于 某 一类 的 隶属 程度 这 对 多 特征向量 图像 像素 分析 是 很 有用 的 例如 ， 当 某点 对 各类 的 隶属 度远 小于 时 表明 其 处于 各类 的 分界 处 或是 某 几类 物体 的 混合 　 　 通过 图谱 匹配 的 结果 我们 可 得到 一个 预 分割 模板 ， 它 反映 了 脑中 各 结构 的 数目 、 位置 、 集合 形状 等 为了 将 这些 形状 的 约束 引入 聚类 分割 我们 将 目标 图像 各 像素 的 空间 坐标 作为 一个 特征 但是 由于 各 组织 结构 形状 各异 很 难用 球形 或 其他 规则 的 形状 来 表示 所以 各点 到 各聚类 中心 的 距离 不能 用 欧基 里德 距离 来 表示 因此 我们 引入 形状 因子 这个 概念 利用 形状 因子 我们 可以 计算 出 空间 某 一点 到 某类 的 空间 距离 而 其他 特征 空间 的 距离 仍然 采用 欧基 里德 距离 来 计算 然后 将 两种 距离 进行 加权 相加 就 得到 通常 模糊 聚类 中 使用 的 距离 　 　 所谓 形状 因子 简单 地说 就是 用 一个点 的 集合 来 表示 某 结构 的 中心 某点 到 该 结构 的 距离 为 该 点 到 中心点 集 的 最 短距离 空间 内 所有 点到 该 结构 的 距离 的 矩阵 构成 该 结构 的 形状 因子 这个 距离 应 满足 以下 两点 （ ） 离 形状 的 中心点 越 近距离 越小 （ ） 形状 边缘 的 点 到 中心 的 距离 相等 但是 这个 点集 实际上 是 很 难 计算 得到 的 我们 利用 数学 形态 法中 的 腐蚀 和 膨胀 操作 可以 避开 求点集 直接 计算 各点 到 某类 的 距离 　 　 首先 对 每 一个 结构 M 建立 一个 二值化 的 模板 dijk 表示 从点 ijk 到 M 的 距离 则 距离 的 计算方法 如下 　 　 初始化 lMlM 　 　 计算 距离 　 　 收缩 操作 MlerosionMl 　 　 如果 MlMl 进到 第步 否则 ll 回到 第步 　 　 　 　 　 　 　 　 　 　 　 　 　 d ′ ijkdijkllMlM 　 　 膨胀 操作 MldilationMl 　 　 计算 距离 　 　 如果 l ＞ tL 或 MklMkl 算法 结束 否则 ll 回到 第步 　 　 求得 所有 模板 的 距离 矩阵 后设 dijk 是 由 图像 空间 上 一点 （ ij ） 到 类 k 的 距离 d 为 第步 得到 的 距离 则 　 　 式 中 a 为 比例 系数 c 为 总 的 结构 数 　 　 有 了 距离 的 计算方法 后 我们 可 仿照 传统 的 FCM 算法 的 步骤 进行 模糊 聚类 分割 图为 几个 结构 皮质 、 豆状 核 、 丘脑 、 白质 的 形状 因子 越亮 表示 距离 越大 它们 的 计算 是 相互 制约 的 　 　 　 　 　 　 　 　 图 　 某 一切 面上 种 结构 的 形状 因子 算法 流程 　 　 （ ） 由于 TT 图谱 没有 头皮 、 颅骨 、 肌肉 等 部分 所以 在 模糊 分割 前 我们 要 先 在 MRI 图像 中 去掉 这些 部分 MatthewCClark 在 文献 ［ ］ 中 给出 了 一种 方法 可以 方便 地 去掉 颅骨 等 组织 其 中心思想 是 对 T 加权 的 图像 作二值化 由于 颅骨 的 T 值 最小 所以 容易 将 其 和 脑 分开 然后 利用 数学 形态学 的 方法 得到 脑 的 二值化 模板 　 　 （ ） 将 TT 图谱 和 脑 的 MRI 图像 进行 三维线 形 匹配 通常 脑中 隔面 和 AC 点 易于 找到 当 切片 间距 太大时 （ 如 mm ） PC 点 有时 找 不到 这时 可 根据 丘脑 估计 PC 点 对 数据 重新 采样 可 得到 矢状面 的 切片 在 脑中 隔 面上 可以 确定 脑 的 顶点 然后 我们 可以 根据 这些 参考点 计算 出 图像 中 每 一点 在 TT 坐标系 中 的 坐标 再 进行 一些 交互 操作 如 ， 使脑 皮层 的 外沿 和 TT 图谱 的 皮层 外沿 相当 使 图像 和 TT 图谱 更好 地 匹配 （ 线形 基础 上 ） 由此 反推 对 MRI 的 每 一个二维 断层 图像 ， 可 得 一个 包含 组织 结构 信息 的 预 分割 模板 　 　 （ ） 利用 预 分割 模板 按照 第节 中 的 算法 计算 形状 因子 Dik 　 　 （ ） 引入 形状 因子 的 FCM 聚类 在 聚类 过程 中 某点 到 某类 的 空间 距离 保持 不变 dikaDikad ′ ikd ′ ik 由式 计算 此时 vk 是 TTPD 构成 的 R 空间 中 的 向量 a 和 a 是 比例 系数 聚类 的 迭代 计算 过程 和 标准 的 FCM 聚类 相同 　 　 （ ） 通过 聚类 结果 分割 MRI 图像 　 　 （ ） 重复 步骤 ～ 数次 参数 选择 　 　 在 上述 方法 中有 两处 涉及 迭代 一处 是 FCM 聚类 的 迭代 求解 另 一处 是 分割 和 求 形状 因子 的 次数 在 第种 情况 中 虽然 距离 的 求法 和 标准 方法 不同 但 由于 空间 距离 在 迭代 时 保持 定值 因此 该 迭代 过程 是 一个 收敛 过程 而且 由于 初始 隶属 度 矩阵 由 分割 模板 得到 是 一个 较 优化 的 解 因此 收敛 过程 也 是 比较 快 的 在 第种 情况 下 迭代 次数 越 多则 预 分割 模板 的 限制 作用 越弱 分割 结果 和 图像 的 属性 的 相关性 就 越 强当 迭代 次数 无限 多时 就 成 了 一般 的 FCM 聚类 分割 如果 强调 模板 的 作用 则 迭代 次数 要少 反之 可 增加 迭代 次数 对于 MRI 图像 分割 迭代 次数 应较 少 一般 取 ～ 次 分割 结果 　 　 我们 用 NLM 的 VisibleHumanDataset 中 的 MRI 图像 对 算法 进行 了 验证 首先 我们 对 图像 作 线形 匹配 匹配 方法 是 找到 图像 集 的 坐标系 到 TT 坐标系 的 变换 矩阵 然后 反求 出 某 一点 对应 的 TT 组织 特性 图 （ a ） 为 TT 图谱 中 的 一片 横断面 图像 （ 原图 为 彩色 ） 图 （ b ） 为 匹配 后且 简化 后 得到 的 预 分割 模板 图 c 是 去掉 颅骨 等 组织 的 MRI 图像 （ 原图 为 （ TTPD 三 分量 的 彩色图像 ） 图 d 是 无 模板 模糊 分割 的 结果 图 （ e ） 引入 了 形状 因子 的 模糊 分割 结果 二次 迭代 图 f 是 引入 形状 因子 的 模糊 分割 结果 四次 迭代 图 （ b ） 给出 了 按 此 方法 求得 的 距 头顶 cm 处 的 MRI 切片 的 预 分割 模板 然后 根据 图像 的 特征 对 一些 结构 进行 了 合并 和 简化 最后 得到 的 模板 包含 皮质 、 白质 、 尾状核 、 豆状 核 、 丘脑 、 脑室 、 胼胝 体等 结构图 （ e ） 给出 了 分割 的 结果 其中 FCM 算法 的 模糊 度为 模板 的 迭代 次数 为 FCM 中 的 最大 迭代 次数 为 终止 条件 为 ε ＜ 由于 结构 信息 直接 和 类 相关 我们 将 不同 的 类用 不同 的 颜色 表示 从 分割 结果 看 各 结构 具有 较为 清晰 的 边界 且 和 手工 分割 的 效果 差不多 但 豆状 核 消失 的 结果表明 引入 形状 因子 的 模糊 分割 能 结合 脑 结构 信息 和 实际 图像 的 特征 达到 自动 分割 和 标注 的 目的 　 　 　 　 　 　 　 a 　 　 　 　 　 　 b 　 　 　 　 　 　 c 　 　 　 　 　 　 d 　 　 　 　 　 　 e 　 　 　 　 　 　 f 图 分割 结果 　 　 在 实际 分割 中有 一些 结构 的 特征向量 没有 什么 差别 而且 又 互相 邻近 通过 简单 的 模糊 聚类 也 无法 分开 如 胼胝 体 和 白质 尾状核 和 豆状 核用 引入 形状 因子 的 模糊 分割 能 得到 两个 区域 但 其 边界 对 参数 极为 敏感 因此 也 没有 实用价值 对于 这样 的 结构 我们 采用 二次 分割 的 方法 即先 将 其 合并 作为 同 一类 进行 匹配 分割 ， 然后 将 模板 中 这 两种 结构 的 空间 关系 映射 到 分割 的 结果 中 当然 这样 做 就 需要 对 分割 图像 的 特征 进行 分析 好 在 MRI 图像 的 特征 都 是 相似 的 我们 可以 统计 这种 例外 的 情况 并 应用 到 所有 的 MRI 脑 图像 的 标注 中 收敛性 　 　 图为 收敛性 的 检验 其中 横坐标 为 聚类 时 的 迭代 次数 纵坐标 为 目标 函数 值 实线 为 第次 计算 的 目标 函数 虚线 为 第次 圆圈 为 第次 方块 为 第次 为 清晰 起 见 坐标 采用 对数 坐标 模板 每 更新 一次 我们 可 得到 一条 目标 函数 的 趋势 线图 给出 了 模板 迭代 次 所 得到 的 条 趋势 线 从 图 中 我们 可以 看出 每次 迭代 的 收敛 是 比较 快 的 特别 是 在 模板 更新 以后 由 分割 得到 的 模糊 度 矩阵 的 目标 函数 值 已经 较 小 收敛 速度 也 比 初始 模板 快 但 第次 、 第次 的 目标 函数 值及 收敛 速度 和 第次 几乎 相同 以致 在 图 上 很 难 将 三者 分离 开来 我们 认为 这 是因为 模板 已经 和 实际 结果 差不多 所以 再次 聚类 的 目标 函数 变化 不大 但 这时 在 空间 上 各类 的 点集 分割 变化 仍 在 进行 如果 两类 在 空间 上 相邻 而 特征值 相近 则 得到 的 分割 结果 变化 更加 明显 　 　 　 　 　 图 目标 函数 变化趋势 图 结论 　 　 本文 提出 了 结合 图谱 匹配 和 模糊 分割 的 一种 自动 MRI 图像 的 分割 标注 结果表明 引入 形状 因子 的 模糊 分割 能 结合 脑 结构 信息 和 实际 图像 的 特征 实现 MRI 图像 自动 分割 和 标注 特别 是 脑 中部 的 结构 如 丘脑 、 壳 、 苍白 体等 的 分割 标注 但是 对于 互相 邻近 且 图像 特征 相同 的 区域 本 方法 也 不能 区分 对于 这种 情况 我们 只能 找到 其 合并 后 的 外 边缘 和 标注 但 两 区域 之间 的 分界线 只能 是 模糊 的 这 和 人眼 识别 的 效果 是 相同 的 下 一步 的 工作 是 提取 更 多 的 图像 特征 如 纹理 属性 可 进一步 优化 分割 的 结果 和 分割 出 更 多 的 区域 本文 提出 的 方法 也 适用 于 其他 断层 图像 的 分割 标注 如脑 的 彩色 切片 图像 、 CT 图像 等 的 自动 分割 标注 作者简介 　 谭鸥 年生 博士生 主要 研究 领域 为 医学 图像处理 虚拟现实 　 　 　 　 　 贾 春光 年生 博士 主要 研究 领域 为 信号 及 医学 图像处理 计算机 图形学 　 　 　 　 　 吕 旭东 年生 博士生 主要 研究 领域 为 医学 图像处理 远程 医疗 　 　 　 　 　 段会龙 年生 博士后 副教授 主要 研究 领域 为 人体 视觉 信号 及 医学 图像处理 远程 医疗 　 　 　 　 　 吕维雪 年生 教授 博士生 导师 主要 研究 领域 为 生物医学 信息 图像 重建 仿真 建模 本文 通讯联系 人 谭鸥 ， 杭州 浙江大学 生命科学 与 医学 工程学系 作者 单位 ： 浙江大学 生命科学 与 医学 工程学系 杭州 参考文献 FuKMuiJSurveyonimagesegmentationPatternRecognition ～ LiCGoldgofDHallLAutomaticsegmentationandtissuelabelingofMRbrainimagesIEEETransactionsonMedicalImaging ～ LiangZhengrongTissueclassificationandsegmentationofMRimagesIEEEEngineeringinMedicineandBiology ～ PetraAvandenElsenetalMedicalimagematchingareviewwithclassificationIEEEEngineeringinMedicineandBiology ～ TalairachJTournouxPCoplanarStereotaxicAtlasoftheHumanBraindimensionalProportionalSystemAnApproachtoCerebralImagingNewYorkGeorgThiemeVerlagStuttgartHohneKHPflesserBetalAnewrepresentationofknowledgeconcerninghumananatomyandfunctionNatureMedicine ～ AckermanMJThevisiblehumanprojectNationalLibraryofMedicineWorldWideWebaddresshttp ∥ wwwnlmnihgovClarkMCHallLOMRIsegmentationusingfuzzyclusteringtechniquesintegratingknowledgeWorldWideWebaddresshttp ∥ wwwcseeusfedu 本文 收到 原稿 收到 修改稿