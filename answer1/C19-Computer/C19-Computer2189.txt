计算机 应用 研究 APPLICATIONRESEARCHOFCOMPUTERS 　 Vol 　 No 　 P 数据安全 及 双机 容错 解决方案 陆郁梅 摘要 随着 近年来 网络系统 的 普及 和 应用 ， 人们 日益 认识 到 企业 中 最 宝贵 的 不是 各种 网络 硬件 ， 而是 网络 中 存储 的 用 金钱 也 难以 买到 的 业务 数据 。 如果 无法 保证 网络 数据 的 安全 ， 那么 对 网络 的 大量 投资 就 失去 了 意义 ， 并 结合 了 实际 应用 讨论 了 容错 技术 及 在 NT 、 NOVELL 环境 下 双机 容错 的 解决方案 。 关键词 容错 数据恢复 LifekeeperLEC 　 　 近年来 ， 计算机 和 网络 技术 的 普及 大大提高 了 企业 的 工作效率 ， 但 同时 也 带来 了 一些 负面影响 ， 其中 最 值得 我们 关注 的 就是 系统 失效 问题 。 　 　 造成 计算机系统 失效 的 因素 归纳起来 可 分为 两类 ： 一类 是 自然灾害 包括 人为 破坏 ； 另一类 是 系统 缺陷 ， 即 计算机系统 自身 的 不 可靠 因素 ， 如 ： 误操作 、 软件缺陷 、 硬件 老化 、 病毒 等 。 　 　 在 计算机系统 中 最 宝贵 的 财富 是 系统 中 的 业务 数据 。 由于 企业 越来越 依赖于 计算机 处理 业务 ， 系统 失效 将会 是 一场 大灾难 。 如果 出现 故障 ， 企业 将 无法 正常 经营 ， 甚至 陷入 瘫痪 ， 这时 ， 企业 最 关注 的 问题 就 在于 如何 尽快恢复 计算机系统 ， 使 其 能够 正常 运行 。 故障 分类 物理 故障 　 　 物理 故障 是 指 造成 系统 无法 正常 运行 的 软硬件 损坏 。 这些 故障 通常 会 导致 逻辑 故障 ， 如 硬盘 故障 可能 会 导致 数据 丢失 ， 网络故障 可能 会 破坏 数据 一致性 等 。 　 　 常见 的 物理 故障 包括 ： 　 　 ● 操作系统 故障 ： 非法 指令 造成 的 系统 崩溃 ， 系统文件 被 破坏 导致 无法 启动 操作系统 等 。 　 　 ● 应用程序 损坏 ： 缺少 文件 或 程序 本身 不 完善 导致 程序 无法 运行 。 　 　 ● 整机 损坏 ： 由 掉电 、 火灾 、 地震 等 造成 设备 无法 运行 。 　 　 ● 硬盘 故障 ： 硬盘 系 精密 设备 ， 安装 时 的 无意 磕碰 、 掉电 、 电流 突然 波动 等 原因 都 有 可能 造成 硬盘 损坏 。 　 　 ● 网络设备 故障 ： 传输 距离 过长 、 设备 添加 与 移动 、 传输 介质 的 质量 问题 和 老化 都 有 可能 造成 网络故障 。 逻辑 故障 　 　 逻辑 故障 包括 两种 ： 第一种 是 系统 虽然 能够 正常 运行 ， 但 实际 已经 有 部分 损坏 ， 如 数据文件 丢失 、 程序 丢失 等 ； 第二种 是 系统 本身 虽然 完好无损 ， 可是 系统 中 的 部分 数据 是 错误 的 ， 这 类 故障 的 隐蔽性 很强 ， 通常 难以 发现 ， 更 难以 修复 。 　 　 常见 的 逻辑 故障 包括 ： 　 　 ● 数据 不 完整 ： 系统 缺少 完成 业务 所 必需 的 数据 。 　 　 ● 数据 不 一致 ： 系统 数据 是 完全 的 ， 但 逻辑关系 不 正确 。 　 　 ● 数据 错误 ： 系统 数据 是 完全 的 ， 也 符合 逻辑关系 ， 但 数据 是 错误 的 ， 与 实际 不符 。 　 　 ● 逻辑 故障 隐蔽性 强 ， 往往 带有 巨大 的 破坏性 ， 是 造成 损失 的 主要 原因 。 根据 有关 统计 ， 恢复 MB 约页 纸 的 数据 最少 也 要花费 近天 时间 ， 成本 在 万元 以上 。 目前 服务器 硬盘容量 平均 为 GB ， 我们 不难 算 出 恢复 服务器 数据 的 开支 十分 惊人 。 网络 备份 及 数据恢复 　 　 企业 拥有 好 的 备份 系统 和 备份 方案 ， 可以 将 灾难 的 损失 减小 到 最低 程度 。 一般 地 ， 在 硬件 一级 有 磁盘镜像 、 磁盘阵列 、 双机 容错 等 备份 方案 ； 在 软件 一级 有 热 修复 、 数据 拷贝 等 措施 。 　 　 备份 的 方法 主要 可以 分为 三类 ： 硬件 级 、 软件 级 和 人工 级 。 　 　 硬件 级 的 备份 是 指用 多余 的 硬件 来 保证系统 的 连续 运行 ， 比如 硬盘 双工 、 双机 容错 等 ， 如果 某个 硬件 损坏 ， 后备 硬件 马上 能够 接替 其 工作 。 但 这种 方式 无法 防止 逻辑 上 的 错误 ， 如 人为 误操作 、 病毒 、 数据 错误 等 。 据 有关 资料 统计 ， 计算机系统 中 以上 的 错误 属于 人为 误操作 。 当 逻辑 错误 发生 时 ， 硬件 备份 只会 将 错误 复制 一遍 ， 无法 真正 保护 数据 。 硬件 备份 的 作用 实际上 是 保证系统 在 出现 故障 时 能够 连续 运行 ， 因此 称为 硬件 容错 更为 恰当 。 　 　 软件 级 的 备份 是 指 将 系统 数据 保存 到 其它 介质 上 ， 当 系统 出错 时 可以 将 系统 恢复 到 备份 时 的 状态 。 由于 这种 备份 是 由 软件 来 完成 的 ， 所以 称为 软件 备份 。 用 这种 方法 进行 备份 和 恢复 数据 都 要花费 一定 的 时间 ， 但 可以 完全 防止 逻辑 错误 ， 因为 备份 介质 和 计算机系统 是 分开 的 ， 错误 不会 复写 到 介质 上 。 这 意味着 ， 只要 保存 时间 足够 长 的 历史数据 ， 就 能够 恢复 正确 的 数据 。 　 　 人工 级 的 备份 最为 原始 ， 也 最 简单 ， 因为 如果 所有 数据 都 有 文字 记录 ， 显然 可以 恢复 数据 ， 但 耗费 的 时间 恐怕 相当 长 。 因此 全部 数据 都 用 手工 方式 备份 是 不 可取 的 。 　 　 理想 的 备份 系统 是 软件 备份 和 手工 方式 相结合 。 如果 系统 出错 ， 备份 之前 的 数据 用 软件 方法 恢复 ， 备份 之后 的 数据 用 手工 方式 恢复 。 采用 这种 结合 方式 ， 不仅 能够 有效 地 防止 逻辑 错误 ， 还 能够 节省 备份 和 恢复 时间 。 如果 在 备份 系统 的 基础 上 再 加上 硬件 容错 系统 ， 那 就 会 更加 安全可靠 。 　 　 可以 说 网络 备份 实际上 不仅 是 网络 上 各 计算机 的 文件 备份 ， 实际上 还 包含 了 整个 网络系统 的 一套 备份 体系 。 双机 容错 及 解决方案 　 　 双机 容错 ： 可以 防止 单台 计算机 的 物理 故障 ， 当 一台 计算机 出现 故障 时 ， 系统 仍然 可以 工作 。 双机 容错 方案 分为 纯 软件 的 解决方案 和 软件 与 硬件 结合 的 解决方案 ， 本 方案 提供 的 是 一种 完整 的 解决方案 ， 也 可以 只 保留 软件 来 实现 容错 。 　 　 现将 NT ， Novell 平台 双机 容错 解决方案 介绍 如下 ， 该 解决方案 在 证券 及 金融 行业 得到 广泛应用 ， 并 取得 了 良好 的 使用 效果 。 NT 平台 下 Lifekeeper 解决方案 　 　 LifeKeeperForWindowsNT 软件 是 NCR 公司 推出 的 全球 第一套 基于 NT 操作系统 ， 并 支持 台 服务器 的 容错 软件 。 该 系统 可 有效 避免 由于 证券商 交易 服务器 宕机 造成 的 业务 中断 、 数据 丢失 等 重大损失 ， 保证 交易平台 系统 级 的 在线 热切 换 ， 有效 维护 用户 的 商业 信誉 。 　 　 LifeKeeperForWindowsNT 提供 了 一个 完全 容错 的 软件 解决方案 ， 它 不 需要 任何 自定义 的 容错 硬件 ， 服务器 可以 是 任何 基于 Intel 架构 的 平台 。 用户 可以 集合 使用 到 个 NT 节点 。 在 出现 故障 的 情况 下 ， LifeKeeper 会 将 被 保护 资源 自动 转换 到 一个 根据 优先权 设定 的 系统 。 用户 在 实际 进行 切换 时 ， 会 经历 一个 十分 短暂 的 休眠 ， 但是 ， 当 系统 完成 切换 操作 后 ， LifeKeeper 会 在 所 选择 的 系统 上 自动 地 恢复 操作 。 LifeKeeperForWindowsNT 支持 共享 磁盘阵列 柜 和 非 共享 磁盘阵列 柜 两种 实现 方式 ， 从而 给 不同 选择 、 不同 需求 的 用户 提供 了 多种 选择 。 　 　 软 ， 硬件 配置 　 　 两台 服务器 ， 每台 服务器 有 一块 网卡 ， 一块 本地 硬盘 ， 一个 外接 SCSI 接口 。 　 　 一台 磁盘阵列 ， 相应 容量 阵列 硬盘 。 　 　 NCR 公司 LifeKeeper 容错 软件包 。 　 　 硬件 连接 及 软件 安装 　 　 将 磁盘阵列 通过 SCSI 接口 分别 与 两台 服务器 相连 ， 两台 服务器 网卡 接到 一个 HUB 上 ， 在 本地 硬盘 上装 NT 操作系统 ， 数据库 引擎 ， 容错 软件包 。 在 磁盘阵列 上装 数据 。 　 　 工作 原理 　 　 正常 时 ， 一台 服务器 做 主机 工作 ， 另一台 做备机 等待 ， 当 主机 出 故障 时 ， 备机 在 秒 内 ， 通过 网链 及 SCSI 链 自动 侦测 出 ， 然后 开始 接管 ServerIP ， 重启 数据库 进程 ， 接管 磁盘阵列 上 的 数据库 数据 。 整个 过程 在 一分钟 左右 完成 。 当 主机 恢复 后 ， 自动 作为 备机 ， 也 可 手工 切回 。 　 　 WindowsNT 平台 双机 容错 软件包 　 　 NCR 公司 Lifekeeper 双机 容错 软件包 核心 包括 SQLServer 的 RecoverKit 工具 用于 WindowsNT 操作系统 平台 每台 主机 各 配备 一套 ， 支持 ClientServer 结构 。 　 　 工作 方式 ： 　 　 Activeandstandbymodel 主机 工作 ， 备机 在线 热备 ， 故障 时 自动 侦测 切换 ， 原 故障 主机 修复 后 自动 作为 在线 备机 。 　 　 ActiveandActive 两台 服务器 各自 承担 自己 的 任务 ， 当 其中 一台 故障 时 ， 另一台 自动 接管 故障 机 的 用户 ， 数据 及 进程 ， 当 故障 机 恢复 后 ， 自动 切回 。 Novell 平台 　 　 软 、 硬件 配置 　 　 两台 服务器 ， 每台 服务器 有 二块 网卡 ， 一块 本地 硬盘 ， 一个 外接 SCSI 接口 。 　 　 一台 磁盘阵列 ， 相应 容量 阵列 硬盘 。 　 　 Vinca 公司 StandbyforNetWare 容错 软件包 。 　 　 硬件 连接 及 软件 安装 　 　 将 磁盘阵列 通过 SCSI 接口 分别 与 两台 服务器 相连 ， 两台 服务器 各选 一块 网卡 接到 一个 HUB 上 ， 作 数据传输 ， 另 一块 网卡 交叉 互接 ， 作 侦测 ； 在 本地 硬盘 上装 NetWare 操作系统 ， 容错 软件包 。 在 磁盘阵列 上建 SYS 卷及 DATA 卷 。 　 　 工作 原理 　 　 正常 时 ， 一台 服务器 做 主机 管理 磁盘阵列 上 的 SYS 卷及 DATA 卷 ， 另一台 做备机 等待 ， 当 主机 故障 时 ， 备机 通过 侦测 网链 自动 侦测 出 ， 然后 开始 接管 磁盘阵列 上 的 SYS 卷及 DATA 卷 。 整个 过程 在 一分钟 左右 完成 。 当 主机 恢复 后 ， 自动 作为 备机 ， 也 可 手工 切回 。 　 　 StandbyforNetWare 双机 容错 软件包 　 　 NETWARE 平台 双机 容错 软件包 ： 　 　 双机 容错 切换 软件包 ： 用于 NETWARE 操作系统 平台 。 　 　 工作 方式 ： 　 　 Hotstandbymodel ： 主机 工作 ， 备机 在线 热备 ， 故障 时 自动 侦测 切换 ， 原 故障 主机 修复 后在备 机上 的 任务 将 自动 重新 交回 ， 原备机 继续 作为 在线 备机 。 　 　 特点 ： 原 主机 修复 后 将 自动 重新 回切 ， 适合 于 主机 功能 配置 高于 备机 的 情形 。 硬件 配置 ： LEC 双 机智 能 容错 磁盘阵列 　 　 ● LECDiskArraySubsystem 容错 磁盘阵列 系统 　 　 ● OneIntelligentSystemController 智能 系统 控制器 　 　 ● OneASICSCSIControllerChipSetSCSI 专用 控制组 　 　 ● MBRewriteReadCacheMB 读写 缓存 　 　 ● WideSCSIHostChannel 两个 主机 接口 　 　 ● InternalUltraSCSIDiskChannels 个 内部 快速 硬盘 通道 支持 个 阵列 盘 　 　 ● SCSIHarddiskCRU 个 热插拔 硬盘 槽 位 　 　 ● RAIDSupportRAID 磁盘 校验 ： ， 通过 美国 RAB 测试 　 　 ● HotSwapSupport 故障 硬盘数据 在线 自动 恢复 ， 硬盘 热 替换 　 　 ● RedunantHotSwapPowerSupplyFan 双 热插拔 电源 、 双 风扇 　 　 ● LCDDisplayPanel 前面板 LCD 液晶 显示屏 　 　 ● SCSIIICableSCSI 电缆 ， 用于 磁盘阵列 与 主机 连接 　 　 ● ActiveTermintorSCSI 总线 终结 器 　 　 ● DesksideCabinet 桌边 式 机箱 　 　 ● SCSIHarddisk 硬盘容量 可 根据 容量 要求 选配 各种 型号 的 UltraWideSCSI 接口 的 GBGBGBGBSCSI 单元 硬盘 及其 数量 ， LEC 容错 磁盘阵列 已 提供 七个 热插拔 硬盘盒 。 　 　 SCSI 硬盘 配置 参考 ： 接口标准 ： UltraWideSCSI ， pin ， rpm 。 陆郁梅 （ 中国科技大学 研究生院 中国人民大学 北京 ） 参考文献 ， 美 拉拉 LalaPK 容错 与 故障 可测性 系统 设计 ， 袁由光 陈以 农 容错 与 避错 技术 及其 应用 ， 闻新 控制系统 的 故障诊断 和 容错 控制 收稿 日期 ： 年月日