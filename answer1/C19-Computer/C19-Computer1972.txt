微型机 与 应用 MICROCOMPUTERITSAPPLICATIONS 年 第卷 第期 VolNoVB 数据 访问 技术 及 方法 马瑞民 　 阚志刚 　 衣 治安 　 　 摘 　 要 ： VisualBasic 数据库 的 体系结构 及 相应 的 结构图 ； 介绍 微软 JET 数据库 引擎 和 ODBCDirect 种 数据 访问 技术 ； 对 数据 访问 对象 、 数据 控件 和 直接 调用 ODBCAPI 函数 种 数据 访问 方法 进行 了 说明 。 　 　 关键词 ： 数据 访问 对象 　 数据 控件 　 JET 数据库 引擎 　 ISAM 驱动程序 　 ODBCAPI 函数 　 　 在 各类 应用软件 中 ， 数据库 应用软件 的 数量 是 相当 大 的 。 作为 一种 优秀 的 开发工具 ， VisualBasic 提供 了 相当 强 的 数据库 存取 功能 ， 将 Windows 的 各种 先进 特性 与 强大 的 数据库 管理 功能 有机 地 结合 在 一起 ， 不但 能够 直接 支持 MicrosoftAccess 数据库 ， 而且 还 可以 安装 ISAMIndexedSequentialAccessMethod 驱动程序 支持 Paradox 、 Foxpro 及 Btrieve 等 数据库 文件 ， 并且 ODBC 结构 中 还有 个 接口 ， 可以 直接 调用 ODBCAPI 函数 对 数据库 操作 。 所有 这些 数据库 存取 机制 都 可 通过 MicrosoftJETJointEngineeringTechnology 引擎 和 ODBCDirect 技术 来 实现 。 基于 VisualBasic 的 数据库 应用程序 可 从 逻辑 上 分为 个 部分 ： 用户 接口 、 数据库 引擎 和 数据库 存储 ， 其中 用户 接口 和 数据库 存储 通过 数据库 引擎 有机 地 结合 在 一起 ， 这种 体系结构 使得 相同 的 应用 程序接口 可以 存取 不同 类型 的 数据源 。 　 VisualBasic 数据库 的 体系结构 　 　 为了 使用 和 操纵 结构化 数据库 ， VisualBasic 提供 了 如图所示 的 数据库 体系结构 。 在 此 体系结构 中 ， VisualBasic 可以 使用 种 数据 访问 技术 ： JET 数据库 引擎 和 ODBCDirect 技术 ； 种 数据 访问 方法 ： 数据 控件 、 数据 访问 对象 和 直接 调用 的 ODBCAPI 函数 也 可以 把 “ 直接 调用 ODBCAPI 函数 ” 看成 是 一种 技术 。 其中 数据库 引擎 和 ODBCDirect 技术 是 数据 访问 的 核心 部分 ， 位于 应用程序 和 数据库 存储 之间 。 这种 结构 使得 所 访问 的 数据库 有 较大 的 独立性 ， 使用 相同 的 数据 访问 对象 可以 访问 不同 类型 的 数据库 ； 数据库 引擎 能够 把 数据 控件 和 数据 访问 对象 所 提出 的 数据库 操作 转变成 对 数据库 的 物理 操作 ， 也 能够 支持 不同 类型 的 数据库 。 图 　 数据库 体系结构 　 　 数据 控件 和 数据 访问 对象 是 基于 数据库 引擎 的 种 数据 访问 方法 。 数据 控件 的 使用 方法 比较简单 ， 不需 用户 编程 ， 但是 它 访问 数据 的 能力 有限 。 数据 访问 对象 是 提供 给 用户 的 完整 编程 接口 ， 它 能够 对 数据库 进行 全方位 的 控制 。 实际上 ， 这种 方法 并 不 相互 排斥 ， 在 许多 情况 下 ， 它们 之间 能 互相 补充 。 另外 ， 在 ODBC 结构 中 还有 个 接口 ， 可以 直接 调用 ODBCAPI 函数 对 数据库 操作 。 　 　 在 VisualBasic 中 除了 基本 数据库 引擎 的 数据 访问 方法 之外 ， 还 支持 其它 方法 ， 如 ODBCDirect 技术 。 另外 ， 在 VB 企业 版中 除图 所示 的 技术 以外 ， 还 提供 了 远程 数据 对象 RDORemoteDataObject 库 和 远程 数据 控件 RDCRemoteDataControl 访问 ODBC 数据 。 用户 如果 要 对 MicrosoftSQLServer 进行 访问 ， 还 可以 利用 VBSQLVisualBasicSQLLibraries ， 这是 VB 提供 给 应用程序 访问 SQLServer 数据库 的 接口函数 。 　 　 在 VisualBasic 的 数据库 应用程序 中 ， 可以 访问 种 类型 的 数据库 。 　 　 VisualBasic 数据库 。 也 称为 内部 数据库 ， 它 具有 和 MicrosoftAccess 相同 的 数据格式 。 数据库 引擎 可以 直接 创建 和 操纵 内部 数据库 ， 具有 最高 的 工作效率 。 　 　 外部 数据库 。 外部 数据库 又 称为 ISAM 数据库 ， 包括 ： Btrieve 、 dBASEIII 、 dBASEIV 、 MicrosoftFoxProV 和 、 VisualFoxProV 、 ParadoxVx 和 等 。 用户 也 可以 访问 文本文件 和 MicrosoftExcel 或 Lotus 电子表格 文件 。 　 　 ODBC 数据库 。 ODBC 数据库 指 的 是 基于 ODBC 标准 的 客户服务器 模式 的 数据库 ， 如 MicrosoftSQLServer 。 要 想 编制 真正 意义 上 的 客户 服务器应用程序 ， 可以 使用 ODBCDirect 技术 ， 该 技术 直接 把 数据库 操作命令 传给 外部 服务器 。 如果 有 外部 数据库 的 ODBC 驱动程序 ， 也 可以 把 外部 数据库 看作 是 ODBC 数据库 。 　 VisualBasic 的 数据库 引擎 和 ODBCDirect 技术 　 　 VisualBasic 数据库 的 核心 结构 是 JET 数据库 引擎 ， 它 将 数据库 相关 的 内存 管理 、 游标 管理 及 错误处理 等 具体 而 复杂 的 细节 问题 抽象 为个 既 高度一致 又 简化 的 编程 接口 。 它 为 应用程序 提供 了 ： 　 　 个 符合 ANSISQL 标准 的 语法分析 器 。 　 　 为 使用 查询 结果 集而 提供 的 内存 管理 功能 。 　 　 同所 支持 的 数据库 的 外部 接口 。 　 　 为 应用程序 提供 的 统一 的 外部 接口 。 　 　 JET 数据库 引擎 内部 有个 SQL 语法分析 器 ， 这个 分析器 可以 接受 符合 由 用户 应用程序 提供 的 ANSI 标准 SQL 语句 ， 并且 提供 了 VisualBasic 的 本地 分析 和 错误处理 功能 。 实际上 ， 这个 SQL 语法分析 器 不仅 用来 支持 MicrosoftAccess 数据库 的 内部 库函数 ， 而且 可以 为 JET 引擎 所 支持 的 其它 数据库 提供 SQL 语法分析 。 　 　 另外 ， 基于 JET 数据库 引擎 有种 类型 的 结果 集 对象 ， 它们 分别 是 ： ForwardOnly 、 Dynamic 、 Table 、 Snapshot 和 Dynaset ， 合 称为 记录集 对象 ， 应用程序 可以 创建 和 管理 它们 以便 操纵 和 使用 数据 。 　 　 ODBCDirect 技术 是 指 通过 RDO 控件 和 DAO 特征 直接 访问 ODBC 数据源 的 技术 。 当 ODBC 数据源 通过 这种 方式 访问 时 ， 被 称为 “ ODBCDirect ” 数据源 ； 如果 ODBC 数据源 通过 微软 数据库 引擎 间接 访问 时 ， 被 称为 “ JetODBC 连接 ” 数据源 。 这种 数据源 使用 不同 的 DAO 对象 、 方法 和 属性 。 ODBCDirect 技术 对 ODBC 数据源 有 较 高 的 存取 效率 。 　 数据 访问 对象 DAO 、 数据 控件 和 直接 调用 ODBCAPI 函数 　 　 数据 访问 模型 是 数据库 引擎 的 面向对象 接口 ， 它 的 类 层次 如图所示 。 每个 类 对应 关系 型 数据库系统 的 逻辑 模型 ， 例如 数据库 本身 以及 数据库 中 的 二维 表格 和 它们 的 字 段 、 索引 等 。 利用 数据 访问 对象 ， 用户 可以 创建 和 操纵 Database 对象 、 Table 对象 、 Field 对象 和 Index 对象 等 数据库 对象 ， 这些 对象 与 数据库 物理 存储 是 一一对应 的 ， 通过 这些 对象 的 属性 设置 和 方法 使用 就 可以 完成 对 数据库 的 操作 。 用户 通过 对 数据 访问 对象 编程 ， 可以 对 多种 数据源 进行 访问 。 这种 访问 技术 简化 了 程序代码 ， 屏弊 了 许多 复杂 的 数据 提取 技术细节 ， 给 用户 以 极大 的 灵活性 。 但 它 只能 进行 间接 的 错误处理 和 错误 恢复 ， 对 每个 数据库 操作 没有 细粒度 的 控制 。 　 　 数据 控件 是 类似 “ 命令 按钮 ” 等 的 编程 构件 ， 能够 利用 Table 、 Snapshot 和 Dynaset 种 数据 访问 对象 对 数据库 中 的 数据 进行 逐条 记录 存取 ， 并 能够 把 最后 结果 在 数据 绑定 控件 中 显示 出来 。 通常 所用 的 数据 绑定 控件 有 ： DBList 、 DBCombo 、 DBGrid 和 MSFlexGrid 。 此外 ， Picture 、 Label 、 TextBox 、 CheckBox 、 Image 、 OLE 、 ListBox 和 ComboBox 控件 可以 绑定 在 单一 的 记录 集合 上 。 使用 数据 控件 是 最 简单 的 数据 访问 方法 ， 它 的 编码 量 最小 ， 并且 能够 使用 第三 厂商 制订 的 控制 项 ， 但 它 不能 进行 真正 的 事务处理 。 图 　 数据 访问 模型 类 层次 图 　 　 直接 调用 ODBCAPI 函数 方法 对 数据库 操作 提供 了 最大 程度 的 直接 控制 。 ODBCAPI 函数 提供 以下 功能 ： 分配 和 释放 环境 句柄 、 连接 句柄 及 语句 句柄 ； 与 数据源 及 多条 语句 建立 连接 ； 准备 执行 或 直接 执行 SQL 语句 ； 为 SQL 语句 的 参数 及 结果 集中 的 列 分配 存储 参数 ； 检索 结果 集中 的 数据 ； 提交 或 滚回 事务 ； 检索 错误 及 状态 信息 。 对于 在 复杂性 、 综合性 及 性能 方面 有 较 高 要求 的 应用程序 来说 ， 直接 调用 ODBCAPI 函数 是 适当 的 。 这种 方法 最大 的 特点 是 ： 可以 直接参与 结果 集 的 开发 、 管理 及 规范化 ； 对 结果 集 游标 提供 了 更 多 的 控制 ， 并且 提供 了 更 多 的 游标 类型 和 执行 动作 ； 可以 更好 地 控制 Windows 的 执行 及 资源 利用 。 　 　 种 数据 访问 方法 各有特点 和 使用 范围 ， 但 它们 不是 互相 独立 的 。 通常 将 这种 方法 结合 使用 是 有益 的 ， 这样 不仅 可以 得到 某种 方法 的 优点 ， 而且 可以 减少 该种 方法 的 限制 。 笔者 对 VisualBasic 的 数据库 体系结构 进行 了 归纳 和 总结 ， 并 投入 实际 应用 ， 取得 了 较 好 的 效果 。 作者 单位 ： 黑龙江 大庆 石油学院 计算机科学 系 　 参考文献 　 孟小峰 开放 数据库 互连 — ODBC 使用 大全 北京 ： 清华大学出版社 ， 　 廖 卫东 ， 赵军 VisualBasic 编程 手册 北京 ： 机械 工业 出版社 ， 　 宋琦凡 ， 付敬平 使用 VisualBasic 开发 数据库 应用软件 北京 ： 电子 工业 出版社 ， 收稿 日期 ：