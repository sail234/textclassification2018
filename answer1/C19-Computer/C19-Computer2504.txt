软件 学报 JOURNALOFSOFTWARE 　 Vol 　 No 　 P 一种 基于 照片 中 纹理 重构 三维 模型 的 方法 杨孟洲 　 石教英 　 摘要 　 如何 从 真实世界 中 获取 具有 真实感 的 三维 场景 模型 一直 是 计算机 图形学 中 的 一个 难点 该文 给出 了 一种 从 真实世界 的 照片 中 重建 三维 场景 模型 的 算法 算法 根据 在 空间 稀疏 分布 的 不同 视点 处 的 真实 场景 照片 中 颜色 纹理 的 一致性 来 建立 达到 照片 级 真实 程度 的 三维 场景 模型 可 用于 真实世界 复杂 形体 真实感 三维 模型 的 建立 　 关键词 　 基于 照片 建模 三维 模型 一致性 　 中图法 分类号 　 TPADModelReconstructionAlgorithmBasedontheTextureofPhotosYANGMengzhou 　 SHIJiaoying （ StateKeyLaboratoryofCADCG 　 ZhejiangUniversity 　 Hangzhou 　 ） Abstract 　 　 IncomputergraphicsitsdifficulttoacquirerealisticDscenesfromtherealworldInthispaperanovelDscenemodelreconstructionalgorithmispresentedtodealwiththisproblemThismethodreconstructsphotorealisticscenemodelsaccordingtothecolorandtextureofbasicinputphotoswhicharedistributedintheenvironmentThismethodcanbeusedtoreconstructphotorealisticDmodelofcomplexrealobjectsKeywords 　 PhotoBasedmodelingDmodelconsistency 　 　 在 计算机 中 如何 表达 真实世界 一直 是 计算机 图形学 研究 中 的 难点 和 热点 目前 主要 有类 方法 ： 基于 几何 造型 、 基于 图像 绘制 以及 几何 、 图像 混合 的 方法 　 　 基于 几何 造型 的 方法 通常 利用 成熟 的 造型 软件 手工 搭建 模型 这种 方法 工作量 大 结果 不够 精确 绘制 效果 也 不够 逼真 基于 图像 绘制 的 方法 ［ ］ 通常 用 场景 的 一个 图像 集合 和 与 之 对应 的 深度 映射 来 表达 场景 模型 基于 图像 绘制 的 主要 优点 是 ， 它 提供 了 一种 对 结果 图像 中 每个 像素 只 需要 固定 计算 量 而 与 场景 复杂度 无关 的 绘制 方法 但 对于 大规模 场景 则 需要 很多 照片 使 存储 成为 瓶颈 而且 系统 能 提供 的 场景 交互 手段 有限 对于 很多 应用领域 不能 满足要求 把 几何 造型 和 基于 图像 绘制 结合 起来 是 一种 非常 有效 的 方法 最 常见 的 例子 是 纹理 映射 的 应用 　 　 如果 能 从 真实世界 直接 获取 几何 模型 ， 将 大大降低 人工 建模 的 工作量 同时 将 大大提高 绘制 的 逼真度 很多 学者 对 这种 方法 进行 了 研究 Debevec ［ ］ 给出 了 一种 从 建筑物 的 照片 中 提取 有关 信息 重建 三维 模型 的 方法 该 方法 由 用户 交互 指出 建筑物 的 组成 构件 、 构件之间 的 相互 关系 以及 构件 的 一些 边 在 照片 中 的 对应 边 根据 建筑物 的 规整 性及 相互 依赖性 计算 出 照相机 的 参数 和 构件 的 位置 、 尺寸 提取 出 相应 的 纹理 搭 建成 具有 照片 级 真实度 的 建筑物 三维 模型 Debevec 的 照片 建模 算法 只 对 具有 规整 性 和 相互 关系 明确 的 建筑物 类 场景 有效 对 任意 形状 的 场景 则 无能为力 另外 ， 还有 很多 学者 对 如何 从 一组 场景 的 照片 中 合成 该 场景 在 任意 视点 的 新 视图 进行 了 研究 提出 了 立体 视觉 匹配 ［ ］ 、 体 元 颜色 赋值 ［ ］ 等 方法 Seitz 的 体元 颜色 赋值 模型 重建 方法 根据 场景 在 空间 中 稀疏 分布 的 视点 处 照片 中 像素 颜色 之间 的 相关性 来 重建 模型 Seitz 首先 将 建模 空间 离散 成体 元 并 对 照片 提出 一个 限制 条件 ： 所有 照片 的 相机 位置 形成 一个 空间 凸包 模型 上 任意 一点 都 不能 位于 这个 凸包 之内 否则 将 导致 重建 算法 失败 ； 对于 满足 该 条件 的 照片 根据 每个 体元 在 输入 照片 上 的 投影 覆盖 的 像素 之间 的 相关性 给 这些 体元 赋以 颜色 值 由 这些 有色 体元来 表示 三维 场景 模型 Seitz 的 模型 重建 算法 的 优点 是 ， 对于 模型 外形 的 复杂程度 没有 限制 同时 重建 过程 不 需要 人工 参与 ； 缺点 是 对 相机 位置 有 限制 建立 的 场景 模型 只 包含 场景 的 一部分 信息 使得 模型 只能 从 有限 的 角度 去 观察 同时 用体 元 表示 模型 增加 了 计算 中 的 复杂度 　 　 本文 给出 的 模型 重建 算法 与 Seitz 的 体元 颜色 赋值 方法 都 是 用 像素 的 相似性 来 计算 模型 不同之处 在于 ， 本 算法 对 相机 的 位置 没有 任何 限制 这是 优于 体 元 颜色 赋值 方法 之 处 同时 解决 了 模型 重建 中 的 场景 之间 的 遮挡 问题 并用 面片 来 表示 模型 使 计算 更为 简单 　 基于 照片 的 三维 模型 重建 　 　 模型 重建 算法 应该 满足 下面 两个 原则 ［ ］ 　 　 照片 完备 性 将 重建 得到 的 三维 模型 重新 投影 应该 能 精确 地 产生 出 输入 图像 并且 保持 图像 的 颜色 、 纹理 以及 像素 分辨率 与 输入 图像 相同 　 　 视点 覆盖范围 宽 模型 在 一个 宽 范围 内 的 视点 处 的 重新 投影 应该 精确 这 就 要求 输入 图像 的 视点 在 环境 中 稀疏 分布 　 　 将 三维 场景 空间 用组 分布 于个 坐标 平面 上 的 平行 平面 分割 开来 本 算法 要 解决 的 问题 就是 给 这些 平面 上 分割 成 的 面片 赋以 颜色 值 使得 对 一组 输入 图像 最大 程度 地 满足 照片 完备 性即 在 相同 视点 处 绘制 出 的 图像 应 与 原始 图像 尽可能 地 接近 　 符号 表示 　 　 假定 场景 和 光照 都 是 静止 的 且 场景 的 表面 是 朗伯 表面 在 这种 条件 下 场景 表面 上 每 一点 的 辐射 度 都 具有 各向同性 特征 这样 就 可以 用 颜色 来 描述 该点 的 辐射 度 我们 以 一个 不 透明 、 有色 面片 的 有限 集合 S 来 表示 三维 场景 表面 以 F 表示 场景 空间 中 由 划分 得到 的 所有 面片 的 集合 以 I 表示 一幅 图像 上 所有 像素 的 集合 同时 ， 我们 假设 面片 和 像素 无限小 　 　 定义 处于 同一 平面 上 的 面片 为 一面 片层 Fs 定义 一个 平行 于 该面 片层 的 平面 为 参考 平面 s 参考 平面 应 位于 重建 空间 外且 面片 的 法 向量 指向 该 参考 平面 f 与 s 的 距离 为 ‖ f ‖ s 则 Fdsf ｜ ‖ f ‖ sd 假设 由 重建 空间 所有 面片 组成 集合 F 即 则 组成 场景 空间 表面 的 所有 面片 都 包含 在 F 中 　 辅助 定义 　 　 定义 场景 完备 性 给定 场景 S 和 一幅 视点 在 V 的 图像 I 存在 一面 片 f ∈ Sf 对 V 可见 将 f 投影 到 I 上 得到 像素 pfSp 记 像素 p ∈ I 的 颜色 为 colorpI 面片 f 的 颜色 为 colorfS 假设 对于 一组 图像 IIIn 中 的 每 一幅 图像 Ik 及 Ik 上 每 一个 像素 p 都 存在 一个 面片 f ∈ S 使得 fSp 我们 就 说 场景 S 对 这组 图像 完备 　 　 定义 场景 一致性 假设 对于 一个 完备 的 场景 S 有 我们 就 说 场景 S 与 图像 IIIn 一致 　 　 模型 重建 的 任务 是 对于 一组 输入 图像 IIIn 求取 一个 面片 集来 表示 三维 场景 模型 其中 fp 为 与 输入 图像 一致 的 面片 　 　 为了 确保 重建 过程 是 逐步 一致 的 即 重建 的 每 一步 都 与 输入 图像 一致 我们 引入 不 完全 面片 集 的 弱 一致性 　 　 定义 面片 集弱 一致性 假设 一个 面片 集 的 投影 与 每 一幅 输入 图像 的 重叠 部分 完全一致 我们 就 说 它 对 输入 图像 弱 一致 更 确切 地说 一个 面片 集 S ′ 中 的 每 一个 面片 f ∈ S ′ 假设 对于 输入 图像 IIIn 上 的 像素点 p ∈ Iiq ∈ Ij 面片 fSpSq 有 colorpIicolorqIjcolorfS 那么 S ′ 对于 图像 IIIn 弱 一致 　 　 因此 ， 对于 面片 集说 场景 一致性 与 面片 集弱 一致性 具有 以下 两个 性质 　 　 性质 如果 S 是 一致性 场景 则 对于 每 一个 f ∈ Sf 与 参考 平面 s 的 距离 为 df ∪ Sds 是 弱 一致 面片 集 　 　 性质 假定 场景 S 完备 且 对 每 一个 f ∈ Sf 与 参考 平面 s 的 距离 为 df ∪ Sds 是 弱 一致 面片 集则 S 是 一致性 场景 　 遮挡 问题 的 处理 　 　 对于 在 某 一 视点 可见 的 一部分 场景 当 视点 转移 后 可能 会 被 另 一部分 场景 遮挡 即 变为 不 可见 在 三维 模型 重建 过程 中 如何 判断 场景 是否 被 遮挡 对 重建 成功 与否 至关重要 如图 a 所示 为 面片 f 的 法 向量 VV 为 视点 F 为 面片 f 的 中点 面片 f 对 视点 V 有 可能 可见 ； 面片 f 对 视点 V 不 可见 如果 一个 面片 对 一幅 图像 不 可见 则 在 重建 该 面片 时 不 考虑 该 图像 ① 参考 平面 S ② 场景 FigPLrocessingofocclusion 图 　 遮挡 问题 的 处理 　 　 当时 如图 b 所示 场景 表面 上 两点 PQ 和 视点 V 位于 一条 直线 上 PQ 对 视点 V 都 可能 可见 由于 PVQV 因此 对 V 来说 P 不 可见 这时 我们 就 说 Q 遮挡住 了 P 则 在 重建 面片 P 时 不 考虑 视点 在 V 的 图像 而 在 重建 面片 Q 时要 对 该 图像 投影 　 模型 重建 　 　 重建 算法 根据 归纳法 逐步 地 计算 出 场景 模型 　 　 　 　 F ′ kff ∈ Fdks ， f ∪ Fk 的 投影 中 f 的 投影 与 输入 图像 重叠 部分 不 一致 ， 　 ≤ k ≤ r ， 　 　 Fk ＝ FkF ′ ， 　 ≤ k ≤ r ， 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 Fresultff ∈ FrFr 的 投影 中 f 的 投影 与 输入 图像 重叠 部分 一致 ， 则 即 为 所求 的 场景 模型 　 　 证明 首先 我们 定义 Fi ＝ Fdks － F ′ i ， ≤ k ≤ r ， 则 有 且 F ″ 弱 一致 　 　 假设 弱 一致 由 一致性 性质 有 F ″ i ＝ F ″ i － ∪ Fi 弱 一致 由式 、 可知 因此 有 　 　 由 归纳法 可得 F ″ r 弱 一致 　 　 由于 因此 并且 Fresult 是 弱 一致 面片 集 很 明显 由于 重建 过程 中 仅仅 去掉 了 F 中 与 输入 图像 不 一致 的 面片 因此 Fresult 是 完备 的 由 一致性 性质 可知 Fresult 是 一致性 场景 因此 □ 　 算法 描述 　 　 本 节 给出 了 从 一组 图像 IIIn 中 重建 三维 场景 模型 的 算法 在 上 一节 ， 我们 假定 将 三维重建 空间 空间 六面体 用组 分布 于个 坐标 平面 上 的 平行 平面 划分 在 这些 平面 上 可以 得到 一组 面 片层 FdisiFdirsidididir ≤ i ≤ 如果 一个 面片 f 对于 图像 Ij 没有 被 完全 遮挡 其 投影 将 覆盖 Ij 上 的 一部分 像素 这些 像素 组成 一个 非 空集合 π j 在 没有 噪声 及 量化 误差 的 情况 下 一致 场景 S 中 的 面片 f 的 投影 将 得到 一组 具有 相同 颜色 的 像素 集合 考虑 到 噪声 及 量化 误差 的 影响 就要 用 像素 集 π π π j 之间 的 相关性 来 判断 一致性 相关性 由 各个 像素 集中 所有 像素 RGB 的 平均值 的 方差 来 衡量 方差 越小 相关性 越强 反之亦然 　 重建 过程 　 　 重建 空间 中 所有 面片 组成 集合 S 取定 重建 空间 某 一面 为 参考 平面 首先 对 距离 参考 平面 最近 的 面 片层 进行 重建 即 从 S 中 剔除 该面 片层 中 与 输入 图像 不 一致 的 面片 然后 对 距离 参考 平面 次近 的 面 片层 进行 重建 从 S 中 剔除 该面 片层 中 与 输入 图像 不 一致 的 面片 依次 对 所有 平行 于 参考 平面 的 面 片层 进行 重建 即 剔除 S 中 与 输入 图像 不 一致 的 面片 取 重建 空间 的 另一面 为 参考 平面 对 S 中 与 之 平行 的 面 片层 进行 重建 得到 面片 集 S 同样 地 ， 依次 将 重建 空间 的 另外 个 表面 作为 参考 平面 按照 距离 参考 平面 由近及远 的 次序 对面 片层 进行 重建 剔除 面 片层 中 与 输入 图像 不 一致 的 面片 最后 得到 面片 集 S 将 S 向 每幅 输入 图像 投影 去掉 其中 对 所有 图像 都 不 可见 的 面片 得到 场景 的 三维 模型 　 重建 算法 　 　 本 节 给出 重建 算法 结构 如下 　 　 SF 　 　 fork 　 　 　 　 forirdo 　 　 　 　 　 　 foreveryf ∈ Fdkiskdo 　 　 　 　 　 　 　 projecttoIIIncompute λ 　 　 　 　 　 　 　 if λ ≥ threshthenSSf 　 　 S 　 　 fork 　 　 　 　 forirdo 　 　 　 　 　 　 foreveryf ∈ Fdkisk ∩ Sdo 　 　 　 　 　 　 　 　 projecttoIIIncompute λ 　 　 　 　 　 　 　 　 if λ ＜ threshthenS ＝ S ∪ ｛ f ｝ 　 　 λ 为 π π π j 的 方差 thresh 是 最大 允许 方差 thresh 越小 计算结果 越 精确 但 也 可能 越 不 完备 ； 反之 thresh 越大 计算结果 越 不 精确 但 也 越 完备 重建 中 遮挡 的 检测 通过 逐步 远离 参考 平面 的 重建 过程 来 解决 即 如果 f 被 f 遮挡 则 f 必定 先 被 重建 具体 到 计算 中 首先 对 每 一幅 输入 图像 上 的 每 一个 像素 设置 标志 为 表示 没有 一致性 面片 投影 到 该 像素 上 如果 对面 片 f 的 投影 有 λ thresh 则 将 其 投影 在 输入 图像 上 的 重叠 部分 的 像素 设置 标志 为 以后 再有 面片 投影 到 该 像素 上时 就 认为 后者 被 遮挡 　 实验 结果 　 　 实验 的 输入 图像 由 DMAX 在 不同 的 照相机 位置 对 一个三维 犀牛 模型 加以 渲染 而 获得 即 任意 设定 了 个 照相机 位置 获得 幅 图像 其中 相机 位置 符合 在 空间 中 稀疏 分布 的 原则 然后 将 这些 图象 输入 重建 程序 同时 给出 相应 的 相机 位置 和 其他 相机 参数 开始 重建 考虑 到 在 实际 照片 中 照相机 的 位置 不 可能 很 精确 地 获得 而且 由 Tsai ［ ］ 的 照相机 位置 校正 方法 对 真实 照片 校正 后 照相机 的 位置 误差 为 因此 在 重建 时 对 输入 图像 照相机 位置 加 了 大约 的 随机 扰动 来 模拟 真实 照片 输入 重建 后 输出 一个 彩色 面片 集来 表示 三维 模型 图 给出 了 重建 的 实验 结果 其中 a 是 原始 输入 图像 中 的 一幅 b 为 与 a 在 同一 视点 由 重建 后 的 模型 绘制 的 图像 c 为 重建 模型 在 任意 视点 绘制 的 图像 　 　 算法 在 P Ⅰ Ⅰ 兼容机 上 实现 软件 环境 为 WindowsVCFig 　 Theexperimentalresultsofrhinocerosmodel 图 　 犀牛 模型 实验 结果 　 结论 　 　 本文 给出 了 一种 新 的 基于 照片 的 三维 场景 重建 算法 根据 不同 照片 中 场景 颜色 纹理 的 相关性 来 建立 达到 照片 级 真实 程度 的 三维 场景 模型 算法 突破 了 体元 颜色 赋值 方法 对 照相机 位置 的 限制 使得 可以 对 真实 场景 全方位 拍摄 照片 以 重建 包含 全部 信息 的 三维 场景 模型 解决 了 重建 中 场景 之间 的 遮挡 问题 并且 用 面片 代替 体元来 表示 模型 使 计算 更为 简单 算法 可 用于 建立 真实世界 复杂 形体 的 真实感 三维 模型 杨孟洲 （ 浙江大学 CADCG 国家 重点 实验室 　 杭州 　 ） 　 石教英 （ 浙江大学 CADCG 国家 重点 实验室 　 杭州 　 ） 参考文献 ， LevoyMHanrahanPLightfieldrenderingInRushmeierHedComputerGraphicsProceedingsAnnualConferenceSeriesNewYorkACMSIGGRAPH ～ ， GortlerSJGrzeszczukRSzeliskiRetalThelumigraphInRushmeierHedComputerGraphicsProceedingsAnnualConferenceSeriesNewYorkACMSIGGRAPH ～ ， DebevecPETaylorCJJitendraMalikModelingandrenderingarchitecturefromphotographsahybridgeometryandimagebasedapproachInRushmeierHedComputerGraphicsProceedingsAnnualConferenceSeriesNewYorkACMSIGGRAPH ～ ， MaximilianOttLewisJPIngernarCoxTeleconferencingeyecontactusingavirtualcameraftpftpnjneccompubingemarpapersinterchipsZ ， SetizSMDyerCRPhotorealisticSceneReconstructionbyVoxelColoringhttpwwwcswisceducomputervisioncvprseitzps ， TsaiRYAversatilecameracalibrationtechniqueforhighaccuracyDmachinevisionmetrologyusingofftheshelfcamerasandlensesIEEETransactionsonRoboticsandAutomation ～