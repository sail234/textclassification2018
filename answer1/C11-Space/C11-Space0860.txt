航空 动力学 报 JOURNALOFAEROSPACEPOWER 年 　 第卷 　 第期 　 Vol 　 No 　 真空 羽 流场 的 DSMC 并行 数值 模拟 蔡国飙 　 刘世俭 　 王慧玉 　 庄逢 甘 　 　 【 摘要 】 　 对 DSMC 方法 进行 小 喷管 真空 羽流 数值 模拟 的 计算 软件 进行 了 并行 化 改造 。 计算 表明 在 多处理器 （ 节点 ） 上 实现 并行计算 能够 大幅度 地 提高 运算 速度 ， 缩短 运行 时间 ， 增加 计算 规模 ， 计算结果 与 串行 计算 一致 。 并 对 目前 串行 计算 不能 完成 的 真空 羽流 计算 的 算例 成功 地 进行 了 DSMC 并行计算 ， 计算结果 与 理论 分析 一致 。 　 　 主题词 ： 　 喷管 气流 　 蒙特卡罗 法 　 数值 模拟 　 计算 　 　 　 　 　 　 　 自由词 ： 　 并行计算 　 　 分类号 ： 　 V 　 引言 　 　 真空 羽 流场 包括 羽流 核心区 的 连续流 ， 外围 区 的 自由 分子 流 和 过渡 区 的 过渡流 。 其 流动 极为 复杂 ， 很 难用 一种 方法 来 描述 ， 特别 是 对于 过渡 区 的 流动 ， 目前 尚无 完善 的 理论 ， 与 之 相对 应 的 数学 方程 是 完全 的 Boltzman 方程 ， 除 特殊 情况 外 求解 极为 困难 。 比较 成功 地 能够 模拟 真空 羽 流场 的 数值 技术 是 直接 模拟 的 蒙特卡洛 方法 （ DSMC ） ， 这种 方法 由 BirdGA 等 人 在 年代 提出 ， 几十年 来此 方法 被 证明 是 成功 的 ， 并 得到 深入 发展 。 但 由于 其 计算 量过大 ， 计算 时间 过长 ， 对 内存 的 要求 很 高 ， 而 使得 其 应用 受到限制 ［ ］ 。 　 　 计算机技术 的 迅速 发展 ， 特别 是 网络 技术 在 计算机领域 的 广泛应用 ， 使得 并行 计算机 在 科学计算 中 的 优势 越来越 明显 。 从 理论 上 讲 ， 并行计算 规模 可 无限 增大 ， 并行计算 速度 可 无限 提高 。 真空 羽 流场 DSMC 实现 并行计算 ， 将 能够 满足 其 计算 规模 与 计算速度 的 要求 。 　 　 年代 末 ， FurlaniTR 和 LordiJA 等 人 ［ ］ ， 采用 三种 并行 方法 实现 过渡流 场 DSMC 并行计算 ， 在 节点 上 计算速度 最快 可 提高 倍 。 年代 初 ， WilmmthRG 和 CarlsmAB 等 ［ ］ 在 异构 并行 环境 实现 DSMC 的 并行计算 。 他们 利用 Sun 工作站 、 GrayYmp 巨型机 和 IntelIpsc 系列机 所 构成 的 较为 复杂 的 异构 并行 环境 进行 DSMC 并行计算 ， 得出 与 串行 计算 较为 一致 的 结果 ， 计算速度 有 更为 明显 的 提高 ， 计算 规模 能够 基本上 满足 实际 需要 。 　 并行计算 和 PVM 系统 　 　 并行 计算机 已有 很长 的 发展 历程 ， 其 种类 较 多 ， 可 分为 单 指令流 多数据流 SIMD 和 多 指令流 多数据流 MIMD 两大类 。 SIMD 并行机 按 结果 和 运行 机理 可 分为 阵列 机 、 流水线 机和 向量 机 。 MIMD 并行机 按 存储器 的 组成 也 可 分为 存储器 分布式 MIMD 和 存储器 共享 式 MIMD 并行机 。 　 　 并行 计算机 的 种类 不同 ， 相应 的 并行算法 也 截然不同 ， SIMD 并行机 需要 对 计算 问题 进行 微观 并行处理 ， 对 并行算法 的 依赖性 强 ， 串行 占优 的 计算 问题 其 并行 效率 很难 提高 。 存储器 分布式 MIMD 并行机 可 由 识别 串行 算法 的 内在 并行性 加以 改造 ， 而 使 整个 计算 实现 并行 ， 对 并行算法 的 依赖性 较弱 ， 通过 适当 选取 并行 对象 能 不同 程度 地 包容 串行 计算 过程 。 　 　 本文 应用 的 并行 计算机 是 基于 信息 传递 机制 的 松散 耦合 的 大规模 并行 计算机系统 MPP ， 属 存储器 分布式 MIMD 并行机 。 　 　 存储器 分布式 MIMD 并行机 ， 能够 同时 对 多条 指令 及其 各自 相关 的 数据 进行 处理 。 但 其 对 系统软件 要求 比较 高 。 在 算法 运行 过程 中 ， 需要 协调 进程 之间 的 同步 问题 以 满足 它们 的 数据 往来 或 控制 依赖 要求 。 年代 末 ， 美国 橡树 岭 国家 实验室 （ ORNL ） 推出 的 PVM 系统 能够 较 好 地 完成 这些 任务 。 PVM 系统 意即 并行 虚拟机 （ ParallelVirtualMachine ） ， 是 一个 并行 系统 软件包 ， 它 能够 将 异构 并行 网络 和 其它 系列机 用作 同一个 并行计算 环境 来 操作 ， 完成 大规模 的 计算 任务 。 　 　 并行计算 的 目的 是 要 克服 运行 速度 和 内存空间 的 不足 ， 使 计算 顺利完成 。 因此 实现 并行 化 计算 的 原则 应为 ： 尽可能 提高 计算速度 ； 能够 处理 更 大规模 的 计算 任务 ； 并行计算 过程 不 影响 计算结果 的 准确性 。 　 　 并行算法 与 并行程序 设计 的 优劣 将 直接 导致 并行计算 效率 有 很大 的 差异 ， 并行 效果 可以 由 并行 加速 比 与 可扩展性 来 衡量 。 并行 加速 比是 表示 采用 多个 处理器 并行计算 时 计算速度 所 能 得到 的 加速 倍数 。 设 tseq 表示 用 串行 计算机 求解 某个 计算 问题 所 需 的 时间 ， tp 是 用 P 个 处理器 求解 问题 的 时间 。 在 理论 情况 下 ， 程序 的 每 一部分 若能 完全 并行 ， P 个 处理器 的 加速 比 应该 等于 P ， 但 在 一般 情况 下 ， 这 是 不 可能 的 。 定义 加速 比 Sp 和 并行 效率 Ep 为 ［ ］ ： Sp ＝ tseq ／ tp 　 　 　 　 　 　 　 　 Ep ＝ Sp ／ P 　 　 加速 比 Sp 一般 比 P 小 ， Ep 也 小于 ， 且 随着 处理器 个数 的 增多 Ep 将 减小 。 　 DSMC 并行计算 及 真空 羽 流场 的 DSMC 并行计算 过程 ． 　 DSMC 方法 简介 　 　 DSMC 方法 是 根据 稀薄 气体 流动 的 数值 模拟 研究 的 需要 发展 起来 的 一种 新 的 计算 气体 流动 方法 ， 以 跟踪 分子运动 为 依据 ， 运用 统计力学 的 方法 来 获得 气体 流动 参数 ［ ］ 。 在 流场 中总有 一些 分子 发生 碰撞 ， 而 另 一些 分子 自由 运动 ， DSMC 方法 采取 在 一定 时间 间隔 内 将 分子 自由 运动 和 分子 碰撞 解 耦 。 模拟 每个 网格 中 的 分子 间 的 碰撞 时 ， 忽略 分子 的 具体位置 及其 位移 ， 而 模拟 分子 自由 运动 和 与 壁面 碰撞 时 忽略 分子 间 的 相互 碰撞 。 利用 少量 的 模拟 分子 代替 真实 流 场内 数目 众多 的 气体 分子 ， 用 计算 模拟 实际 物理 过程 ， 即 对 模拟 分子 跟踪 ， 记录 它们 的 位置 和 速度 变化 ， 计算 分子 之间 、 分子 和 物面间 的 碰撞 ， 再 经 统计 平均 获得 所 需 的 各种 流动 参数 。 ． 　 DSMC 并行处理 　 　 由前 所述 ， DSMC 法 进行 真空 羽 流流 场 数值 模拟 可 分为 四 部分 ： 分子 的 自由 运动 及 与 壁面 碰撞 ； 分子 由来流 进入 区域 ； 分子 间 的 碰撞 ； 统计 处理 流场 参数 。 主要 计算 量 在 前 三 部分 ， 因此 对 第四 部分 计算 不 考虑 并行处理 。 　 　 分子 自由 运动 和 与 壁面 碰撞 是 各自 独立 无关 的 ， 因此 对此 过程 并行处理 可以 分子 为 对象 ， 最佳 并 行为 各 节点 处理 等量 的 分子 数 。 　 　 分子 由来流 进入 区域 与 边界 来流 状态 有关 ， 边界 上 不同 区域 来流 一般 不同 。 对此 过程 并行处理 应 在 考虑 来流 状态 计算 量 的 基础 上 ， 按 空间 区域 并行 ， 最佳 并 行为 各 节点 处理 等 计算 量 的 区域 。 　 　 分子 碰撞 过程 是 DSMC 法 计算 量 最大 的 部分 。 由于 位置 不同 其 分子 碰撞 概率 也 不同 ， 等 网格 数 区域 内 的 分子 碰撞 过程 的 计算 量 一般 有 较大 的 差异 ， 因此 并行处理 时 并行 对象 为 区域 ， 而 各 节点 处理 网格 数 的 多少 则 应 考虑 碰撞 概率 的 不同 进行 分配 。 　 　 根据 并行 化 原则 的 要求 ， 各 节点 计算 时 在 每个 计算 过程 应 保持 同步 以 减少 等待 。 同时 由于 信息 通信量 的 大小 严重 影响 运行 速度 ， 因此 一个 计算 问题 的 整体 并行 需 兼顾 计算 量 的 均匀分布 和 降低 通讯 量 两个 方面 。 DSMC 真空 羽 流场 计算 并行 化 处理 以 计算 量 最大 的 分子 碰撞 过程 为 主要 因素 。 根据 碰撞 概率 的 不同 划分 网格 数 ， 概率 大 的 区域 网格 数少 ， 概率 小 的 区域 网格 数多 ， 在 此基础 上 按 区域 分子 数 众寡 调整 区域 大小 使 并行计算 接近 同步 。 ． 　 二次 过滤法 　 　 内存 分布式 MIMD 并行 计算机系统 在 进行 并行计算 时 一般 存在 信息 传递 问题 ， 在 并行 化 处理 时应 尽可能减少 信息 传递 量 ， 恰当 选取 并行 对象 ， 充分利用 各 节点 独立 计算 和 信息处理 过程 中 串行 计算 自 依赖性 特点 ， 降低 节点 间 信息 依赖度 。 用 DSMC 法 直接 模拟 流场 计算 时 ， 由于 分子运动 是 随机 的 ， 无论 节点 计算 区域 怎样 划分 ， 任何 两个 节点均 存在 信息 传递 问题 。 在 节点 较多时 ， 信息 传递 方式 则 会 严重 影响 并行 加速 比 。 图 　 二次 过滤法 　 　 在 存储器 分布式 MIMD 并行机 上 ， 用 PVM 系统 进行 节点 间通信 是 通过 信息 “ 打包 ” 发送 和 接受 “ 解包 ” 实现 的 。 针对 DSMC 并行计算 的 特点 ， 本文 提出 了 一种 较为 实用 的 通信 方法 — “ 二次 过滤法 ” 。 如图 ， 每个 计算 节点 处理 的 分子 信息 通过 第一次 过滤 将 不 属于 自己 的 分子 信息 过滤出来 “ 打包 ” 广播 发送给 其它 节点 ， 其它 节点均 接收 到 信息 包后 通过 第二次 过滤 将 属于 本 节点 处理 的 信息 留下 。 其 特点 是 ： 每个 节点 只 需要 发送 一个包 就 可 将 信息 发送 出去 ， 同时 每个 节点 可 只 考虑 自己 处理 区域 的 边界 情况 而 不必 保存 更 多 的 信息 ， 通过 减少 打包 次数 、 降低 信息 通讯 时间 ， 当 节点 增多 时 可 避免 因 频繁 发送信息 包所 可能 出现 的 梗塞 现象 ， 各 节点 不 保存 其它 区域 的 边界 信息 ， 能够 节约 更 多 的 内存 。 ． 　 真空 羽 流场 的 DSMC 并行计算 过程 　 　 DSMC 法 进行 真空 小 喷管 羽 流场 并行计算 采用 主 － 从 模式 完成 ， 程序设计 如图所示 。 主控 机处理 主控 程序 ， 各 节点 完成 从 程序 计算 。 　 　 主控 程序 的 作用 在于 启动 从 程序 ， 将 从 程序 加载 到 各 节点 上去 ， 并 随时 进行 监控 管理 ， 发出 相应 的 指令 ， 调整 计算 范围 。 对 循环 计算 作出 判断 ， 接收 各 节点 计算结果 ， 并 最终 完成 流场 的 参数 统计 计算 。 　 　 从 程序 的 作用 是 完成 直接 模拟 过程 ， 依据 并行 化 原则 将 流场 划分 为 多个 计算 区域 ， 每个 节点 处理 其中 的 一个 区域 。 各 节点 的 计算 内容 是 相似 的 ， 均 包括 分子 自由 运动 ， 分子 逃逸 注销 ， 来流 分子 加入 ， 分子 碰撞 等 过程 。 在 分子 碰撞 计算 之前 ， 节点 间 进行 信息 传递 ， 将 不 属于 本 计算 区域 的 分子 信息 送出去 ， 接收 来自 其它 区域 的 分子 信息 ， 使 模拟 区域 始终保持 完备 统一 。 　 算例 计算 ． 　 基本 假设 　 　 卫星 和 空间站 的 调姿 发动机 的 喷管 一般 为 轴对称 拉伐尔 喷管 ， 喷管 扩张 段 为 锥形 ， 由于 喷管 外 的 环境 为 真空 环境 ， 因而 喷管 羽流 为 自由 膨胀 流动 ， 没有 激波 的 出现 。 由于 喷管 内外 流动 均 为 较 低密度 流动 ， 分析 时作 如下 基本 假设 ： 流场 中 分子 的 碰撞 均 为 二体 碰撞 ； 不 考虑 分子 内 自由度 激发 和 化学 非 平衡 效应 ； 假设 喷管 壁面 为 恒温 壁面 ； 气体 流动 为 定常流动 ； 将 分子 视为 硬球 分子 ， 即 分子 间 作用力 忽略不计 。 图 　 真空 羽 流场 并行计算 程序 流程图 　 　 由于 该 流动 问题 包含 连续介质 流 、 过渡流 和 分子 自由 流 三种 流动 ， 因此 需用 分子 气体 动力学 的 理论 来 分析 。 为了 数值 模拟 上 的 方便 ， 在 上述 基本 假设 下 ， 我们 统一 用 DSMC 方法 来 数值 模拟 真空 下 低密度 羽 流场 。 喷管 喉部 流动 参数 由 给定 条件 通过 差分 求解 NS 方程 数值 计算 喷管 流场 给出 ［ ］ 。 ． 　 计算结果 及 分析 　 　 用 DSMC 方法 并行 模拟 真空 下 发动机 喷管 的 羽 流场 ， 模拟 时 采用 RSF 方法 ［ ］ 。 并行 采用 宏观 无 重叠 区域 分解 法 ， 程序流程 如图 。 为了 验证 并行计算 结果 的 正确性 ， 首先 计算 一个 与 串行 计算 相一致 的 算例 ， 考虑 单 计算机 CPU 和 内存 的 限制 ， 算例 的 喷管 尺寸 和 原始数据 按表 所示 。 网格 划分 喷管 内为 轴向 × 径向 ＝ × ， 喷管 外为 × 。 初始 时 每个 网格 内 放置 个 分子 。 当 模拟 区域 分子 总数 变化 很 小时 ， 认为 流动 达到 稳定 状态 ， 此后 取 时间 平均 使 统计 涨落 减小 到 要求 的 范围 内 即可 。 　 　 并行计算 与 串行 计算结果 对 比如 图 ， 由此 可 看出 并行计算 与 串行 计算结果 是 一致 的 。 表 　 算例 喷管 几何 尺寸 及 流动 参数 喉部 直径 D 面积 比 Ae ／ At 出口 ／ 喉部 扩张 角 θ 气体 总温 T 总压 P 喷管 壁温 Tw × m ° NKPaK 　 图 　 串 、 并行计算 轴向 压强 曲线 对比 　 　 　 图 　 并行 加速 比 和 并行 效率 与 节点 数 的 关系 　 　 算例 的 计算 验证 了 并行计算 结果 的 正确性 ， 在 模拟计算 过程 中 ， 同时 得出 并行程序 单位 计算 量 的 计算 时间 、 并行 加速 比及 并行 效率 等 与 计算 节点 数 的 关系 ， 如图所示 。 由图 可以 看出 ， 通过 对 DSMC 法 的 并行处理 ， 计算速度 明显 加快 ， 计算 时间 减少 ， 同时 还 可以 看出 计算 节点 增多 并行 加速 比 始终 在 增大 ， 呈现出 较 好 的 可扩展性 。 图 　 算例 等 压强 线 、 等 温度 线 、 等 马赫数 线及 速度 矢量图 　 　 在 算例 验证 的 基础 上 ， 不 改变 喷管 的 几何 尺寸 和 形状 ， 根据 现有 能够 使用 的 并行机 条件 ， 对 气体 较 高 总压 、 较大 区域 的 真空 羽 流场 进行 并行 数值 模拟 ， 所 给 算例 气体 总压 为 Pa ， 是 算例 的 倍 ， 轴向 计算 范围 由算例 的 m 增加 到 m ， 计算 网格 数 增加 到 个 ， 计算结果 分别 如图所示 。 从图 可以 看出 计算结果 与 真空 羽流 规律 是 一致 的 ［ ］ 。 　 结束语 　 　 本文 实现 了 真空 小 喷管 羽 流场 的 并行 数值 模拟 。 在 分布式 并行机 上 进行 并行计算 ， 通过 兼顾 计算 规模 和 计算速度 的 协调 提高 ， 能够 使 DSMC 法 进行 真空 羽 流场 的 数值 模拟 具有 更强 的 适应性 ， 为 真空 羽 流场 的 进一步 研究 打下 良好 的 基础 。 本文 提出 的 并行 化 原则 与 二次 过滤法 是 对 并行 工作 的 经验总结 ， 可 为 大型 计算 问题 在 分布式 并行机 上 实施 并行 化 处理 提供 参考 。 并行计算 能够 通过 牺牲 计算速度 来 换取 大 的 计算 规模 。 随着 更为 先进 的 并行 计算机 的 推广 使用 ， 羽 流场 的 并行 数值 模拟 将 具有 更强 的 适应性 。 本文 系 国家 高技术 资助 项目 作者简介 ： 男 　 岁 　 博士 　 副教授 　 北京航空航天大学 宇航 学院 　 作者 单位 ： 北京航空航天大学 参考文献 　 　 　 BirdGAMolecularGasDynamicsClarendonPressOxford 　 　 　 FurlaniTRLordiJAAComparisonofParallelAlgorithmsfortheDirectSimulationMonteCarloMethod Ⅱ ： ApplicationtoExhaustPlumeFlowfieldsAIAA 　 　 　 WilmothRGCarlsonABDSMCAnalysisinaHeterogeneousParallelComputingEnvironmentAIAA 　 　 　 孙家 昶 ， 张林波 ， 迟学斌 ， 汪道 柳 ． 网络 并行计算 与 分布式 编程 环境 ． 北京 ： 科学出版社 ， 　 　 　 蔡国飙 ． 真空 羽流 问题 的 数值 模拟 研究 ： ［ 博士论文 ］ ． 北京航空航天大学 ， 　 　 　 樊菁 ， 沈青 ． 直接 模拟 蒙特卡罗 方法 中 的 一个 新 算法 — 随机取样 频率 法 ． 第六届 全国 计算 流体力学 会议 论文集 ， 北京 ： 科学出版社 ， 　 　 　 蔡国飙 ， 王慧玉 ， 祖国 君 ， 张振鹏 ． 真空 小 喷管 羽 流场 的 MonteCarlo 直接 模拟 ． 推进 技术 ， ， ： （ 责任编辑 　 杨再荣 ） 年 月 收稿 ； 年 月 收到 修改稿 。