计算机 应用 研究 APPLICATIONRESEARCHOFCOMPUTERSVolNoP 基于 公共 网络 的 虚拟 专用网 探析 范志 荣 　 陈文元 　 张卫平 摘 　 要 ： 虚拟 专用网 VPN 是 一个 新 的 网络 热门 技术 ， 它 可 替代 专线 而 利用 公共 网络 进行 网络 互联 ， 在 减轻 企业 费用 的 同时 还 带来 了 数据 安全性 的 保证 。 讨论 了 VPN 的 分类 、 隧道 技术 和 QoS 问题 ， 并 提出 要 充分利用 我国 的 等 公共 骨干网 建设 VPN ， 同时 ， 要 注意 加密算法 安全 方面 的 自主权 。 关键词 ： VPN 隧道 协议 QoS 安全 　 概述 　 　 Telecommunications 杂志 评出 的 年 电信 行业 十大 热门 技术 之一 就 有 虚拟 专用 网络 VPNVirtualPrivateNetwork ； InfoneticsResearch 公司 的 研究 人员 预计 到 年 ， 虚拟 专用网 产品 、 系统集成 和 服务 的 市场 将 达到 亿美元 ， 每年 的 增长率 将 超过 。 因此 ， VPN 正 受到 各大 网络设备 制造商 、 网络 服务提供者 NSPNetworkServiceProvider 、 企业 集团 和 许多 专业 人员 的 密切 关注 。 　 　 VPN 业务 作为 一种 能 大幅 减少 网络 开销 ， 减轻 企业 负担 ， 并 提高 网络 生产 效率 的 有效 方法 ， 成为 替代 以前 远程 接入 企业 内部网 必须 用 专线 的 传统 做法 的 时日 已 为期不远 。 因为 企业 IT 主管 所 关心 的 是 ： 既 要 有效 降低 网络 费用 ， 更要 保证 企业 敏感数据 的 安全性 、 私有 性 和 完整性 。 VPN 正是 一种 满足 这种 要求 的 解决方案 ， 它 在 公共 网络 如 Internet 上 开辟 出 了 一条 专用 通道 供 封装 后 的 数据包 通过 ， 并 使用 加密 、 认证 和 访问控制 等 方法 来 保证数据 的 安全 。 因此 ， 它 可以 替代 专线 ， 把 公司 的 移动 雇员 、 远程 分支机构 、 供应商 和 商业 合作伙伴 连接 到 公司总部 的 内部网 。 VPN 的 简单 配置 示意图 如图 。 图 　 VPN 简单 配置 　 　 VPN 的 访问 方法 可以 多种多样 ， 包括 模拟 拨号 、 ISDN 、 xDSL 、 CableModem 和 专线 。 VPN 也 可以 利用 IP 网络 、 帧中继 网络 FRFrameRelay 和 ATM 网络 来 建设 。 具有 和 专线 网络 同样 的 可靠性 、 安全性 、 可管理性 等 特点 ， 除此之外 ， 还有 高效 、 易 扩展 等 特点 。 　 VPN 的 分类 　 　 根据 VPN 所起 的 作用 ， 可以 将 VPN 分为 三类 ： VPDN 、 IntranetVPN 和 ExtranetVPN 。 　 VPDNVirtualPrivateDialNetwork 　 　 在 远程 用户 或 移动 雇员 和 公司 内部网 之间 的 VPN ， 称为 VPDN 。 远程 用户 利用 本地 的 网络 服务提供商 NSP 登录 到 Internet ， 与 公司 内部网 之间 建立 隧道 后 收发 信息 ， 就 像 在 公司 内部 办公 一样 ， 不仅 省去 了 远程 长途 拨号 费 和 专用 网络设备 建设 维护费 而且 由于 Internet 无处不在 访问 也 就 显得 更加 简便易行 。 　 　 由于 远程 用户 不 一定 接受 过 专门 的 训练 ， 所以 ， VPDN 的 客户端 配置 应 尽量 简单 ， 其 实现 对 用户 来说 应该 是 透明 的 ， 而 在 NSP 的 拨号 服务器 和 公司总部 的 边界 路由器 或 网关 处 的 VPN 设备 进行 相应 的 配置 。 　 　 VPDN 的 实现 过程 如下 所述 ： 用户 拨号 NSP 的 网络 访问 服务器 NASNetworkAccessServer ， 发出 PPP 连接 请求 ， NAS 收到 呼叫 后 在 用户 和 NAS 之间 建立 PPP 链路 ； 然后 ， NAS 对 用户 进行 身份验证 ， 确定 是否是 VPDN 用户 ， 如是 ， 就 启动 VPDN 功能 ， 否则 ， 视为 普通 的 Internet 用户 ； 身份 鉴别 通过 后 ， NAS 启动 和 公司总部 VPN 服务器 的 隧道 连接 ， VPN 服务器 可 对 由 NAS 传来 的 用户 身份 信息 进行 再次 的 验证 ， 以 确保 只有 正确 授权 的 用户 才能 访问 公司 的 内部 资源 。 　 IntranetVPN 　 　 在 公司 远程 分支机构 的 LAN 和 公司总部 LAN 之间 的 VPN ， 称为 IntranetVPN 。 通过 Internet 这一 公共 网络 将 公司 在 各地 分支机构 的 LAN 连到 公司总部 的 LAN ， 以便 公司 资源共享 、 方便 文件 传达 、 提高 办公 效率 ， 也 节省 了 以前 FR 、 DDN 等 专线 所 带来 的 高额 费用 。 　 　 由于 分支机构 和 总部 的 局域网 可以 认为 是 可信 的 ， 因此 ， IntranetVPN 主要 的 安全 重点 在于 ： 保护 公司 的 内 联网 不 受 外部 的 入侵 和 保证 公司 的 敏感数据 流经 Internet 时 的 安全性 。 基于 以上 考虑 ， 有 必要 在 两端 LAN 边界 的 VPN 服务器 上 加强 加密 和 认证 的 措施 ， 并 设置 防火墙 进行 数据包 的 过滤 。 现在 ， 当 建立 新 的 分支机构 局域网 时 ， 可以 很 容易 地连上 因特网 ， 因此 ， IntranetVPN 的 互连 就 显得 很 方便 ， 其 建设 时间 短 、 成本低 的 特性 ， 作为 那些 大型 企业 集团 的 网络 解决方案 尤为 适合 。 　 ExtranetVPN 　 　 在 供应商 、 商业 合作伙伴 的 LAN 和 公司 的 LAN 之间 的 VPN ， 称为 ExtranetVPN 。 由于 不同 公司 网络 环境 的 差异性 ， ExtranetVPN 应能 兼容 不同 的 操作 平台 和 协议 。 　 　 由于 并 不能 保证 外 联网 的 用户 都 具有 完全 的 可信性 除了 一般 的 安全 规则 外 公司 的 网络管理员 还 应该 设置 特定 的 访问控制 列表 ACLAccessControlList 根据 访问者 的 身份 、 网络地址 等 参数 来 确定 他 所 相应 的 访问 权限 ， 开放 部分 资源 而 非 全部 资源 给 外 联网 的 用户 。 如对 安全 需要 要求 更 高 的 公司 ， 可 在 公司 局域网 设置 两层 防火墙 ， 把 局域网 放在 第二层 防火墙 后面 ， 两层 防火墙 的 中间 区域 即 所谓 的 非军事区 DMZDemilitarizedZone ， 把 VPN 服务器 和 其它 一些 可以 公开 的 服务器 如 WWW 服务器 、 Email 服务器 等 放在 DMZ 区 黑客 即使 攻破 第一层 防火墙 还要 通过 VPN 服务器 的 验证 以及 第二层 防火墙 的 过滤 ， 因此 ， 很难 到达 公司 内部 资源网 。 　 VPN 的 隧道 协议 　 　 VPN 区别 于 一般 网络 互联 的 关键在于 隧道 的 建立 ， 然后 ， 数据包 经 加密 后 ， 按 隧道 协议 进行 封装 、 传送 以 确保 安全性 。 一般 ， 在 第二层 数据 链路层 实现 数据 封装 的 协议 叫 第二层 隧道 协议 ， 常用 的 有 PPTP 、 LF 、 LTP ； 同样 ， 在 第三层 网络层 实现 数据 封装 的 协议 叫 第三层 隧道 协议 ， 常用 的 有 IPSec ； 除此之外 ， 在 TCP 层 实现 数据安全 的 有 SOCKSv 协议 。 下面 分别 作一 简要 介绍 。 　 PPTPPointtoPointTunnelingProtocol 　 　 年 ， Microsoft 和 Ascend 等 在 PPP 协议 的 基础 上 开发 了 PPTP ， 它 集成 于 WindowsNTServer 中 ， WindowsNTWorkstation 和 Windowsx 也 提供 相应 的 客户端 软件 ， 因而 ， 对于 使用 Microsoft 操作系统 的 用户 来说 ， 不仅 免费 而且 操作 使用方便 。 　 　 PPTP 支持 多种 网络协议 ， 可 把 IP 、 IPX 、 AppleTalk 或 NetBEUI 的 数据包 封装 在 PPP 包中 ， 再 将 整个 报文 封装 在 PPTP 隧道 协议 包中 ， 最后 ， 再 嵌入 IP 报文 或 帧中继 或 ATM 中 进行 传输 。 PPTP 提供 流量 控制 ， 减少 拥塞 的 可能性 ， 避免 由包 丢弃 而 引发 包 重传 的 数量 ， 改善 了 网络 的 性能 。 PPTP 的 加密 方法 采用 Microsoft 点对点 加密 MPPEMicrosoftPointtoPointEncryption 算法 可以 选用 相对 较弱 的 位 密钥 或 强度 较大 的 位 密钥 。 由于 PPTP 只 在 隧道 建立 时 对 用户 进行 认证 ， 对 VPDN 用户 尤为 适合 。 　 LTPLayerTunnelingProtocol 　 　 年 ， Cisco 提出 LFLayerForwarding 隧道 协议 ， 它 也 支持 多 协议 ， 但 其 主要 用于 Cisco 的 路由器 和 拨号 访问 服务器 。 年底 ， Microsoft 和 Cisco 公司 把 PPTP 协议 和 LF 协议 的 优点 结合 在 一起 ， 形成 了 LTP 协议 。 LTP 同 PPTP 一样 ， 支持 多 协议 ， 利用 公共 网络 如 IP 网 、 FR 网 、 ATM 网 封装 PPP 帧 ， 可以 实现 和 企业 原有 非 IP 网 的 兼容 。 还 继承 了 PPTP 的 流量 控制 ， 支持 MPMultilinkProtocol ， 把 多个 物理 通道 捆绑 为 单一 逻辑 信道 。 LTP 使用 PPP 可靠性 发送 RFC 实现 数据包 的 可靠 发送 。 LTP 隧道 的 建立 在 两端 VPN 服务器之间 采用 口令 握手 协议 CHAP 来 验证 对方 的 身份 其后 不 验证 ， 可 采用 IPSec 对 数据包 加密 传送 ， 以 保证 安全 。 LTP 受到 了 许多 大 公司 的 支持 。 　 IPSecInternetProtocolSecurity 　 　 IPSec 是 IETFInternetEngineerTaskForce 正在 完善 的 安全 标准 ， 它 把 几种 安全 技术 结合 在 一起 形成 一个 较为 完整 的 体系 ， 受到 了 众多 厂商 的 关注 和 支持 。 通过 对 数据 加密 、 认证 、 完整性检查 来 保证 数据传输 的 可靠性 、 私有 性 和 保密性 。 　 　 IPSec 由 IP 认证 头 AHAuthenticationHeader 、 IP 安全 载荷 封装 ESPEncapsulatedSecurityPayload 和 密钥 管理 协议 组成 。 　 　 AH 协议 保证 了 隧道 中 报文 的 完整性 ， 它 对 每组 IP 包 进行 认证 ， 防止 黑客 利用 IP 欺骗 进行 攻击 。 AH 协议 可 采用 多种 认证 算法 ， 已经 被 定义 的 认证 算法 有 散列 信息 认证码 消息 文摘 HMACMD ： HashedMessageAuthenticationCodeMessageDigest 和 安全 散列 算法 JMACSHA ： SecurityHashAlgorithmVersion 。 通信 双方 中 的 一方 用 密钥 对 整个 IP 包 进行 消息 文摘 计算 ， 另一方 用 同样 的 密钥 和 算法 进行 计算 ， 如果 两者 的 结果 相同 ， 则 说明 数据包 在 传送 过程 中 没有 被 改变 ， 且 可 确认 数据包 是从 持有 密钥 的 对方 发送 的 ， 因此 ， 数据 的 完整性 和 认证 安全 得以 保证 。 AH 头 支持 IPv 协议 ， IPv 中 的 实现 是 强制性 ， 而 在 IPv 中 的 实现 是 可选 的 ， 两者 的 数据 报 格式 稍 有 差异 。 　 　 ESP 协议 保证数据 的 保密性 。 ESP 可 在 两种 模式 下 运行 ： 隧道 Tunneling 模式 和 传送 Transport 模式 。 在 隧道 模式 下 ， ESP 对 整个 IP 数据包 封装 和 加密 ， 这样 可以 隐藏 源 和 目的 IP地址 ， 从 外部 看不到 数据包 的 路由 过程 ； 在 传送模式 下 ， 只 对 IP 有效 数据 载荷 进行 封装 和 加密 ， IP 源 和 目的 地址 不 加密 传送 ， 因此 ， 它 的 安全 程度 不如 隧道 模式 来得 好 ， 但 其 开销 较 小 。 IPSec 未 具体 规定 使用 哪 一种 加密算法 ， 但 缺省 建议 使用 密码 分组 链 方式 的 DES 算法 CBCDES 这是 一个 密钥 长度 为位 的 加密算法 ， 对于 一般 的 商业 应用 已经 足够 。 其它 加密算法 可 采用 TripleDES 、 RC 、 RC 、 IDEA 等 。 由于 各国 政府 对 当地 密码 的 法律 规定 、 出口 政策 有所不同 ， 因此 ， IPSec 规范 草案 灵活 的 加密算法 机制 对于 加密算法 的 未来 扩展 、 适应 各地 政策 方面 的 重要性 是 不言而喻 的 。 ESP 包头 在 IPv 、 IPv 中 的 数据 报 格式 是 相同 的 。 　 　 密钥 管理 协议 是 IPSec 安全 协议 的 一个 重要 的 组成部分 ， IETF 规定 了 Internet 安全 协议 和 密钥 管理 协议 ISAKMPInternetSecurityAssociationandKeyManagementProtocol 来 实现 IPSec 的 密钥 管理 需求 ； IETF 还 设计 了 OAKLEY 密钥 确定 协议 KeyDeterminationProtocol 来 实施 ISAKMP 的 具体 功能 。 这个 协议 在 通信 系统 之间 建立 了 一个 安全 联系 ， 它 是 一个 产生 和 交换 IPSec 密钥 材料 并 协调 IPSec 参数 的 框架 ， 并 对 之 进行 管理 的 协议 。 　 　 IPSec 还有 一个 中央 组件 DOIDomainOfInterpretation 它 实际上 是 一个 存放 所有 IPSec 安全 参数 的 数据库 ， 这些 参数 可 被 与 IPSec 服务 相应 的 系统 参考 并 调用 。 IPSec 的 认证 、 加密 功能 与 密钥 管理系统 也 是 一种 松散 耦合 的 关系 ， 一旦 安全 功能 或 密钥 管理系统 发生变化 ， 不 需要 另 一部分 作 很大 的 修订 ， 就 能 完成 整体 框架 的 升级 。 　 　 IPSec 的 安全性 和 灵活性 为 其 带来 了 强大 的 生命力 ， 对于 建设 局域网 和 局域网 之间 的 VPN 尤为 适合 。 如 美国 汽车 工业 行动 组 AIAG 建设 的 汽车 网络 交换网 的 隧道 和 安全 技术 就 采用 了 IPSec ， 该网 是 目前 工业界 最大 的 IP 网络 之一 。 　 SOCKsv 　 　 SOCKsv 由 NEC 公司 开发 ， 它 是 建立 在 TCP 层上 的 安全 协议 ， 更 容易 为 与 特定 TCP 端口 相连 的 应用 建立 特定 的 隧道 ， 可 协同 低级 IPSec 、 LTP 、 PPTP 等 一起 使用 。 SOCKsv 能 对 连接 请求 进行 认证 和 授权 ， 如果 通过 的话 ， 则 建立 代理 连接 并 传送数据 。 由于 代理 的 存在 ， 可 增加 进一步 的 安全性 、 隐藏 内部 网络地址 和 拓扑 结构 。 当同 SSL 协议 配合 使用 时 ， 可 用作 企业 的 防火墙 ， 防止 黑客 通过 Internet 对 内部 主机 的 未 授权 访问 。 通常 用作 ExtranetVPN 。 虽然 SOCKsv 提供 强有力 的 认证 和 访问控制 方法 ， 但 整体 性能 较差 ， 管理 复杂 ， 且 推广 使用 较晚 ， 远不如 前 三种 协议 使用 广泛 。 但 随着 整体 水平 的 提高 ， 其 应用 前景 还是 看好 。 　 VPN 中 的 QoS 　 　 由于 Internet 是 一个 开放性 的 网络体系结构 ， 在 数据传输 过程 中 会 带来 不 可预测性 ， 而 有关 政府部门 和 大型 企业 有时 更 关心 的 是 数据传输 的 安全性 和 传输 质量 ， 因此 ， 如何 在 VPN 中 实现 QoS 就 显得 颇为重要 。 　 　 QoS 的 目标 是 能 合理 分配 带宽 以 保证 关键 应用 对 吞吐量 的 需求 ， 因此 ， 当 不同 的 数据类型 在 VPN 上 争夺 有限 的 带宽 时 ， 不仅 要 保证 各种 应用 同时 存在 ， 而且 要 各 有 可 接受 的 传输 效果 。 提供 QoS 保障 可以 采用 对包 进行 分类 、 对 带宽 进行 管理 、 进行 流量 控制 ， 以及 采用 资源 预留 等 方法 。 　 　 ． 在 将 包 加密 和 送入 隧道 前 ， 按照 一定 的 原则 对包 进行 分类 并 标记 不同 的 优先级 ， 在 传输 过程 中 ， 可以 对 不同 类型 的 包 采取 不同 的 处理 方式 ， 按 一定 的 优先级 传送 。 在 尚未 过渡 到 IPv 之前 ， 采用 MPLSMultiProtocolLabelSwitching 或 DiffServDifferentiatedServices 保证 QoS 不失为 一种 办法 。 　 　 ． 带宽 管理 就是 在 一定 信道 的 情况 下 ， 自动 分配 不同 的 子 信道 给 按 一定 原则 组织 起来 的 包 ， 并 进行 排队 管理 、 优先级 管理 。 　 　 ． 流量 控制 用来 预防 VPN 隧道 发生 过度 的 拥塞 而 引起 包 丢弃 之后 发生 大量 的 数据包 重传 。 　 　 ． RSVPResourseReservationProtocol ： 从 现在 骨干网 上 未 充分利用 的 带宽 中 划出 一部分 来 为 一些 有 安全 需要 的 单位 如 ： 国家 部委 和 政府 机关 提供 QoS 保障 。 　 VPN 的 应用 　 　 由于 VPN 的 成本低 、 安全 而 又 灵活 ， 支持 未来 扩展 等 特性 ， 它 已经 引起 广泛 的 关注 ， 随着 协议 标准 、 产品 的 不断 成熟 ， 也 将 引起 一轮 更为 广泛 的 应用 。 　 　 从 我国 的 网络 的 发展 情况 来看 ， 由于 中国 公用计算机 互联网 俗称 和 中国 公众 多媒体 互联网 俗称 已经 初具规模 。 网 ， 遍布 除 台湾 外 的 个 省 ； 网 也 在 全国 多个 省 互连 。 两者 的 骨干网 大部分 都 达到 了 M ， 拨号 用户 和 专线 用户 日渐 增多 ， 网络应用 如 电子商务 、 网络 购物 、 网上银行 、 网上 拍卖 、 网上 证券 等 如 雨后春笋 。 继 年底 启动 的 政府 上网 后 ， 年 又 将 推出 企业 上网 和 家庭 上网 ， 其中 许多 应用 将 涉及 到 安全 方面 的 内容 而且 的 网络 规划 目标 中 也 有 发展 VPN 数据 增值 业务 的 服务 内容 。 年月日 ， 国内 商用 公共 网络 的 两大 运营商 之一 吉通 公司 在 北京 宣布 ， 吉通 公司 将 以金桥 网络 优质 的 接入 服务 与 集成 服务 ， 与 Cisco 的 软硬件 设备 相结合 ， 推出 VPN 业务 。 因此 ， 个人 、 企业 用户 协同 网络 服务提供商 在 这样 一种 良好 的 氛围 中 如何 利用 好 这 一 现有 的 资源 特别 是 作为 我国 自有 的 多媒体 网络 更能 保护 资源 的 安全性 ， 以 实现 个人 访问 的 方便 ， 企业 成本 降低 、 工作效率 提高 ， NSP 扩展 业务 、 增加利润 等 对 各方 都 有利 的 服务 作 相应 的 策略 调整 就 显得 很 有 必要 。 　 结束语 　 　 基于 公共 网络 的 虚拟 专用网 方兴未艾 其 市场前景 相当 广阔 。 在 我们 关注 技术 发展 的 同时 ， 也 要 追踪 世界 优秀 产品 的 特点 ， 结合 我国 的 国情 ， 生产 出 有 我国 自主 知识产权 的 产品 。 特别 是 VPN 中 很 关键 的 加密算法 ， 要 根据 本 部门 的 实际 情况 进行 选择 ， 对 安全性 要求 很 高 的 特殊 机构 ， 应 选择 我国 自有 的 加密算法 。 国内 网络设备 厂商 在 机遇 和 挑战 面前 ， 应 能 抓住机会 。 范志 荣 上海交通大学 信息 存储 研究 中心 国家教委 薄膜 与 微细 技术 部门 开放 实验室 上海 陈文元 上海交通大学 信息 存储 研究 中心 国家教委 薄膜 与 微细 技术 部门 开放 实验室 上海 张卫平 上海交通大学 信息 存储 研究 中心 国家教委 薄膜 与 微细 技术 部门 开放 实验室 上海 参考文献 TomNovlleVPNKeytoConvergenceTelecommunicationsVolNoP ～ MarkTuomenokaVirtualPrivateNetworksTheBigPayoffTelecommunicationsVolNoP ～ httpwwwdatacomtutorialsbullethtmlhttpwwwietforginternet － drafts 冯运波 等 虚拟 专用网 技术 电子科技 导报 P ～ 收稿 日期 ： 年月日