计算机 应用 COMPUTERAPPLICATIONS 年 第卷 第期 VolNoExchangeServer 与 MSPCMail 邮件系统 连接 的 实现 李杰 　 　 摘 　 要 　 本文 论述 了 MSExchangeServer 邮件系统 与 MSPCMail 邮件系统 进行 连接 的 方法 以及 MSExchangeServer 与 MSPCMail 邮局 目录 同步 的 实现 。 　 　 关键词 　 ExchangeServer ， MSMail 连接器 ， 目录 同步 　 引言 　 　 当 我们 机构 的 邮件系统 中 同时 使用 着 MSExchangeServer 和 MicrosoftMailforPCNetworks 我们 可以 利用 ExchangeServer 的 MSMail 连接器 （ MMC ） 透明 地 实现 ExchangeServer 与 MSMail 用户 的 连接 。 　 　 首先 ， 在 运行 MMC 的 ExchangeServer 上将 自动 创建 一个 影子 MSPCMail 网络 和 邮局 。 我们 可以 在 MMC 中 增加 和 维护 MMC 提供 服务 的 MSPCMail 邮局 连接 。 MMC 在 标准 的 NT 局域网 协议 之上 运行 ， 可以 通过 局域网 连接 ， 也 可以 通过 异步 连接 或 X 连接 。 虽然 每台 ExchangeServer 只能 运行 一个 MMC 实例 ， 但 通过 单个 MMC 可以 连接 到 多个 MSPCMail 邮局 ， 而且 一个 MMC 能够 为 Exchange 机构 中 的 一个 场点 或 所有 场 点 提供 服务 。 　 　 其次 ， 需要 创建 一个 消息 传输 代理 （ MTA ） ， 以便 为 新 设计 的 MSPCMail 邮局 连接 提供 服务 。 MTA 是 一种 NT 服务 ， 它 将 在 ExchangeServer 上 运行 ， 能够 仿真 MSPCMail 的 EXTERNALEXE 程序 完成 的 功能 。 这个 服务 在 ExchangeServer 影子 邮局 和 MSPCMail 邮局 之间 移动 报文 。 　 　 接下来 ， 我们 需要 把 ExchangeServer 影子 邮局 的 有关 信息 告诉 给 实际 的 MSPCMail 邮局 ， 即 在 MSPCMail 邮局 管理程序 中 创建 相应 的 外部 邮局 。 这个 外部 邮局 可以 通过 局域网 连接 ， 也 可以 通过 异步 连接 或 X 连接 。 　 　 现在 ， MMC 的 影子 邮局 和 实际 的 MSPCMail 邮局 就 能够 通过 MMCMTA 实现 相互 通讯 了 。 　 　 我们 利用 MSMail 连接器 实现 了 ExchangeServer 和 MicrosoftMailforPCNetworks 系统 之间 的 邮件 交换 。 为了 免去 在 两个 系统 之间 进行 邮件 传递 时 手工 输入 其它 系统 的 地址 带来 的 麻烦 ， 我们 可以 利用 目录 同步 Dirsync 把 ExchangeServer 地址 引入 到 MSPCMail 邮局 中 ， 反之亦然 。 这样 ， ExchangeServer 和 MSPCMail 用户 在 编写 报文 时 ， 就 能够 从 地址 表中 选择 其它 系统 的 地址 ， 如同 自己 系统 的 地址 一样 。 　 实现 ExchangeServer 与 MSPCMail 邮件系统 的 连接 　 设置 MSMail 连接器 的 交换 和 一般 特性 　 　 要 开始 配置 MSMail 连接器 ， 应 在 ExchangeServer 管理器 中 适当 的 Connector 存储器 中 查找 并 双击 希望 运行 的 MSMail 连接器 。 需要 做 的 第一件 工作 是 增加 管理员 邮箱 。 选择 一个 ExchangeServer 接收器 作为 管理员 邮箱 ， 以便 完成 对 ExchangeServer 影子 邮局 的 管理 。 随后 ， 可以 设置 使用 的 正确 语言 ， 并 为 MMC 设置 报文 大小 限制 。 　 创建 MSPCMail 邮局 连接 　 　 现在 我们 必须 在 MSMail 连接器 中 创建 通向 其它 真正 MSPCMail 邮局 的 连接 。 　 　 如果 创建 基于 局域网 的 连接 ， 我们 必须 告诉 MSMail 连接器 MSPCMail 邮局 位于 局域网 中 的 何处 ， 局域网 中 邮局 路径 的 一般 格式 是 “ 　 计算机 名 　 目录 ” 。 不必 手工 输入 MSPCMail 网络 和 邮局 的 名字 ， ExchangeServer 能够 自动 从 邮局 中 检索 这些 信息 。 　 　 如果 创建 基于 异步 或 X 的 连接 ， 在 ExchangeServer 影子 邮局 和 MSPCMail 邮局 之间 建立 调制解调器 连接 ， 必须 手工 输入 MSPCMail 网络 和 邮局 的 名字 ， 并 设置 关于 异步 连接 或 X 连接 的 各项 信息 。 　 创建 连接器 消息 传输 代理 ConnectorMTA 　 　 我们 必须 创建 一个 MTA ， 以便 为 新 设计 的 MSPCMail 邮局 连接 提供 服务 。 MTA 是 一种 NT 服务 ， 可以 像 对待 其它 任何 NT 服务 那样 对待 它 。 　 　 为 新创建 的 服务 指定 一个 名字 ， 当 运行 NT 控制面板 的 Service 程序 时 ， 可以 看到 这个 名字 。 选择 MTA 服务 启动 模式 ， 在 默认 情况 下 ， 当 NT 启动 时 MTA 服务 自动 启动 。 　 　 选择 MTA 与 它 支持 的 实际 MSPCMail 邮局 进行 连接 的 方式 ， 有 三种 连接 方式 ： “ LAN ” 、 “ AsyncandLAN ” 以及 “ XandLAN ” 。 　 　 现在 ， 我们 应该 把 创建 的 MSPCMail 邮局 连接 分配 给 MSMail 连接器 MTA ， 使 MTA 为 相应 的 MSPCMail 邮局 连接 提供 服务 。 　 　 最后 ， 运行 NT 控制面板 的 Service 程序 ， 查找 新创建 的 MSMail 连接器 MTA 服务 ， 单击 “ 开始 ” 按钮 启动 该 服务 。 　 MSPCMail 邮局 的 设置 　 　 我们 需要 把 ExchangeServer 影子 邮局 的 有关 信息 告诉 给 实际 的 MSPCMail 邮局 。 在 MicrosoftPCMail 执行 文件目录 下 运行 Admin 程序 ， 以 Admin 权限 的 用户 身份 进行 登入 ； 创建 新 的 外部 邮局 ， 输入 ExchangeServer 影子 邮局 的 网络 名 、 邮局 名 、 路由 方式 和 连接 类型 ； 如果 指定 邮局 的 路由 方式 和 连接 类型 是 Direct 和 通过 Async 或 X 的 ， 必须 设置 与 ExchangeServer 影子 邮局 连接 的 端口 、 速率 、 登录 识别 符 和 口令 信息 。 　 测试 连接 　 　 可以 通过 从 MSPCMail 端 向 Exchange 端 发送 报文 来 测试 MSMail 连接器 ， 反之亦然 。 因为 我们 还 没有 实现 ExchangeServer 和 MSPCMail 系统 之间 的 目录 同步 ， 所以 不能 从 地址 表中 选择 地址 ， 而 必须 手工 输入 它们 。 　 　 首先 ， 从 MSPCMail 端 向 Exchange 端 发送 报文 测试 。 运行 MSPCMail 客户端程序 ， 编写 一个 新邮件 ， 在 收件人 地址 框中 指定 一个 基于 ExchangeServer 影子 邮局 的 Exchange 邮箱 名 ， 然后 编写 报文 并 发送 该 邮件 。 几分钟 后 ， 该 邮件 将 出现 在 邮箱 所有者 Exchange 客户程序 的 收件箱 中 。 　 　 然后 ， 从 Exchange 客户机 向 MSPCMail 网络 邮箱 发送 测试 报文 。 运行 Exchange 客户端程序 ， 编写 一个 新邮件 ， 点击 “ 收件人 ” 按钮 ， 新建 一个 相应 的 MSPCMail 邮箱 ， 然后 编写 报文 并 发送 该 邮件 。 在 MMCMTA 完成 它 工作 后 ， MSPCMail 邮箱 的 所有者 就 能够 利用 任何 MSPCMail 客户程序 阅读 该 邮件 。 　 实现 ExchangeServer 与 MSPCMail 邮局 的 目录 同步 　 　 我们 可以 在 一台 ExchangeServer 上 运行 Dirsync 服务器 ， 并 为 每 一个 进行 目录 同步 的 MSPCMail 邮局 建立 相应 的 远程 目录 同步 请求 器 RemoteDirsyncRequestor ； 在 所有 MSPCMail 邮局 上 运行 Dirsync 请求 器 ， 由此 来 实现 两个 系统 间 的 目录 同步 。 这样 ， 我们 就 能够 从 地址 表中 选择 其它 系统 的 地址 ， 如同 自己 系统 的 地址 一样 。 　 邮局 地址 的 导入 和 导出 　 　 为了 确保 MicrosoftPCMail 地址 传送 到 目录 同步 服务器 （ ExchangeServer ） ， 并且 ExchangeServer 地址 传送 到 目录 同步 请求者 （ MicrosoftPCMail ） ， 每个 进行 目录 同步 的 MicrosoftPCMail 邮局 都 必须 导入 和 导出 目录 同步 地址 。 实现 此 步骤 的 方法 如下 ： 　 　 运行 MicrosoftMail 管理员 程序 Adminexe ， 选择 “ Config ” “ DirSync ” “ Requestor ” “ Export ” 菜单 。 　 　 当 提示 导出 本地用户 和 组 （ LocalUsersandGroups ） 时 ， 点击 “ Yes ” 。 在 相同 的 菜单 上 ConfigDirSyncRequestorImport ， 点击 “ Import ” 并 点击 “ Yes ” 确认 。 　 目录 同步 的 实现 ： 　 　 对 所有 作为 目录 同步 请求者 的 MicrosoftPCMail 邮局 ， 在 MicrosoftPCMail 执行 文件目录 下 运行 下列 命令 完成 目录 同步 信息 的 发送 ： 　 　 reqmainddrivet 　 　 drive 是 连接 到 邮局 数据库 的 驱动器 号 。 　 　 打开 控制面板 中 的 服务 管理程序 ， 暂停 “ MicrosoftExchangeDirectorySynchronization ” 服务 。 　 　 对 每 一个 作为 目录 同步 请求者 的 MicrosoftPCMail 邮局 ， 在 MicrosoftPCMail 执行 文件目录 下 运行 下列 命令 完成 目录 同步 信息 的 接收 ： 　 　 reqmainddriverimportddriveadminppasswordqyrebuildddrivef 　 　 其中 ： 　 　 drive 是 连接 到 邮局 数据库 的 驱动器 号 。 　 　 “ Reqmainr ” 命令 接收 目录 更新 信息 ， 并 将 它们 放入 SRVTRANSGLB 中 。 　 　 “ Import ” 命令 从 SRVTRANSGLB 文件 中 提取 记录 ， 放入 暂存 处理 文件 中 ； 然后 将 目录 放入 USR 和 NME 文件 中 。 　 　 “ Rebuildf ” 命令 使用 网络 名 、 NME 文件 和 USR 文件 重建 GAL 文件 及其 索引 文件 。 　 验证 目录 同步 过程 的 正确性 　 　 当 我们 完成 以上 步骤 后 ， 如果 在 ExchangeServer 接收器 中 出现 了 MSPCMail 用户 的 邮箱 ， 同时 在 MSPCMail 相应 的 外部 邮局 中 也 增加 了 ExchangeServer 的 用户 信息 ， 则 MSPCMail 邮局 和 MicrosoftExchangeServer 之间 的 目录 同步 过程 就 顺利完成 了 。 　 结束语 　 　 本文 介绍 了 MSExchangeServer 邮件系统 与 MSPCMail 邮件系统 进行 连接 的 方法 和 实现 步骤 ， 以及 ExchangeServer 与 MSPCMail 邮局 的 目录 同步 的 实现 。 通过 本文 介绍 的 方法 可以 将 MSExchangeServer 邮件系统 与 MSPCMail 邮件系统 无缝 地 集成 到 一起 ， 大大 扩展 了 邮件系统 的 应用 范围 。 作者简介 ： 李杰 　 讲师 。 主要 研究 方向 ： 计算机网络 、 数据库系统 。 作者 单位 ： 山东 工业 大学 计算机科学 系 　 山东 济南 （ ） 参考文献 ［ ］ 　 BarryGerberMicrosoftExchangeServer 从 入门 到 精通 北京 ： 电子 工业 出版社 ， ［ ］ 　 MicrosoftMicrosoftExchangeServer 资源 指南 北京 ： 科学出版社 ， ［ ］ 　 MicrosoftMicrosoftMailAdministrator ′ sGuideMicrosoftCorp ， 收稿 日期