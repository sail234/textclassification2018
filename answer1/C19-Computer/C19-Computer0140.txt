计算机 应用 COMPUTERAPPLICATIONS 年 第卷 第期 VolNo 互联网 防火墙 的 设置 张珏 　 唐宁 九 　 　 摘 　 要 　 论述 Firewall 的 作用 以及 安装 实例 。 　 　 关键词 　 Internet 防火墙 ， 防火墙 服务器 　 了解 Firewall 　 　 Firewall 原来 是 汽车 上 的 一个 术语 ， 它 用来 隔离 引擎 和 乘客 ， 在 引擎 爆炸 时 可以 发挥 保护 乘客 的 功能 。 电脑 上 的 Firewall 是 一个 逻辑 装置 ， 用来 保护 私人 的 区域 不 受 公用 部份 的 侵害 ， 做法 是 ： 　 　 使用 一部 有 路由 功能 的 电脑 例如 LinuxOS ； 　 　 加入 两个 界面 （ 例如 ： 串行口 ， 以太网卡 等 ） ； 　 　 关掉 IPForwarding 的 功能 ； 　 　 把 其中 一个 界面 接上 外界 网络 （ 如 互联网 ） ； 　 　 把 受 保护 的 网络 接在 另 一个 界面 上 。 　 　 现在 你 使 电脑 接到 两个 不同 的 网络 上 。 这部 Firewall 电脑 ， 现在 就 称为 Firewall 服务器 了 ， 可以 接到 Internet 上 ， 也 可以 接到 保护 网络 （ ProtectedNetwork ） 上 。 但 保护 网络 无法 连上 Internet ， Internet 也 连不上 保护 网络 。 　 　 如果 要 从 保护 网络 内连上 Internet ， 必须 要 先 连接 到 Firewall ， 从 那里 使用 Internet 。 同样 的 ， Internet 上 的 人 要 进入 保护 网络 ， 也 必须 先 透过 Firewall 。 　 　 这种 作法 ， 对于 Internet 上 的 攻击 有 很 优秀 的 免疫 作用 。 如果 有人 企图 对受 保护 的 网络 进行 攻击 ， 则 必须 先 穿过 Firewall ， 攻击 必须 分成 两个 步骤 ， 难度 也 增加 了 。 如果 有人 想 借着 使用 一般 的 手法 ， 如 邮件 炸弹 （ MAILBOMB ） 或 “ InternetWorm ” 来 攻击 受 保护 的 网络 ， 他们 可能 是 无法 如愿 的 。 　 Firewall 的 缺点 　 　 Firewall 最大 的 问题 在于 由 内部 网络 访问 外界 网络 的 困难 。 基本上 ， Firewall 利用 拨号 帐号 来 减少 对于 Internet 的 使用 ， 必须 选 登录 到 Firewall 才能 做 其他 对 Internet 的 Access 动作 。 因此 一些 需要 直接 连接 Internet 程序 （ 如 Netscape ） 便 无法 在 Firewall 后方 顺利 动作 ， 解决 的 办法 是 使用 ProxySerer 。 　 Firewall 的 安全性 　 　 目前 的 Firewall 还 不够 好 ， 因为 它 还 敞着 大门 等 别人 来 攻击 。 首先 ， 取消 所有 不 需要 的 功能 ， 例如 netstat 、 systat 、 tftp 、 bootp 、 finger 。 甚至 你 可以 关掉 telnet ， 只 允许 rlogin 或 vicaversa 。 　 Firewall 软件 　 　 单纯 的 Firewall 除了 Linux 核心 及 基本 网络 套装 软件 （ inetdtelnetd 和 telnetftpd 和 ftp ） 外 ， 不需 外加 任何 软件 。 所以 有些 软件 可以 使 你 的 Firewall 更 有用 ， 这里 简单 介绍 以下 软件 。 　 ISFirewallToolkit 　 　 TIS 中有 一套 程序 用来 进行 Firewalling ， 这些 程序 和 socks 基本上 相同 ， 但 采用 了 不同 的 设计 策略 。 socks 是 用 一个 程序 来 完成 所有 的 Internet 动作 ， TIS 则 用 不同 的 功能 发展 不同 的 程序 。 　 　 以 WWW 和 telnet 作 例子 ， 在 socks 中 ， 设定 一个 config 文件 和 一个 daemon 透过 这个 文件 及 daemontelnet 及 WWW 可以 正常 使用 ， 就 宛如 你 没 把 它们 关掉 前 一样 。 而 在 TIStoolkit 中 ， 须 为 WWWandTelnet 各设 一个 daemon 及 config 文件 。 完成 之后 ， 其他 的 InternetAccess 仍 被 禁止 ， 直到 你 完成 其 设定 为止 。 如果 某一 特定 功能 没有 daemon 如 talk ， 你 可以 使用 “ plugin ” 的 daemon ， 只是 不像 其他 的 工具 那样 有 弹性 且 不易 使用 罢了 。 　 　 Socks 易于 安装 、 易于 complie 且 具有 较大 的 弹性 。 如果 你 想 严格控制 网络 内 的 使用者 ， 则 TIStoolkit 的 安全性 较佳 。 但 二者 都 提供 了 对外 的 绝对 保护 。 　 TCPWrapper 　 　 TCPWrapper 不是 一个 Firewalling 工具 ， 但 它 提供 了 许多 相同 的 效果 。 通过 TCPwrapper ， 你 可以 控制 谁 有权 Access 你 的 机器 和 Access 那些 服务 ， 同时 可能 追踪 连线 的 记录 ， 而且 它 还 提供 了 一个 基本 的 侦测 伪装 功能 。 TCPwrapper 基于 一些 理由 ， 并未 广泛 的 运用 。 　 Ipfw 和 IpfwAdmin 　 　 这是 国内 使用 最多 的 Firewall 软件 之一 ， 它 使用 和 安装 都 比较简单 ， 可以 提供 转向 功能 。 缺点 是 需要 Unix 核心 的 支持 ， 有时 会 导致 要求 重新 编译 Unix 核心 ， 这 对于 某些 网管 人员 会 是 一个 不小 的 问题 。 　 ProxyServer 　 　 ProxyServer 需要 额外 的 软件 ， 你 可以 从 互联网 上 下载 所 需 软件 。 在 sockconf 下 同时 有 一个 config 文件 范例 。 　 　 socks 的 程序 需要 两个 configuration 文件 。 一个 说明 那些 Access 是 被 允许 的 ， 另 一个 则 是 把 请求 route 到 适当 的 ProxyServer 。 Access 文件 必须 设在 server 上 。 而 routing 文件 则 要 装 在 每部 Unix 机器 上 。 　 　 Firewall 内 的 DNS ， 在 Firewall 内 安装 DNS 是 很 简单 的 事 ， 只要 在 Firewall 的 机器 上装 个 DNS ， 并且 将 Firewall 内 的 机器 DNS 设定 改成 它 就行了 。 　 　 ProxyServer 的 缺点 ， 无法 处理 UDP 封包 是 ProxyServers 的 致命伤 。 　 网络 设计 实例 　 　 假设 现在 一个 公司 里 有部 电脑 ， 有 多重 的 访问 等级 ， 要 依据 不同 的 等级 完成 不同 的 事情 。 同时 要求 某些 机器 能够 通过 路由器 访问 Internet ， 很 明显 ， 就 必须 把 网络 中 的 一部分 保护 起来 ， 防止 不同 等级 的 人 去 接触 。 　 　 这些 等级 分别 为 ： 　 　 员工 级 　 泛指 可以 给 所有 的 人 看 的 ， 一些 公开 的 、 不 需要 保护 的 资料 。 　 　 管理层 　 在 这里 所 要 保护 的 资料 只 允许 管理人员 查看 。 　 　 核心 级 　 管理 核心 资料 ， 在 这 一级 中 ， 对 所有 资料 进行 保护 ， 未经 得 授权 的 人 ， 无法 看到 里面 的 资料 。 　 网络 设计 　 　 IP地址 安排 如下 ： 　 　 ， 用作 广播 之用 。 　 　 个 IP地址 挪出 个 ， 供 互联网 访问 机器 使用 。 　 　 一个 IP 给 Linux 系统 。 　 　 一个 IP 给 网络 上 另 一部 Linux 系统 。 　 　 两个 IP 号码 给 Router 。 　 　 剩下 四个 DomainNames 设为 paulringojohn 和 george 用来 掩人耳目 。 　 　 保护 网络地址 为 xxx 。 　 　 建立 出 两个 分离 的 网络 ， 放在 不同 的 办公 场地 中 ， 避免 线路 上 的 盗用 。 两个 网络 各 接上 一台 Linux 系统 作为 服务器 。 　 　 有 一个 FileServer 连上 两个 保护 网络 ， 对 管理 级用 ， 对 核心 级用 。 之所以 用 不同 的 地址 是因为 它们 用 两个 不同 的 Ethernet 卡 ， IPforwarding 已经 关掉 ， 可以 避免 网络 数据 的 转发 。 　 　 两台 Linux 系统 上 的 IPForwarding 都 关掉 ， 路由器 不会 把 发送到 xxx 的 数据包 向前 传 ， 除非 另有 设定 。 因此 两个 网络 已经 安全 。 关掉 IPforwarding 是 为了 防止 管理 级 网络 接触 到 核心 网络 。 　 　 NFSserver 也 可以 设计 来 提供 不同 的 文件 案 存取 权限 ， 这 可以 用 手动 来 控制 ， 但 要 用到 一点 符号 链结 的 技巧 ， 使得 一些 共用 文件 可 供 所有人 使用 。 利用 这个 设定 再 加上 一块 Ethernet 卡 可以 使 三个 网络 都 可以 分享 这些 文件 案 。 　 Proxy 的 架设 　 　 制定 三个 网络 的 访问 权 。 员工 级 直接 连上 Internet ， 省得 跟 ProxyServer 搅混 ， 管理 级 及 核心 级 被包 在 Firewall 内 ， 所以 员工 级 中 不用 架设 ProxyServer 。 管理 级 和 核心 网络 的 架设 十分相似 ， 因此 加入 一些 限制 条件 ， 使 它 有些 变化 而且 有趣 。 　 　 不 允许 任何人 用 FileServer 作 互联网 访问 ， 以 防止 病毒 及其 他 的 恶作剧 等 。 这点 十分 重要 。 　 　 不 允许 管理 级 的 机器 使用 某些 互联网络 资源 （ 如 WWW ） 。 防止 资料 泄密 。 所以 管理 级 Linux 系统 上 的 sockdconf 文件 设定 如下 ： 　 　 deny 　 　 核心 级 机器 上 则 是 ： 　 　 deny 　 　 管理 级 还要 加上 这 一行 ： 　 　 denyeq 　 　 这样 可以 防止 任何 机器 作用 PortHTTPPort ， 但 其他 的 服务 仍然 是 开放 的 ， 除了 浏览 Web 之外 ， 然后 两边 的 文件 中 还要 加上 ： 　 　 Permit 　 　 使得 xxx 的 电脑 可以 使用 这个 ProxyServer ， 除了 已经 被 拒绝者 之外 。 （ 如 FileServer 和 管理 级 上 的 Web 访问 ） 管理 级 的 sockdconf 如下 ： 　 　 deny 　 　 denyeq 　 　 permit 　 　 核心 级 的 文件 如下 ： 　 　 deny 　 　 permit 　 　 每个 网络 都 是 独立 的 ， 只 允许 有 限度 的 接触 。 作者简介 ： 张珏 　 工程师 。 主要 研究 方向 ： 网络 技术 应用 。 唐宁 九 副教授 。 主要 研究 方向 ： 计算机 基础教育 。 作者 单位 ： 张珏 　 四川大学 计算机 基础教育 中心 　 四川 成都 （ ） 唐宁 九 　 四川大学 计算机 学院 　 四川 成都 （ ） 收稿 日期