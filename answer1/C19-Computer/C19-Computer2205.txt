计算机 应用 研究 APPLICATIONRESEARCHOFCOMPUTERS 　 Vol 　 No 　 P 生产 信息 实时 发布 系统 张伟 　 彭 民德 　 黄炜 摘要 Network 分布式 过程 控制系统 是 ElsagBailey 集团 年代 推出 的 产品 ， 在 我国 许多 企业 的 生产 过程 自动控制 中 有着 广泛 的 应用 。 但 受 产品 生产 年代 的 制约 ， N 上 运行 的 许多 管理软件 ， 已 不能 适应 今天 企业 发展 的 需要 。 生产 信息 实时 发布 系统 将 原 N 系统 中 的 MCS 仿真 软件 移植 到 Windows 环境 下 的 网络 工作站 上 ， 有效 地 解决 了 这 一 问题 。 详细 地 阐述 了 生产 信息 实时 发布 系统 的 功能 及 结构 。 关键词 过程 控制 分布式 实时 生产 信息 前言 　 　 Network 以下 简称 N 分布式 过程 控制系统 ， 是 ElsagBailey 集团 年代 推出 的 产品 ， 该 系统 性能 先进 、 适用范围 广 ， 在 我国 众多 企业 的 工业 过程 自动化 控制 中 ， 有着 广泛 的 应用 。 因 当时 计算机 发展 情况 的 制约 ， 多数 软件 已 不能 适应 今天 企业 对 生产 过程 控制 管理 的 自动化 需要 ， 对于 广大 用户 而言 ， 开发 基于 N 的 新一代 管理 控制软件 势在必行 。 生产 信息 实时 发布 系统 是 基于 N 开发 的 、 对原 N 管理 控制系统 MCS 软件 的 仿真 。 此 系统 运行 在 管理 局域网络 的 工作站 上 ， 通过 计算机 接口 单元 CIU ， 与 N 环路 网络通信 ， 从而 取得 实时 生产 信息 ， 经 分析 处理 后 ， 在 管理 工作站 上 再现 生产 过程 仿真 画面 。 N 系统结构 N 系统 体系结构 　 　 硬件 体系结构 如图所示 。 N 系统 由 若干个 环形 通讯 网络 组成 ， 在 每个 环行 网络 上 ， 可 挂接 多个 过程 控制 单元 PCU ， 多功能 处理器 MPU 、 过程 控制 观察站 PCV 、 操作员 接口 站 OIS 、 计算机 接口 单元 CIU 、 工程师 工作站 EWS 等 组件 。 其中 MFP 是 PCU 的 核心 组件 ， 它 通过 相关 接口 与 现场 设备 传感器 相连 ， 接收 和 处理 现场 生产 信息 。 在 N 中 ， 每个 信息 采样 点 都 用 一个 整数 － 标签 来 标识 。 生产 信息 在 环形 网络 的 控制 下 ， 合理 地 在 系统 的 各个 组件 之间 流动 。 PCV 、 OIS 、 EWS 上 运行 N 配套 的 系列 软件 ， 用来 完成 对 整个 系统配置 、 监控 、 管理 等 任务 。 CIU 是 N 为了 增强 其 开放性 而 增加 的 与 第三方 产品 的 接口 设备 。 第三方 产品 可 通过 CIU 及 N 规定 的 标准协议 与 N 环路 通信 ， 达到 控制 、 管理 的 目的 。 图 　 系统结构 示意图 环路 通信协议 及其 专用 技术 　 　 N 系统 采用 存储器 插入式 的 存储转发 协议 ， 网络 中 没有 通讯 指挥 器 ， 所有 节点 的 地位 是 平等 的 ， 没有 主次 之分 。 每一 节点 随时 独立 地 进行 数据 接收 、 数据 发送 以及 数据 删除 功能 ， 通过 传输 介质 与 相邻 的 两个 节点 相连 ， 最后 形成 一个 闭合 的 回路 。 数据 信息 在 网络 节点 间 依次 传递 ， 从 信源 节点 到 目的 节点 ， 再 由 目的 节点 到 发出 信息 的 节点 上 。 　 　 为了 防止 通讯 通道 的 阻塞 ， 保证 通讯 传输 的 通畅 ， 提高 网络通讯 效率 ， N 系统 采用 两种 有效 的 通讯 技术 ， 即 例外 报告 技术 和 信息 打包 技术 。 　 　 例外 报告 技术 　 　 例外 报告 技术 就是 在 过程 控制 中 产生 的 涉及 测量 、 操作 、 报警 、 管理 的 信息 ， 经过 一定 的 技术 处理 后 ， 形成 一种 反映 信息 值 的 专门 报告 。 这一 报告 的 显著特点 是 只 反映 某一时间 间隔 内 发生 显著 变化 的 信息 ， 而 对 没有 发生 显著 变化 的 信息 ， 不 产生 报告 。 　 　 信息 打包 技术 　 　 在 N 环路 中 ， 信息 的 传输 格式 规定 为 两 帧 式 。 其中 第一 帧 为 标题 帧 ， 第二 帧 为 信息 帧 ， 并且 两帧 之间 有 一定 的 间隔 。 打包 技术 就是 将 去 同一 地址 的 所有 信息压缩 在 一起 ， 使用 一个 标题 帧 ， 再 把 信息 发送 出去 的 专有 技术 。 生产 信息 实时 发布 系统 的 设计 及 实现 　 　 生产 信息 实时 发布 系统 根据 原 MCS 系统 的 特点 ， 在 运行 Windows 的 网络 工作站 上 进行 了 二次开发 ， 在 保存 了 原 MCS 系统 功能 的 同时 ， 采用 了 OpenGL 图形处理 技术 ， 配置 了 图形 加速卡 和 大屏幕 终端 ， 所以 图形 显示 速度 快 ， 画面 显示 清晰 。 在 人机交互 方面 ， 将 原 系统 中 大部分 由 键盘 完成 的 工作 ， 交由 鼠标 控制 下 完成 ， 使 用户 在 较 少 的 击键 情况 下能 完成 更 多 的 工作 。 所以 系统 功能 更强 ， 使用 更 方便 。 　 　 根据 N 的 MCS 系统 仿真 监控 的 要求 ， 系统结构 设计 如下 ： 为了 能 从 环路 中 获得 信息 ， 并 进行 仿真 控制 ， 首先 在 被 监控 N 环路 上 增加 一个 CIU 模件 及 一个 端子 模件 ， 管理 局域网络 上 的 前端 数据 采集 工作站 通过 串行口 以 RS 协议 与 环路 相连 ， 完成 数据 采集 工作 。 数据 从 环路 中 接收 后 ， 分析 处理 ， 写入 网络 服务器 中 的 数据库 。 运行 在 管理 局域网络 上 的 多个 MCS 仿真 工作站 从 数据库 中 获取数据 ， 完成 仿真 任务 。 这样 就 形成 了 以 网络 数据库 为 服务器 ， 以 数据 采集 和 MCS 仿真 为 客户机 的 ClientServer 体系结构 。 其 硬件 互连 结构 如图所示 ， 软件结构 如图所示 。 图 　 系统软件 结构 示意图 　 　 根据 以上 分析 ， 整个 系统 由 三 部分 组成 ： 中央 网络 数据库 、 N 环路 接口 数据 采集 软件 、 MCS 仿真 软件 。 中央 网络 数据库 　 　 网络 数据库 用来 存放 从 N 环路 中 取得 的 生产 实时 信息 。 为了 处理 上 的 统一 ， N 将 环路 中 的 各种 信息 归纳 为种 数据类型 。 这种 数据类型 ， 是 设计 数据库 结构 的 重要依据 。 数据库 的 属性 ， 一方面 要 能 正确 表示 这种 数据类型 ， 达到 存放 环路 数据 的 目的 ， 另一方面 ， 还要 包括 环路 号 、 标签 号 等 信息 ， 从而 完成 数据 的 定位 和 标识 工作 。 N 环路 接口 软件 　 　 N 环路 接口 软件 的 主要 任务 是 通过 CIU 从 环路 中 获得 生产 实时 信息 。 当 接口 软件 开始 工作 时 ， 首先 要 判断 是否是 第一次 运行 ， 如是 第一次 运行 ， 则 要 创建 数据库 并 完成 初始化 工作 ， 然后 ， 初始化 CIU ， 通知 环路 建立 信息 采集 点 即 标签 点表 ， 随后 向 环路 发送 例外 报告 读取 命令 ， 接收 回响 后 ， 分析 处理 ， 并 写入 数据库 。 接口 软件 流程 如图所示 。 图 　 接口 软件 流程图 　 　 其 主要 工作 由 以下 几个 方面 组成 。 　 　 数据库 的 初始化 。 环路 接口 软件 运行 时 涉及 到 从 环路 中 采集 哪些 标签 数据 的 问题 。 在 N 系统 中 ， MCS 的 仿真 画面 ， 是 由 工程师 根据 生产 过程 的 实际 需要 用 线性 编辑 生成器 LEDG 编辑 虚拟 设备 介质 文件 VDM 描述 的 。 每个 过程 的 仿真 也 即 每个 VDM 文件 都 与 若干个 标签 相关联 。 通过 对系统 中 所有 VDM 文件 的 分析 ， 我们 可 获得 整个 系统 所 需 的 标签 。 在 对 VDM 文件 分析 的 过程 中 ， 每 获得 一个 所 需要 的 标签 ， 就 向 数据库 中 插入 一个 记录 ， 并 使 数据库 中 的 记录 和 系统 所 需 标签 呈 一一对应 关系 。 此项 任务 在 接口 软件 第一次 运行 时 完成 。 　 　 实时 信息 的 采集 。 系统 提供 多种 命令 与 原有 命令 兼容 ， 允许 前端 工作站 通过 CIU 以 RS 协议 与 环路 通信 。 命令 可 分为 三类 ： ① 环路 初始化 、 标签 点表 的 建立 等 通信 服务 建立 命令 。 ② 数据 采集 命令 ， 如 例外 报告 的 读取 、 报警 故障 信息 的 读取 等 命令 。 ③ N 系统配置 命令 。 　 　 接口 软件 通过 串行口 、 CIU 向 N 环路 发布 相应 命令 ， 异步 接收 回响 后 ， 分析 处理 ， 再 写入 数据库 。 另外 ， 接口 软件 还要 处理 通信 过程 中 的 差错 、 超时 等 异常情况 。 　 　 接收 信息 的 分析 处理 。 N 环路 中 发到 前端 机 的 例外 数据包 ， 每包 中 可能 包含 多个 标签 的 例外 数据 ， 因此 必须 首先 以 标签 为 依据 ， 进行 分割 。 另外 ， 对于 每个 标签 的 数据 ， 可能 又 包含 多个 数据 信息 ， 因此 ， 必须 根据 此 标签 所 对应 的 数据类型 ， 将 此 标签 所 对应 的 数据 分解 为 多个 字 段 。 这些 字段 有 的 可能 又 被 N 压缩 了 。 N 可 根据 实际 情况 将 其 压缩成 字节 或 字节 或 字节 。 对于 此类 数据 ， 必须 解压 处理 。 以上 处理过程 完成 后 ， 才能 将 此 标签 对应 的 数据 写入 数据库 的 相应 字段 中 。 MCS 仿真 软件 　 　 MCS 仿真 软件 运行 在 管理网络 的 MCS 仿真 工作站 上 ， 其 主要 任务 是 根据 LEDG 仿真 过程 画面 生成 软件 所 生成 的 仿真 画面 描述 文件 即 VDM 文件 的 内容 ， 从 数据库 中 获得 相应 标签 数据 ， 对 生产 过程 进行 实时 仿真 。 除 以上 主要 工作 外 ， 仿真 软件 还要 响应 键盘 及 鼠标 消息 ， 完成 人机交互 功能 。 主要 流程 如图所示 。 图 　 MCS 仿真 软件 主 流程图 　 　 其 具体任务 如下 。 　 　 绘图 命令 处理 。 为了 对 生产 过程 进行 有效 仿真 ， N 系统 提供 了 大量 的 绘图 命令 ， 用来 描述 反映 生产 过程 的 实时 画面 。 仿真 系统 一个 重要 的 工作 就是 处理 这些 绘图 命令 ， 绘图 命令 处理 正确 与否 ， 是 仿真 系统 实现 成败 的 关键 。 这些 绘图 命令 可 分为 两大类 。 　 　 静态 绘图 命令 。 这些 命令 主要 用来 绘制 一些 简单 的 图元 ， 如画 折线 命令 pl 、 画圆 命令 cc 、 画 弧段 命令 ac 、 文本 显示 命令 tx 等 。 这些 命令 不会 与 生产 过程 中 的 实时 数据 即 标签 数据 相关 连 。 　 　 动态 绘图 命令 。 MCS 仿真 系统 用 动态 绘图 命令 实现 对 生产 过程 状态 的 动态 追踪 功能 。 如泵 的 启停 ， 管道 的 压力 ， 报警 信息 、 趋势 信息 等 的 动态 实时 描述 。 为了 让 动态 绘图 命令 能 完成 以上 功能 ， 动态 命令 一般 都 与 标签 数据 相 联系 ， 即 标签 作为 动态 绘图 命令 的 一个 参数 。 动态 绘图 命令 被 解释 处理 之前 ， 必须 根据 其所 提供 的 标签 索引 ， 从库 中 检索 出 实时 数据 ， 然后 再 依据 此 数据 绘制 相应 的 图形 。 动态 图形 命令 可 分为 如下 几类 ： 动态 报警 命令 ea 、 动态 配置 命令 ec 、 动态 交互 命令 ei 、 报警 摘要 命令 as 、 趋势 命令 et 、 动态 程序 命令 ep 、 动态 符号 命令 ed 。 　 动态 绘图 命令 一方面 涉及 系统 过程 中 动态数据 ， 所以 会 与 标签 相关 连 。 另一方面 还要 完成 某些 静态 图形 命令 所 完成 的 功能 ， 如 字符 的 显示 、 字符 特征 的 设置 、 图形符号 着色 等 功能 ， 所以 它 又 有 静态 绘图 命令 的 特点 。 　 　 MCS 仿真 过程 所 需 数据 获取 。 MCS 仿真 系统 要 不停 地 根据 生产 过程 中 的 实时 数据 动态 地 调整 仿真 画面 。 其所 需 的 实时 数据 ， 是 仿真 系统 从 网络 数据库 中 获得 的 。 结束语 　 　 生产 信息 实时 发布 系统 在 运行 Windows 操作系统 的 网络 工作站 上 实现 原 N 系统 中 的 MCS 仿真 系统 的 功能 ， 有效 地 克服 了 原 仿真 系统 的 缺点 ， 使 N 系统 在 新 的 市场 环境 下 更 能 适应 企业 对 生产 过程 的 控制 、 管理 和 决策 的 需要 。 这 对于 我国 广大 N 用户 而言 ， 具有 一定 的 实际意义 。 张伟 （ 长沙 铁道 学院 计算机系 长沙 ） 彭 民德 （ 长沙 铁道 学院 计算机系 长沙 ） 黄炜 （ 长沙 铁道 学院 计算机系 长沙 ） 参考文献 ， BaileyGRPNetworkManagementCommandSystemOperationConfigurationManualSoftwareReleaseLProductInstructionE ， BaileyGRPNetworkEnhancedComputerInterfaceUnitProgrammersReferenceManualProductInstructionE ， 张伟 等 INFI 分布式 过程 控制系统 长沙 铁道 学院 学报 ～ 收稿 日期 ： 年月日