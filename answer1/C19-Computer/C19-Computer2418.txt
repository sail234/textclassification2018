计算机 研究 与 发展 JOURNALOFCOMPUTERRESEARCHANDDEVELOPMENT 年 　 第卷 　 第期 　 Vol 　 No 　 基于 类比 的 壁画 色彩 虚拟 复原 魏宝刚 　 潘云鹤 　 华 　 忠摘 　 要 ： 文中 以 敦煌 莫高窟 为 应用 背景 ， 介绍 了 基于 类比 的 计算机辅助 古代 壁画 色彩 恢复 方法 将 色彩 保持 相对 完好 的 壁画 图像 以及 描述 壁画 属性 的 特征参数 作为 壁画 色彩 恢复 的 类比 源 存入 数据库 ， 根据 决定 和 影响 壁画 色彩 的 不同 因素 ， 特征参数 分为 个 层次 ， 以便 于 图像 数据库 的 类比 检索 为了 在 处理 图像 过程 中 与 人 的 视觉 保持一致 ， 除 RGB 颜色 空间 外 ， 又 选择 了 SHI 颜色 空间 结合 图像 色彩 区域 提取 、 基于 直方图 的 色彩 转换 等 技术 实现 了 壁画 图像 的 色彩 复原 关键词 ： 色彩 恢复 ， 类比 ， 区域 生长 ， 色彩 转换 中图法 分类号 ： TPANANALOGYBASEDVIRTUALAPPROACHFORCOLORRESTORATIONOFWALLPAINTINGWEIBaoGangPANYunHeandHUAZhongArtificialIntelligentInstituteZhejiangUniversityHangzhouStateKeyLaboratoryofCADCGZhejingUniversityHangzhouAbstract 　 AnewcomputeraidedanalogyapproachforcolorrestorationofancientmuralisproposedinthispaperThemuralimageswhosecolorsarerelativelyintactarestoredalongwiththeirfeatureparametersusedtodescribethemuralsintothedatabaseastheanalogysourceforcolorrestorationoffadedmuralsThefeatureparametersareclassifiedintothreelevelsaccordingtodifferentfactorsthatdetermineandaffectthecolorofmuralThedatabasecanberetrievedfromoneormorethanonelevelInordertoachieveauniformperceptionwithhumanvisionSHIcolorspaceischosenSeveraltechniquesforcolorimageprocessingareusedtoprocessthemuralimageTheseincludecolorobjectextractionbasedoninteractiveregiongrowingandcolortransformationbasedoncolorhistogramKeywords 　 colorrestorationanalogyregiongrowingcolortransformation 　 引 　 言 　 　 中华民族 在 人类 发展史 上 创造 出 了 与 古埃及 、 古印度 和 两河 流域 并称 于世 的 灿烂 文明 ， 遗存 了 极其丰富 的 文物古迹 书画 特别 是 壁画 艺术 更是 独具特色 ， 其中 敦煌 莫高窟 壁画 上 起 十六 国 ， 下止 元代 ， 历史悠久 ， 在 世界 享有 很 高 的 声誉 但 壁画 经 千百年 风日 侵蚀 等 各种 自然 和 人为因素 的 影响 ， 损坏 严重 ， 色彩 大多 褪变 ， 且 这种 现象 仍 在 持续 　 　 敦煌 壁画 色彩 变化 大体上 分为 褪色 和 变色 两种 现象 褪色 是 颜料 色泽 、 饱和度 的 降低 ， 以及 色泽 的 鲜明 感觉 和 相互之间 对比度 减弱 ； 而 变色 则 是 颜料 在 长期 的 光 和 其它 因素 作用 下 ， 由 一种 色相 变为 另 一种 色相 ， 使 原来 鲜明 强烈 的 色调 变得 晦暗 、 模糊 变色 的 主要 内部 原因 是 颜料 中 的 铅 成分 ［ ］ 变色 的 外部 原因 有 光照 、 氧气 、 温湿度 、 工业气体 、 霉菌 、 细菌 等 ， 其中 阳光 和 温湿度 是 重要 因素 　 　 为了 使 人们 能够 欣赏 到 作品 原来 绚丽 的 色彩 ， 艺术家 在 壁画 临摹 工作 中 做 过 一些 色彩 复原 工作 ， 但 基本上 是 尝试性 的 ， 至今 未 大量 开展 除了 复杂 的 技术 原因 外 ， 这种 完全 依赖 手工 的 恢复 临摹 存在 两个 不可避免 的 缺陷 ， 一个 是 其 局限性 ， 也就是说 临摹 往往 凭借 个人 或 少数 人 的 经验 知识 ； 另 一个 是 临摹 的 不可逆性 ， 当对 某 一步 工作 不 满意 时 ， 不 可能 撤消 当前 的 工作 ， 再 返回 到 前面 步骤 从 新 开始 　 　 采用 计算机辅助 方法 虚拟 恢复 古代 壁画 色彩 可以 有效 地 克服 上述 两个 缺陷 首先 可以 将 不同 专业 有关 壁画 色彩 的 研究成果 、 经验 知识 加以 归纳 、 抽象 、 存储 ， 并 应用 于 虚拟 色彩 恢复 中 此外 ， 在 恢复 过程 中 随时 可以 放弃 某 一步 的 工作 ， 从 新 开始 ， 直到 取得 满意 结果 为止 　 基于 类比 的 色彩 恢复 　 色彩 恢复 知识 的 分类 　 　 敦煌 壁画 有着 一千六百 多年 的 历史 ， 颜料 的 成分 既有 矿物质 的 ， 也 有 植物 质 的 ； 影响 颜料 变色 的 因素 既有 物理 的 ， 化学 的 ， 也 有 生物 的 ； 不同 成分 、 不同 色彩 颜料 的 混合 使得 变色 情况 差别 很大 ； 颜料 的 使用 又 与 绘画 的 风格 、 内容 、 技法 等 相关 ； 而 不同 时期 、 不同 画派 有着 不同 的 绘画 技法 所有 这些 一环套 一环 ， 错综复杂 因此 ， 要 想 恢复 变色 壁画 的 色彩 必须 利用 所有 可能 的 研究成果 、 经验 知识 概括 起来 有 以下 三大类 知识 　 　 第类 是 艺术家 长期 积累 的 经验 知识 这 类 知识 通常 是 在 参阅 历史文献 和 有关 图片 ， 考证 衣冠 制度 、 发髻 装饰 和 风俗习惯 ， 仔细 研究 不同 时代 壁画 的 色调 、 色种 以及 颜料 的 质量 等 基础 上 总结 得出 的 ， 具有 普遍 的 指导意义 比如 ， 段文杰 先生 ［ ］ 阐述 隋代 壁画 的 人物 面部 立体感 的 表现 方法 时 ， 概括 出 了 中西合壁 晕染 法 、 中国 传统 晕染 法 、 中国 素面 、 以及 天竺 遗法 等种 赋色 方法 　 　 第类 是 壁画 保护 科学 工作者 的 知识 这 类 知识 是 通过 颜料 的 化学 实验 分析 得出 的 颜料 变色 机理 ， 这 类 知识 较 准确 地 反映 了 含铅 颜料 色彩 的 变色 规律 比如 铅丹 PbO 在 阳光 照射 下 从 桔红色 到 棕红 ， 最后 变为 黑 红色 　 　 第类 知识 来自 于 壁画 自身 由于 年代久远 、 环境 条件 的 变更 等 客观原因 ， 要 想 全面 、 准确 地 掌握 壁画 不同 成分 颜料 的 化学变化 规律 和 壁画 的 赋色 方法 是 不 可能 的 因此 ， 壁画 本身 作为 知识 源 的 作用 尤为 突出 ， 这里 指 的 是 未 变色 或 变色 程度 不 严重 的 作品 ， 特别 是 通过 对 重层 壁画 剥出 的 色彩 鲜亮 作品 本文 只 针对 这 类 知识 ， 介绍 基于 类比 的 壁画 色彩 恢复 技术 方法 　 基于 类比 的 色彩 恢复 模型 　 　 利用 类比 机制 进行 学习 和 解决问题 是 人类 智能 的 一大 特点 当 面临 两幅 内容 相似 的 壁画 时 ， 我们 很 自然 地会 将 两者 的 色彩 联系 起来 ， 看看 它们 是否 也 具有 某些 相似性 例如 ， 图中 两幅 图像 是 同处 窟 的 两幅 壁画 ， 都 是 以 菩萨 为主 研究 表明 两幅 壁画 菩萨 的 肤色 原来 应该 有 相似 的 色彩 ， 现在 之所以 呈现 两种 完全 不同 的 色彩 ， 主要 是 环境 条件 造成 的 左图 所示 的 壁画 由于 受 光照 的 影响 ， 变色 较 严重 ， 原来 的 肉 红色 变成 灰色 ， 朱色 叠晕 已 变成 大黑 圈 而 右图 所示 的 壁画 由于 佛龛 遮蔽 ， 不易 受光 ， 人体 的 肉 红色 以及 朱色 晕染 仍然 比较 清晰 图 　 窟 不同 光照 条件 下 的 壁画 　 　 除了 这种 同一 洞窟 中 内容 相似 的 壁画 具有 可比性 外 ， 属于 同一 时期 或 同一 朝代 ， 甚至 是 不同 朝代 的 ， 但 绘画 风格 、 技法 相似 的 壁画 也 具有 一定 的 类比性 因此 ， 将 色彩 保持 相对 完好 的 壁画 图像 连同 其 相关 的 特征 信息 作为 类比 源 存储 、 利用 ， 是 我们 色彩 恢复 系统 的 一个 主要 功能 　 　 基于 类比 的 色彩 恢复 过程 （ 见图 ） 为 ： ① 输入 变色 图像 和 相关 的 特征 信息 ； ② 通过 类比 检索 从 数据库 中 检索 出 用于 变色 图像 色彩 恢复 的 参照 图像 ； ③ 根据 要 恢复 的 色彩 从 两个 图像 中 提取 对应 的 色彩 区域 ； ④ 确定 变色 色彩 和 恢复 色彩 的 转换 关系 ， 完成 色彩 的 恢复 ； ⑤ 若 对 结果 不 满意 可 返回 前面 某步 重新 开始 图 　 基于 类比 的 色彩 恢复 　 数据库 的 组织 和 类比 检索 　 　 数据库 用来 存储 作为 类比 源 的 图像 数据 和 壁画 特征 属性 当 系统 面对 一个 输入 的 变色 壁画 图像 和 特征 信息 时 ， 为了 使 系统 能够 比较 准确 和 快速 地 从 数据库 中 检索 出 参照 图像 ， 数据库 应该 包括 哪些 特征 信息 以及 数据库 如何 组织 显得 尤为重要 　 　 除了 图像 数据 外 ， 我们 将 数据库 分成 个 层次 ， 分别 对应 壁画 的 色彩 结构 、 绘画 技法 和 环境 条件 在 色彩 结构 这 一层 上 ， 图像 按 壁画 所处 的 洞窟 、 时代 、 朝代 等 决定 色彩 总体 分布 的 属性 分类 ； 在 绘画 技法 层上 ， 图像 按 壁画 主题 、 内容 、 风格 以及 绘画 技法 等 属性 分类 如 壁画 的 内容 分 佛教 、 经变 、 装饰 、 菩萨 、 供养人 等 ； 在 环境 条件 层 图像 按 洞窟 的 温湿度 、 光照 、 大小 、 壁画 在 洞窟 内 的 位置 等 与 壁画 的 变色 程度 相关 的 属性 分类 而 实际 图像 按 各层次 所 划分 的 类链 起来 在 这个 库 结构 中 ， 对应 每 一条 链路 及 定义 在 其 上 的 属性 是 一幅 具体 壁画 的 条理性 分析 ， 因而 它 是 抽象 知识 的 一种 具体 表达形式 　 　 类比 检索 可 在 多条 链路 上 同时 进行 ， 也 可 在 某条 链路 上 单独 检索 一般来讲 多 链路 检索 结果 比 单链 路 检索 结果 更 有效 ， 但 由于 多 链路 所 附加 的 约束条件 更 多 ， 往往 得不到 结果 ， 这时 只能 进行 单链 路 检索 不同 链路 以及 不同 属性 赋予 不同 的 权值 ， 设 第 i 条 链路 权值 为 ω Li 、 它 的 第 j 个 属性 权值 为 ω Aij ， 当 检索 出 多个 图像 时 ， 按权 和 的 大小 排列 它们 ， 供 系统 取舍 和 使用 计算 权 和 公式 为 　 　 SLi 和 SAij 用以 表示 链路 和 相应 层次 上 的 属性 是否 与 输入 图像匹配 ， 若 匹配 取值 为 ， 否则 为 　 图像 色彩 区域 提取 与 色彩 转换 　 　 对于 壁画 来说 ， 由于 绘画 作品 的 色彩 丰富 ， 不同 色彩 相互 融合 ， 加之 壁画 表面 的 磨损 、 脱落 等 ， 使得 壁画 图像 的 处理 更为 复杂 ［ ］ 完全 自动 的 彩色图像 分割 结果 很难 为 进一步 的 图像处理 所 应用 因此 ， 我们 采用 交互式 的 区域 生长 法来 提取 与 恢复 相关 的 色彩 区域 这时 颜色 空间 的 选取 对 分割 结果 和 效率 有 很大 的 影响 　 颜色 空间 的 选取 　 　 图像 显示器 采用 红绿蓝 三 基色 混合 得到 各种 色彩 ， 每个 像素 的 颜色 都 是 以 三 基色 的 数量 来 定义 的 ， 人们 在 处理 彩色图像 时 往往 采用 RGB 颜色 空间 但 RGB 颜色 空间 不 符合 人 的 感知 心理 ， 例如 很难说 出 深棕色 中 三 基色 R ， G ， B 的 准确 含量 到底 是 多少 因此 ， 除 RGB 空间 外 ， 人们 通过 线性 或 非线性 变换 从 三 基色 计算 得出 一些 其它 颜色 空间 ， 比如 HSV ， SHI ， Lab 、 II ′ I ′ ， YES 等 　 　 在 众多 的 颜色 空间 中 选择 哪 种 用于 图像处理 更好 ， 一直 为 人们 所 重视 Schumeyer 和 Barner ［ ］ 在 RGB ， Lab ， HSV ， 颜色 空间 上 对种 不同 肤色 人脸 图像 进行 了 分割 ， 结果 是 Lab 和 HSV 空间 上 所得 的 结果 更好 Liu 和 Yang ［ ］ 用 他们 提出 的 多解 彩色图像 分割 技术 在 RGB ， HSV ， II ′ I ′ ， Lab ， XYZ 以及 YIQ 空间 上 对 幅 典型 的 彩色图像 进行 了 分割 ， 分析 了 各 颜色 空间 用于 不同 图像 分割 的 结果 ， 指出 了 它们 的 优缺点 Saber 等 ［ ］ 指出 YES 颜色 空间 有 以下 个 优点 ： ① 降低 了 由于 亮度 改变 所 引起 的 色度 变化 ； ② 彩色 分量 E ， S 可 由 三 基色 移位 变换 得到 ， 因此 有 较 高 的 计算 效率 ； ③ 避免 了 非线性 空间 的 奇异 性 　 　 从 上述 介绍 的 情况 可以 看出 ， 颜色 空间 选取 确实 对 分割 结果 起着 重要 的 作用 ， 但 颜色 空间 及 特征 的 选取 ， 似乎 不同 的 组合 用于 不同 的 目的 ［ ］ 针对 壁画 图像 ， 我们 选择 SHI 和 RGB 两 颜色 空间 SHI 颜色 空间 在 视觉 上 是 均匀 的 ， 与 人 的 颜色视觉 有 很 好 的 一致性 ， 它 比较 适合 于 人机交互 式 图像 区域分割 但 选择 SHI 颜色 空间 并非 在 整个 色彩 分布 范围 内 都 能 取得 理想 的 效果 实验 表明 饱和度 分量 S 的 取值 范围 对以 色调 分量 H 为主 的 图像 分割 结果 有 一定 的 影响 当 s 分割 结果 比较 可靠 ， 而 当 s 时 ， 分牲 结果 与 视觉 有 较大 的 差距 因此 ， 当 s 或 R ， G ， B 三分 量值 比较 接近 时 ， 将 直接 在 RGB 颜色 空间 上 分割 图像 　 交互式 区域 生长 法 　 　 由于 自动 分割 壁画 图像 满足 不了 实际 要求 ， 而且 要 处理 的 主要 是 变色 色彩 所以 ， 我们 采用 交互式 的 区域 生长 法 提取 色彩 区域 这里 所说 的 区域 包括 要 恢复 图像 上 的 和 参照 图像 上 的 两个 色彩 区域 ， 且 区域 是非 连通 的 ， 只要 满足 色彩 相似性 度量 就 被 认为 是 目标 区域 在 区域 生长 过程 中 ， 种子 点 的 位置 和 大小 由 用户 交互 选取 区域 点聚类 的 距离 度量 标准 为 ： 　 　 其中 像素点 ij 的 色彩 值为 Cij ， 它 的 相邻 扩充 点 色彩 值 、 生长 区域 的 平均 色彩 值 以及 种子 点 的 色彩 值 分别 为 和 Csij ； δ ptp ， δ ptr 和 δ pts 为个 阈值 ， 它们 的 大小 一般 应 满足 δ ptp ＞ δ ptr ＞ δ pts 　 　 在 区域 生长 过程 中 ， 若 待定 点 的 饱和度 s 或 其 RGB 分量 大小 接近 时 ， 颜色 距离 的 度量 采用 RGB 空间 的 欧几里德 距离 ； 否则 用 SHI 空间 的 色调 分量 的 差值 衡量 颜色 距离 在 区域 边沿 提取 过程 中 ， 当 区域 的 大小 不 超过 × 个 像素 时 ， 将 作为 噪声 不 予以考虑 图为 变色 菩萨 肤色 区域 的 交互式 提取 的 部分 结果 对于 每个 连通 的 子 区域 ， 至少 需要 一次 交互 确定 种子 点 ， 当子 区域 色彩 变化 较大 时 ， 可能 需要 多次 交互 图 　 交互式 色彩 区域 提取 　 色彩 转换 及 恢复 　 　 提取 出 彩色 区域 后 ， 在 SHI 空间 统计 得出 区域 颜色 直方图 ， 由此 确定 恢复 区域 和 参照 区域 的 色彩 分布 ， 为 色彩 转换 提供 基础 我们 采用 了 一种 线性变换 实现 恢复 区域 中 像素 的 色彩 转换 ， 其 方法 是 根据 两 图像 的 HSI 分量 直方图 ， 取 各自 峰值 处 的 hsI 值 HMsSMsIMs 和 HMcSMcIMc 作为 参数 ， 按下式 求出 所要 恢复 区域 像素 i 的 色彩 值 ： 　 　 图为 人体 肤色 的 恢复 效果 对比 ， 只取 了 整幅 图像 中所要 恢复 区域 的 局部 为例 其中 左图 为 未 恢复 前 的 图像 ， 人物 肤色 呈 灰色 ； 中图 为 类比 检索 出 的 参照 图像 ， 人物 肤色 为 肉 红色 ； 而 右图 为 恢复 后 的 图像 图 　 恢复 结果 对比 　 结 　 论 　 　 本文 重点 介绍 了 基于 类比 的 壁画 色彩 虚拟 复原 技术 方法 由于 选择 了 SHI 颜色 空间 ， 使得 在 交互 提取 色彩 区域 和 恢复 壁画 色彩 过程 中 ， 与 人 的 视觉 保持 较 好 的 一致性 ， 且 恢复 色彩 保持 了 绘画 所 产生 的 色彩 层次 关系数据库 的 层次 组织 结构 有助于 准确 高效 地 检索 出所 需要 的 图像 　 　 虽然 一般 情况 下 恢复 结果 较 好 ， 但 在 色调 变化 较大 的 区域 ， 采用 线性 转换 色彩 方式 效果 不 甚 理想 因此 ， 我们 进一步 的 工作 将 从 两个 方面 入手 ， 一个 是 研究 非线性 转换方法 ， 另外 还 可以 将 色彩 区域 的 提取 与 颜色 分色 结合 起来 ， 使得 色彩 的 恢复 可 在 某 一 色彩 层上 进行 本 课题 得到 国家自然科学基金 （ 项目编号 ） 和 中国 博士后 基金项目 资助 作者简介 ： 魏宝刚 ， 男 ， 年生 ， 博士 ， 副教授 ， 主要 研究 方向 为 人工智能 、 图像处理 、 数据库 与 知识库 系统 　 　 　 　 　 潘云鹤 ， 教授 ， 中国工程院 院士 ， 浙江大学 校长 ， 主要 研究 方向 为 人工智能 、 认知科学 、 智能 CAD 、 计算机 美术 等 　 　 　 　 　 华忠 ， 男 ， 硕士 研究生 ， 主要 研究 方向 为 人工智能 、 图像处理 作者 单位 ： 浙江大学 人工智能 研究所 　 CADCG 国家 重点 实验室 　 杭州 　 参考文献 　 李 最雄 石窟 保护 论文集 兰州 ： 甘肃 民族出版社 ， 　 　 LiZuixiongGrottoesConservationinChineseLanzhouGansuFolkPublisher 　 段文杰 敦煌 研究 文集 — — 石窟 保护 篇 兰州 ： 甘肃 民族出版社 ， 　 　 DuanWenjieDunhuangResearchinChineseLanzhouGansuFolkPublisher 　 LuDongmingLiXiangyangWeiBaogangetalColorrestorationtechniquesforfadedmuralofmogaogrottoInTheprocofthIntlConfonVirtualSystemsandMultimediaVSMMGifuJapan ～ 　 SchuemyerRPBarnerKEAcolorbasedclassifierforregionidentificationinvideoSPIE ～ 　 LiuJYangYHMultiresolutioncolorimagesegmentationIEEETransonPatternAnalysisandMachineIntelligence ～ 　 SaberETekalpAMBozdagiGFusionofcolorandedgeinformationforimprovedsegmentationandedgelinkingImageandVisionComputing ～ 　 魏宝刚 ， 李向阳 ， 鲁 东明 等 彩色图像 分割 研究进展 计算机科学 ， ， ～ 　 　 WeiBaogangLiXiangyangLuDongmingetalDevelopmentofcolorimagesegmentationComputerScienceinChinese ～ 原稿 收到 日期 ： ； 修改稿 收到 日期 ：