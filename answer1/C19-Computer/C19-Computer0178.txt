软件 学报 JOURNALOFSOFTWARE 　 Vol 　 No 　 P 宽带 IP 路由器 的 体系结构 分析 徐恪 　 熊勇强 　 吴建平 摘 　 要 ： 随着 宽带 技术 的 不断 发展 组建 主干网 的 路由器 必然 需要 以 千兆比特 以上 的 速率 转发 分组 而 基于 总线 和 中央处理器 的 路由器 具有 无法 克服 的 局限 这 就 对 传统 的 路由器 体系结构 提出 了 严峻 的 挑战 该文 全面 综述 了 近年来 在 宽带 IPInternetprotocol 路由器 方面 研究 的 最新进展 详细分析 了 用于 主干网 互连 的 宽带 IP 路由器 的 体系结构 设计 最后 指出 了 该 领域 中 需要 进一步 研究 的 问题 关键词 ： 宽带 IPInternetprotocol 路由器 体系结构 分类号 ： TPAnalysisofBroadbandIPRouterArchitectureXUKe 　 XIONGYongqiang 　 WUJianpingDepartmentofComputerScienceandTechnologyTsinghuaUniversityBeijingAbstract ： WiththeincreasingdevelopmentofbroadbandtechnologythespeedofpacketsforwardingneedstobeovergigabitspersecondforthebackboneroutersTraditionalroutershavesomeinsuperablebarriersandcannotsolvetheproblembasedonsharedbusandcentralprocessingunitItisagreatchallengeforthefuturerouterarchitectureInthisarticletheauthorssurveytherecentadvancesintheresearchofbroadbandIProuterandanalyzethearchitecturedesignofthefourthgenerationbackbonerouterindetailFinallysomechallengingopenproblemsareidentifiedKeywords ： BroadbandIPInternetprotocolrouterarchitecture ▲ 　 　 随着 Internet 的 飞速发展 和 宽带 技术 的 不断 出现 对 Internet 互连 的 核心 设备 — — 路由器 的 性能 提出 的 要求 越来越 高 传统 的 基于 总线 和 中央处理器 结构 的 路由器 由于 其 体系结构 上 的 局限 已经 无法 满足 组建 高速 主干 网络 的 需求 近年来 国际 上 对 宽带 IP 路由器 技术 的 研究 也 日益 活跃 提出 了 几种 不同 的 研究 和 设计 思路 ［ ］ 其 基本 思想 主要 包括 个 方面 （ ） 将 路由 引擎 （ routingengine ） 和 转发 引擎 （ forwardingengine ） 分开 将 局部 转 发表 从 全局 路由表 中 独立 出来 （ ） 用 快速 的 硬件 实现 IP 报文 的 报头 处理 、 寻径 和 转发 （ ） 用 多个 分布式 的 接口 单元 加 中央 控制器 的 模式 取代 中央处理器 加 接口卡 的 模式 （ ） 用 交换 结构 （ switchfabric ） 提高 各 接口 单元 之间 的 数据通信 速度 从 研究 趋势 来看 IP 路由 技术 的 发展 已经 和 交换 技术 以及 宽带 技术 的 发展 有机 地 结合 在 一起 本文 综述 了 目前 宽带 IP 路由器 所 采用 的 主要 的 体系结构 详细 讨论 了 其中 的 技术 难点 和 相应 的 解决方案 并 提出 了 进一步 的 发展 方向 　 　 本文 第节 分析 IP 路由器 的 种 主要 体系结构 第节 论述 宽带 IP 路由器 设计 中 存在 的 主要 问题 第节 讨论 了 当前 解决 这些 问题 的 主要 的 方案 第节 总结 了 全文 并 指出 了 进一步 的 研究 方向 IP 路由器 的 体系结构 分析 　 　 从 体系结构 来看 IP 路由器 经历 了 从 单 处理器 到 并行 处理器 、 从 共享 总线 到 交换 结构 的 发展 过程 我们 可以 把 它 划分 为 以下 种 类型 　 　 单 处理器 共享 总线 式 体系结构 这是 第代 路由器 主要 采用 的 体系结构 基于 单个 通用 CPU 使用 实时操作系统 （ 如图 a 所示 ） 采用 这种 体系结构 主要 是 考虑 到 网络协议 经常 发生变化 而 运行 多个 协议 的 路由器 不 可能 针对 某种 特定 的 协议 进行 优化 此时 连接 的 建立 和 管理 比高 转发 能力 更 重要 这种 体系结构 的 路由器 可以 使用 通用 计算机 来 实现 与 一般 的 通用 计算机 不同 的 是 它 具有 多块 网络 接口卡 网络 接口卡 之间 通过 系统总线 相连 到达 网络接口 的 报文 首先 被 送到 中央处理器 由 中央处理器 上 运行 的 路由 引擎 决定 下 一 跳 的 地址 并 把 它 送到 相应 的 输出 网络接口 上路 由 协议 和 其他 控制协议 均 在 中央处理器 上 实现 　 　 显然 这种 路由器 的 性能 主要 由 共享 总线 的 吞吐 率和主 CPU 转发 报文 的 速度 决定 由于 主 CPU 必须 执行 多个 实时 操作 因此 操作系统 的 选择 相当 重要 而 实时操作系统 的 设计 也 比较复杂 因此 这种 体系结构 的 可扩展性 （ scalability ） 比较 差 而且 很难 与 网络 接口卡 接口 速率 的 提高 相适应 　 　 多处理器 共享 总线 式 体系结构 在 第代 路由器 中 所有 的 路由 计算 都 在 中央处理器 上 进行 在 高速 和 动态变化 的 网络 环境 下 路由 计算 的 能力 将 制约 路由器 的 转发 速率 第 代 路由器 （ 如图 b 所示 ） 采用 的 多处理器 共享 总线 式 体系结构 的 路由器 把 转发 计算 分布 在 各个 处理器 上 从而 有效 地 解决 了 路由 计算能力 的 问题 　 　 在 多处理器 共享 总线 式 体系结构 中 网络 接口卡 具有 本地 的 快速 处理器 和 高速缓存 以及 具有 独立 处理 分组 的 能力 每个 连接 的 第个 包被 送到 主 CPU 的 路由 引擎 上 进行 处理 路由 引擎 在 得到 输出 接口卡 的 端口号 之后 将 其 传给 输入 网络 接口卡 输入 网络 接口卡 就 在 本地 高速缓存 中 增加 一个 表项 这样 该 连接 以后 的 分组 就 可以 直接 在 网络 接口卡 之间 交换 而 无需 再 经过 主 CPU 在 这种 结构 中路 由 计算 就 转换成 各 分布式 处理器 上 的 转发 计算 了 因此 转发 引擎 所 使用 的 高速缓存 表项 的 设计 就 必须 比较 精巧 我们 可以 为 每个 连接 建立 一项 转 发表 项 （ oneforwardingitemperconnection 简称 OFIPC ） 也 可以 每条 路由 建立 一项 oneforwardingitemperroute 简称 OFIPR 如果 采用 OFIPR 即使 连接数 非常 多 高速缓存 表项 也 不会 太 大 　 　 这种 体系结构 的 主要 问题 是 共享 总线 的 容量 限制 共享 总线 的 容量 直接 限制 了 路由器 的 吞吐 率 成为 系统 无法 避免 的 瓶颈 另 一个 问题 是 这种 体系结构 很 难用 在 主干 网络 路由器 上 由于 主干 网络 路由器 往往 具有 很 高 的 包转发 速度 因此 在 网络 接口卡 上 的 路由 一般 不 具有 局部性 在 这种 情况 下 网络 接口卡 上 的 高速缓存 很难 发挥作用 也 就 很 难 减轻 主 CPU 的 负担 为了 解决 这一 问题 可以 在 每个 网络 接口卡 上 都 存放 完整 的 路由表 这样 可以 进一步 增强 这种 路由器 的 能力 　 　 多处理器 交换式 体系结构 为了 解决 第 代 路由器 中 的 系统总线 瓶颈 问题 人们 提出 了 多处理器 交换式 体系结构 （ 如图 c 所示 ） 在 这种 体系结构 中 第类 结构 中 的 系统总线 被 交换 结构 所 代替 交换 结构 可以 提供 比 共享 总线 高得 多 的 带宽 足以 支持 现有 的 高速 网络接口 　 　 旧 的 问题 解决 了 新 的 问题 又 随之而来 在 这种 路由器 中 每个 报文 的 处理 成 了 新 的 瓶颈 为了 提高 报文 处理 的 速度 人们 又 提出 了 新 的 体系结构 　 　 共享 并行 处理器 交换式 体系结构 在 文献 ［ ］ 中 提出 了 并行 报文 处理 的 方法 使用 这种 方法 可以 极大 地 加快 报文 处理速度 该 方法 的 基本 设计 思想 基于 如下 考虑 一般来说 不 可能 出现 所有 的 网络接口 同时 阻塞 的 情况 因此 可以 通过 共享 转发 引擎 来 提高 路由器 的 端口 密度 这种 体系结构 如图 d 所示 Fig 　 Thearchitecturesoffourkindsofprincipalrouters 图 　 种 典型 的 路由器 体系结构 　 　 在 如图 d 所示 的 体系结构 中 转发 引擎 只 负责 查找 下 一 地址 在 找到 下 一 地址 后 将 其 送给 网络 接口卡 这样 网络 接口卡 就 可以 直接 把 后继 的 报文 送交 输出 接口 需要 注意 的 是 这里 只 需要 把 报文 的 头部 送交 转发 引擎 这样 做 可以 减少 互连 结构 上 不必要 的 报文 传输 负载 报 文体 只 在 接口卡 之间 传递 　 　 在 这种 体系结构 中 只要 有 足够 的 转发 引擎 就 可以 使 路由器 具备 高速 主干 网络 需要 的 转发 能力 使用 这种 体系结构 是因为 单一 的 转发 引擎 没有 足够 的 能力 处理 所有 的 网络 接口卡 的 突发性 的 传输 请求 因此 需要 在 多个 网络 接口卡 之间 共享 多个 转发 引擎 　 　 从 物理 上 来说 转发 引擎 既 可以 和 网络 接口卡 做 在 一起 也 可以 相互 独立 如果 转发 引擎 在 物理 上 是 独立 的 部分 那么 通过 调整 转发 引擎 和 网络 接口卡 的 比例 就 可以 增大 或者 减少 包转发 率 文献 ［ ］ 中 讨论 的 Gb 的 IP 路由器 就 使用 了 这种 方案 但是 把 转发 引擎 和 网络 接口卡 分开 会 给 交换 结构 带来 额外 的 负担 而且 在 多个 转发 引擎 之间 还 需要 使用 负载平衡 机制 因此 也 有 的 设计方案 把 网络 接口卡 和 转发 引擎 集成 在 一起 如 NetStar 公司 的 GigaRouter ［ ］ 在 这种 方案 中 转发 引擎 不 在 所有 的 网络 接口卡 之间 共享 而是 每个 网络 接口卡 都 具有 一个 转发 引擎 实际上 这种 体系结构 就是 多处理机 交换式 体系结构 使用 这种 体系结构 必须 保证 单个 的 转发 引擎 能够 满足 网络 接口卡 的 突发性 的 传送 请求 宽带 IP 路由器 设计 中 的 主要 问题 　 　 目前 的 宽带 IP 路由器 主要 采用 第节 中 提到 的 第种 和 第种 体系结构 下面 我们 将 主要 讨论 这 两种 体系结构 的 路由器 的 设计 问题 　 　 在 宽带 IP 路由器 中 可能 的 系统 瓶颈 有 两处 一处 是 报文 的 转发 在 共享 总线 式 的 结构 中 这 是 系统 的 主要 瓶颈 在 交换式 结构 中 由于 交换 结构 的 带宽 很 高 报文 转发 不再 是 系统 的 主要 瓶颈 另 一处 是 报文 的 路由 即 在 转 发表 （ 也 称为 路由表 ） 中 查找 路由 当 一个 报文 到达 时 路由器 必须 根据 其 目的 地址 在 转 发表 中 查找 目的 端口号 一般来说 转 发表 按照 如下 的 形式 保存 路由 项 〈 目的 网络地址 掩码 逻辑 端口号 〉 当 接受 到 目的 地址 为 A 的 报文 时 输入 端口 将会 遍历 转 发表 使用 掩码 和 A 进行 与 操作 如果 结果 和 相应 的 网络地址 一样 该 端口 就 成为 候选 端口 之一 最后 选择 的 端口 将 是 所有 候选 端口 中 相应 的 掩码 最长 的 端口 这 被 称为 最长 前缀 匹配 （ thelongestprefixmatch ） 举例来说 如果 一台 路由器 的 路由表 中有 如下 项 〈 〉 〈 〉 〈 〉 那么 一个 目的 地址 为 的 报文 将会 同时 匹配 前 两项 由于 端口 对应 的 路由表 项 的 掩码 最长 因此 该报 文 的 目的 端口 应该 是 端口 　 　 从 这个 例子 中 可以 看出 高效 的 路由表 查找 是 相当 困难 的 首先 主干 路由器 上 路由表 包括 上万条 表项 （ 一个 典型 的 值 是 K 路由表 项 ） 如果 顺序 查找 其 效率 将 非常低 为了 尽可能 提高 路由 速度 我们 必须 尽可能减少 路由 查找 的 时间 其次 一个 报文 可能 会 同时 匹配 多个 路由表 项 我们 必须 在 这 多个 路由表 项中 寻找 最长 的 匹配 前面 也 提到 过 在 主干 网络 上 使用 路由表 高速缓存 并 不会 提高 路由表 查找 的 速度 因此 我们 还 需要 使用 新 的 方法 来 提高 路由表 的 查找 速度 　 　 根据 输入输出 端口 和 交换 结构 的 相对速度 的 不同 宽带 IP 路由器 可以 分成 输入 排队 的 （ inputqueued ） 和 输出 排队 的 （ outputqueued ） 路由器 如果 交换 结构 的 带宽 大于 所有 的 输入 端口 的 带宽 的 总和 那么 报文 就 只 在 输出 端口 排队 这种 路由器 被 称为 输出 排队 的 路由器 否则 报文 就 会 在 输入 排队 这种 路由器 就 被 称为 输入 排队 的 路由器 　 　 输入 排队 的 路由器 和 输出 排队 的 路由器 都 有 路由 查找 的 瓶颈 除此之外 它们 各自 还 具有 自己 特有 的 性能 瓶颈 由于 在 输出 排队 的 路由器 中 所有 的 报文 都 在 输出 端口 的 缓冲区 排队 而 输出 端口 缓冲区 的 存取速度 是 受 动态 存储器 和 静态 存储器 的 访问 时间 限制 的 这 最终 将会 限制 输出 排队 路由器 的 性能 那么 我们 如果 把 所有 的 队列 都 放到 输入 一端 又 如何 呢 ？ 如果 这样 做 就 需要 由 仲裁 器来 解决 交换 结构 和 输出 线 之间 的 竞争 问题 但是 设计 一个 高速 而 公平 的 仲裁 器是 相当 困难 的 ［ ］ 主要 问题 的 解决方案 　 　 本节 将 结合 近年来 在 宽带 IP 路由器 研究 和 设计 中 取得 的 新进展 来 阐述 如何 解决 第节 中 提到 的 几个 主要 问题 高效 的 路由表 查找 　 　 在 第节 中 我们 已经 提到 在 使用 交换式 结构 的 宽带 IP 路由器 中 主要 的 性能 瓶颈 就是 在 路由表 中 查找 与 到达 报文 的 目的 地址 相匹配 的 最长 前缀 的 路由 我们 知道 路由表 查找 的 速度 是 由 查找 时 需要 访问 内存 的 次数 和 内存 的 速度 共同 决定 的 例如 一种 算法 需要 执行 次 内存 访问 而 每次 内存 访问 的 时间 是 ns 那么 查找 一次 路由 的 时间 就是 ns 也就是说 每秒 可以 执行 大约 万次 路由 查找 使用 相同 的 算法 如果 使用 访问速度 为 ns 的 内存 那么 每秒 就 大约 可以 执行 万次 路由 查找 　 　 在 设计 路由表 查找 算法 时 需要 考虑 的 另 一个 问题 是 路由表 的 修改 最近 的 研究 表明 路由表 的 变化 是 比较慢 的 大约 只 需要 每 两分钟 更新 一次 ［ ］ 这 就 允许 我们 使用 比较复杂 的 数据结构 来 提高 查找 速度 而 付出 的 代价 是 修改 路由表 需要 更 多 的 时间 　 　 常见 的 保存 路由表 的 数据结构 是 树 在 树中 每条 从 根 节点 到 叶子 节点 的 路径 就 对应 着 路由表 中 的 一项 这样 寻找 最长 的 前缀 就 转化 成为 寻找 最长 的 路径 ［ ］ 一般来说 基于 树 的 算法 从树 的 根 节点 开始 使用 目的 地址 中 的 下 若干位 来 匹配 当前 节点 的 子 节点 直到 找到 一个 匹配 为止 因此 在 最坏 情况 下 查找 路由表 所 花费 的 时间 和 找到 的 最长 前缀 匹配 的 长度 成正比 基于 树 的 算法 的 主要 思想 是 大多数 节点 只 需要 保存 很少 的 子 节点 而 不用 保存 所有 可能 的 值 这类 算法 节约 了 内存 付出 的 代价 是 需要 进行 更 多次 的 内存 查找 随着 内存价格 的 下降 这种 设计 方法 已经 越来越 不 常用 了 　 　 提高 路由表 查找 性能 的 方法 有 多种 我们 可以 把 它们 分成 以下 类 　 　 基于 硬件 的 技术 　 　 常用 的 基于 硬件 的 技术 使用 相联 存储器 （ contentaddressablememories ） 和 高速缓存 来 提高 查找 速度 这 两种 技术 都 很 难 随着 路由表 的 变化 而 扩展 因此 不能 用 在 需要 使用 大 路由表 的 主干 路由器 上 近来 研究 人员 提出 的 基于 硬件 的 策略 把 内存 和 逻辑 集成 到 一块 芯片 中 这样 可以 极大 地 减少 内存 访问 时间 　 　 第种 基于 硬件 的 技术 是 通过 增大 使用 的 内存 来 存储 路由表 通过 空间 换取 时间 文献 ［ ］ 提出 了 一种 方案 使用 M 的 内存 来 保存 路由表 达到 的 性能 是 在 多数 情况 下 只 需要 查找 一次 路由表 就 可以 得到 目的 端口 在 最坏 的 情况 下 也 只 需要 查找 两次 路由表 通过 使用 一些 优化 技术 可以 把 内存 的 使用量 降到 M 相应 的 最坏 查找时间 就 会 变成 次 内存 访问 时间 该 方案 的 基本 思想 是 把 位 的 目的 地址 分成 两 部分 前位 是 一部分 后位 是 另 一部分 使用 前位 作为 地址 直接 查找 路由表 如果 目的 地址 的 路由 长度 小于 位则 会 在 一次 内存 访问 时间 内 查找 到 目的 端口 如果 目的 地址 的 路由 长度 大于 位则 在 路由表 的 相应 位置 会 得到 一个 索引 值 利用 该 索引 值 和 目的 地址 的 最后 位 作为 地址 去 查找 另 一个 存储器 这样 在 最坏 的 情况 下 也 只 需要 读 两次 内存 该 方案 的 核心思想 就是 把 路由表 分散 保存 例如 条 〈 〉 的 路由 将 在 路由表 中 占据 从 地址 开始 的 连续 的 项 这样 做 虽然 提高 了 路由表 的 查找 速度 但 却 带来 了 路由表 更新 的 不便 条 路由 的 改变 就 需要 更新 大量 的 路由表 项 于是 为了 提高 更新 的 速度 在 文献 ［ ］ 中 提出 了 相应 的 解决方案 　 　 表 紧缩 技术 　 　 表 紧缩 技术 ［ ］ 是 使用 复杂 但是 紧缩 的 数据结构 来 保存 路由表 这样 路由表 就 可以 放在 处理器 的 第级 高速缓存 中 这种 方案 可以 支持 千兆比特 速率 的 路由表 查找 使用 文献 ［ ］ 中 提出 的 数据结构 可以 把 具有 条 路由 的 路由表 压缩 到 只有 K 字节 　 　 哈希 表 技术 　 　 哈希 表 技术 也 可以 用于 路由表 查找 寻找 最长 前缀 匹配 的 需求 限制 了 哈希 表 技术 的 使用 在 实际 使用 中 我们 并不知道 一个 目的 地址 对应 的 最长 前缀 匹配 是 多长 解决 这一 问题 的 方法 是 尝试 不同 长度 的 掩码 从中 选择 最长 的 匹配 掩码 的 选择 既 可以 使用 迭代 方式 也 可以 使用 层次 方式 还 可以 使用 地址 的 前 几位 指向 一个 前缀 长度 列表 但是 这些 方案 的 可扩展性 都 很 差 　 　 文献 ［ ］ 提出 了 一种 可 扩展 的 基于 哈希 表 的 查找 算法 该 算法 查找 n 位 地址 的 最长 前缀 匹配 的 步骤 为 Ologn 该 算法 对于 每种 长度 的 前缀 都 使用 一个 单独 的 哈希 表 查找 时 并 不是 从 最长 的 前缀 开始 而是 根据 前缀 长度 执行 折半 查找 为了 能够 执行 折半 查找 就 需要 哈希 表 包含 标记 字 段 标记 字 段 用于 指出 当 查找 失败 时 是 到 长度 更大 的 表中 查找 还是 到 长度 小 一些 的 表中 查找 此外 文献 ［ ］ 还 采用 了 相应 的 技术 来 减少 标记 字段 的 存储空间 该 算法 可以 比较 容易 地 扩展 到 IPv 高速 的 报文 转发 　 　 交换 结构 是 宽带 IP 路由器 中 的 关键 部分 是 解决 高速 报文 转发 的 主要 方式 它 的 性能 直接 决定 了 路由器 的 性能 交换 结构 一般 可以 采用 交叉开关 和 共享内存 两种 方式 来 实现 交叉开关 的 速度 受 调度 器 的 限制 而 共享内存 的 速度 受 内存 访问速度 的 限制 Cisco 公司 推出 的 高端 路由器 GSR 系列 使用 了 交叉开关 作为 交换 结构 ［ ］ 而 Juniper 公司 推出 的 主干网 路由器 JuniperM 则 使用 了 共享内存 作为 交换 结构 ［ ］ 交叉开关 和 共享内存 都 能够 达到 比较 高 的 吞吐 率 即 都 能够 达到 每秒 Gbps （ 当 配置 块 OC 线路 接口卡 时 ） 以上 的 吞吐 率 共享内存 的 特点 是 实现 简单 也 能 达到 比较 高 的 吞吐 率 但是 其 性能 的 进一步提高 将 受到 内存 访问 速率 的 限制 而且 其 可扩展性 比较 差当 线路 接口卡 数量 较多时 性能 将 受到 一定 的 影响 而 交叉开关 能够 达到 比较 高 的 速率 扩展性 好 但是 需要 设计 完善 的 调度 算法 并用 高速 硬件 实现 调度 器 随着 人们 对 交叉开关 调度 算法 研究 的 深入 已经 设计 并 实现 了 许多 性能 良好 、 实现 简单 的 调度 算法 因此 目前 宽带 IP 路由器 都 趋向于 使用 交叉开关 作为 交换 结构 下面 我们 将 重点 讨论 交叉开关 的 设计 与 实现 　 　 使用 交叉开关 主要 基于 如下 的 考虑 首先 交叉开关 可以 在 网络 接口卡 之间 建立 点到点 的 连接 这 就 意味着 网络 接口卡 之间 可以 高速 传递数据 目前 在 商用 产品 中 芯片 到 芯片 的 线路 速度 已经 可以 达到 Gbs 在 实验室 中 已经 可以 达到 ～ Gbs 其次 交叉开关 可以 同时 提供 多路 传送 只要 源 和 目的地 不 冲突 就 可以 同时 传送 这样 可以 极大 地 增加 带宽 　 　 在 使用 交叉开关 时 需要 把 报文 变成 定长 的 分组 在 使用 定长 的 分组 时 可以 根据 分组 的 大小 划分 时间 片 根据 时间 片 一步 一步 地 处理 如果 使用 变长 的 分组 那么 分组 通过 交叉开关 的 时间 就是 随机 的 调度 器 就 必须 知道 所有 输入 和 输出 的 状态 这使 调度 器 的 设计 相当 复杂 而且 很难 做到 公平 调度 　 　 在 使用 交叉开关 时 需要 解决 以下 几个 主要 问题 阻塞 问题 　 　 当 使用 交叉开关 作为 交换 结构 时 可能 会 遇到 以下 种 阻塞 　 　 第种 是 线路 头部 阻塞 如果 输入 端口 等待 交换 的 分组 都 使用 一个 队列 排队 就 会 出现 线路 头部 阻塞 问题 举例来说 如果 队列 头部 的 分组 要 去 的 端口 正 忙 那么 此 分组 只能 在 队列 中 等待 这时 即使 它 后面 的 分组 要 去 的 端口 是 空闲 的 也 没有 机会 发送 这种 阻塞 会 极大 地 降低 交叉开关 的 流量 在 文献 ［ ］ 中 提出 了 一种 称为 虚拟 输出 队列 （ virtualoutputqueuing 简称 VOQ ） 的 机制 来 解决 线路 头部 阻塞 问题 思路 是 假设 系统 中有 n 个 输入 端口 和 n 个 输出 端口 那么 每个 输入 端口 都 有 n 个 队列 分别 对应 每个 输出 端口 这样 若 一个 输出 端口 发生 阻塞 对 其他 的 输出 端口 不会 产生 影响 当然 在 实际 输出 时 每个 端口 只 对应 于 交叉开关 中 的 一条线 因此 称之为 虚拟 输出 队列 　 　 第种 是 输入 阻塞 由于 虚拟 输出 队列 对应 的 交叉开关 的 线 只有 条 因此 每次 只能 交换 一个 分组 当 虚拟 输出 队列 中有 多个 分组 时 得不到 交换 机会 的 队列 头部 分组 就 处于 输入 阻塞状态 输入 阻塞 不 影响 交叉开关 的 流量 只会 增大 被 阻塞 的 分组 的 延迟 　 　 第种 是 输出 阻塞 如果 两个 输入 端口 的 分组 都 要 去 同一个 输出 端口 就 会 发生 输出 阻塞 这种 阻塞 和 输入 阻塞 一样 不会 影响 交叉开关 的 流量 只 增大 被 阻塞 的 分组 的 延迟 以 解决 输入 阻塞 和 输出 阻塞 在 文献 ［ ］ 中 提出 了 两种 解决方案 第带 优先级 的 虚拟 输出 队列 给 每个 输出 队列 划分 个 优先级 相应 的 输出 队列 也 就 变成 条高 优先级 的 分组 优先 发送 这种 方案 并 不能 完全 解决 输入 阻塞 问题 比如 优先级 相同 的 分组 之间 还是 有 阻塞 但是 它 可以 保证 高 优先级 的 分组 的 延迟 比较 小 第 加快 交叉开关 的 交换 速度 如果 交叉开关 的 交换 速度 是 端口 速度 的 两倍 那么 相对 于 端口 来说 交叉开关 能够 一次 交换 两个 分组 从 理论 上 说 如果 有 n 个 输入 端口 和 n 个 输出 端口 那么 交叉开关 的 速度 必须 是 端口 速度 的 n 倍 才能 保证 没有 输出 阻塞 文献 ［ ］ 指出 在 实际 使用 中 只要 交叉开关 的 速度 是 端口 速度 的 两倍 就 可以 基本 保证 不 出现 输出 阻塞 调度 算法 　 　 交叉开关 的 另 一个 重要 问题 就是 调度 算法 调度 算法 设计 的 基本 要求 是 　 　 效率高 高效率 的 调度 算法 应该 能够 同时 匹配 尽可能 多 的 输入 队列 一般来说 使用 硬件 很难 快速 计算 出 最佳 匹配 因此 一般 在 设计 调度 算法 时 总是 尽力 寻找 次优 的 算法 　 　 稳定性 无论 输入 队列 的 情况 如何 调度 算法 都 应该 迅速 找到 可行 的 调度 　 　 不会 出现 某些 队列 永远 得不到 响应 的 情况 　 　 快速 调度 算法 必须 快速 执行 否则 将会 抵消 交叉开关 带来 的 带宽 的 增加 　 　 易于 实现 调度 算法 应该 易于 用 硬件 实现 实现 的 复杂性 包括 调度 器 维护 的 状态 的 数量 基于 这些 状态 作出 决策 的 逻辑 的 复杂度 和 修改 状态 时 的 通信 开销 　 　 调度 算法 可以 分成 输入 排队 的 调度 算法 和 输出 排队 的 调度 算法 长期以来 人们 一直 认为 输入 排队 的 调度 算法 性能 比较 差 因而 对 输出 排队 的 调度 算法 进行 了 大量 的 研究 ［ ～ ］ 但是 输出 排队 的 调度 算法 要求 输出 端的 接口 速率 是 输入 端的 N 倍 （ N 是 端口 数量 ） 否则 就 会 出现 大量 丢包 的 情况 随着 输入 端口 速度 的 不断 提高 和 输入 端口 数量 的 增多 输出 排队 的 调度 算法 已经 不能 满足 高速 交叉开关 的 要求 因此 研究 人员 又 重新 把 注意力 集中 到 了 输入 排队 的 调度 算法 上 　 　 在 文献 ［ ］ 中 提出 了 一种 输入 排队 的 称为 iSLIP （ iterativeroundrobinmatchingwithSLIP ） 的 交叉开关 调度 算法 该 算法 是 一个 简单 的 循环 算法 每次 循环 建立 一个 或 多个 输入 到 输出 的 连接 为止 直到 建立 所有 可能 的 连接 为止 然后 同时 传送 每次 循环 分成 步 第步 是 输入 端 向 输出 端 提出 请求 第步 是 每个 输出 端 在 所有 的 请求 中 选择 优先级 最高 的 进行 回应 第步 是 每个 输入 端 从 可能 的 多个 回应 中 选择 优先级 最高 的 建立 连接 为了 保证 公平 调度 使用 了 优先级 轮转 机制 为了 能够 处理 多播 传送 文献 ［ ］ 把 iSLIP 算法 扩展 成 可以 支持 多播 的 ESLIP （ extendedSLIP ） ［ ］ 该 算法 原理 简单 易于 用 硬件 实现 而且 具有 很 好 的 性能 ［ ］ Cisco 公司 推出 的 高端 路由器 GSR 系列 中 的 交叉开关 调度 算法 就 采用 了 iSLIP 和 ESLIP 　 　 调度 算法 的 进一步 的 研究 方向 是 提供 对 服务质量 QoS （ qualityofservice ） 的 支持 在 文献 ［ ］ 中 提出 了 一种 结合 输入 、 输出 排队 的 交换 结构 CIOQ （ combinedinputoutputqueuing ） 并 提出 了 若干 调度 算法 该 交换 结构 能够 在 保证 高 分组 交换 率 的 同时 提供 服务质量 支持 该 交换 结构 的 加速 比为 在 文献 ［ ］ 中 对 输入 排队 的 交换 结构 的 服务质量 支持 进行 了 研究 并 提出 了 几种 线性 复杂性 且 不 需要 加速 比 的 调度 算法 如何 基于 流 进行 支持 服务质量 的 调度 将 是 调度 算法 的 进一步 的 研究 方向 高性能 的 实时 路由器 操作系统 　 　 以前 的 路由器 操作系统 一般 都 是 一个 简单 的 内核 提供 基本 的 服务 原语 随着 网络协议 的 不断 发展 对 路由器 操作系统 的 要求 也 越来越 高 路由器 操作系统 需要 能够 支持 路由 协议 的 高性能 的 执行 需要 能够 允许 上层 协议 软件 的 动态 升级 这 就 需要 一种 高性能 的 、 模块化 的 、 可 扩展 的 操作系统 来 支持 　 　 文献 ［ ］ 提出 了 基于 plugin 的 路由器 操作系统 体系结构 在 该 体系结构 中上层 协议 软件 可以 作为 plugin 动态 加载 到 操作系统 内核 中 执行 以 获得 高性能 和 高 可扩展性 文献 ［ ］ 根据 此 体系结构 构造 了 一个 扩展 的 集成 服务 路由器 　 　 这种 方式 的 一个 极端 就是 主动 网络 （ activenetwork ） 在 主动 网络 中 可以 通过 网络 分组 给 路由器 安装 协议 软件 ［ ］ 但是 这种 方式 给 整个 网络 带来 了 很大 的 安全隐患 能否 取得 很 好 的 效果 还 有待于 进一步 研究 总结 　 　 随着 计算机网络 互联 规模 的 不断扩大 对 主干 网络 路由器 的 性能 提出 的 要求 越来越 高 本文 综述 了 近年来 国内外 在 宽带 IP 路由器 研究 领域 取得 的 新进展 随着 网络 技术 的 发展 我们 必须 致力于 研究 自主 版权 的 宽带 IP 路由器 在 国家 “ 九五 ” 规划 期间 清华大学 计算机科学 与 技术 系 设计 和 开发 了 性能 超过 Cisco 公司 系列 路由器 的 高性能 路由器 ［ ］ 为 进一步 的 研究 打下 了 良好 的 基础 在 高速 宽带 IP 路由器 领域 中 需要 进一步 研究 的 问题 有 　 　 如何 支持 流 标识 流是 在 一段时间 内 从 某个 源地址 到 某个 目的 地址 的 连续 的 报文 流 可能 是 一个 连续 的 TCP 连接 发送 的 报文 也 可能 是 网络 会议 中 的 UDP （ userdatagramprotocol ） 报文 通过 定义 流 可以 优化 资源 的 使用 比如 高速缓存 表项 在 标识 流 时 需要 使用 分类 算法 而 前面 讨论 的 高速路 由 算法 都 很 难 被 修改 成 分类 算法 目前 还 缺乏 通用 而 有效 的 流 描述 这些 还 都 需要 进行 进一步 的 研究 　 　 如何 支持 资源 预留 Internet 对 资源 预留 的 支持 很 弱 无论是 局域网 路由器 、 广域网 路由器 还是 宽带 IP 路由器 采用 的 都 是 尽力 传送 机制 不 支持 优先级 随着 网络应用 的 发展 人们 对 网络 的 服务质量 QoS 提出 的 要求 越来越 高 为了 支持 服务质量 的 要求 需要 路由器 支持 资源 预留 支持 资源 预留 首先 要 解决 上面 提到 的 流 标识 问题 在 流 标识 的 基础 上 还 需要 实现 灵活 而 通用 的 调度 和 缓冲区 管理 算法 支持 服务质量 的 交换 结构 和 有效 的 流 隔离 机制 　 　 高效率 的 路由器 操作系统 以前 的 路由器 往往 被 看成 是 转发 IP 分组 的 硬件 设备 因此 以往 的 路由器 操作系统 往往 功能 很少 而且 一般 都 不 提供 应用 编程 接口 API （ applicationprogramminginterface ） 随着 网络应用 的 发展 端 用户 和 网络管理员 越来越 需要 动态 地往 路由器 中 加载 软件 模块 以 提供 防火墙 、 流量 管理 等 机制 这 就 要求 路由器 操作系统 能够 提供 一个 灵活 的 、 高效率 的 机制 来 支持 这种 应用 需求 ■ 基金项目 ： 本文 研究 得到 国家自然科学基金 No ． 和 国家 “ 九五 ” 科技攻关 　 　 　 　 　 项目 基金 资助 ． 作者简介 ： 徐恪 ， 年生 ， 博士生 ， 主要 研究 领域 为 计算机 网络体系结构 ， 计算机系统 性能 评 　 　 　 　 　 价 。 　 　 　 　 　 熊勇强 年生 博士生 主要 研究 领域 为 计算机 网络体系结构 网络安全 技术 　 　 　 　 　 吴建平 年生 博士 教授 博士生 导师 主要 研究 领域 为 计算机 网络体系结构 网络 　 　 　 　 　 协议 测试 作者 单位 ： 徐恪 清华大学 计算机科学 与 技术 系 　 北京 　 　 　 　 　 　 熊勇强 清华大学 计算机科学 与 技术 系 　 北京 　 　 　 　 　 　 吴建平 清华大学 计算机科学 与 技术 系 　 北京 　 参考文献 ： ［ ］ AsthanaADelhpSJagdishHetalDesignofaGigabitIPRouterTechnicalReportTMATTBellLaboratorys ［ ］ AsthanaADelhpSJagdishHetalTowardsagigabitIProuterJournalofHighSpeedNetworks ～ ［ ］ PartidgeCCarveyPPBurgessEetalAGbsIProuterIEEETransactionsonNetworking ～ ［ ］ KachelmeyerDANewRouterArchitectureforTomorrowsInternetNetStarInchttpwwwnetstarcom ［ ］ McKeownNSchedulingalgorithmsforinputqueuedcellswitchs ［ PhDThesis ］ BerkeleyCAUniversityofCalifornia ［ ］ McKeownNAnantharamVWalrandJAchievingthroughputinaninputqueuedswitchInToshiharuHasegawaPickholtzRLedsProceedingsoftheIEEEINFOCOMSanFranciscoCAIEEEComputerSocietyPress ～ ［ ］ LabovitzCMalanGRJahanianFInternetroutinginstabilityACMComputerCommunicationReview ～ ［ ］ StevensWRTCPIPIllustratedVolMAAddisonWesley ～ ［ ］ GuptaPLinSMcKeownNRoutinglookupsinhardwareatmemoryaccessspeedsInGuerinRedProceedingsoftheIEEEINFOCOMSanFranciscoCAIEEEComputerSocietyPress ～ ［ ］ BrodnikACarlssonSDegermarkMetalSmallforwardingtablesforfastroutelookupsACMComputerCommunicationReview ～ ［ ］ WaldvogelMTurnerJPlattnerBScalablehighspeedIProutinglookupsACMComputerCommunicationReview ～ ［ ］ McKeownNFastSwitchedBackplaneforaGigabitSwitchedRouterWhitePaperhttpwwwciscocom ［ ］ SemeriaCInternetBackboneRoutersandEvolvingInternetDesignWhitePaperhttpwwwjunipercom ［ ］ MekkittikulAMcKeownNPracticalschedulingalgorithmtoachievethroughputininputqueuedswitchesInGuerinRedProceedingsoftheIEEEINFOCOMSanFranciscoCAIEEEComputerSocietyPress ～ ［ ］ KellyEffectivebandwidthsatmulticlassqueuesQueuingSystemsTheoryandApplications ～ ［ ］ KeshavSAnefficientimplementationoffairqueuingInternetworkingResearchandExperience ～ ［ ］ KesidisGWalrandJChangCEffectivebandwidthsformulticlassMarkovfluidsandotherATMsourcesIEEEACMTransactionsonNetworking ～ ［ ］ McKeownNIzzardMMekkittikulAetalTinyTeraapacketswitchcoreIEEEMicro ～ ［ ］ ShangTseChuangetalMatchingoutputqueuingwithacombinedinputoutputqueuedswitchIEEEJournalonSelectedAreasinCommunications ～ ［ ］ AnthonyCKSiuKaiyeungLinearcomplexityalgorithmsforQoSsupportininputqueuedswitcheswithnospeedupIEEEJournalonSelectedAreasinCommunications ～ ［ ］ DecasperDPlattnerBParulkarGMetalScalablehighperformanceactivenetworknodeIEEENetwork ～ ［ ］ AlexanderDSShawMNettlesSMetalActivebridgingACMComputerCommunicationReview ～ ［ ］ FanXiaoboLinChuangWuJianpingetalPerformancemodelandanalysisofadistributedrouterChineseJournalofComputers ～ 范晓勃林 闯 吴建平 等 分布式 路由器 的 性能 模型 与 分析 计算机 学报 ～ 收稿 日期 ： 修稿 日期 ：