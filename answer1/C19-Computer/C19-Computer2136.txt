计算机 应用 研究 APPLICATIONRESERCHOFCOMPUTERSVol 　 No 　 P 通用 串行总线 及其 应用 王省 书 秦石乔 邵福球 摘要 随着 通用 串行总线 USB 的 接口 集成 到 PC 主板 上及 Windows 等 操作系统 全面 支持 USB 技术标准 ， USB 的 应用 正 得到 突飞猛进 的 发展 。 介绍 了 目前 在 进行 PC机 功能 扩展 时 存在 的 问题 、 USB 的 性能 、 发展趋势 及 USB 在 计算机 外设 、 虚拟仪器 和 工业 测控 领域 中 的 应用 。 关键词 通用 串行总线 USB 设备 虚拟仪器 测控 系统 　 引言 　 　 信息 革命 是 本世纪 末期 的 主要 特征 ， PC 在 信息 革命 中 起到 推波助澜 的 作用 。 PC 外设 的 日益 丰富 ， 扩展 了 PC 的 应用 范围 。 PC 在 军事 、 工业生产 、 教学科研 和 日常生活 中 的 应用 日益 普及 和 深入 ， 因 PC 本身 只 提供 高性能 的 运算 处理 等 方面 的 基本 能力 ， 当 我们 将 一台 PC 应用 于 某个 具体 实际 需要 时 ， 往往 面临 着 对 PC 基本功能 进行 扩展 的 难题 。 在 对 PC 进行 功能 扩展 时 ， 原则上 每 一个 外设 必须 插 在 一个 接口 上 ， 如果 所有 的 接口 均 被 用 上 了 就 只能 通过 添加 插卡 来 追加 接口 了 ， 当然 机器 内部 可增 插卡 的 数量 还 受到 计算机 上 插槽 个数 的 限制 ， 多功能 卡 的 出现 以及 有些 厂家 针对 自己 的 产品线 开发 的 自家 适用 的 通用 接口 ， 在 很大 程度 上 是 为了 解决 多种 设备 连接 到 主机 及 提高 传输速率 而 出现 的 解决方案 。 由于 PC 的 标准接口 有限 ， 因此 目前 对 PC 进行 功能 扩展 的 一种 常用 方法 是 通过 增加 功能 接口 插卡 来 实现 ， 但 扩展 时 必须 对 计算机 很 熟悉 ， 且 需 对 接口卡 的 硬件资源 IO 地址 、 内存 、 中断 、 DMA 进行 合理 的 配置 等 ， 扩展 难度 大 。 　 　 为了 解决 功能 扩展 接口 插卡 最 头痛 的 配置 问题 ， 九十年代 中期 推出 了 即插即用 接口卡 标准 PCI 和 ISAPnP ， 由 即插即用 BIOS 和 即插即用 操作系统 完成 对 接口卡 资源 的 自动 配置 ， 使 功能 扩展 接口卡 的 使用 变得 简单 方便 。 但 扩展 接口卡 仍 存在 以下 问题 ： 第一 、 接口卡 的 插拔 过程 必须 停机 ， 并且 需 打开 PC机 箱 进行 安装 和 拆卸 ， 这个 过程 仍 需要 一定 层次 的 技术支持 ， 即插即用 技术 的 采用 只是 降低 了 功能 扩展卡 的 技术 需要 程度 ， 这 对 PC 这样 广泛应用 的 工具 而言 仍显 不足 ； 第二 、 接口 插卡 设备 驱动程序 的 安装 、 调试 直至 正常 运行 的 过程 仍旧 需要 各种 技术 的 支持 ， 特别 是 接口 插卡 作为 一种 硬件 设备 插入 PC 后 ， 总是 要 占用 PC 的 各种 硬件资源 ， 即插即用 算法 虽能 解决 绝大部分 的 资源配置 ， 但 不能 保证 是 解决 ， 因此 ， 其 安装 和 配置 过程 仍 需要 人工干预 。 而 当 扩展 插卡 较多时 ， 常会 出现 一块 或 多块 插卡 因 无法 合理配置 而 不能 正常 工作 的 情况 ， 严重 时 可 导致系统 崩溃 ； 第三 、 接口 插卡 的 质量 高低 、 兼容性 和 标准 性 的 程度 以及 驱动 软件 的 可靠性 将 直接 影响 计算机 的 寿命 和 系统 的 稳定性 、 可靠性 ； 第四 、 对象 笔记本电脑 之类 的 小 体积 PC 很 难用 接口 插卡 进行 功能 扩展 ； 第五 、 PC 插槽 中 的 各种 接口卡 受到 PC 内部 强 的 射频 辐射 干扰 ， 使 其 性能 受到 很大 影响 ， 除非 接口卡 是 全 数字化 的 。 　 　 那么 当 把 外设 连接 到 PC 上 对 其 进行 功能 扩展 时 ， 能 不能 简单 到 用户 只 需拿起 外设 的 接线 ， 把 插线 插入 接口 中 就行了 呢 ？ 　 　 年 Intel 、 Compaq 、 Digital 、 IBM 、 Microsoft 、 NEC 、 NorthernTelecom 这些 世界 上 著名 的 计算机 公司 和 通讯 公司 成立 了 USB 论坛 ， 于 年 月 推出 了 USB 通用 串行总线 UniversalSerialBus 规范 ， 年 开始 有 真正 符合 USB 技术标准 的 外设 出现 。 USB 是 目前 推出 的 支持 USB 的 计算机 与 外设 上 普遍 采用 的 标准 。 在 年月日 的 Intel 开发者 论坛 大会 上 ， 介绍 了 USB 规范 。 USB 将 向下兼容 USB ， 数据 的 传输率 将 达到 MbpsMbps ， 预备 支持 宽带 宽 数字 摄像 设备 及 下一代 扫描仪 、 打印机 及 存储设备 。 预计 明年 下半年 将会 出现 符合 USB 规范 的 系统 和 外设 。 在 Microsoft 公司 与 Intel 公司 推出 的 PC 的 硬件 体系 规范 和 PC 的 软件 规范 都 包括 对 USB 的 支持 。 APPLE 公司 的 MACOS 及 Microsoft 公司 年 月 发布 的 Windows 、 年 月 发布 的 WindowsCE 全面 支持 USB 技术标准 ， 未来 的 Windows 中 也 将 全面 支持 USB 。 目前 国际 市场 上 销售 的 最新型 的 计算机 一般 都 带有 两个 USB 端口 。 　 　 USB 技术 的 提出 是 基于 采用 通用 连接 技术 实现 外设 的 简单 快速 连接 ， 达到 方便 用户 、 降低成本 、 扩展 PC机 连接 外设 的 范围 之 目的 ， 使 PC 的 功能 扩展 变得 非常简单 方便 ， 并且 能 最大 限度 地 降低 用户 对 计算机技术 的 需求 ， 使 所有 的 外设 均 成为 所谓 的 撋 倒 蠑 式 的 设备 。 USB 技术 具有 开放性 ， 是非 赢利性 的 规范 ， 得到 了 广泛 的 工业 支持 ， 在 数字 图象 、 电话 语音 合成 、 交互式 多媒体 、 消费 电子产品 等 应用领域 得到 了 广泛 的 应用 。 可以 预见 USB 将 成为 今后 PC 应用 的 主流 和 发展 的 必由之路 。 　 USB 概述 　 　 USB 系统 由 USB 主机 Host 、 集线器 HUB 、 连接 电缆 、 USB 外设 组成 。 USB 设备 的 具体 连接 方式 如图所示 。 图 　 USB 设备 的 连接 方式 　 　 集线器 HUB 是 为 多个 USB 外设 提供 接口 的 ， 它 以 主仆 的 方式 实施 外设 的 管理 。 集线器 可 由 自己 提供 电源 或 从 主机 获得 电源 。 通过 USB 集线器 ， USB 端口 非常容易 扩展 ， 真正 实现 多个 外设 共用 一个 接口 。 　 　 USB 技术 的 应用 是 计算机 外设 连接 技术 的 重大 变革 。 USB 接口标准 属于 中 低速 的 传输 界面 ， 面向 家庭 与 小型 办公 领域 的 中 低速 设备 ， 比如 键盘 ， 鼠标 、 游戏 杆 、 显示器 、 数字 音箱 、 数字相机 以及 Modem 等 ， 目的 是 在 统一 的 USB 接口 上 实现 中 低速 外设 的 通用 连接 。 USB 的 定义 借助 了 目前 所有 成熟 的 网络 技术 ， 并 在 此基础 上 进行 了 合理 的 简化 ， 以 达到 简单 实用 的 目的 和 最佳 的 性能 价格比 。 USB 是 一种 同步 串行 半双工 传输 总线 ， 目前 的 数据 传输率 最高 达 Mbps ， 比 标准 串口 快倍 ， 比 并 口 快 倍 ， 可 用于 更 多 的 新型 设备 ， 并 可 很 好 地 满足 视频 图象 的 实时 传输 要求 ； 采用 差分 传输方式 ， 具有 很 好 的 传输 可靠性 。 与 扩展 插卡 相比 ， USB 设备 不 占用 PC 的 硬件资源 如 IO 地址 、 内存 、 中断 、 DMA 等 ， 设备 的 控制 、 管理 和 信息 交换 完全 是 由 系统软件 按 USB 协议 进行 传输 ， 因此 ， 具有 更 高 的 可靠性 和 兼容性 ， 不 存在 因 设备 占用 资源 冲突 而 导致系统 的 紊乱 的 问题 。 为 适应 外设 的 多样性 ， USB 提供 了 四种 数据 传送 类型 ： 控制 、 中断 、 同步 和 块 传输 。 USB 的 所有 信息 按包 传送 ， 具有 满足 设备 各种 控制 管理 和 数据传输 的 多种 信息 包 格式 ， 包中 的 数据 有效载荷 可 达 字节 。 USB 允许 系统 自动 地 优化 外设 间 的 数据传输 ， 可以 对 未经 压缩 的 数字 图象 进行 实时 传送 ， 也 可以 实现 主机 与 外设 及 消费 电子产品 与 外设 间 像 数码相机 与 打印机 间 的 直接 数据 传送 。 　 　 理论 上 一个 USB 接口 可以 雏菊 链 的 方式 连接 种 外设 。 当 外设 的 电源 要求 为 V 且 电流 小于 mA 时 ， 可 直接 从 USB 总线 获取 电源 ， 这样 USB 设备 就 不再 需要 专门 的 电源线 ， 可以 降低 设备 的 成本 且 减少 了 连线 的 烦琐 程度 。 USB 允许 外部设备 的 快速 连接 ， 在 不用 关闭 计算机 的 情况 下 真正 支持 即插即用 ， 即 USB 设备 的 插拔 可以 在 PC 正常 工作 条件 下 进行 。 在 USB 系统 中 ， 设备 的 插拔 由 与 之 相连 的 Hub 自动检测 出来 ， 随后 告之 主机 总线 上 的 设备 的 变化 情况 。 如果 一旦 有 新 设备 连接 到 集线器 上 ， 主机 通过 像 Windows 或 MACOS 操作系统 的 即插即用 特性 ， 自动 去 搜索 识别 所 连接 的 外设 并 按 其 要求 进行 自动 配置 ， 操作系统 将 自动 分配 新增 外设 所 需要 的 资源 ， 包括 软件 的 驱动 及 所 需 的 带宽 ， 使 其能 正常 工作 ； 若 是 设备 拆除 ， 系统软件 将 收回 已 分配 给 该 设备 的 USB 资源 ， 自动 卸载 相应 的 驱动程序 。 这种 带电插 拔 的 即插即用 功能 目前 仅 USB 设备 独有 ， 使 USB 设备 的 应用 非常简单 、 方便 ， 降低 了 设备 成本 与 使用 过程 中 技术支持 与 服务 的 成本 ， 使 缩小 主机 系统 的 空间 成为 可能 。 USB 使 增加 外设 的 整个 过程 自动化 ， 避免 了 目前 在 PC机 上 每 增加 硬件 设备 都 需要 打开 机箱 插入 新卡 、 重新 设置 、 重新启动 的 麻烦 。 　 　 正是 由于 USB 上述 突出 的 优点 ， USB 设备 不仅 在 计算机 外设 的 扩展 方面 有 广泛应用 前景 ， 而且 将 在 工业 控制系统 、 虚拟仪器 方面 有着 重要 的 发展潜力 。 　 USB 的 应用 　 计算机 外设 　 　 USB 正在 吸引 众多 的 外设 制造商 ， 在 ComdexFall 大会 上 Intel 公司 演示 的 一台 计算机 实际 连接 外设 个 ， 创造 了 个人 计算机 连接 外设 的 最高 记录 ， 虽然 实际 使用 过程 中 一台 PC机 不太可能 连接 个 外设 ， 但 根据 USB 论坛 预测 一般 用户 在 使用 过程 中 还是 需要 连接 到 个 外设 。 　 　 USB 是 新一代 商用 和 家庭 用 PC 外设 的 使 能 技术 。 USB 技术 将 为 商业 和 家庭用户 转换 PC 功能 使 之 进入 一个 通用 信息 、 通信 和 娱乐 应用领域 。 除了 已有 的 外设 可用 USB 实现 外 ， USB 技术 还 在 下面 几个 方面 拓展 了 PC 的 应用 范围 。 扩展 商业 PC 的 功能 　 　 。 CTIComputerTelephonyIntegration 设备 　 　 　 声音 邮件 　 　 　 集成 通信 　 　 　 带 注释 的 Email 　 　 　 呼叫者 识别 CallerID 　 　 　 Internet 和 Web 开发 　 　 　 视频压缩 和 POTS 电话会议 　 　 。 安全设备 　 　 　 ID 卡 阅读器 　 　 　 数字 加密 设备 　 　 。 图象 和 桌面 出版 设备 　 　 　 限定 范围 的 数字相机 　 　 　 个人 扫描仪 　 　 　 专用 打印机 为 家用 PC 增加 新 的 功能 　 　 。 多用户 游戏 　 　 。 数字 游戏 杆 　 　 。 Internet 设备 　 　 。 相片 扫描仪 和 限定 范围 的 数字相机 　 　 。 数字音频 设备 ， MIDI 接口 外设 　 　 目前 ， USB 设备 的 发展势头 正 如日中天 ， 国外 已 推出 了 上 百种 USB 外设 ， 包括 USB 集线器 、 打印机 、 扫描仪 、 存储器 、 数字 音箱 、 数字相机 和 MODEM 等等 。 USB 设备 在 国外 的 实际 应用 中 已经 开始 逐渐 取代 传统 外设 ， 在 国内 还 处于 逐渐 被 接受 的 时期 。 年 年初 我们 已 感到 USB 设备 进入 我国 市场 的 强劲 之势 ， 不论是 外设 还是 主机 ， 都 有 产品 推出 。 年月日 ， 联想公司 通过 Internet 进行 其 东芝 笔记本电脑 新品 的 新闻 就是 用 了 USB 端口 摄像头 。 但 国内 市场 的 USB 产品 ， 品种 并不多 。 随着 USB 技术 的 普及 应用 和 PC 应用 范围 的 拓展 ， USB 外设 特别 是 利用 了 USB 技术 的 消费 电子产品 将 是 一个 潜力 巨大 的 市场 。 　 USB 总线 虚拟仪器 和 测控 系统 　 　 所谓 虚拟仪器 ， 是 指 一种 具有 某种 测量 仪器 功能 的 设备 ， 但 其 完整 的 仪器 功能 的 实现 必须 与 计算机 软硬件 紧密结合 才能 完成 。 目前 的 虚拟仪器 有 两类 ： 一类 是 PC 总线 虚拟仪器 ， 特定 的 仪器 功能 制作 在 一块 扩展 接口 插卡 上 ， 将 其 插入 计算机 的 扩充 插槽 中 ， 在 计算机 的 软硬件 支持 下 工作 。 这 类 虚拟仪器 除 具有 一般 插卡 的 缺点 之外 ， 还 存在 两个 显著 缺点 ： 一是 配置 复杂 ， 非专业 人员 不能 进行 安装 ， 这样 极大 地 限制 了 这类 虚拟仪器 的 推广应用 ； 二是 测量 信号 直接 进入计算机 ， 各种 现场 的 被 测 信号 对 计算机 的 安全 造成 很大 的 威胁 ， 同时 计算机 内部 的 强 电磁干扰 对 被 测 信号 也 会 造成 很大 的 影响 。 另一类 是 外挂式 虚拟仪器 ， 它 既 具有 PC 总线 虚拟仪器 的 优点 ， 同时 又 克服 了 PC 总线 虚拟仪器 的 缺点 ， 这是 虚拟仪器 发展 的 一个 理想 方向 。 外挂式 虚拟仪器 国内 目前 还 没有 报道 ， 国外 主要 是 美国 的 虚拟仪器 实验室 于 年底 推出 的 基于 双向 并口 IEEE 打印机 并口 的 外挂式 虚拟仪器 。 　 　 计算机 集中 测控 系统 主要 是 以 PC 为主 并 通过 PC 总线 测量 接口卡 和 控制 接口卡 构成 的 测控 系统 。 其中 测量 环节 可以 看成 是 专用 的 虚拟 测量 仪器 ， 因此 测控 系统 与 虚拟仪器 相比 主要 是 多 了 一个 闭环控制 环节 ， 即 PC 总线 的 输出 接口 模块 和 相应 的 控制软件 ， 主要 是 开关 量 控制 和 DA 输出 模拟量 控制 两大类 模块 。 　 　 USB 本身 是 一种 工业 级 总线 标准 ， 其 可靠性 等级 可 很 好 地 满足 现场 工业 测量 控制系统 的 要求 。 根据 虚拟仪器 及 USB 总线 的 特点 ， 将 二者 结合 起来 构成 外挂式 USB 总线 虚拟仪器 是 一种 理想 的 选择 。 虽然 外挂 式打印机 并口 虚拟仪器 较 好地解决 了 PC 总线 虚拟仪器 的 缺点 ， 但 并 口 上 多个 设备 的 扩展 不太 方便 ， 且 成本 高 。 而 USB 总线 从 速度 性能 方面 而言 与 IEEE 打印机 并口 相差无几 ， 只 比 ISA 总线 略低 。 因此 ， 用 USB 总线 构成 外挂式 虚拟仪器 的 速度 性能 可 与 IEEE 持平 ， 比 PC 总线 虚拟仪器 要 略低 ， 但 可 很 好 满足 如 高速 数字 存储 示波器 的 实时 显示 和 处理 要求 ， 也就是说 能 满足 各种 虚拟仪器 的 速度 要求 。 USB 总线 的 设备 扩展 非常 方便 ， 最多 可 支持 由台 设备 构成 的 大型 测量 系统 ， 而 成本 只 比 ISA 总线 虚拟仪器 略 高 ， 与 PCI 总线 虚拟仪器 可 基本 持平 。 除此之外 ， 外挂式 USB 总线 虚拟仪器 还 具有 许多 优点 ， 如 可 很 好 地 满足 工业 测量 的 环境 要求 、 可 容易 地 实现 完全 的 光电 隔离 、 测量 系统 的 改变 和 扩展 非常 方便 、 可 带电 拔 插 设备 、 完全 的 即插即用 等 ， 通过 优化 设计 的 组态 软件 还 可 实现 自动 组态 。 　 　 USB 总线 测控 系统 主要 也 是 利用 USB 总线 的 独特 优点 在 USB 虚拟仪器 的 基础 上 增加 控制 模块 而 实现 的 一种 兼 集中控制 ICS 和 集散 控制系统 DCS 优点 于 一体 的 测控 系统 。 与 基于 PC 总线 的 集中型 控制系统 相比 ， 因 USB 总线 中 的 控制 模块 是 外挂式 的 ， 为了 与 USB 总线 相连 ， 模块 中 必须 有 独立 工作 的 CPU ， 因此 ， USB 总线 上 的 控制 模块 可 设计 成 既 可 在 主机 PC 的 统一 管理 下 协调 工作 ， 也 可以 脱离 USB 总线 独立 工作 ， 这 一点 与 DCS 的 特点 是 一样 的 ， 即 不会 因为 主机 或者 通信 总线 的 崩溃 而 导致 控制系统 瘫痪 。 因此 ， USB 总线 的 测控 系统 的 可靠性 比 PC 工业 总线 系统 更高 。 USB 总线 测控 系统 显然 具有 上述 USB 总线 虚拟仪器 的 全部 特点 ， 而且 系统 构造 的 灵活性 、 所 能 达到 的 系统 规模 和 程度 、 设备 资源 的 可 重复 利用 性 和 系统结构 改变 和 重组 的 高效率 及 由此 产生 的 效益 是 以往 任何 系统 所 不及 的 。 　 　 总之 ， PC机 的 使用 已经 超越 了 办公桌 的 范围 ， 外设 连接 的 瓶颈 一旦 被 突破 ， 它 的 影响力 不是 我们 可以 料想得到 的 。 USB 技术 的 实用 带来 的 也许 是 一场 PC机 应用领域 的 革命 。 随着 外设 的 日益 丰富 与 消费 电子产品 的 电脑化 ， PC机 必将 进入 更为 广阔 的 应用 空间 。 王省 书 （ 国防科学技术大学 二系 长沙 ） 秦石乔 （ 国防科学技术大学 二系 长沙 ） 邵福球 （ 国防科学技术大学 二系 长沙 ） 参考文献 ， 秦石乔 等 微机 接口技术 和 应用 长沙 ： 国防科技大学 出版社 ， 龙志宏 连接 的 艺术 中国 计算机 报年 第期 收稿 日期 ： 年月日