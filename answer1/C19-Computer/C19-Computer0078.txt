计算机 工程 COMPUTERENGINEERING 年 第卷 第期 VolNo 图 搜索 中 A 算法 的 SQL 解法 贾纳豫 ， 李慧 ， 楼荣生 摘要 ： 讲座 图 搜索 的 A 算法 和 SQL 算法 ， 利用 数据库 存储 图中 原始数据 ， 借助 SQL 语言 来 生成 A 算法 要求 取 的 解 ， 简化 了 编程 。 关键词 ： 图 搜索 ； A 算法 ； SQL 语言 UseSQLSolutingAAlgorithminGraphSearchingJiaNayuLiHuiLouRongshengDeptofComputerScienceFudanUniversityShanghai 【 Abstract 】 ThespaperresearchstwographsearchingalgorithmsAAlgorithmandSQIAlgorithmItusesdatabasetostoreinitiativedatainagraphandusesSQLtogetAAlgorithmssolutionitcansimplifytheprogramminginthisarea 【 Keywords 】 GraphsearchAAlgorithmSQLlanguage 问题 提出 　 　 在 图 中 寻找 最佳 路径 过程 的 算法 GraphSearch 是 　 　 建立 一个 只 含有 初始 结点 s 的 搜索 图 GNENsE φ ， 把 s 放到 一个 叫做 OPEN 表 的 未 扩展 结点 表中 。 　 　 建立 一个 叫做 CLOSED 表 的 扩展 结点 表 ， 其 初始 为 空表 。 　 　 LOOP 若 OPEN 表为 空 ， 则 失败 退出 。 　 　 选择 OPEN 表上 的 第一个 结点 ， 把 它 从 OPEN 表 移出 并 放进 CLOSED 表中 。 称此 结点 为 n 。 　 　 若 n 为 一 目标 结点 ， 则 有解 并 成功 退出 ， 此解 是 追踪 图 G 中 沿着 边 从 n 到 s 这条 路径 而 得到 。 　 　 扩展 结点 n ， 生成 不是 n 的 祖先 的 那些 后继 结点 的 集合 M 。 　 　 令 NN ∪ MEE ∪ nmm ∈ M 把 M 的 这些 成员 加进 OPEN 表 。 对 已经 在 OPEN 表 或 CLOSED 表上 的 每 一个 M 成员 m ， 删去 通到 s 的 代价 较大 的 边 ， 和 OPEN 中 的 相应 结点 。 如果 与 被删 的 边 相连 的 结点 ， 在 CLOSED 中 ， 还要 把 它 的 后裔 结点 连到 m 　 　 按 某 一 方式 重排 OPEN 表 。 　 　 GOLOOP 图 计费 示意图 　 　 算法 GraphSearch 的 第步 OPEN 表上 的 结点 进行 排序 ， 以便 能够 从中 选出 一个 最好 的 作为 第四步 扩展 用 。 　 　 例 ： 交通图 中 最小 费用 路线 ， 如图 中 五个 顶点 ， 八条 边 的 图 ， 边上 的 数据 是 代价 。 　 　 其中 A 为 起点 ， E 为 终点 。 算法 过程 为 ： 　 　 第 ， 步 ： 建立 GNENAE Φ 。 生成 OPENACLOSED 　 　 第 ～ 步 　 　 第趟 NE 为 目标 结 ， 成功 退出 。 追踪 上表 最后 一列 知 始点 A 到 终点 E 的 路径 是 A → B → D → E 代价 为 。 表 Open 表 开始 护展 NM 表 路径 最小 代价 第趟 OPENCLOSEDANA 后继 BCDMBCDOPENBCDABACAD 第趟 OPENCDCLOSEDABNB 后继 CDMCDOPENCDABACBCBD 第趟 OPENDCLOSEDABCNC 后继 DEMDEOPENDEABACBCBDCE 第趟 OPENECLOSEDABCDND 后继 EMEOPENEABACBDDE 第趟 OPENCLOSEDABCDENEA 算法 　 　 A 算法 中 ， 用 一个 特别 的 估计 函数 f ， 其值 fn 表示 从 起始 点 S 到 n 的 最小 代价 路径 与 从 结点 n 到 目标 点 的 最小 代价 路径 的 代价 之 和 ， fngnhn 。 即 fn 是从 起点 过 n 到达 终点 的 一条 最小 代价 路径 的 代价 。 因此 OPEN 表上 具有 最小 f 值 的 那个 结点 可 作为 该趟 中 的 N ， 下步 从 这个 结点 扩展 。 　 　 在 图 中 ， 对 任意 结点 n ， 定义 函数 hn 表示 从 结点 n 到达 目标 结点 的 最小 代价 精确 的 ； 函数 gn 表示 从 起始 结点 S 到 结点 n 的 最小 代价 ； 根据上述 算法 ， 有 gngn 。 函数 fngnhn 表示 从 起始 结点 S 通过 结点 n 到达 目标 结点 的 最小 代价 。 若 结点 n 到 目标 结点 无 通路 时 ， hn 无 定义 。 　 　 对于 hn ， 它 依赖于 有关 的 问题 领域 的 启发 信息 ， 所以 称 h 为 启发 函数 。 　 　 在 A 算法 工作 中 除了 使用 OPEN 和 CLOSED 表外 ， 还 需要 一个 计算 两点 xy 间 最小 代价 的 函数 hxy 。 　 　 把 算法 GraphSearch 的 第步 改为 　 　 从 OPEN 表中 取出 gnhnb 最小 的 顶点 n 移出 ， 并 放入 CLOSED 。 　 　 gn 为 始点 s 到 n 的 代价 ， hnb 为 n → b 的 代价 　 　 同时 取消 步骤 ， 便是 A 算法 。 　 　 例在 例中 ， 起点 A 扩展 后 有 个 后继 B ， C ， D ， 如图 可得 ： gBgCgD 　 　 若 选取 g 最小 的 点 B 进一步 扩展 ， 得 两个 后继 CD 且 gDgC 由 上次 的 扩展 已有 gC 是 AC 所以 这里 gC 是 ABC 去除 ； 可用 这里 的 gD 是 ABD 来 代替 扩展 A 时 的 gD 是 AD 的 值 。 若 再 扩展 结点 D 又 得 两 后继 E ， C 且 gE 是 ABDEgC 是 ABDC 该值 也 可 去除 。 　 　 如果 有 数据库 支持 ， 可 把 函数 h 的 精确 值 事先 存入 数据库 中 ， 则 可 提高 算法 效率 。 数据库 支持 的 图 搜索算法 　 　 本节 用 数据库 的 SQL 语言 实现 起始 点到 目标 点 最佳 路径 的 图 搜索 问题 。 由于 SQL 是 基于 集合 各 关系 运算 的 非 过程 性 语言 ， 没有 如 A 算法 中 逐步 扩展 的 概念 ， 解答 是 根据 WHERE 条件 “ 一步到位 ” 的 ， 完全 是 一种 新 的 思路 。 一般 做法 如下 ： 　 　 例由例 的 交通图 的 顶点 、 边 及权 生成 一个 交通图 的 原始 数据库 ， 其 结构 ： 　 　 CitytrafnCHARnCHAR ， dNUMBER 如图所示 。 并 以此 为 出发点 生成 任意 两点 间 的 代价 表 。 Cityttafn ： AAABBCCDn ： BCDCDDEEd ： 图 代价 表 　 　 从 Citytraf 出发 ， 可以 得到 任何 两点 间 的 最小 代价 ， 先生 成一 处理 库 ， 初始值 是 　 　 Citytray 　 　 CreateTableOpernndasselectnnd 　 　 　 　 FromCitytraf 　 　 从表 Citytraf 与 Oper 中 各选 一点 nn ， 求 出 它们 可能 的 路径 的 代价 ， 并 放入 Oper 中 ： 　 　 InsertintoOper 　 　 SelectCitytrafnOpernCitytrafdOperd 　 　 FromCitytrafOper 　 　 WhereCitytrafnOpern 　 　 留下 权 最小 者 ： 　 　 CreateTableEndnnd 存放 任 两点 的 最小 代价 　 　 　 　 InsertintoEnd 　 　 　 　 Selectnnmind 取出 d 项 最小 的 行 　 　 　 　 FromOper 　 　 　 　 Groupbynn 消去 nn 段 重复 的 记录 　 　 由于 SQL 无 递归 处理 功能 ， 该 两段 程序 需由 其它 方法 控制 反复 执行 若干次 ， 直到 不再 生成 新 的 行 。 则 End 中 的 记录 是 所有 有 通路 的 点 对 的 最小 代价 。 　 　 为 找出 任意 两点 ， 如 A 和 E 的 最小 代价 的 路径 并 存入 PATH ， 可 如下 建表 ： 　 　 CreateTablePATHnnd 建立 一个 最佳 路径 库 　 　 InsertintoPATH 　 　 最佳 路径 中 从 起点 开始 的 第一条 边 　 　 SelectCnCnCdFromCitytrafCEndE 　 　 WhereCnAandEnCn 　 　 　 　 andCdEdSelectdfromEndwherenAandnE 　 　 UNION 最佳 路径 中除 第一 和 最后 边 外 中间 段 各边 　 　 SelectEnEnEdfromEndEEndECitytrafC ， EndE 　 　 WhereCnAandEnCnandEnEnandEnE 　 　 　 　 andEdCdEdSelectdFromEndWherenAandnE 　 　 UNION 找 最佳 路径 到达 终点 的 边 　 　 SelectCnCnCdFromCitytrafCEndE 　 　 WhereCnEandEnCn 　 　 　 　 andCdEdSelectdfromEndwherenAandnE 　 　 UNION 若 最佳 路径 是 图 中 一边 　 　 SelectnndfromCitytraf 　 　 WherenAandnE 　 　 最后 显示 表 Path 中 的 记录 就是 最佳 路径 经过 的 各 结点 。 结论 　 　 A 算法 除了 计算 始点 A → S 任 一点 的 代价 外 ， 同时 还要 计算 S → B 目标 点 的 代价 。 这样 A → S → B 必然 是 最佳 路径 。 从而 每次 总能 选到 正确 的 结点 来 扩展 。 但 A 算法 的 复杂性 在于 计算 S → B 的 最小 代价 上 。 依据 不同 的 问题 领域 ， 找到 相应 的 启发 函数 ， 将 是 A 算法 的 核心 。 　 　 使用 数据库 方法 时 ， 由于 原始数据 都 存在 一个 库中 ， 所以 算法 Graphsearch 中 搜索 的 复杂性 就 转化成 了 对 原始 数据库 的 查询 的 复杂性 。 在 路径 A → S → B 的 搜索 中 ， A → S 及 S → BS 为 A → B 路径 中任 一点 的 代价 很 容易 用 SQL 从 数据库 中 查询 到 ， 从中 可 比较 出 最小 的 代价 。 这时 只要 能 把 A → B 代价 最小 分解 出 初始 点 、 中间 各点 、 及 目标 点 便 为 解 。 　 　 SQL 解法 的 特点 是 避免 了 繁杂 的 编程 问题 ， 由于 SQL 是非 过程 性 语言 ， 只要 正确 写出 了 最佳 路径 的 条件 ， 程序 就 能 自动 找到 这一 路径 中 的 边 ， 在 数据库 环境 下 很 容易 实现 ， 所谓 编程 就是 要 合理 的 数据库 设计 和 恰到好处 地 写出 条件 ， 但是 标准 SQL 语言 还 不能 处理 GL 所能 处理 的 全部 问题 ， 从文中 已 看出 ， 递归 功能 在 SQL 中 无法 解决 ， 还有 一些 问题 虽然 能解 但 效率 低下 ， 故 在 有些 SQL “ 方言 ” 中 加入 了 一些 设施 以 扩展 它 的 功能 ， 如 DB 中 的 WITH 语句 ， Oracle 中 的 PLSQL 等 ， 但 由于 这些 都 是非 标准 设施 ， 影响 了 程序 的 可移植性 ， 本文 不予 讨论 ， 但 普遍 做法 是 把 SQL 嵌入 到 一个 GL 语言 中 ， 这 就 迫使 现在 的 DBMS 都 要 有 连接 GL 语言 的 能力 ， 如果 一个 问题 存在 SQL 算法 ， 就 不必 求助于 GL ， 故 SQL 算法 的 研究 是 很 有 意义 的 。 作者 单位 ： 复旦大学 计算机系 ， 上海 参考文献 蔡子 经施 伯乐 数据结构 上海 ： 复旦大学 出 出版社 王朝 瑞 图论 国际 出版社 胡运发 新型 程序设计 方法 复旦大学 计算机系 施 伯乐 丁宝 康楼 荣生 数据库系统 导论 北京 ： 高等教育出版社