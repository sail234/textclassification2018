计算机 工程 ComputerEngineering 年 　 第卷 　 第期 　 VolNo 实现 分布式 网络管理 的 一种 方式 黄 　 淞 　 瞿兆荣 　 　 摘 　 要 ： 通过 整合 MbDMamagementbyDelegation 、 CORBA 分布式 数据库 达到 统一 构建 分布式 网管 平台 的 期望 ． 　 　 关键词 ： MbDCORBA 分布式 数据库 IntroductionofaWaytoDesignDistributedNetworkManagementHuangSongQuZhaorongEeatChinaInstituteofComputerTechnologyShanghai 　 　 Abstract 　 ThispaperestablishedapartofnetworkmanagementplatformwhichintegratesMbDManagementbyDelegationCORBAandDistributedDatabace 　 　 Keywords 　 MbDCORBADistributeddatabase 　 　 首先 讨论 平台 的 选择 。 传统意义 上 的 网络管理 可以 以 SNMP 协议 为 代表 。 在 代理 端 所 做 的 工作量 相对而言 是 很 轻 的 ， 这 也 是 和 当时 的 硬件 水平 有关 。 随着 嵌入式 系统 的 发展 ， 从 CPU 到 内存 都 有 了 长足 的 进步 ， 再 简单 地 进行 SNMP 代理 工作 有些 在 P Ⅱ 上 跑 DOS 的 味道 。 对 网管 的 改进 有 几种 方法 。 一种 直接 的 方法 是 增加 SNMP 代理 的 功能 ， 如 相应 的 SNMP 以后 的 版本 VV 等 ， 增加 MIB 库 变量 如 RMON ， 就是 把 “ DOS ” 不断 升级 。 操作系统 还是 传统意义 的 操作系统 。 另 一种 方法 是 在 代理 端先 驻留 上 一个 Runtime ， 以后 需要 什么 功能 再 以 代码 下发 的 方式 下载 到 代理 上去 。 还 和 操作系统 比较 就是 这时 只 驻留 了 一个 微内核 完成 诸如 调度 的 工作 ， 而 所 需 的 其它 模块 在 运行 时 必要 时要 加载 进 内存 。 只不过 不同 的 是 ， 一个 是从 Manager 下载 到 代理 ， 而 另 一个 是从 硬盘 载入 内存 。 后 一种 网管 方法 称为 MbDManagementbyDelegation 目标 ， 本 对照 就是 后者 治本 前者 治标 。 　 　 网络 复杂 以后 ， 往往 是 层次 式 、 分布式 结构 。 这 就 由 一个 Manager 演变成 了 MoMManagerofManoger 。 由 Manager 和 几个 Submanager 组成 ， 甚至 可以 有 MoMoM … 的 关系 。 关系 一 复杂 以后 ， 各种 问题 就 出来 了 ， 如何 对 各个 Submanager 寻址 ， 统一 传送 格式 等 ， 在 通信 中间件 无处不在 的 今天 ， 我们 只 需 利用 中间件 提供 的 功能 就 可以 不 关心 这些 繁琐 而 枯燥 的 事情 了 。 这里 用 的 是 CORBA ， 当然 其它 如 DCE 也 可以 ， 只不过 CORBA 的 天然 对象性 用 起来 自然 一些 。 因为 MoM 的 现象 并非 只有 网管 才 有 ， 所以 在 其它 各种 需 管理 的 地方 都 可以 适用 。 正如 OSF 的 “ bringmanagementtoeverything ， 这时 所 管理 的 库 信息 就 得 相应 地 变动 ， 访问 该 信息 的 操作 的 意义 也 需 进行 “ 本地化 ” 了 。 　 　 接下来 就是 应用层 协议 的 安排 了 。 CORBA 是 个 中间件 ， 在 网络层 中 可以 看成 会话层 、 表示层 、 应用层 的 一部分 。 整个 系统 的 应用层 协议 参照 分布式 数据库 实现 ， 将 分散 于 各个 域 中 的 各个 Agent 控制 的 视图 变量 统一 在 一个 模式 下 进行 管理 关于 视图 变量 下面 详细 阐述 。 实质 是 在 首先 将 局部 MIB 库 进行 “ 数据库 ” 化后 再 将 全部 网络 的 各域 中 的 各个 代理 所 控制 的 “ 数据库 ” 进行 “ 分布式 数据库 整合 。 这样 做 不光 访问 方便 了 ， 也 解决 了 一些 通常 方法 完成 不了 的 问题 具体 参见 文献 。 　 　 下面 逐步 细化 整个 设计 过程 。 　 客户 登录 部分 　 　 整个 系统 的 框架 如图 。 为 保证系统 的 安全性 ， 用 SSL 是因为 在 Socket 上 动手脚 ， 所以 不 影响 其上 的 各层 即 可以 Web 方式 登录 在 Manager 上 驻留 一个 HTTPServer ， 也 可以 用 CORBA 方式 登录 IIOP 协议 ， 或 干脆 自行 做 一个 CS 结构 的 东西 都行 。 关于 SSL 的 整个 过程 ， 由于 是 程式化 的 一套 ， 现在 有 许多 plugin 来 完成 这项 工作 ， 如 SSLeay 就是 C 的 Plugin 。 在 登录 的 整个 过程 里 ， 中心 服务器 Manager 需 完成 ： 用户 的 确认 ； 其 管理权限 的 确认 。 图 　 系统 框架 　 中心 服务器 　 　 在 中心 服务器 中 必须 存有 管理 用户 权限 表 ； Submanager 的 名称 ， 提供 的 服务 ； 全 网络 的 视图 变量 及其 对应 的 域 、 代理 。 　 　 在 管理 用户 需 访问 某 变量 时 ， 首先 判断 找出 该 变量 对应 域 、 代理 名 和 权限 表 对应 后 ， 如 合法 则 由 命名 服务器 定位 Submanager 进行 操作 。 　 　 设计 中心 网管 服务器 对外 编程 接口 至少 需 包括 个 ： getset 和 make 。 它们 分别 是 获取 、 设置 某 视图 变量 的 值 和 产生 一 视图 变量 。 　 　 所谓 视图 变量 就是 MIB 变量 是 在 “ 数据库 ” 化后 的 外 模式 下 的 视图 。 没有 进行 “ 数据库 ” 化 以前 ， SNMP 可以 看成 是 对 MIB 库 的 查询语言 ， SMI 是 其 数据 定义语言 DDL ， Agent 是 DBMS 。 对照 完整 的 数据库 体系结构 发现 内 模式 有 的 即 Agent 对 MIB 变量 的 内部 表示 ， 模式 有 的 即 用 SMI 语法 规则 表示 的 被 管理 实体 ， 但外 模式 就 没有 了 。 不同 的 用户 看到 的 是 同一个 模式 全体 MIB 变量 ， 这 不仅 不 安全 ， 而且 访问 效率 也 不 高 。 MIB 库 的 “ 数据库 ” 化 过程 就是 加上 外 模式 的 过程 ， 具体 是 通过 添加 视图 变量 实现 的 。 由 代理 Agent 实现 从 视图 到 MIB 变量 的 转换 。 这个 转换 程序代码 可以 是 一直 驻留 在 代理 上 的 ， 也 可以 是从 域 Submanager 下 发给 代理 再 编译 运行 的 ； 而 视图 变量 则 由 make 接口 所 接收 的 类 AQL 代码 下发 到 代理 上 ， 再 由 该 代理 完成 定义 的 视图 到 实际 的 MIB 变量 间 的 转换 ， 过程 见图 。 图 　 变量 转换 　 Manager 和 Submanager 互操作 部分 　 　 由于 在 系统 内部 就 不 考虑 SSL ， 当然 根据 需要 添上 也 是 无妨 的 。 　 　 这时 的 总线 是 CORBA 。 在 具体 使用 的 时候 ， 首先 定制 所 需 的 部分 。 由于 完全 的 CORBA 包括 CORBAcore 和 CORBACompliancepoints ， 一些 必需 的 部分 也 即 最小 内核 为 包括 ORBInterface 、 BOA 、 IR 、 IDLMapping 在内 的 CORBACore 。 而 如 CORBA 互操作 CIIOP 、 CORBA 服务 包括 生存期 服务 、 命名 服务 、 trader 服务 等种 服务 和 CORBA 公共设施 facility 都 算是 Compliancepoints 。 在 考虑 到 系统 的 尽可能 精减 和 功能 上 的 需求 ， 系统 所用 的 CORBA 产品 必须 包括 Core 命名 服务 IIOP 。 如该 产品 可 提供 Transaction 和 Concurency 服务 ， 则 不 需 自行 完成 许多 工作 ， 若 不 提供 ， 则 自选 设计 也 行 。 在 Mapping 方面 一般 用 C 。 Java 的 目前 弊病 在 JVM 的 效率 上 。 　 　 CORBA 的 实质 其实 是 这样 的 。 首先 不管 是 客户 还是 服务端 对象 ， 都 把 自己 的 应用层 意义 通过 统一 的 IDL 语言 说明 ， 这 就 保证 了 跨 语言 的 能力 ， 实现 了 应用层 上 互通 的 可能 。 而 下面 各层 由 ORB 来 完成 通信 ， 然后 在 客户端 把 这个 IDLmapping 成由 本地 语言 写成 的 Stub ， 服务端 把 它 的 IDLmapping 成由 它 本地 语言 写成 的 Skeleton 。 这时 Stub 和 Skeleton 就 可以 看成 是 双方 的 两个 代理 翻译 ， 成 了 CORBA 这个 中间件 的 转换器 。 在 互通 的 基础 建 好 之后 ， 就 必须 知道 对方 服务 方 的 IORInteroperableObjectReference 号 了 ， 很 像 打电话 所 必需 的 电话 号 和 上网 的 IP地址 一样 。 这时 就 可以 通过 CORBA 的 命名 服务器 把 IOR 和 有 一定 意义 的 对象 名称 联系 起来 。 　 Submanager 和 Agent 间 的 互操作 　 　 这是 通过 MbD 完成 的 主要 针对 make 操作 。 对于 getset 可以 看成 是 MbD 和 SNMP 互 作用 的 结果 。 MbD 详细 介绍 参见 参考文献 。 简而言之 就是 在 Agent 上 的 程序 由 Submanager 完全 控制 ， 而 这个 程序 是 由 Submanager 下发 到 Agent 上 的 ， 好处 就 像是 随时 可以 清理 硬盘空间 和 内存 一样 。 在 进行 互操作 前 需 预先 下发 一个 类 SQL 语言 SMI 的 翻译器 和 一个 类 SNMPAgent 代码 到 Agent 的 Runtime 上 。 这 两者 前者 处理 make 接口 ， 后者 处理 get 、 set 接口 。 基本上 整个 系统 的 难点 就 在 这 两个 daemon 上 ， 类 SNMPAgent 还 好办 一些 ， 有 现成 的 各种 资料 好查 ， 而类 SQLSML 翻译 部分 需花些 时间 。 与 分布式 数据库 结合 　 　 所以 在 应用层 用到 分布式 数据库 理论 主要 是 考虑 到 存在 多用户 同时 访问 同一 域 中 同一 MIB 变量 的 可能 ， 也 存在 make ， set 写 操作过程 中 突然 出现 的 异常情况 而 导致 整个 操作 不能 正确 完成 的 情况 。 所以 有 必要 引入 分布式 数据库 中 的 事务处理 中 的 事务 提交 方法 和 锁定 临界 区 的 方法 ， 这里 以 IPL 和 IPC 为 代表 。 　 　 具体 而言 ， 中心 服务器 在 接收 到 客户 请求 式 自行 判断 标准 生效 后 ， 起动 IPC 、 IPL 过程 。 IPL 的 过程 若 是 有 同级 ， 高级 用户 正在 访问 某一域 时 用户 等待 。 IPC 的 过程 是 在 所有 所 需提交 的 域 完成 提交 之后 才 回写 日志 完成 提交 。 　 　 这样 ， 在 局部 进行 了 数据库 化 处理 ， 增加 外 模式 之后 ， 全局 引入 分布式 数据库 的 一些 解决 方法 ， 再 在 通信 方面 以 CORBA 连接 后 ， 整个 系统 就 可 搭建 起来 了 。 作者简介 ： 黄 　 淞 ～ ， 男 ， 研究生 ， 主攻 方向 ： 分布式 与 网络 软件系统 作者 单位 ： 华东 计算技术 研究所 ， 上海 　 参考文献 黄淞 利用 MbD 实现 分布式 网络管理 华东 计算所 研究生 论文 GermanGoldszmidtOnDistributedSystemManagementhttpwwwcscolumbiaedugermanGermanGoldszmidtYechiamYemimDistributedManagementbyDelegationhttpwwwcsColumbiaedugerman 收稿 日期 ：