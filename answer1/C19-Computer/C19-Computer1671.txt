软件 学报 JOURNALOFSOFTWARE 　 Vol 　 No 　 P 文本 规划 中 焦点 移动 控制算法 的 研究 姚天 昉 　 汤学彦摘 　 要 ： 该文 完善 了 全局 焦点 和 局部 焦点 的 移动 规则 使 规则 适合 更 广泛 的 应用领域 所 提出 的 新 算法 以 Mckeown 的 焦点 算法 为 基础 将 原来 的 栈式 控制结构 改进 成树型 控制结构 可以 同时 控制 全局 焦点 和 局部 焦点 的 移动 新 算法 改进 了 Schema 的 扩充 转移 网络 表示 为 弧 增加 了 重复 特性 和 优先级 的 信息 还 加入 了 对 Schema 进行 递归 的 控制 和 回溯 机制 并 由 知识库 决定 Schema 的 填充 和 递归 此外 又 增加 了 对 Schema 可 交换 符号 的 处理 在 此基础 上 进一步 介绍 了 实验 系统 的 设计 并 讨论 了 算法 的 效果 关键词 ： 文本 规划 全局 焦点 局部 焦点 模式 谓词 分类号 ： TPResearchontheShiftControllingAlgorithmofGlobalandImmediateFocusesinTextPlanningYAOTianfang 　 TANGXueyanDepartmentofComputerScienceandEngineeringShanghaiJiaotongUniversityShanghaiAbstract ： TheimprovementontheshiftrulesofglobalandimmediatefocusesispresentedTheimprovedrulescanbeusedformoreextensivedomainBasedonMckeownsfocusalgorithmanewalgorithmthatadoptstreeasacontrollingstructureinsteadofstackisproposedItcancontroltheshiftofbothglobalandimmediatefocusessimultaneouslyThenewalgorithmimprovestheATNrepresentationofSchemabyaddingrepeatpropertyandpriorityinformationtotheedgeandincorporatesthecontroloftherecursionofSchemaandbacktrackmechanismThefillingandrecursionofSchemaaredeterminedbytheknowledgebaseMoreoverthenewalgorithmcanalsohandletheinterchangeablesymbolsintheSchemaThedesignofanexperimentalsystembasedontheproposedalgorithmisintroducedandtheeffectivenessofthealgorithmisdiscussedKeywords ： TextplanningglobalfocusimmediatefocusSchemapredicate ▲ 　 　 文本 生成 不仅 需要 保证 句子 语义 、 句法结构 和 词法 的 正确性 而且 必须 围绕 文本 的 主题 来 组织 句子 使 它们 恰当 地 衔接 以 保证 文本 的 连贯性 一般说来 文本 生成 可 分为 个 阶段 即 文本 规划 textplanning 、 句子 规划 sentenceplanning 和 表层 生成 surfacegeneration ［ ］ 焦点 控制 机制 是 文本 规划 中 的 一种 重要 的 机制 它 在 组织 文本 内容 时 跟踪 两个 相邻 句子 或者 段落 之间 焦点 的 移动 以 确保 所 生成 的 文本 是 连贯 的 　 　 Schema 方法 是 采用 语言学 中 的 修辞 性 谓词 rhetoricalpredicate 简称 predicate 来 表达 文本 结构 的 一种 方法 文本 是 由 命题 proposition 组成 的 Proposition 是 一个 句子 或者 一个 从句 Predicate 将 文本 中 的 Proposition 分类 每个 Proposition 都 被 归纳 为 特定 的 Predicate 对 同一 类型 文本 存在 着 一些 标准 的 Predicate 的 组合 模式 来 表示 文本 的 结构 这种 标准 模式 称为 Schema 用 Schema 表示 的 文本 结构 是 一种 层次化 的 结构 即 Schema 可以 递归 嵌套 ［ ］ 在 文本 生成 阶段 先 选择 合适 的 Schema 然后 用 知识库 中 的 内容 填充 匹配 Schema 中 的 Predicate 为 Predicate 的 参数 赋值 每个 Predicate 都 包含 若干 参数 参数 的 个数 和 类型 是 由 其 语义 决定 的 ［ ］ Proposition 是 将 Predicate 中 的 参数 赋值 后 所 得到 的 实例 Schema 的 填充 过程 是 在 遍历 其 Predicate 的 同时 利用 Predicate 的 语义 选择 适当 的 Proposition 进行 匹配 当 出现 多种 匹配 方案 时 由 焦点 控制 机制 决定 选择 哪个 Proposition 最后 输出 遍历 Schema 所得 的 Proposition 序列 供 后续 阶段 使用 　 　 文本 是 围绕 某些 概念 或者 对象 的 描述 展开 的 它们 称为 焦点 焦点 控制 机制 限制 所 生成 文本 的 内容 使 整个 文本 尽可能 地 连贯 文本 中 存在 着 两种 类型 的 焦点 全局 焦点 globalfocus 简记 为 GF 和 局部 焦点 immediatefocus 简记 为 IFGF 描述 的 是 文本 段落 或者 文本 的 表述 中心 与 Schema 一一对应 为了 使 文本 的 结构 更 清晰 我们 假设 所 涉及 文本 的 GF 只有 一个 GF 只有 在 Schema 发生 递归 时才 可能 发生变化 文本 生成 之前 必须 提供 最 外层 Schema 的 GF 如果 Schema 出现 递归 在 内层 Schema 填充 结束 后 恢复 外层 Schema 及其 GF 继续 填充 GF 的 控制 与 Schema 递归 密切相关 Schema 递归 实现 的 关键在于 如何 决定 被 嵌套 的 新 的 Schema 的 GFIF 是 指 一个 句子 所 表述 的 中心 概念 或 对象 是 Proposition 中 一个 被 赋值 的 参数 Proposition 的 赋值 参数 可以 分为 两类 一类 是 可能 成为 焦点 的 参数 另一类 是 不 可能 成为 焦点 的 参数 为了 控制 IF 的 移动 在 文本 生成 过程 中 需要 跟踪 和 维护 下列 个 方面 的 信息 　 　 当前 句子 的 IF 称为 当前 焦点 简记 为 CF 　 　 当前 句子 中 可能 成为 下 一个 句子 的 IF 的 成份 称为 potentialfocuslist 简记 为 PFL 　 　 前 文中 部分 句子 的 IF 所 构成 的 焦点 栈 focusstack ［ ］ 　 　 本文 主要 研究 基于 Schema 技术 的 文本 规划 中 的 焦点 控制 机制 　 焦点 移动 规则 　 　 研究 IF 的 重点 在于 如何 在 相邻 两个 句子 之间 变换 或者 保持 焦点 Sidner 提出 条 焦点 移动 规则 ［ ］ 新 的 CF 可以 是 ① 前句 PFL 中 的 元素 ② 前句 的 CF ③ 从 焦点 栈 中弹 出 的 元素 ④ 与 前句 CF 隐含 相关 的 概念 Mckeown 将 上述 规则 中 的 前条 应用 于 焦点 算法 中 ［ ］ 如果 只 使用 前条 规则 那么 CF 转移 至 一个 从未 成为 过 焦点 的 新 概念 时 只能 通过 规则 ① 而 所有 PFL 中 的 元素 都 被 前 一个 句子 提及 所以 当 一个 概念 没有 被 提及 时 它 就 不 可能 成为 焦点 因此 其 通用性 较差 例如 　 　 上海 中心 气象台 月 日 点钟 发布 上海市 天气预报 Focus 天气预报 今天 夜里 和 明天 上海市 和 长江口 区 天气预报 Focus 天气 阴 有时 有 阵雨 Focus 天气 局部地区 雨量 中等 Focus 雨 明天 转阴 到 多云 Focus 天气 偏南风 Focus 风 明天 转 东南风 Focus 风 风力 都 是 到 级 Focus 风 明天 最高 温度 度 Focus 温度 明天 最低温度 度 Focus 温度 　 　 在 上述 天气预报 文本 中 CF 由 天气 转入 风 、 温度 时 必须 应用 规则 ④ 但 规则 ④ 中 CF 的 转移 范围 太广 必须 加以 一定 的 限制 在 分析 文本 的 基础 上 我们 将 规则 ④ 修改 为 “ 涉及 一个 与 当前 Schema 的 GF 隐含 相关 的 概念 implicitlyrelatedfocus 简记 为 IRF ” 新 的 规则 ④ 只 允许 CF 转移 至 IRF 以 避免 使 文本 结构 过于 松散 在 上例 中风 和 温度 都 是 与 天气预报 密切相关 的 概念 记 IRFObject 为 与 对象 Object 隐含 相关 的 对象 的 集合 下面 来 定义新 的 IF 移动 规则 　 　 规则 焦点 转移 为 前句 的 潜在 焦点 即 CFnewsentence ∈ PFLlastsentence 　 　 规则 焦点 保持 前句 的 当前 焦点 即 CFnewsentence ＝ CFlastsentence 　 　 规则 焦点 回到 先前 讨论 的 某 一 焦点 即 CFnewsentence ∈ FocusStack 　 　 规则 焦点 转移 到 与 全局 焦点 隐含 相关 的 新 焦点 即 CFnewsentence ∈ IRFGF 　 　 这里 需要 说明 的 是 上述 条 规则 描述 的 是 一个 Schema （ 对应 于 一个 GF ） 内部 IF 的 变化 不 允许 跨 Schema 使用 为了 利用 这些 规则 必须 为 它们 赋以 优先级 根据 文本 连贯性 的 特点 并 结合 对 文本 的 分析 我们 提出 下列 优先级 关系 Priority 规则 Priority 规则 Priority 规则 Priority 规则 　 　 文本 生成 时若 存在 多个 Proposition 可 供选择 则 需要 利用 焦点 移动 规则 进行 控制 首先 删除 不 符合 任何 一条 上述 规则 的 Proposition 然后 按 优先级 从 高到 低 依次 运用 这些 规则 选择 符合 最高 优先级 规则 的 Proposition 　 Schema 的 实现 方法 　 　 Schema 是 通过 扩充 转移 网络 augmentedtransitionnetwork 简称 ATN 的 方法 实现 的 ATN 原来 在 自然语言 理解 中 用来 分析 句子 ［ ］ 代表 Schema 的 ATN 是 一张 有向图 它 的 结点 代表 起始 状态 、 填充 过程 中 的 中间状态 或 终止 状态 Schema 的 递归 嵌套 对应 于 ATN 的 递归 嵌套 ATN 弧 共有 两种 类型 一种 是 SchemaPredicate 代表 Schema 中 的 一个 符号 包括 它 的 Schema 和 Predicate 实现 如果 该 符号 不能 扩展 成 另 一个 新 的 Schema 则 Schema 实现 为 null 另 一种 是 jump 代表 状态 之间 的 无条件 转移 即 转移 时 无需 匹配 任何 Schema 或 Predicate 在 每条 弧上 设置 一个 代表 重复 次数 的 特性 对 SchemaPredicate 型 弧此 信息 表示 Schema 和 Predicate 实现 可以 重复 的 次数 “ ” 表示 次 “ ” 表示 任意 多次 （ 即 ～ N 次 ） 对 jump 型 弧 重复 次数 一般 为次 在 Schema 被 填充 的 过程 中 如果 匹配 失败 就 需要 回溯 退回 到 先前 的 状态 选择 其他 的 Predicate 进行 匹配 所以 为 每条 弧 还 增加 了 一个 优先 数 优先 数越 小 优先级 越高 在 转移 到 某 一 状态 后先 选择 以该 状态 为 弧尾 的 弧 中 优先级 最高 的 （ 不 一定 是 一条 ） 进行 匹配 若因 填充 不 成功 而 回溯到 该 状态 再 选择 下 一 优先级 的 弧 进行 匹配 依此类推 弧 可以 用 如下 四元组 表示 Predicate 实现 Schema 实现 重复 特性 优先 数 对于 jump 型 的 弧 Predicate 实现 jumpSchema 实现 null 重复 特性 “ ” 表为 ConstituencySchema 其 对应 的 ATN 如图所示 Fig 　 ATNofconstituencyschema 图 　 Constituencyschema 所 对应 的 ATNTable 　 Constituencyschema 表 　 Constituency 模式 　 　 这里 的 ATN 与 Mckeown 表示 Schema 的 ATN 有所不同 主要 区别 是 　 　 在 Schema 的 ATN 表示 中 不 允许 出现 子图 （ 即 Mckeown 的 ATN 中 的 subr ） 子图 的 作用 是 提取 Schema 表达式 中 可 共享 的 子 表达式 用 另 一个 ATN 表示 以 简化 Schema 的 表示 在 填充 Schema 过程 中若 转移 到子 图 进行 匹配 时 CF 可以 转移 到 外层 ATN 中 已 匹配 所得 的 Proposition 的 CF 规则 若 转移 到 被 嵌套 的 Schema 所 对应 的 ATN 则 不 允许 出现 这种 情况 因为 IF 移动 规则 不 允许 跨 Schema 使用 所以 两者 的 焦点 控制 是 不同 的 在 这里 Schema 与 ATN 一一对应 控制 在 ATN 之间 的 转移 只 可能 是 由于 Schema 的 递归 造成 的 原因 是 便于 控制 　 　 为 每条 弧 增加 了 重复 特性 的 信息 在 Mckeown 的 ATN 中 通过 环来 表示 Schema 或 Predicate 实现 重复 任意 次数 遇到 此类情况 需要 多次 匹配 每次 只 从 匹配 结果 中 选取 一个 Proposition 在 改进 后 的 ATN 中 Schema 或 Predicate 重复 任意 次数 既 可以 用 上述 方法 实现 也 可以 用 一条 弧 （ 重复 特性 为 “ ” ） 实现 如果 用后 一种 方法 实现 只 需 一次 匹配 便 可 输出 多个 Proposition 便于 对 它们 按照 时间 、 空间 等 顺序 排序 对 这 两种 方法 IF 的 移动 情况 是 不同 的 如果 用环 实现 那么 同一 Predicate 所 对应 的 多个 Proposition 之间 的 IF 允许 通过 规则 或 规则 转移 如果 用 “ ” 型 弧 实现 那么 这些 Proposition 之间 的 IF 相对 于 前面 的 句子 来说 是 一种 并列 关系 应该 根据 具体情况 选择 合适 的 方法 例如 介绍 事物 属性 的 Attributive 谓词 就 适宜 用后 一种 方法 实现 因为 Attributive 着重 对 事物 的 属性 加以 介绍 中间 IF 不 应该 转移 否则 可能 出现 下列 情况 使 文本 结构 变得 松散 而 不连贯 文本 中 的 黑体字 表示 连贯 部分 　 　 　 　 弹道导弹 型 核潜艇 是 一种 战略武器 Focus 弹道导弹 型 核潜艇 弹道导弹 是 装有 弹头 和 动力装置 并 能 制导 的 高速 飞行 武器 Focus 弹道导弹 弹道导弹 的 射程 较远 Focus 弹道导弹 弹道导弹 的 飞行轨道 是 椭圆 曲线 Focus 弹道导弹 弹道导弹 型 核潜艇 在 首部 设有 ～ 个 鱼雷 发射管 Focus 弹道导弹 型 核潜艇 弹道导弹 型 核潜艇 一般 携带 ～ 枚 核弹头 的 弹道导弹 Focus 弹道导弹 型 核潜艇 弹道导弹 型 核潜艇 长期 在 水下 活动 出没无常 难以 发现 Focus 弹道导弹 型 核潜艇 　 焦点 控制算法 　 　 为了 加入 对 IF 移动 规则 、 Schema 递归 以及 填充 过程 中 回溯 的 处理 我们 改进 了 Mckeown 的 焦点 算法 中 的 栈式 控制结构 采用 树型 控制结构 （ 称之为 焦点 控制 树 ） 这样 做 的 目的 主要 有 两个 ① 原来 的 栈式 结构 不 适合 处理 Schema 递归 而树 是 一个 具有 递归 定义 的 数据结构 如果 将 一个 Schema 对应 文本 按 焦点 的 转移 规律 组成 一棵树 那么 Schema 的 递归 可以 看成 是 将 树 中 的 结点 扩展 成 一棵 新 的 子树 这样 可以 方便 地 实现 递归 ② 采用 树型 控制结构 可以 保留 迄今为止 产生 的 所有 文本 及其 焦点 信息 便于 进行 回溯 在 栈式 控制结构 中 如果 执行 了 出栈 操作 则 很 难 在 回溯 的 时候 恢复 以前 的 状态 在 树型 控制结构 中 填充 Schema 的 过程 就是 焦点 控制 树 不断 生长 的 过程 在 回溯 的 时候 只 需 回到 先前 生成 的 某 一 结点 删去 其子 树 即可 算法 中 的 回溯 分为 两个 阶段 第 阶段 是 在 规则 和 规则 不能 适用 时 通过 回溯 寻找 焦点 栈中 符合 规则 的 元素 如果 找到 则 匹配 相应 的 Proposition 否则 回溯到 当前 填充 Schema 对应 的 子树 的 根 结点 利用 规则 作 筛选 如果 还 不能 找到 合适 的 Proposition 则 恢复 第 阶段 回溯 以前 的 状态 在 第 阶段 回溯 时 逐步 删除 已经 构建 好 的 焦点 控制 树 选择 ATN 图中 的 其他 候选 Predicate 进行 匹配 第 阶段 的 回溯 不 允许 跨 Schema 进行 第 阶段 的 回溯 允许 跨 Schema 进行 可以 将 原先 采用 Schema 实现 填充 但 没有 成功 的 符号 改用 Predicate 实现 匹配 继续 尝试 　 　 选用 二叉树 作为 控制结构 每个 结点 的 左子 树 表示 与 该 结点 具有 相同 CF 的 结点 右子 树 表示 由 具有 该 结点 的 CF 引伸出 的 新 焦点 的 结点 或者 是 被 嵌套 的 Schema 所 对应 子树 的 根 结点 二叉树 中 的 每个 结点 可能 对应 文本 中 的 一个 Proposition 也 可能 是 为了 构造 焦点 控制 树 的 需要 而 虚设 的 结点 不 对应 任何 实际 的 Proposition 每个 结点 都 表示 填充 Schema 过程 中 的 中间状态 包含 如下 信息 ① 当前 正在 填充 的 Schema 包括 其 对应 的 ATN 、 子树 的 根 结点 和 GF ② Schema 对应 的 ATN 中 到达 的 状态 ③ 匹配 所得 的 Proposition 包括 Proposition 的 CFPFL 等 ④ 回溯 时 的 前驱 结点 如果 前驱 结点 是 父 结点 则 以 表示 ⑤ 若 是 Schema 所 对应 子树 的 根 结点 还 需 记录 当前 进行 的 匹配 是 按照 Schema 实现 扩展 填充 还是 Predicate 实现 进行 匹配 回溯 时 对 Schema 扩展 填充 将 其 改用 Predicate 实现 继续 尝试 对 Predicate 匹配 则 进一步 向前 回溯 所以 对于 ATN 中 的 每个 状态 实际 匹配 时 进行 选择 的 优先权 从 高到 低 依次 为 最高 优先权 弧 的 Schema 实现 最高 优先权 弧 的 Predicate 实现 次 高 优先权 弧 的 Schema 实现 次 高 优先权 弧 的 Predicate 实现 依此类推 　 　 对 Schema 中 匹配 的 第个 Proposition 焦点 栈为 空故 没有 前句 的 PFL 可 供选择 所以 规则 和 规则 都 不 可能 使用 此时 CF 可以 是 该 Schema 的 GF （ 规则 的 推广 ） 或者 其 IRF 中 的 元素 （ 规则 ） 在 算法 中 在 每个 Schema 对应 子树 的 根 结点 中置 CFGF 其他 Proposition 信息 为 null 这样 在 匹配 Schema 的 第个 Proposition 时 就 只能 使用 规则 和 规则 了 下面 给出 按照 条 IF 移动 规则 选出 Proposition 后 对 焦点 控制 树 的 处理 以 C 表示 控制 树中 的 当前 结点 NNN 表示 新 增加 的 结点 水平 链 表示 二叉树 的 右子 树 垂直 链 表示 二叉树 的 左子 树 SchemaStatusPropositionPrec 和 Match 域 分别 表示 结点 的 上述 类 信息 　 　 算法 选出 符合 IF 移动 规则 的 Proposition 后 对 焦点 控制 树 的 处理 　 　 ① 按照 表 扩展 焦点 控制 树 ② 如果 被 匹配 的 弧 有 Schema 实现 置 C ＝ N 否则 置 C ＝ NTable 　 Processingforcontrollingtreeoffocusinalgorithm 表 　 算法 对 焦点 控制 树 的 处理 　 　 　 算法 选出 符合 IF 移动 规则 的 Proposition 后 对 焦点 控制 树 的 处理 　 　 ① 基本 与 算法 的 步骤 相同 不同之处 是 当 被 匹配 的 ATN 弧 没有 Schema 实现 且 重复 特性 为 “ ” 时新 增加 的 结点 N 是 当前 结点 C 的 左子 树 而 不是 右子 树 ② 如果 被 匹配 的 弧 有 Schema 实现 置 CN 否则 置 CN 　 　 算法 选出 符合 IF 移动 规则 的 Proposition 后 对 焦点 控制 树 的 处理 　 　 在 第 阶段 回溯 的 时候 应用 规则 设 第 阶段 回溯 前 的 当前 结点 为 C 在 第 阶段 回溯 时 从 当前 结点 开始 沿着 二叉树 向 祖先 方向 寻找 能 应用 规则 的 结点 设 找到 的 结点 为 F 　 　 ① 按表 扩展 焦点 控制 树 目的 是 建立 第 阶段 回溯 的 Prec 前驱 结点 链 并 置 CP ② 与 算法 的 步骤 相同 但 所有 新增 结点 的 Prec 域 都 置 为 C ③ 如果 被 匹配 的 弧 有 Schema 实现 置 CN 否则 置 CNTable 　 Processingforcontrolingtreeoffocusinalgorithm 表 　 算法 对 焦点 控制 树 的 处理 　 　 算法 选出 符合 IF 移动 规则 的 Proposition 后 对 焦点 控制 树 的 处理 　 　 设 第 阶段 回溯 前 的 当前 结点 为 C 在 第 阶段 回溯 结束 尚未 找出 合适 的 Proposition 的 时候 应用 规则 此时 已 回溯到 当前 填充 Schema 对应 子树 的 根 结点 　 　 ① 从 该 根 结点 开始 沿左子 树链 寻找 最 深层 的 结点 设为 F ② 以下 同 算法 　 　 下面 给出 填充 Schema 时 完整 的 焦点 移动 控制算法 算法 　 　 ① 初始化 设置 根 结点 Root 其中 RootSchema 待 填充 匹配 SchemaRootStatus 待 填充 匹配 的 Schema 所 对应 的 ATNRootPropositionnullRootPrecRootMatchPredicateMatchCRoot 　 　 ② 根据 从 当前 结点 出发 具有 下 一 优先权 的 弧 的 Predicate 实现 选择 与 之 匹配 的 Proposition 　 　 ③ 如果 下 一个 待 匹配 的 弧为 jump 类型 按表 扩展 焦点 控制 树置 CN 然后 转 ⑨ Table 　 Processing （ ） forcontrolingtreeoffocusinalgorithm 表 　 算法 对 焦点 控制 树 的 处理 （ ） 　 　 ④ 如果 存在 符合 规则 的 Proposition 按照 算法 处理 然后 转 ⑨ 　 　 ⑤ 如果 存在 符合 规则 的 Proposition 按照 算法 处理 然后 转 ⑨ 　 　 ⑥ 进行 第 阶段 回溯 　 　 while 允许 继续 向上 回溯 （ 即 不 回溯到 上 一 层次 的 Schema ） if 存在 符合 规则 的 Proposition 按照 算法 处理 然后 转 ⑨ 当前 结点 当前 结点 的 父 结点 　 　 ⑦ 如果 存在 符合 规则 的 Proposition 按照 算法 处理 然后 转 ⑨ 　 　 ⑧ 进行 第 阶段 回溯 恢复 第 阶段 回溯 前 的 当前 结点 Cwhiletrue 　 删去 当前 结点 的 子树 　 if 从 当前 结点 出发 有 更 低 优先权 的 弧 选择 这样 的 弧 进行 匹配 然后 转 ⑨ 　 if 当前 结点 C 当前 结点 C 的 Schema 所 对应 子树 的 根 结点 　 　 ifCMatchSchemaMatch 　 　 　 　 CMatchPredicateMatchtempCPrec 　 　 　 　 CSchematempSchemaCStatustempStatus 　 　 　 　 if 当前 结点 C 有右子 树 　 当前 结点 C 当前 结点 C 的 右子 树 　 　 　 　 else 当前 结点 C 当前 结点 C 的 前驱 结点 的 左子 树 然后 转 ⑨ 　 　 else 整个 Schema 匹配 失败 算法 结束 　 　 　 　 当前 结点 C 当前 结点 C 的 前驱 结点 　 　 ⑨ while 当前 结点 CStatus 是 ATN 的 终止 状态 　 　 　 　 当前 结点 C 当前 结点 C 的 Schema 所 对应 子树 的 根 结点 　 　 　 　 if 当前 结点 C 是 整棵 二叉树 的 根 结点 　 整个 Schema 填充 匹配 成功 算法 结束 　 　 　 　 elseif 当前 结点 有右子 树 　 当前 结点 C 当前 结点 C 的 右子 树 　 　 　 　 　 　 　 　 else 当前 结点 C 当前 结点 C 的 前驱 结点 的 左子 树 　 　 转 ② 　 　 注为 当前 结点 C 增加 右子 树时 如果 C 的 右子 树 已经 非空则 先为 C 增加 一个 左子 树如表 所示 然后 置 CPTable 　 Processing （ ） forcontrolingtreeoffocusinalgorithm 表 　 算法 对 焦点 控制 树 的 处理 （ ） 　 　 此外 还 需注意 在 第 阶段 回溯 沿 Prec 链 查找 时 如果 CPrec 那么 C 的 前驱 结点 就是 其父 结点 否则 C 的 前驱 结点 是 CPrecPrec 即要 向前 回退 两次 如果 匹配 得到 多个 Proposition 符合 同一 焦点 移动 规则 若 被 匹配 弧 的 重复 特性 为 “ ” 则 将 这些 Proposition 按照 指定 的 顺序排列 后 依次 放置 到 焦点 控制 树上 若 被 匹配 弧 的 重复 特性 为 “ ” 则 将 这些 Proposition 按照 指定 的 顺序排列 后 选择 最 前面 的 Proposition 放置 到 焦点 控制 树上 　 实验 系统 设计 　 　 根据 改进 的 焦点 控制算法 设计 了 一个 实验 系统 以 验证 算法 的 效果 实验 系统 主要 是 实现 文本 规划 阶段 的 焦点 控制 及其 与 Schema 填充 的 相关 部分 系统 的 输入 数据 有 ① 参数 定义 定义 Predicate 中 使用 的 各种 参数 的 信息 ② Predicate 定义 定义 Schema 中 使用 的 Predicate 的 名称 、 参数 格式 等 信息 ③ Schema 定义 定义 待 填充 匹配 的 Schema 的 结构 ④ 知识库 定义 定义 填充 匹配 Schema 的 知识 所有 输入 信息 都 采用 文本文件 方式 定义 为了 便于 实现 还 对 部分 定义 作 了 简化 实验 系统 根据上述 定义 来 输入 利用 焦点 控制算法 输出 填充 匹配 后 的 Proposition 序列 并 跟踪 算法 的 中间 过程 实验 系统 的 总体 结构 如图所示 Fig 　 Architectureforexperimentalsystem 图 　 实验 系统 的 总体 结构 　 　 焦点 控制算法 在 上 一节 已经 作 了 详细描述 这里 给出 由 焦点 控制 树 得出 Proposition 序列 的 递归 算法 　 　 GetText （ 参数 焦点 控制 树 的 根 结点 root ） 　 　 ifroot 算法 结束 　 　 ifroot 不是 某一 Schema 所 对应 子树 的 根 结点 　 　 　 　 　 ifroot 的 Proposition 信息 不为 null 输出 root 的 Proposition 　 　 　 　 　 GetTextroot 的 右子 树根 结点 　 　 　 　 　 GetTextroot 的 左子 树根 结点 　 　 　 　 elseGetTextroot 的 左子 树 的 根 结点 GetTextroot 的 右子 树根 结点 　 　 下面 我们 讨论 实现 中 的 若干 问题 　 　 可 交换 符号 “ ‖ ” 及其 实现 　 　 Schema 表示 中 的 可 交换 符号 ［ ］ 的 作用 是 使 前后 相关 的 若干 成分 的 次序 可以 交换 文本 生成 时 根据 特定 的 条件 进行 排列 P ‖ P 相当于 PPPP 对应 的 ATN 如图所示 图中 弧 〈 〉 和 〈 〉 的 优先级 是 相同 的 P 和 P 可能 是 由 另 一个 Schema 递归 嵌套 来 实现 在 状态 处 判别 P 和 P 的 取舍 （ 即 选择 哪一条 路径 ） 实际上 是 取舍 P 和 P 的 Predicate 实现 为此 在 知识库 中为 每个 Proposition 设立 优先级 Fig 　 ATNofP ‖ P 图 　 P ‖ P 所 对应 的 ATN 　 　 当 存在 多个 Predicate 匹配 得出 的 Proposition 符合 同一 焦点 移动 规则 时 选择 优先级 较 高 的 一个 以表 所示 的 天气预报 Schema 为例 在 匹配 了 Title 之后 分别 匹配 WeatherAmplification 和 StormAmplification 的 Predicate 实现 Title 和 Attributive 得 Title 今天 夜里 和 明天 上海市 和 长江口 区 天气预报 Attributive 今年 第 号 台风 的 中心 位置 已经 到达 台湾省 恒春 市 东南 大约 公里 的 洋面 上 在 夏季 可以 设 的 优先级 的 优先级 先 填充 台风 的 描述 之一 StormAmplification 后 填充 天气 的 描述 WeatherAmplification 在 其他 季节 可以 设 的 优先级 的 优先级 先 填充 天气 的 描述 WeatherAmplification 后 填充 台风 的 描述 StormAmplification 这样 可以 突出 两者 在 不同 季节 的 重要性 Table 　 Schemaofweatherforecast 表 　 天气预报 的 Schema 　 　 在 不同 的 应用领域 需要 设置 不同 的 辅助 程序 来 确定 IRF 关系 、 Proposition 优先级 和 排序 信息 等 内容 这些 信息 的 提供 与 各自 的 领域 知识 相关 　 　 IF 移动 规则 的 使用 应 注意 避免出现 焦点 循环 即 在 下述 序列 中 PropositionCFAPFLBPropositionCFBPFLAPropositionCFAPFLProposition 与 前文 的 关系 体现 的 应该 是 规则 而 不是 规则 也就是说 在 实际 使用 规则 时 PFL 除了 要 删去 已 被 选中 的 CF 外 还 应该 删去 当时 在 焦点 栈中 的 元素 CF 要 转入 焦点 栈中 的 元素 即使 该 元素 还 出现 在 PFL 中 也 必须 使用 规则 　 　 如果 使用 IF 移动 规则 或者 规则 的 弧 的 重复 特性 为 “ ” 且 该 弧 的 Schema 实现 不是 null 那么 每个 选出 的 Proposition 都 可能 扩展 成 另 一个 Schema 所 对应 的 描述 此时 应该 对 这些 Proposition 执行 压缩 操作 对 焦点 相同 的 Proposition 只 保留 一个 避免 多个 展开 的 Schema 描述 具有 相同 的 GF 　 结束语 　 　 新 算法 在 以下 几 方面 进行 了 改进 　 　 改进 了 Schema 的 ATN 表示 使 Schema 表达式 中带 “ ” 和 “ ” 的 Predicate 在 ATN 中有 了 两种 表示 方法 可以 根据 不同 的 文本 特点 选择 相应 的 表示 方法 　 　 将 栈式 控制结构 改进 为树型 控制结构 保留 了 所有 填充 过程 中 得到 的 Proposition 及其 焦点 信息 实现 了 Schema 的 递归 和 填充 匹配 过程 中 的 回溯 确定 了 Schema 递归 时 GF 的 移动 和 控制 方法 为了 实现 回溯 还 在 ATN 的 弧 中 增加 了 优先级 　 　 完善 了 IF 移动 规则 将条 规则 同时 运用 相对 增加 了 文本 焦点 转移 的 灵活性 使 算法 适合 更 广泛 的 应用领域 　 　 增加 了 对 并列 关系 或 句式 相同 的 句子 的 排序 这是 文本 连贯性 的 一个 重要 方面 虽然 本文 没有 给出 具体 的 排序 方法 （ 这 与 应用领域 有关 ） 但 在 实验 系统 中 已 加入 了 对 排序 结果 的 应用 　 　 增加 了 对 可 交换 符号 的 处理 为 Proposition 设立 了 优先级 　 　 语言 是 多层次 的 因此 语篇 的 衔接 与 连贯 必然 在 不同 层面 上 有所 反映 包括 音系层 、 句法 层 、 词汇 层 、 语义 层 、 社会 符号 层 等 ［ ］ 本文 的 算法 主要 是 针对 语义 层 使 生成 的 文本 保证 连贯性 这 与 具体 的 自然语言 语种 是 无关 的 文本 生成 过程 中 还 可以 在 句法 层 （ 包括 句式 选择 、 结构 衔接 等 ） 和 词汇 层 （ 包括 指称 、 词汇 衔接 等 ） 等 层次 上 研究 文本 连贯性 控制 的 方法 这 就 与 具体 的 语种 相关 了 ■ 基金项目 ： 本文 研究 得到 国家自然科学基金 No 、 上海市科委 科技 发展 基金 　 　 　 　 　 No 和 德国大众 基金 VW 资助 作者简介 ： 姚天 昉 年生 副教授 主要 研究 领域 为 机器翻译 自然语言 生成 　 　 　 　 　 汤学彦年生 硕士生 主要 研究 领域 为 自然语言 生成 计算机网络 作者 单位 ： 姚天 昉 上海交通大学 计算机科学 与 工程系 　 上海 　 　 　 　 　 　 汤学彦 上海交通大学 计算机科学 与 工程系 　 上海 　 参考文献 ： ［ ］ ColeRAetalSurveyofthestateoftheartinhumanlanguagetechnologyhttpwwwcoliunisbde ～ hansuTheWebPagefortheDepartmentofComputationalLinguisticsattheUniversityoftheSaarland ［ ］ MckeownKRTextGenerationUsingDiscourseStrategiesandFocusConstraintstoGenerateNaturalLanguageTextCambridgeCambridgeUniversityPress ～ ～ ～ ［ ］ YaoTianshunNaturalLanguageUnderstandingAStudyofMakingaMachineUnderstandHumanLanguageBeijingTsinghuaUniversityPress ～ 姚 天顺 自然语言 理解 — — 一种 让 机器 懂得 人类 语言 的 研究 北京 清华大学出版社 ～ ［ ］ WangXianYaoTianfangDesignandimplementationofmacroplannerforChineseweatherforecastautomatedgenerationsystemInChenLiweiYuanQiedsLanguageEngineeringBeijingTsinghuaUniversityPress ～ 王纤 姚天 昉 汉语 天气预报 文本 内容 规划 器 的 设计 与 实现 见 陈力 为 袁琦编 语言 工程 北京 清华大学出版社 ～ ［ ］ CaiZixingXuGuangyouArtificialIntelligencePrinciplesandApplicationsndedBeijingTsinghuaUniversityPress ～ 蔡自兴 徐光 祐 人工智能 及其 应用 第版 北京 清华大学出版社 ～ ［ ］ HuZhuanglinTheJoiningandCoherenceofDiscourseShanghaiShanghaiForeignLanguageEducationPress ～ 胡壮麟 语篇 的 衔接 与 连贯 上海 上海 外语 教育 出版社 ～ 收稿 日期 ： 修稿 日期 ：