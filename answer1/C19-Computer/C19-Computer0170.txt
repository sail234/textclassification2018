软件 学报 JournalofSoftwareVolNoP 一种 基于 形状 的 图像 信息检索 方法 刘继敏 　 史忠植 摘 　 要 　 该文 把 一幅 图像 看成 是 由 一些 区域 构成 的 这些 区域 在 其 内部 有着 颜色 或 纹理 等 方面 的 相似性 图像 的 形状 由 这些 区域 的 边界线 及其 空间 关系 来 描述 要 根据 图像 中 所 包含 的 物体 或 场景 在 形状 方面 的 特征 进行 检索 关键问题 是 形状 相似性 的 度量 及其 空间 关系 的 表示 与 匹配 文章 应用 变形 模板 匹配 技术 提出 了 较为 合理 的 简单 形状 相似性 计算方法 而 这些 简单 形状 之间 的 空间 关系 则 由 二维 集合 串来 表示 文章 还 给出 了 空间 关系 匹配 算法 在 检索 方法 上将 整个 检索 过程 分为 初级 检索 、 检索 求精 与 空间 关系 匹配 个 阶段 实验 表明 此 方法 既有 较 高 的 检索 速度 又 有 较 高 的 检索 精度 关键词 　 相似性 二维 集合 串 基于 形状 的 检索 图像 库 中图法 分类号 　 TPAShapeBasedImageInformationRetrievalMethodLIUJimin 　 SHIZhongzhiInstituteofComputingTechnology 　 TheChineseAcademyofSciences 　 Beijing 　 Abstract 　 AnimagecanbeconsideredasacombinationofregionswhichhavesomeintrinsichomogeneitiesincolorortextureetcTheshapesinanimagearedescribedbytheboundariesoftheseregionsandtheirspatialrelationsToretrieveimagebyshapeitisakeyproblemtomeasurethesimilarityamongshapesandmatchtheirspatialrelationsAdoptingtemplatematchingtechniquetheauthorspresentacomputationmethodforsimpleshapesimilarityBasedonthetwodimensionalsetstringrepresentationofthespatialrelationofthesesimpleshapesaspatialrelationmatchalgorithmisalsopresentedThewholeretrievalprocessisdividedinthreestagesietheroughstagetherefiningstageandthespatialrelationmatchingstageTheexperimentshowsthismethodisrapidandaccurateKeywords 　 SimilarityDsetstringshapebasedretrievalimagedatabase 　 　 基于 形状 的 图像 信息检索 是 基于 内容 的 图像 信息检索 的 一个 十分 重要 的 方面 目前 已有 不少 基于 内容 进行 检索 的 实用 系统 如 QBICPhotobookVisualSeek 等 这些 系统 在 根据 颜色 与 纹理 等 信息 进行 检索 时所 得到 的 检索 结果 与 所 期待 的 结果 较为 接近 在 根据 形状 信息 进行 检索 时 它们 是 用 形状 所 具有 的 特征 如 周长 、 面积 、 矩 不 变量 等 来 描述 形状 并 由此 建立 索引 进行 检索 文献 ［ ］ 也 是 采用 类似 的 方法 这种 根据 索引 进行 检索 的 方法 检索 速度 快 但是 形状 的 特征描述 仅仅 是 在 一定 的 程度 上 体现 了 人们 对 形状 的 感知 给 人 感觉 到 完全 不同 的 形状 可能 有 相同 的 特征 量 因而 这种 方法 的 检索 结果 与 用户 想要 得到 的 结果 往往 会 相差 很大 而且 在 实际 中 特征 量 的 提取 都 会 有 不同 程度 的 误差 这 势必 进一步 影响 到 检索 的 精度 　 　 与此相反 在 文献 ［ ］ 中 应用 了 变形 模板 技术 把 用户 提供 的 形状 看作 模板 并 与 图像 库中 的 形状 进行 匹配 这一 方法 是 直接 把 两个 形状 进行 比较 而 不是 比较 其 特征 量 因而 有 较 高 的 精度 但是 在 检索 时 由于 是 将 模板 与 每 一个 图像 进行 匹配 而且 每 一次 匹配 都 有 很大 的 计算 量 因而 这一 方法 的 检索 速度慢 　 　 为了 既 提高 检索 速度 又 保证 较 高 的 检索 精度 我们 的 做法 是 ： 对 每个 存储 在 图形库 中 的 图像 提取 其 具有 显著 形状 特征 的 区域 每个 区域 的 边缘 是 一个 简单 形状 或 由 几个 简单 形状 构成 这里 简单 形状 是 指 平面 上 的 简单 闭 曲线 图像 的 形状 由 这些 区域 的 边界线 及其 空间 关系 来 描述 如图所示 SimpleshapeareboundariesoftheregionsthathavenotablefeaturesTheshapeoftheoriginalimageisrepresentedwiththethreesimpleshapesandtheirrelationship 简单 形状 是从 原始 图像 中 提取 的 具有 显著 形状 特征 的 区域 的 边界 我们 用 这个 简单 形状 及其 空间 关系 来 描述 原始 图像 所 具有 的 形状 特征 Fig 　 Shaperepresentation 图 　 形状 的 描述 　 　 我们 将 这些 简单 形状 保存起来 同时 将 其 周长 、 面积 等 形状 特征 存入 特征 库 在 进行 检索 时 用户 直接 画出 一个 或 几个 简单 形状 作为 其 查询 要求 如图所示 InordertoretrievetheoriginalimageinFigtheusercandirectlydrawoneormoresimpleshapeswhichheconcernsasresearchqueryeg 为了 从 图像 库中 检索 出图 中 的 原始 图像 用户 只要 直接 画出 他 所 关心 的 个 或 几个 简单 形状 作为 其 查询 要求 如 abcFig 　 Thesubmissionoftheresearchquery 图 　 查询 要求 的 提交 　 　 系统 根据 各 简单 形状 的 特征 量 进行 初次 检索 检索 出 包含 所有 这些 简单 形状 的 图像 再用 变形 模板 匹配 技术 ［ ］ 进行 检索 求精 排除 相似 度 较 小 的 图像 最后 如果 用户 提交 的 是 多个 简单 形状 还要 根据 其 隐含 的 空间 关系 对 检索 出 的 图形 进行 空间 关系 匹配 排除 空间 关系 不 匹配 的 图像 并 把 最后 剩下 的 图像 按 相似 度 从 大到 小 返回 给 用户 系统 流程图 如图所示 Fig 　 Systemflowchatr 图 　 系统 流程图 　 　 本文 第节 讨论 形状 相似性 的 度量 第节 讨论 空间 关系 的 表示 及其 匹配 问题 提出 了 用 二维 集合 串 表示 简单 形状 之间 空间 关系 的 方法 并 给出 了 空间 关系 的 匹配 算法 第节 讨论 基于 形状 的 图像 检索 算法 第节 就 有关 问题 进行 了 进一步 的 探讨 　 形状 相似性 的 度量 　 　 假设 我们 能 计算 出 简单 形状 的 n 个 特征 量 fffn 这些 特征 量 可以 是 面积 、 周长 、 矩等 具体 计算方法 本文 不再 叙述 可 参考 通常 的 图像处理 方面 的 文献 如 文献 ［ ］ 用 X ｛ fXfXnfXn ｝ 表示 简单 形状 X 的 n 个 特征 量 为 fXfXnfXn 对 A ｛ fAfAnfAn ｝ 与 B ｛ fBfBnfBn ｝ 而言 我们 可以 用 如下 的 特征 距离 disfAB 来 刻画 相似 度 SimilarfAB ： 其中 ω iin 为 预先确定 的 常数 反映 了 每个 特征 量 的 重要 程度 disfAB 越小 表示 SimilarfAB 越大 　 　 我们 认为 简单 形状 之间 的 相似性 度量 是 形状 相似性 度量 的 关键 上述 方法 是 用 特征 量 之 差来 度量 相似 度 基于 特征 的 检索 方法 一般 都 是 用 与 此类 似的 方法 但是 我们 很难 找到 刻画 形状 本质 的 特征 量 在 我们 所 选取 的 特征 量 中 不可避免 地会 出现 不同 的 形状 具有 几乎 相等 的 特征 量 的 情况 因而 上述 度量 方法 有时 会 有 较大 的 误差 为 得到 较为 精确 的 SimilarfAB 我们 再 提出 基于 模板 形变 的 方法 该 方法 是 对 文献 ［ ］ 中 的 方法 的 简化 其 步骤 如下 ： 　 　 将 简单 形状 A 用 样条 曲线 来 表示 并 选取 适当 的 能量 公式 一个 简单 的 方法 是 将 A 等距 分割 将 分割 点 作为 样条 曲线 的 控制点 假定 其 控制点 为 ckkl 记 Cccck 由 C 所 决定 的 样条 曲线 相对 弧长 S 的 参数 方程 表示 为 Γ CS 其 长度 为 LC 把 曲线 Γ CS 作为 模板 假设 其 能量 为 其中 α β 为 能量 权值 为 Bend 能 E 与 E 构成 模板 的 内能 ExtCSdS 为 外能 这里 我们 取 ExtCSeKdCS 其中 dCS 为 Γ CS 上 的 点 到 简单 形状 B 的 距离 K 为 预先确定 的 常数 上述 的 能量 公式 是 我们 对 文献 ［ ］ 中 的 能量 公式 作 了 很大 的 改进 之后 得到 的 关于 样条 曲线 参见 文献 ［ ］ 　 　 对 A 作 任意 平移 与 适当 的 旋转 选取 使 E 最大 的 位置 作为 A 开始 形变 的 初始 位置 　 　 调节 参量 C 对 A 作拟 相似 形变 使 EC 达到 极小 　 　 把 ELC 作为 匹配 的 相似 度 详细 算法 及 有关 实验 结果 参见 文献 ［ ］ 　 空间 关系 的 表示 与 匹配 　 　 为了 描述 简单 形状 集合 Ω ｛ AAAn ｝ 的 空间 关系 我们 将 各 简单 形状 的 重心 向 X 轴 与 Y 轴 投影 在 X 轴 与 Y 轴上 分别 得到 两个 集合 串 X Ω X Ω X Ω s Ω 与 Y Ω Y Ω Y Ω t Ω 如图所示 　 　 X Ω X Ω X Ω s Ω 有 如下 性质 ： 　 　 这就是说 X Ω iis Ω 是 集合 ｛ AAAn ｝ 的 一个 划分 　 　 如果 ｜ A ） x （ Aj ） x ｜ ＜ ε Ai ∈ X Ω pAj ∈ X Ω q 则 X Ω p ＝ X Ω q 其中 （ Ai ） x 表示 Ai 的 重心 在 X 轴上 的 投影 关于 X 轴 的 坐标 ε 是 预先确定 的 常数 这一 性质 表明 当 两个 形状 的 投影 坐标 相差 不大时 应归为 同 一类 这 主要 是 考虑 到 在 实际 计算 时 本身 有 误差 的 存在 　 　 如果 Ak ∈ X Ω iAl ∈ X Ω ji ＜ j 则 （ Ak ） x ＜ （ Al ） x 　 　 Y Ω Y Ω ． ． ． Y Ω t Ω 也 有 类似 的 性质 　 　 用 这 两个 集合 串 我们 可以 方便 地 描述 简单 形状 集合 各 元素 之间 的 相对 空间 关系 　 　 对 两个 形状 集合 Ω ＝ ｛ AA ． ． ． An ｝ 与 Ω ＝ ｛ BB ． ． ． Bn ｝ 如果 存在 对应 使得 F （ X Ω i ） ＝ X Ω iF （ Y Ω i ） ＝ Y Ω i 则 称 Ω 与 Ω 有 相同 的 相对 空间 关系 这时 我们 还 可以 定义 他们 的 结构 距离 为 ： disF （ Ω Ω ） ＝ 其中 d （ AiAj ） 表示 Ai 与 Aj 的 重心 之间 的 距离 disF （ Ω Ω ） 可以 看作 是 对 Ω 与 Ω 的 绝对空间 关系 的 相似 度 的 一种 度量 方式 disF （ Ω Ω ） 越小 表明 Ω 与 Ω 的 空间结构 越 相似 　 　 现在 我们 来 看看 空间 关系 的 匹配 问题 为 明确 起 见 我们 先 以 实际 例子 来 进行 说明 　 　 假设 用户 在 平面 上画 出 ABCD 这个 简单 形状 如图所示 图像 库中 的 某个 图像 所 包含 的 简单 形状 如图所示 并且 通过 简单 形状 相似性 计算 已 确定 匹配 关系 ： ABCD 我们 的 问题 是 ： 在 图 中 是否 存在 形状 子集 ｛ abcd ｝ ｛ ｝ 使得 AaBbCcDd 并且 ｛ abcd ｝ 与 ｛ ABCD ｝ 有 相同 的 相对 空间 关系 ？ 由图 可见 这一 问题 的 答案 是 abcdFig 　 Representationofspatialrelationship 图 　 空间 关系 的 表示 Fig 　 Exampleforspatialrelationmatching 图 　 空间 关系 匹配 用例 　 　 在 一般 情况 下 我们 的 问题 描述 如下 　 　 已知 Ω ＝ ｛ AAAn ｝ Ω ＝ ｛ BBBm ｝ AiSiinSi Ω 　 　 求 aiin 使 其 满足 ai ∈ Siin 并且 在 映射 Aiai 之下 ｛ aaan ｝ 与 ｛ AAAn ｝ 具有 相同 的 相对 空间 关系 　 　 对 这 一 问题 我们 给出 如下 算法 　 　 　 　 　 　 很 显然 在 实现 图像 空间 关系 检索 方面 我们 这里 提出 的 方法 简单明了 优于 一般 的 关系 图 匹配 方法 　 形状 检索 算法 　 　 由于 关系 型 数据库 提供 了 一些 很 好 的 检索 方法 因此 我们 将 特征 库 、 形状 库 、 图像 库 直接 用 关系 型 数据库 来 管理 其 结构 分别 是 ： Featuredatabase ① 　 Shapedatabase ② 　 Imagedatabase ③ Shapeno ④ Feature ⑤ Feature ⑤ nShapeno ④ Shapedata ⑥ Imageno ⑦ Imageno ⑦ Imagedata ⑧ ① 特征 库 ② 形状 库 ③ 图像 库 ④ 形状 号 ⑤ 特征 量 ⑥ 形状 数据 ⑦ 图号 ⑧ 图形 数据 有关 字 段 说明 如下 ： 我们 把 所有 从 图像 库中 提取 的 简单 形状 统一 编号 给予 每个 简单 形状 给予 一个 唯一 的 形状 号 ； 为了 加快 检索 速度 每个 简单 形状 的 特征 量 与其 形状 数据 本身 分开 存放 形状 数据 可以 是 这个 形状 的 BMP 图形 ； 所有 图像 也 统一 编号 给予 每个 图像 一个 唯一 的 图 号 ； 对 每个 简单 形状 还要 用 一个 图号 标记 它 是从 哪 一个 图像 中 提取 出来 的 　 　 假设 用户 提供 形状 集 为 Ω ＝ ｛ AAAn ｝ 我们 提出 如下 检索 算法 　 　 Step 输入 形状 集 Ω ＝ ｛ AAAn ｝ 确定 常数 ε 及 ε 　 　 Step 对 每 一个 Aiin 　 　 　 　 Step 提取 Ai 的 特征 量 　 　 　 　 StepShapeNoi ← 特征 库中 与 Ai 的 特征 量 距离 disf 小于 ε 的 记录 的 形状 号 　 　 　 　 Step 将 ImageNoi 置 为 空集 　 　 　 　 Step 对 ShapeNoi 中 的 每个 形状 号 Sj 　 　 　 　 Step 用 模板 形变 的 方法 确定 其 与 Ai 的 相似 度 Similarf 　 　 　 　 Step 如果 Similarf 大于 ε 则 从 图像 库 选取 所有 形状 号 为 Sj 的 图像 号 并 将 其 并入 集合 ImageNoi 否则 从 ShapeNoi 中 去掉 Sj 　 　 　 　 Step 标识 映射 Ai → ShapeNoi 　 　 Step 　 　 StepImageNo ← ImageNo 中 与 ｛ AAAn ｝ 具有 相同 的 相对 空间 关系 的 图像 　 　 Step 如果 ImageNo 为 空集 适当 增大 ε 或 减少 ε 转 Step 　 　 Step 对 ImageNo 中 的 每个 图像 计算 其 与 ｛ AAAn ｝ 的 结构 距离 并 按 结构 距离 从小到大 的 顺序 输出 一定 数量 的 图像 　 　 这一 方法 已 用于 基于 形状 的 中草药 图像 检索 实验 系统 该 系统 已有 多幅 图像 响应 时间 在 秒 以内 整个 检索 过程 分为 个 阶段 ： Step 是 基于 特征 的 初级 检索 ； Step 是 检索 求精 Step 是 空间 关系 匹配 扩充 图像 库 只 影响 Step 而 这 一 阶段 是 根据 索引 进行 检索 因而 整体 响应 时间 不会 有太大 的 影响 　 结 　 论 　 　 实验 表明 我们 的 方法 具有 较 高 的 检索 速度 同时 由于 采用 了 模板 匹配 方法 也 保证 了 较 高 的 检索 精度 　 　 在 基于 形状 的 检索 中 如何 有效 地 从 图像 中 提取 简单 形状 哪些 区域 是 具有 显著 形状 特征 的 区域 ？ 这是 基于 形状 检索 必须 解决 的 问题 在 无约束 的 情况 下 这 是 一个 十分困难 的 问题 但是 对 特定 的 应用领域 我们 可以 首先 建立 一个 可能 用于 检索 的 标准 形状 库当 把 一幅 新 的 图像 加入 图像 库时 先用 边缘 提取 ［ ］ 或 区域分割 ［ ］ 等 方法 提取 其 轮廓 然后 把 标准 形状 库中 的 形状 看成 模板 应用 模板 匹配 方法 ［ ］ 找出 其中 所 包含 的 可以 用于 检索 的 简单 形状 这 正是 我们 所 采用 的 方法 　 　 同时 我们 认为 并非 每 一幅 图像 都 可以 用 基于 形状 的 方法 进行 检索 对 一些 形状 特征 不 很 明显 的 图形 就 不好 用 基于 形状 的 方法 进行 检索 要 开发 出 一个 真正 实用 的 基于 形状 的 图像 信息检索 系统 或 子系统 必须 将 认知科学 、 计算机 视觉 、 数据库 技术 等 有机 地 结合 起来 这 将 是 一个 困难 而 有 意义 的 问题 ［ ］ 本文 研究 得到 国家自然科学基金 No 和 国家 高科技 项目 基金 No 资助 。 刘继敏 （ 中国科学院计算技术研究所 　 北京 　 ） 史忠植 （ 中国科学院计算技术研究所 　 北京 　 ） 参考文献 ． GroskyWIMehrotraRIndexBasedobjectrecognitioninpictorialdatamanagementComputerVisionGraphicsandImageProcessing ～ ． MehrotraRGaryJSimilarshaperetrievalinshapedatamanagementIEEEComputer ～ ． AlbertoDelBimboPietroPalaVisualimageretrievalbyelasticmatchingofusersketchesIEEETransactionsonPatternAnalysisandMachineIntelligence ～ ． JainAKYuZhongScridharLakshmananObjectmatchingusingdeformabletemplatesIEEETransactionsonPatternAnalysisandMachineIntelligence ～ ． LiuJiminWangWeiShiZhongzhiAnewdeformabletemplatematchingmethodChineseJournalofComputers ～ 刘继敏 王伟史 忠植 一个 新 的 变形 模板 匹配 方法 计算机 学报 ～ ． XuJianhuaImageProcessingandAnalysisBeijingSciencePress 徐 建华 图像处理 与 分析 北京 科学出版社 ． MichaelKassSnakeanactivecontourmodelsInProceedingsoftheInternationalConferenceonComputerVisionLondon ～ ． CohenFSWangJinyinnPart Ⅰ modelingimagecurvesusinginvariantDobjectcurvemodels — — apathtoDrecognitionandshapeestimationfromimagecontoursIEEETransactionsonPatternAnalysisandMachineIntelligence ～ ． CannyJAcomputationalapproachtoedgedetectionIEEETransactionsonPatternAnalysisandMachineIntelligence ～ ． ZhuSCYuilleARegioncompetitionunifyingsnakesregiongrowingandbayesMDLformultibandimagesegmentationIEEETransactionsonPatternAnalysisandMachineIntelligence ～ ． ForsythDMalikJWilenskyRDigitalimageretrievalSciences ～ ForsythDMalikJWilenskyR 检索 数字图像 科学 ～ ． StrixCImageretrievalontheWebSciences ～ StixC 在 万维网 上 寻找 图像 科学 ～ 收稿 修稿