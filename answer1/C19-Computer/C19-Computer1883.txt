微型机 与 应用 MICROCOMPUTERITSAPPLICATIONS 　 Vol 　 No 　 P 基于 单片机 控制 的 高精度 电缆 自动 测试仪 于秋瑛 顾炳永于 国桥程 春耕 段 雪松 王然伟 摘要 ： 一种 基于 单片机 控制 的 高精度 电缆 自动 测试仪 。 该 测试仪 能 实现 多芯 电缆 的 绝缘 电阻值 、 芯线 电阻值 和 分布电容 值 的 自动检测 。 关键词 ： 多芯 电缆 单片机 控制 继电器 分组 和 隔离 快速 线性化 绝缘 测试 　 　 目前 国内 一些 公司 研制 的 电缆 检测仪 在技术上 虽然 采用 单片机 控制 或 STD 总线 工业 控制机 控制 ， 但 检测 精度 不高 、 检测 速度 低 、 体积 较大 、 操作 使用 复杂 、 可靠性 差 。 我们 采用 单片机 、 继电器 分组 和 隔离 技术 、 先进 的 抗干扰 技术 、 先进 的 数值 快速 线性化 技术 及 独特 的 预充电 技术 ， 研制 了 一种 新型 电缆 自动 测试仪 。 　 系统 主要 功能 及 测量 理 　 　 本 系统 可 对 少于 芯 的 多芯 电缆 进行 芯线 电阻 、 芯线 间 绝缘 电阻 及 芯线 间 分布电容 值 的 快速 自动检测 ， 在 ～ s 内 完成 单线 测试 ； 能 准确 地 测出 电缆 芯线 的 断点 和 短路 位置 ， 并 能 对 不 合格 的 测试 结果 进行 保存 和 查询 ； 操作 使用方便 ， 更换 测试 档位 及 量程 时 ， 无需 任何 人工 校准 。 系统 采用 单片机 控制技术 ， 各种 具有 特殊 功能 的 程序 组成 抗干扰 功能 较强 的 软件包 。 测试 中 ， 给 被 测 电缆 施加 电压 、 产生 电流 ， 由 采样 电阻 把 信号 取出 ， 再 经过 放大 、 线性化 、 模数转换 ， 经 串行口 送给 单片机 进行 数据处理 ， 最后 由 单片机 把 处理结果 送 显示 和 控制 。 整个 过程 全部 智能化 和 自动化 。 　 系统 硬件 结构设计 　 　 本 系统 硬件 由 控制器 、 测试 电路 、 继电器 、 转换 矩阵 、 面板 显示 和 操作 电路 及 电源 等 部分 组成 。 其 原理 框图 如图所示 。 图 　 系统 硬件 原理图 　 控制器 　 　 控制器 由 CPU 、 EPROM 、 EEPROM 、 SRM 、 缓冲器 、 光电 耦合 器及 WDT 组成 。 CPU 为 ， 完成 本 测试仪 的 控制 和 计算 。 C 为 KBEPROM ， 完成 程序 的 存储 。 为 KBEEPROM ， 完成 预置 参数 的 存储 ， 并 能 使 在 起启电时 参数 复现 。 为 KBSRAM ， 作为 外部 存储器 。 芯片 作为 CPU 监视 定时器 （ WDT ） ， CPU 每隔 s 将 WDT 清次 零 ， 当 程序 出错 或 死循环 时 ， WDT 在 s 将 CPU 复位 ， 程序 从头开始 。 以上 器件 以为 中心 组成 系统 ， 是 整个 测试仪 的 控制中心 。 　 测试 电路 　 　 测试 电路 由 高 输入阻抗 、 高精度 的 运算 放大器 和 位 积分 模数转换器 组成 ， 完成 高精度 测量 。 由 采样 电路 、 放大 电路 、 线性化 电路 和 模数转换 电路 组成 绝缘 测试 电路 和 通路 测试 电路 。 由 RC 充放电 电路 、 脉冲 产生器 、 AD 模数转换器 等 电路 组成 电容 测试 电路 。 　 继电器 转换 矩阵 电路 　 　 该 电路 由 只 转换 继电器 、 只 隔离 继电器 和 只 译码 控制 继电器 组成 。 继电器 为 双 触点 继电器 ， 用 只 继电器 能 转接 根 芯线 到 测试 电路 ， 其中 “ ” 号 芯线 为 标校 用 接线柱 ， 这样 实际 能 转接 根 芯线 。 将 继电器 触点 分成 组 ， 每组 有 只 继电器 触点 并联 在 测试 回路 中 ， 减少 了 测试 误差 。 通过 中间 插入 只 隔离 继电器 ， 解决 了 连接 和 隔离 问题 ， 保证 了 测试 电路 的 高 绝缘 状态 。 　 显示 电路 　 　 显示 电路 由 只 MAX 集成块 、 只 LED 数码管 和 只 LED 指示灯 组成 。 MAX 为 串行接口 位 数字 LED 显示 驱动器 ， 每 只 MAX 带 只 LED 数码管 和 只 LED 指示灯 ， 只 MAX 串联 ， 串行 送 数据 。 CPU 通过 串行口 ， 每隔 s 给 NAX 的 RAM 存储器 送 显示 数据 ， MAX 根据 初始化 的 要求 ， 将 RAM 中 的 数据 自动 扫描 显示 。 　 操作 电路 　 　 操作 电路 由 只 LS 和 只 薄膜 按钮开关 组成 。 LS 为 并行 输入 、 串行 输出 的 位移 位 寄存器 。 LS 随时 将 只 薄膜 按钮开关 的 状态 存储 起来 。 CPU 通过 串行口 ， 每隔 s 取次 按钮开关 的 状态 数据 并 及时 进行 处理 ， 同时 把 结果 送 显示 或 输出 相应 的 控制 信号 。 　 系统软件 　 　 本 系统软件 用 MCS 汇编语言 生成 ， 采用 模块化 结构 和 子程序 嵌套 技术 ， 可 节省 内存 ， 便于 程序 的 编制 、 修改 、 扩充 和 联调 。 整套 程序 由 主程序 、 个子 程序 和 个 中断 服务程序 构成 ， 共条 指令 。 下面 介绍 几个 比较 重要 的 程序模块 。 　 主程序 　 　 主 程序框图 如图所示 。 主要 完成 初始化 和 s 环 检查 。 当本 系统 启电 复位 后 ， 首先 检查 P 。 如果 P 是 高电平 ， 则 进行 初始化 工作 ， 对 有关 寄存器 清零 。 从 EEPROM 取出 断电 前 存储 的 数据 ， 送到 有关 寄存器 。 对 显示 驱动器 初始化 ， 送 显示 初始值 。 定时器 T 初始化 ， 开 T 和 串行口 中断 ， 然后 进入 循环 查询 计数器 是否 为 s 。 如果 有 干扰 使 程序 出错 ， 进入 循环 后 WDT 将 CPU 复位 ， 则 程序 从头开始 。 当 计数器 为 s 后 ， 先 将 WDT 和 计数器 清零 ， 然后 对 计数器 ， 并 转 “ s 工作 子程序 ” ， 完成 个 测试 工作 周期 。 图 　 主 程序框图 子程序 　 　 子程序 主要 有 s 工作 子程序 、 按钮 处理 子程序 、 判 测试项目 子程序 、 电源 测试 子程序 、 电容 测试 子程序 、 通路 测试 子程序 、 绝缘 测试 子程序 、 取 AD 转换 数据 及 运算子 程序 、 查询 子程序 、 送 显示 数据 子程序 等 。 　 　 “ s 工作 子程序 ” 为 s 工作 次 ， 主要 完成 以下 任务 ： 判断 在 什么 工作 状态 ， 并 进入 该 状态 ； 判断 在 测试状态 中 的 各种 状态 ， 并 作出 各种 反应 及 操作 ； 对 不 合格 芯线 号 及其 测试 值 进行 寄存 ； 组织 最新 数据 送 显示 ； 组织 最新 控制 参量 送 控制 操作 ； 进行 步进 操作 。 　 　 “ 按钮 处理 子程序 ” 完成 个 按钮 的 操作 判断 ； 每个 按钮 产生 的 某种 状态 的 置位 和 某个 指示灯 的 显示 ； 预置 操作 中 完成 预置 位 的 增减 变化 和 闪亮 送数 显示 ； 查询 状态 中 完成 查询 操作 和 显示 。 　 中断 服务程序 　 　 中断 服务程序 由 “ Tms 中断 服务程序 ” 和 “ 串行 中断 服务程序 ” 组成 。 如图 、 图 所示 。 图 　 Tms 中断 服务程序 图 　 串行 中断 服务程序 　 　 “ Tms 中断 服务程序 ” 主要 完成 个 工作 。 当 T 定时器 计满 后 产生 溢出 ， 使 T 中断 标志 置 ， 产生 中断 ， 进入 中断 服务程序 ： ① 将 计数器 ， 为主 程序 检查 计数器 作 准备 ； ② 给 T 定时器 送 底数 CBH 为 T 计数器 产生 ms 溢出 作 准备 ； ③ 中断 标志 置 零 ， 为 下次 中断 作 准备 。 　 　 “ 串行 中断 服务程序 ” 完成 串行 送数 工作 。 计数器 存有 发送 和 接收数据 的 字节数 ， 进入 中断 后 ， 首先 将 计数器 减 ， 如 计数器 为 零 ， 则 串行 送数 完毕 关 串行 中断 ； 如 计数器 不为 零 ， 则 检查 T 是否 为 ， 是 为 发送 状态 ， 则 将 发送数据 输 SBUF ， 数据 被 发送 出去 ； 当 T 为 ， 为 接收 状态 ， 将 接收数据 存入 指定 位置 。 最后 将 T 、 R 置 ， 为 下次 中断 作 准备 。 　 结束语 　 　 本 测试仪 已 试用 于 实际 检测 ， 适用 于 武器装备 的 地面 电缆 网 、 舰船 电缆 网 、 飞机 电缆 网 、 工业 电缆 网 以及 通信 电缆 网 的 检测 ， 是 一种 很 有 推广 前景 的 现代 测量 仪器 。 收稿 日期 ： － －