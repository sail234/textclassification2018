软件 学报 JOURNALOFSOFTWARE 　 Vol 　 No 　 P 基于 模型 的 人体 动画 方法 劳 志强 　 潘云鹤 摘要 　 文章 从 点点 对应 ， 线线 对应 入手 ， 首先 给出 了 根据 已知 二维 影像 特征 求得 与其 对应 的 三维 模型 特征参数 的 方法 ， 然后 给出 了 已知 人体 二维 影像 特征 求解 三维 人体模型 特征参数 方法 的 详细描述 基于 这一 思想 ， 实现 了 一个 动画 系统 VideoAnimationStudio 文章 最后 给出 了 一个 由该 系统 实现 的 人体 行走 的 例子 关键词 　 人体 动画 ， 影像 特征 和 模型 特征 的 对应 关系 中图法 分类号 　 TPAModelBasedApproachtoHumanAnimation 　 LAOZhiqiang 　 PANYunhe 　 （ StateKeyLaboratoryofCADCG 　 ZhejiangUniversity 　 Hangzhou 　 ） （ InstituteofArtificialIntelligence 　 ZhejiangUniversity 　 Hangzhou 　 ） 　 Abstract 　 　 InthispaperstartingfrompointpointandlinelinecorrespondenceadetaileddescriptionofthecalculationofprojectionparametersforDvideofeaturesandDmodelfeaturescorrespondenceispresentedfirstlyThenadetaileddescriptionofthecalculationofprojectionparametersforDhumanvideofeaturesandDhumanmodelfeaturescorrespondenceisgivenAtthesametimeananimationexampleofhumanwalkingisintroducedwhichisproducedbyananimationsystemcalledVideoAnimationStudioThesystemisdesignedaccordingtotheaboveidea 　 Keywords 　 Humananimationcorrespondencebetweenvideofeaturesandmodelfeatures 　 　 AsweknowtherearetwocategoriesforthecurrentcomputervisionsystemsDepthReconstructionbasedSystemsDRS ［ ～ ］ andKnowledgebasedSystemsKS ［ ～ ］ DRSextractimagefeaturessuchasspatialvisionmotiontextureetcfromtheimagethenformaDsketchandmatchthesefeatureswithDmodelInDRSalltherecognitionworkwasdoneinDspacewhileinKSperceptionalorganizationwasemployedtoformDPerceptionalStructureGroupingsfromimagefeaturesthenknowledgematchprocedureisusedtogetmappingparameterswithDmodelWetrytofindamethodforbridgingthegapbetweenDimagesandknowledgeofDobjectswithoutanypreliminaryderivationofdepthAquantitativemethodisusedtosimultaneouslydeterminethebestviewpointandobjectparametervaluesforfittingtheprojectionofaDmodeltogivenDfeaturesThismethodallowsafewinitialhypothesizedmatchestobeextendedbymakingaccuratequantitativepredictionsforthelocationsofthoseobjectfeaturesintheimageThisprovidesahighlyreliablemethodforverifyingthepresenceofaparticularobjectsinceitcanmakeuseofthespatialinformationintheimagetothefulldegreeofavailableresolutionThefinaljudgmentastothepresenceoftheobjectcanbebasedononlyasubsetofthepredictedfeaturessincetheproblemisusuallygreatlyoverconstrainedduetothelargenumberofvisualpredictionsfromthemodelcomparedwiththenumberoffreeparameters 　 SolvingforSpatialCorrespondence 　 　 ManyareasofAIareaimedattheinterpretationofdatabyfindingconsistentcorrespondencesbetweenthedataandpriorknowledgeofthedomainInourapplicationweneedtodefinetheconsistencyconditionsforjudgingcorrespondencebetweenimagedataandDknowledgeUnlikemanyotherareasofAIanimportantcomponentofthisknowledgeisquantitativespatialinformationthatrequiresspecificmathematicaltechniquesforachievingcorrespondenceTheparticularconstraintthatwewishtoapplycanbestatedasfollowsThelocationsofallprojectedmodelfeaturesinanimagemustbeconsistentwiththeprojectionfromasingleviewpointThepreciseproblemwewishtosolveisasfollowsgivenasetofknowncorrespondencesbetweenDmodelpointsandDimagepointswhatarethevaluesoftheunknownprojectionandmodelparametersthatwillresultintheprojectionofthegivenmodelpointsintothecorrespondingimagepointsTheapproachtakeninthispaperistolinearizetheprojectionequationsandapplyNewtonsmethodforthenecessarynumberofiterations 　 ApplicationofNewtonsmethod 　 　 InthefieldofCGwecandescribetheprojectionofaDmodelpointpxyzintoaDimagepointuvwiththefollowingequationsxyzRpt 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 wheretisaDtranslationvectorRistherotationmatrixwhichtransformspointpintheoriginalmodelcoordinatesintoapointxyzincameracenteredcoordinatesThesearecombinedinthesecondequationwithaparameterfproportionaltothecamerafocallengthtoperformperspectiveprojectionintoanimagepointuv 　 　 OurtaskistosolvefortRandpossiblyfgivenanumberofmodelpointsandtheircorrespondinglocationsinanimageInordertoapplyNewtonsmethodwemustbeabletocalculatethepartialderivativesofuandvwithrespecttoeachoftheunknownparametersHoweveritisdifficulttocalculatethesepartialderivativesforthisstandardformoftheprojectionequationThepartialderivativeswithrespecttothetranslationparameterscanbemosteasilycalculatedbyfirstreparameterizingtheprojectionequationstoexpressthetranslationsintermsofthecameracoordinatesystemratherthanmodelcoordinatesThiscanbedescribedbythefollowingequationsxyzRp 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 HerethevariablesRandfremainthesameasinEqsandbutthevectorthasbeenreplacedbytheparametersDxDyandDzThetwotransformsareequivalentwhen 　 　 　 　 　 　 　 　 　 　 　 　 　 InthenewparameterizationDxandDysimplyspecifythelocationoftheobjectontheimageplaneandDzspecifiesthedistanceoftheobjectfromthecameraAswillbeshownbelowthisformulationmakesthecalculationofpartialderivativeswithrespecttothetranslationparametersalmosttrivial 　 　 WearestillleftwiththeproblemofrepresentingtherotationRintermsofitsthreeunderlyingparametersThesolutiontothissecondproblemisbasedontherealizationthatNewtonsmethoddoesnotinfactrequireanexplicitrepresentationoftheindividualparametersThereforewehavechosentotaketheinitialspecificationofRasgivenandaddtoitincrementalrotations φ x φ yand φ zaboutthexyzaxesofthecurrentcameracoordinatesystem 　 　 Anotheradvantageofusingthe φ 　 sastheconvergenceparametersisthatthederivativesofxyzandthereforeofuandvwithrespecttothemcanbeexpressedinastrikinglysimpleformForexamplethederivativeofxatapointwithrespecttoacounterclockwiserotationof φ zaboutthezaxisissimplyyThisfollowsfromthefactthatxyzrcos φ zrsin φ zzwhereristhedistanceofthepointfromthezaxisandthereforeTablegivesthesederivativesforallcombinationsofvariablesTable 　 Thepartialderivativesofxyzwithrespectto φ x φ y φ z 　 xyz φ xzy φ yzx φ zyx 　 　 UsingEqsanditisnowstraightforwardtoaccomplishouroriginalobjectiveofcalculatingthepartialderivativesofuandvwithrespecttoeachoftheoriginalcameraparametersForexampleEqtellsusthatsubstitutingczDzsimilarlyAlltheotherderivativescanbecalculatedinasimilarwayTablegivesthederivativesofuandvwithrespecttoeachofthesevenparametersofourcameramodelTable 　 Thepartialderivativesofuandvwithrespecttoeachofthecameraviewpointparameters 　 uvDxDyDzfcxfcy φ xfcxyfczcy φ yfczcxfcxy φ zfcyfcxfcxcy 　 　 OurtaskineachiterationofthemultidimensionalNewtonconvergenceisbetosolveforavectorofcorrectionsh ［ △ Dx △ Dy △ Dz △ φ x △ φ y △ φ z ］ Ifthefocallengthfisunknownthen △ fwouldalsobeaddedtothisvectorGiventhepartialderivativesofuandvwithrespecttoeachvariableparametertheapplicationofNewtonsmethodisstraightforwardForeachpointinthemodelwhichshouldmatchsomecorrespondingpointintheimagewefirstprojectthemodelpointontotheimageusingthecurrentparameterestimatesandthenmeasuretheerrorinitspositioncomparedwiththegivenimagepointTheuandvcomponentsoftheerrorcanbeusedindependentlytocreateseparatelinearizedconstraintsThenwehave 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 ForeachpointcorrespondencewederivetwoequationsFromthreepointcorrespondenceswecanderivesixequationsandproduceacompletelinearsystemwhichcanbesolvedforallsixcameramodelcorrections △ Dx △ Dy △ Dz △ φ x △ φ y △ φ zDxDx △ DxDyDy △ DyDzDz △ Dz φ x φ x △ φ x φ y φ y △ φ y φ z φ z △ φ z 　 　 ThenuseEqtoshrinkbyaboutonestepofmagnitudeofvectorDxDyDz φ x φ y φ zandnomorethanafewiterationswouldbeneededevenforhighaccuracy 　 　 InmostapplicationsofthismethodwewillbegivenmorethanthreecorrespondencesbetweenmodelandimageInthiscasetheGaussianleastsquaresmethodcaneasilybeapplied 　 Useoflinetolinecorrespondences 　 　 InmostapplicationsthefeaturecorrespondencebetweenimageandmodelwasgivenintheformoffeaturelinesinsteadoffeaturepointsInthiscircumstancemodificationsshouldbemadeontheabovemethodWeshouldsubstitutetheerrorontherightsideofEqsandwiththedistancebetweenprojectionlineandimagelineinsteadofthatbetweenprojectionpointandimagepointAsthedistancebetweenunparallellinesisnotafixedvaluesoweusethedistancefrompointtolinetosubstitutethedistancebetweenlinesWerepresentlineequationasfollowssubstitutingkmukvd 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 wheredistheperpendiculardistancefromtheoriginpointtothelinemistheslantofthelinesowehave 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 Thenwehave 　 　 Similarlywehave 　 　 　 　 　 　 NowEqsandcanberepresentedasfollows 　 　 　 　 　 　 　 　 　 WithEqsandwecanhave 　 　 　 　 　 　 whereEdistheperpendiculardistancefromthetwoendpointsofcorrespondingimagelinetotheprojectionlineAsonelinehastwoendpointssotherearetwoequationssimilartoEqforeachlinecorrespondenceWiththreelineswecanhaveacompletelinearsystemandthesolutionis △ Dx △ Dy △ Dz △ φ x △ φ y △ φ zThenwecanadjustvectorDxDyDz φ x φ y φ zWithNewtonsmethodemployedtheprojectionparametersinthelinelinecorrespondenceconditionarereached 　 TheCorrespondencebetweenVideoHumanFeaturesandDModelHumanFeatures 　 ProjectionparameterscalculationforDhumanmodel 　 　 FirstlywegivethedatastructureofimagepointandDmodelpointasfollowsPointonimagetypedefstructIMAGEPOINT 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 floatx 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 floatyIMAGEPOINTPointonmodeltypedefstructMODELPOINT 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 floatx 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 floaty 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 floatzMODELPOINTNowwecancalculateprojectionparametersofacertainpartinDhumanmodelSupposeitscorrespondingfeaturelinesontheimageareliStartPtiEndPtiiandtheircorrespondingmodellinesarel ′ iStartPt ′ iEndPt ′ iiPerformingprojectiontransformationonlinel ′ iiwecangetl ″ iil ″ iStartPt ″ iEndPt ″ iiwhereTheslantforlineliiisthenthedistancefrompointStartPtiitolinel ″ iiis 　 Conversionfromprojectionparameterstohumanmotionmodel 　 　 WhenthecalculationofprojectionparametersforeverypartofhumanmodelisfinishedweneedtoconverttheseparameterstofittheskeletonstructureofhumanmodelthenspatialparametersofthevectorsthatcorrespondtoeachpartofthehumanmodelcanbecalculatedThustheconversionfromprojectionparameterstohumanmotionmodeliscompleted 　 Theimplementationofprojectionparameterscontrolledhumanmotion 　 　 BasedontheaboveideawehavedevelopedavideobasedanimationsystemcalledVideoAnimationStudioFiguresabtoabshowahumanwalkingexampleimplementedbyVideoAnimationStudioThefiguresontheleftsidearevideodataandasetofskeletonfeaturesdefinedbyuswhilethefiguresontherightsidearethemotionofthehumanmodelwhichiscontrolledbythesetsofskeletonfeaturesinthevideoFigFig 　 Conclusions 　 　 FromtheexperimentalresultwecanseethattheresultofthismethodissatisfyingButtherearefourpointsthatshouldbenotedThechoiceofinitialvaluesforprojectionparametersisveryimportantActuallywecangetasetofmoreaccurateinitialvaluesbyusingsomeinteractivemethodsThechoiceoffeaturelinesinvideoisalsoveryimportantTheyshouldbethesplineofvideohumanAsfortheerrorinNewtonsmethodwedliketoregardthebodyasawholeTheerrorofaspecificpartofthebodycanbesomehowunsatisfyingbuttheerrorofthewholebodyshouldbetheminimumAsfortheprocessingofvideomoredetaileddescriptioncanbefoundinRef 劳 志强 （ 浙江大学 CAD ＆ CG 国家 重点 实验室 　 杭州 　 ） （ 浙江大学 人工智能 研究所 　 杭州 　 ） 　 潘云鹤 （ 浙江大学 CAD ＆ CG 国家 重点 实验室 　 杭州 　 ） （ 浙江大学 人工智能 研究所 　 杭州 　 ） References ， GibsonJJTheEcologicalApproachtoVisualPerceptionHoughtonMifflinBostonMA ， MarrDVisionFreemanSanFrancisco ， BarnardSTInterpretingperspectiveimagesArtificialIntelligence ～ ， BarrowHGTenenbaumJMInterpretinglinedrawingsasthreedimensionalsurfacesArtificialIntelligence ～ ， BrooksRASymbolicreasoningamongDmodelsandDimagesArtificialIntelligence ～ ， HochbergJEBrooksVPictorialrecognitionasanunlearnedabilityastudyofonechildsperformanceAmericanJournalofPsychology ～ ， LoweDGSolvingfortheparametersofobjectmodelsfromimagedescriptionsInProceedingsARPAImageUnderstandingWorkshopCollegeParkMD ～ ， LaoZhiqiangStudyonimaginarybasedintelligentanimationtechniquesZhejiangUniversity 劳 志强 基于 形象思维 的 智能 动画 技术 的 研究 ［ 博士学位 论文 ］ 浙江大学