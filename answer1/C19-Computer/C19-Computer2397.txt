计算机 研究 与 发展 JOURNALOFCOMPUTERRESEARCHANDDEVELOPMENT 年 　 第卷 　 第期 　 Vol 　 No 　 单向 链路 邻接 发现 和 路径 生成 的 研究 潘 建平 　 顾 冠群 　 　 摘 　 要 　 单向 链路 和 不 对称 应用 需求 的 出现 使得 传统 的 网络 路由 算法 和 协议 不再 适用 隧道 封装 和 路由 修改 是 解决 近期 双向 连通 网络 添加 单向 链路 所 面临 问题 的 常用 方法 ， 但 仍 无法 适合 完全 单向 链路 网络 的 远期 目标 文中 首先 给出 网络 和 路由 的 定义 和 表示 ； 再 提出 基于 有 界 扩散 的 邻接 发现 算法 ， 并 证明 某 一回 路 穿越 特定 链路 次数 的 上界 ； 然后 提出 基于 邻接矩阵 的 路径 生成 算法 ， 并 给出 实例 分析 以 验证 上述 算法 的 正确性 　 　 关键词 　 计算机网络 ， 网络协议 ， 路由 算法 　 　 中图法 分类号 　 TPRESEARCHONNEIGHBORDISCOVERYANDPATHGENERATIONFORUNIDIRECTIONALLINKSPANJianPingandGUGuanQunDepartmentofComputerScienceSoutheastUniversityNanjing 　 　 Abstract 　 WiththeemergenceofunidirectionallinksandasymmetricapplicationsrequirementstraditionalroutingalgorithmsandprotocolsforbidirectionalandsymmetriclinksarefacingsomeseverechallengesTunnelencapsulationandroutemodificationaretwocommonsolutionstotheshorttermscenariowheresomeunidirectionallinksareaddedintotheconnectedbidirectionalnetworksbuttheyalsofailtomeetthelongtermscenariowhereonlyunidirectionallinksareavailableFollowingthedefinitionofgraphtopologyandnetworkroutingaboundedneighbordiscoveryalgorithmisproposedandtheupperboundontripsofanyloopcrossingonespecifiedlinksisprovedApathgenerationalgorithmbasedontheneighborpathmatrixisalsopresentedandvalidatedbysomeexamples 　 　 Keywords 　 computernetworknetworkprotocolroutingalgorithm 　 研究 背景 　 　 传统 的 路由 算法 和 协议 总是 显式 或 隐式 地 要求 下层 物理 链路 具有 双向 传输 能力 ， 通常 称为 双向 链路 bidirectionallinkBDL 路由 基于 距离 向量 的 RIP 路由 协议 ， 若 结点 a 与 b 相邻 ， 且 b 到 c 的 距离 为 x ， a 就 认为 a 到 c 的 距离 为 x 基于 链路 状态 的 OSPF 协议 ， 则 需要 邻接 结点 对称 地 进行 应答 以 保证 路由 信息 可靠 传输 　 　 新 的 应用 需求 和 传输服务 使得 上述 假设 的 合理性 在 某些 场合 不再 适用 对 Web 浏览 或 文件传输 等 应用 ， 大量 的 数据 从 服务器 下载 到 客户端 ， 反向 仅 有 少量 数据 应答 ， 用户 回路 的 应用 需求 并非 总是 对称 的 卫星 信道 具有 大 带宽 覆盖 广 的 特点 ， 但 地面 发射 设备 的 代价 要 远大于 接收 设备 ， 对 移动 或 个体 用户 ， 仅 携带 接收 设备 更 合适 xDSL 和 CableModem 通常 提供 非对称 传输 信道 以 提高 利用效率 传统 路由 算法 和 协议 在 单向 链路 unidirectionallinkUDL 就 无法 正常 工作 ， 如 RIP 的 距离 计算 和 OSPF 的 可靠 应答 此外 单向 链路 还会 对 多点 投递 、 资源管理 甚至 运输 协议 造成 影响 这里 着重 研究 网络 路由 的 问题 　 　 近期 出现 的 网络拓扑 是 在 连通 BDL 网络 添加 一些 UDL 链路 ， 解决 方法 有 隧道 封装 和 路由 修改 两种 前者 建立 UDL 虚拟 的 反向 回路 来 构造 BDL ， 以 避免 沿途 路由 的 修改 ， 但 缺乏 灵活性 和 可扩展性 ； 后者 主要 针对 RIP 协议 ， 但 需要 修改 传统 的 路由 算法 和 协议 远期 需要 解决 的 网络拓扑 是 全 UDL 连通 网络 一条 BDL 等同 两条 相向 UDL ， 显然 ， 现有 或 改进 的 路由 算法 和 协议 都 不能 适合 这种 场合 我们 先对 网络 路由 进行 严格 定义 和 描述 ， 再 研究 其中 关键 的 连接 发现 和 路径 生成 两个 问题 ， 并 得到 了 一些 有 意义 的 结论 　 问题 表示 　 　 图是 UDL 构成 的 连通 网络 ， 可 表示 成图 GVE ， 其中 结点 集合 Vabcdef ， 有 向 边 的 集合 E 〈 ab 〉 〈 cb 〉 〈 da 〉 〈 be 〉 〈 fc 〉 〈 ed 〉 〈 ef 〉 ， 〈 uv 〉 表示 从 结点 u 到 v 的 有 向 边 此外 CE → Rm 是从 E 到 m 维 实数 域 R 的 映射 ， 表示 每个 链路 所 对应 的 度量 有 m 个 因素 u 和 un 路径 〈 uu 〉 〈 uu 〉 … 〈 unun 〉 简记 为 uu … un 的 集合 记作 Rn ‖ Rn ‖ 是 路径 个数 图 　 一个 UDL 网络 　 　 路由 问题 可 表示 为 给定 图 GVE 及其 映射 C ， 任取 vv ∈ V ， 获得 Rvv 和 Rvv ， 依据 C 的 度量 约束 ， 挑选 某个 或 某些 特定 的 rvv 和 rvv 构成 回路 上述 描述 蕴含 每个 结点 都 有 图 的 完整 拓扑 ， 若无此 约束 ， 仅能 得到 Rvv 和 Rvv 的 子集 此外 回路 vvv 和 vvv 并 没有 必要 对称 ， 回路 vvv 的 集合 记作 LvvvRvv × Rvv 　 　 对 多点 投递 源 f 和 宿 集合 Sss … ， RfS 定义 为 超集 RfsRfs … ， RSf 则 为 RsfRsf … 依据 C 的 度量 约束 ， 多点 路由 挑选 一组 特定 的 rfsrsfrfsrsf … 构成 f 与 任一 si 的 回路 多点 投递 仅 定义 fsif 的 回路 ， 因为 仅 有 从源 到 宿 的 数据流 在 大多数 情况 RfS 构成 一棵 以 f 为根 、 si 为叶 或 中间 结点 的 有 向 扩散 树 　 邻接 发现 　 　 邻接 发现 对 BDL 是 显而易见 的 〈 ab 〉 〈 ba 〉 ， 但 对 UDL 却是 很大 的 困难 蕴含 条件 不再 成立 特别 是 邻接 信息 和 路径 生成 会 重复 穿越 某一 特定 单向 链路 如图 ， 若 从 a 到达 f 再 返回 到 a ， 即 afaabefcbeda ， 就 需 穿越 链路 〈 be 〉 两次 ； 而 BDL 决不 重复 以 同一 方向 穿越 某一 链路 所幸 的 是 我们 能 证明 重复 穿越 具有 上 界 　 穿越 上 界 　 　 给定 UDL 图 GVE ， 及 回路 uvu 〈 uu 〉 … 〈 v 〉 〈 v 〉 … 〈 unun 〉 ， 需要 证明 的 是 若 任取 〈 xy 〉 〈 uu 〉 … 〈 v 〉 〈 v 〉 … 〈 unun 〉 ， 〈 xy 〉 在 〈 uu 〉 … 〈 v 〉 〈 v 〉 … 〈 unun 〉 出现 次数 为 m ， 存在 与 图 G 和 回路 L 无关 的 整数 M ， 使 m ≤ M 如 等 号 成立 ， 则 M 为 上 确界 　 　 定义 冗余 路径 　 对于 uv 〈 uu 〉 〈 uu 〉 … 〈 unv 〉 ∈ Ruv ， 如果 有 〈 uu 〉 〈 uu 〉 … 〈 unv 〉 〈 xy 〉 ∈ Ruv ， 则 uv 是 冗余 路径 ； 反之 则 为 无 冗余 路径 类似 定义 冗余 回路 　 　 引理 若 〈 uy 〉 ∈ 〈 uy 〉 〈 uu 〉 … 〈 unv 〉 ， 则 〈 uy 〉 可仅 在 uv 出现 次 　 　 证明 不失 一般性 ， 〈 uy 〉 在 uv 〈 uy 〉 … 〈 uy 〉 i … 〈 unv 〉 的 最后 一次 出现 为 〈 uy 〉 i 则 〈 uy 〉 i … 〈 unv 〉 ∈ Ruv ， 且 由 冗余 路径 的 定义 等价 于 原有 的 uv 　 　 引理 若 〈 xv 〉 ∈ 〈 uu 〉 〈 uu 〉 … 〈 xv 〉 ， 则 〈 xv 〉 可仅 在 uv 出现 次 　 　 证明 不失 一般性 ， 〈 xv 〉 在 uv 〈 uu 〉 … 〈 xv 〉 j … 〈 xv 〉 的 最前 一次 出现 为 〈 xv 〉 j 则 〈 uu 〉 … 〈 xv 〉 j ∈ Ruv ， 且 由 冗余 路径 的 定义 等价 于 原有 的 uv 　 　 引理 若 〈 xy 〉 ∈ 〈 uu 〉 … 〈 xy 〉 … 〈 unv 〉 ， 则 〈 xy 〉 可仅 在 uv 出现 次 　 　 证明 不失 一般性 ， 〈 xy 〉 在 uv 〈 uu 〉 … 〈 xy 〉 i … 〈 xy 〉 j 〈 x ′ y ′ 〉 j … 〈 unv 〉 的 最前 和 最后 一次 出现 分别 为 〈 xy 〉 i 和 〈 xy 〉 j 则 〈 uu 〉 … 〈 xy 〉 i 〈 x ′ y ′ 〉 j … 〈 unv 〉 ∈ Ruv ， 并且 根据 冗余 路径 的 定义 等价 于 原有 的 uv 　 　 任一 uvu 由 uv 和 vu 构成 ， 即 〈 uy 〉 〈 xv 〉 〈 vy 〉 〈 xu 〉 仅 在 uvu 出现 次 　 　 定理 任一 链路 在 某 一回 路 出现 次数 若 〈 xy 〉 且 xyuvxy 即 xy 不 包含 u 或 v ， 若 〈 xy 〉 ∈ 〈 uu 〉 … 〈 v 〉 〈 v 〉 … 〈 unu 〉 ， 则 〈 xy 〉 最多 在 uvu 出现 次 　 　 证明 用 反证法 不妨 假设 〈 xy 〉 在 uvu 出现 次 　 　 根据 引理 ～ ， 〈 sv 〉 或 〈 vt 〉 仅 在 uvu 出现 次 ， 则 v 将 uvu 分割 成个 部分 ， 分别 为 〈 uu 〉 … 〈 sv 〉 和 〈 vt 〉 … 〈 unu 〉 如果 假设 〈 xy 〉 在 uvu 出现 次 ， 则 根据 “ 抽屉 原则 ” ， 则 〈 uu 〉 … 〈 sv 〉 或 〈 vt 〉 … 〈 unu 〉 至少 有 一个 含有 个 以上 的 〈 xy 〉 不失 一般性 ， 不妨 假设 〈 uu 〉 … 〈 xy 〉 i … 〈 xy 〉 j 〈 wz 〉 j … 〈 sv 〉 含有 个 〈 xy 〉 根据 冗余 路径 的 定义 ， 〈 uu 〉 … 〈 xy 〉 j 〈 wz 〉 j … 〈 sv 〉 〈 vt 〉 … 〈 unu 〉 ∈ Luvu 等价 uvu 　 　 有限 次 使用 上述 法则 ， 可以 保证 任一 〈 xy 〉 最多 在 uvu 出现 次图 又 说明 某一 链路 出现 次 是 完全必要 的 对于 〈 be 〉 在 回路 afa 必须 出现 次 　 　 综上所述 ， 任一 UDL 链路 在 某 一回 路 从 出现 的 次数 的 上 确界 为 证毕 　 　 推论 若 〈 xy 〉 且 xyuvxy 即 xy 不 包含 u 或 v ， 若 〈 xy 〉 在 uvu 出现 次 ， 则 可能 出现 的 情况 应该 是 〈 uu 〉 … 〈 xy 〉 i … 〈 v 〉 〈 v 〉 … 〈 xy 〉 j … 〈 unu 〉 　 有限 扩散 　 　 如图 的 a 发现 存在 个 网络接口 ， 其中 一个 输出 另 一个 输入 初始 时 a 仅 具有 自己 的 接口 信息 ， 并 将 上述 信息 通过 输出 接口 告知 下 一 结点 注意 a 并 不知 b 是 下 一个 结点 b 获得 a 的 接口 信息 后 即 导出 〈 ab 〉 ， 但 〈 ab 〉 本身 对 b 的 路由 没有 作用 b 将 〈 ab 〉 及其 接口 信息 一起 再 传递 给 下 一 结点 类似 地 ， e 在 其 所有 输出 接口 发出 〈 ab 〉 〈 be 〉 及其 接口 信息 dfc 有着 相似 的 过程 a 从 d 获得 〈 ab 〉 〈 be 〉 〈 ed 〉 及 〈 da 〉 后 可 导出 abaead 路径 因 上述 信息 和 a 初始 发出 的 信息 蕴含 〈 aa 〉 不同 ， a 继续 将 链路 和 路径 信息 给 下 一 结点 b 从 c 获得 〈 ab 〉 〈 be 〉 〈 ef 〉 〈 fc 〉 及 〈 cb 〉 后 可 导出 bebfbc ， 与 a 同样 原因 b 将 继续 发出 链路 和 路径 信息 b 再次 从 a 获得 路由 信息 将 获得 路径 ba ， 结合 a 给出 的 ab ， b 将 获悉 a 和 b 之间 已 形成 回路 此后 也 被 a 获悉 连接 发现 过程 稳定 后 ， 每个 结点 将 具有 整个 路由 范围 的 拓扑 信息 ， 每个 结点 将 独立 地 进行 路由 计算 与 选择 　 　 产生 路由 信息 后 ， 结点 间 需要 维持 上述 路由 ， 并 适应 链路 的 动态 特性 如新 的 链路 加入 和 原有 链路 失败 等 每个 结点 周期性 给 其 下游 结点 DirectHello 分组 以 通知 下游 结点 该 结点 及 邻接 链路 的 活性 若 下游 结点 在 一段时间 没有 获得 来自 上游 结点 的 DirectHello ， 就 认为 该 结点 或 邻接 链路 失败 下游 结点 将 扩散 链路 失败 的 消息 给 其 下游 结点 ， 直到 所有 结点 均 获得 此 信息 下游 结点 也 通过 周期性 的 RoutedHello 分组 经过 路由 通知 对应 上游 结点 两者 链路 的 活性 ， 若 上游 结点 在 很长 一段时间 没有 获得 来自 下游 结点 的 RoutedHello ， 将 认为 两者之间 的 链路 失败 ， 需要 重新 计算 和 选择 路由 ， 并 在 其它 输出 接口 通知 其它 结点 如图 的 〈 ab 〉 链路 失败 ， b 没有 收到 DirectHello ， 认为 a 或 〈 ab 〉 失败 ， 将 通知 后继 结点 e ， 类似 fdca 也 将 获得 上述 信息 经过 RoutedHello ， a 最终 将 获悉 〈 ab 〉 链路 的 失败 除了 bcef 结点 可能 形成 回路 ， 其它 结点 至少 因为 某个 路径 而 无法 形成 回路 新 加入 结点 将 触发 局部 的 邻接 发现 ， 若 某个 结点 得到 新 的 路由 ， 将 传递 给 后继 直到 拓扑 信息 稳定 　 路径 生成 　 路径 矩阵 　 　 经过 邻接 发现 以后 ， 每个 结点 能够 获得 整个 网络 的 邻接 信息 ， 以及 相关 的 路由 度量 ， 这里 主要 考虑 邻接 信息 以 生成 路径 Aaijnn 是 图 GVE 的 邻接矩阵 ， 当且 仅 当 aij ， 如果 〈 ij 〉 ∈ E ； 否则 aij ， 其中 n 等于 ‖ V ‖ Ann 和 Aij 分别 表示 n × n 的 矩阵 及其 第 ij 个 元素 经过 邻接 发现 后 ， 每个 结点 都 能 对 〈 ij 〉 ∈ E 独立 地 进行 判断 　 　 如果 aik 且 akj ， 则 显然 存在 从 i 到 j 的 路径 根据 i 与 k 邻接 且 k 与 j 邻接 ， i 到 j 的 距离 为 k 可取 ， … ， n 之间 的 任意 一个 结点 标识 ， 则 bij 当且 仅 当 存在 bij 个 这样 的 k ， 使得 aik 且 akj 定义 BAAbijnnnn ， 则 矩阵 B 的 元素 bij 表示 从 结点 i 到 结点 j 存在 bij 条 距离 为 的 路径 定义 ∧ Bdijnn ， 且 dijbij 若 ij ； 否则 dij ， 即 ∧ B 为 B 的 对角 矩阵 因 aii ， 若 dii ， 则 表示 存在 dii 个 k ， 使 aik 且 aki 定义 AB ∧ BAADAA ， 若 ［ A ］ ij 则 i 和 j 的 距离 为 　 　 更 高阶 的 kA 除 需要 从 A 和 kA 的 乘积 中 删去 对角线 元素 表示 的 自环外 ， 还应 考虑 由 Aim 和 kAmj 构成 的 部分 自环 ， 如 kAmj 对应 的 路径 已 穿越 过 i 因此 kA 将 保存 长度 为 k 的 路径 穿越 的 结点 集 kVij 综上所述 kA 可定义 为 其中 　 　 可以 证明 ， kAij 表示 从 结点 i 到 结点 j 存在 kAij 条 距离 为 k 的 无 冗余 路径 ， 且 不 含有 自环 如 abeda 和 部分 自环 如 efcbed 　 　 定理 简单 路径 kA 是 图 GVE 邻接矩阵 A 生成 的 距离 为 k 的 无 冗余 路径 矩阵 　 　 证明 使用 对于 k 的 数学 归纳法 　 　 k ， 结论 显然 成立 　 　 k 假设 kk 时 ， kA 是 图 GVE 邻接矩阵 A 生成 的 距离 为 k 的 无 冗余 路径 矩阵 　 　 k 当 kk 时 ， 根据 kA 定义 ， 考虑 imj 的 情况 ， kAAkA ∧ AkA 其中 AkAij 根据 kAkj 是从 结点 k 到 结点 j 存在 kAkj 条 距离 为 k 的 简单 路径 如果 Aik ， 则 从 结点 i 经过 结点 k 到 结点 j 就 有 kAkj 条 距离 为 k 的 无 冗余 路径 k 可取 ， … ， n 间 的 任一 结点 标识 ， 就 是从 结点 i 经过 所有 可能 结点 k 到 结点 j 的 距离 为 k 的 无 冗余 路径 kAAkA ∧ AkA 仅 去除 可能 的 自环 ； 若 imj 则 删去 可能 存在 的 部分 自环 综上所述 ， 原 命题 结论 成立 证毕 　 　 推论 若 kA 是 图 GVE 的 无 冗余 路径 矩阵 且 存在 ij 使得 kAij 〉 ， 则 有 k 〈 n 　 　 证明 使用 反证法 ， 不妨 假设 kn 且 存在 ij 使得 kAij 〉 ， 则 有 某条 路径 穿越 n 个 结点 　 　 但是 图 G 的 结点 数 ‖ V ‖ n ， 必然 该条 无 冗余 路径 穿越 至少 有个 结点 超过 次 ， 矛盾 　 回路 生成 　 　 通过 路径 矩阵 ， 就 能 获得 集合 Rvv 和 Rvv ， 再 根据 LvvvRvv × Rvv ， 就 可 获得 从 v 到 v 回到 v 的 回路 集合 ， 其中 ‖ Rvv ‖ AvvAvv … nAvv ， ‖ Rvv ‖ AvvAvv … nAvv ， ‖ Lvvv ‖ AvvAvv … nAvvAvv … nAvv 也 就是 任意 选择 Rvv 和 Rvv 各 一条 无 冗余 路径 ， 就 可 构成 一条 从 v 到 v 回到 v 的 回路 ， 需要 指出 的 是 ， 每条 无 冗余 路径 都 不会 两次 穿越 同一 结点 ， 但 两 两 构成 的 回路 就 可能 穿越 某条 特定 链路 次 ， 也 就是 可能 穿越 该条 链路 两端 结点 各 两次 　 实例 分析 　 　 如图 的 UDL 网络 ， 邻接矩阵 和 无 冗余 路径 矩阵 分别 为