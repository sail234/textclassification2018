计算机 应用 ComputerApplications 年 第卷 第期 VolNo 地理 示意图 排版 软件 的 面向对象分析 伍 　 江 　 魏子乐 　 　 摘 　 要 　 本文 讨论 了 一个 地理 示意图 排版 软件 的 主要 结构 和 思想 。 该软件 采用 面向对象 的 方法 进行 分析 、 设计 和 实现 。 本文 具体 阐述 了 所 采用 的 面向对象 方法 ， 并 在 一些 较难 实现 的 功能 上 提出 了 创新 的 解决 方法 。 　 　 关键词 　 面向对象 OOA 属性 服务 连接 地理 示意图 　 　 THEOBJECTORIENTEDANALYSISOFMAPPUBLISHINGSOFTWAREWuJiang 　 WeiZileNationalKeyLaboratoryofTextGraphicsProcessingInstituteofComputerScienceTechnologyPekingUniversityBeijing 　 　 Abstract 　 ThispaperdiscussesthemainstructureandtheoryofamappublishingsoftwareThissoftwareisanalyzeddesignedandimplementedwithobjectorientedmethodThispaperdescribesdetailedlythemethodusedinthesoftwareandgivescreativesolutionstosomedifficultproblems 　 　 Keywords 　 ObjectorientedOOAAttributeServiceLinkMap 　 引言 　 　 地理 示意图 的 排版 在 专业 排版 领域 还 属于 一个 比较 新 的 方向 。 当 排版 人员 需要 在 报纸 或 杂志 的 版面 上 插入 一个 示意图 以 表示 某个 地方 的 相对 位置 以及 该 地方 的 街区 概貌 时 ， 通常 使用 Illustrator 、 CorelDraw 、 FreeHand 等 通用 绘图 软件 来 完成 。 但 这些 绘图 软件 由于 其 固有 的 通用性 ， 满足 不了 地理 示意图 的 一些 特定 要求 ， 例如 ： 方便 地 绘制 各种类型 的 道路 、 铁路 、 河流 ； 灵活 设定 不同 道路 之间 的 交叉 覆盖 和 焊接 ； 灵活 地 设定 文字 的 方向 和 位置 ， 等等 ， 这些 都 是 通用 绘图 软件 所 不 具备 的 功能 。 　 　 我们 开发 的 地理 示意图 软件 是 专门 针对 各类 对 坐标 位置 要求 不是 很 精确 的 地理 示意图 的 排版 而 设计 的 ， 在 需求 上 考虑 了 地理 示意图 版式 和 操作 两 方面 的 特点 ， 因此 既 不同于 精确度 很 高 的 专业 地图 绘制 系统 ， 也 不同于 通用 的 绘图 软件 。 在 整个 开发 过程 中 ， 我们 采用 了 面向对象 的 分析方法 。 　 　 　 地理 示意图 软件 的 需求 描述 　 　 地理 示意图 排版 软件 最 基本 的 功能 需求 是 ： 在 窗口 上用 鼠标 以 所见即 所得 的 方式 生成 一个 报刊杂志 排版 时 常用 的 示意图 ， 并且 可以 将 此 示意图 输出 为 eps 文件 或 直接 打印输出 到 打印机 上 。 以下 是 一个 示意图 的 例子 ： 　 　 图 　 　 和 一般 的 图形 软件 相比 ， 示意图 软件 必须 具有 如下 特殊 功能 ： 　 　 能 方便 地 绘制 各种 风格 的 道路 、 铁路 、 河流 等 通用 图形 对象 ； 　 　 能 方便 地 在 道路 河流 交叉 的 地方 画桥 ； 　 　 能 方便 地 设定 不同 道路 铁路 之间 在 交叉点 处 的 相互 覆盖 关系 ， 甚至 能够 实现 两条道路 首尾 互相 覆盖 ； 　 　 能 方便 地 将 多条 道路 焊接 在 一起 ， 构成 连通 的 道路 ； 　 　 提供 用于 绘制 示意图 的 基本 图例 ， 且 图例 的 参数 可 由 用户 调节 ； 　 　 能 方便 地 将 一串 文字 安排 到 路 中间 或 旁边 ， 以及 与 路 平行 的 方向 ， 还 能 设定 文字 的 指示 线 ， 使 其 固定 指向 某个 位置 。 　 面向对象 的 需求 分析 　 指导思想 和 原理 　 　 从 上面 的 需求 可以 看出 ： 地理 示意图 软件 是 一种 具有 强烈 对象化 特征 的 软件 ， 因而 较 适合 采用 面向对象 的 方法 进行 分析 、 设计 和 实现 ， 即 运用 对象 、 类 、 继承 、 封装 、 聚合 、 消息 传送 、 多态性 等 概念 来 构造 该 系统 。 ［ ］ 　 发现 对象 ， 建立 对象 类 　 　 如图所示 ， 示意图 主要 由 一些 道路 、 建筑物 和 各种 标志 及 文字 组成 。 因此 系统 中 的 对象 可以 是 ： 　 　 示意图 对象 　 表示 整个 要 被 排版 的 地理 示意图 。 对 地理 示意图 进行 的 各种 操作 都 首先 通过 该 对象 进行 。 后文 的 所有 对象 和 示意图 对象 的 关系 均 是 整体 — 部分 关系 ， 它们 被 示意图 对象 所 包含 。 　 　 道路 对象 　 表示 地理 示意图 中 的 各种 道路 。 它 又 可派 生出 以下 几种 道路 对象 ： 带 边界 路 、 黑白相间 路 、 无 边界 路 、 河流 。 带 边界 路 的 特点 是 ： 在 一条 具有 给定 宽度 和 颜色 的 线 两侧 再 附加 上 给定 宽度 和 颜色 的 边界 ； 黑白相间 路 是 指 ： 沿着 线 的 走向 黑线 段 和 白 线段 相互 间隔 的 路 ； 无 边界 路 只是 一条 具有 给定 宽度 和 颜色 的 线 ； 河流 则 是 在 带 边界 路 的 基础 上 再 将 两条 边 之间 的 部分 铺 以 适当 的 波纹 。 带 边界 路 、 黑白相间 路 、 无 边界 路 、 河流 分别 构成 四类 独立 的 对象 ， 它们 和 道路 对象 之间 是 一般 — — 特殊 关系 。 　 　 标志物 对象 　 地理 示意图 中 的 各种 特殊 标志 。 标志物 对象 也 需要 派 生出 大量 具体 的 对象 ： 如 电话亭 ， 路标 ， 公共汽车 站 ， 加油站 等 。 每种 对象 均 可 由 用户 设定 其 特定 的 参数 。 　 　 文字 对象 　 示意图 上 的 文字描述 ， 可以 包含 边框 、 可以 有 附加 的 指示 线 指向 相应 的 对象 。 　 　 扩充 图形 对象 　 这是 一类 没有 固定 物理 意义 的 对象 ， 它 具有 较强 的 形状 描述 能力 ， 能够 描述 各种 比较复杂 的 几何 形状 ， 包括 圆 、 矩形 、 曲线 或 直线 多边形 、 以及 由 这些 形状 合并 而成 的 复杂 形状 。 扩充 图形 对象 类似 于 通用 绘图 软件 中 的 图元 对象 ， 用于 描述 地理 示意图 中 除去 以上 对象 之外 的 其它 各类 有形 对象 。 　 　 依赖 对象 　 用于 实现 道路 之间 的 覆盖 、 焊接 、 道路 和 河流 之间 的 桥 。 这 类 对象 依赖于 相应 的 道路 或 河流 而 存在 ， 但 又 有 一定 的 独立性 ， 因而 自成 一类 ， 称为 依赖 对象 。 从 依赖 对象 派 生出 覆盖 对象 、 焊接 对象 、 桥 对象 ， 从而 具体 实现 道路 和 道路 之间 交叉点 处 的 覆盖 、 焊接 和 桥 。 依赖 对象 和 前述 的 道路 对象 之间 具有 实例 连接 和 消息 连接 两种 联系 。 下图 是 这三类 依赖 对象 的 具体 实例 ： 　 　 图 　 定义 属性 和 服务 　 　 限于 篇幅 ， 表只 列出 各 对象 的 一些 主要 属性 和 服务 。 　 表 对象 名称 属性 服务 示意图 对象 示意图 上 所有 对象 从 到 的 对象 的 列表 。 示意图 的 边框 和 底色 。 示意图 大小 。 对象 检索服务 ： 列举 出 示意图 中 的 所有 对象 或 某 一类 对象 ； 添加 一个 新 的 对象 到 示意图 中 ； 删除 示意图 中 的 对象 ； 调整 对象 在 示意图 中 的 顺序 ； 输出 整个 示意图 到 屏幕 或 eps 文件 。 道路 对象 （ 四种 具体 道路 对象 的 属性 和 服务 从略 ） 道路 的 骨架 线 。 取 道路 的 骨架 线 ； 取 道路 的 轮廓 ； 输出 道路 到 屏幕 或 eps 文件 。 标志物 对象 （ 每 一个 具体 的 标志物 对象 的 属性 和 服务 从略 ） 标志物 的 位置 。 输出 志物 到 屏幕 或 eps 文件 。 文字 对象 文字串 。 文字 所在 的 位置 。 文字 的 排版 格式 （ 如 文字 的 字体 ， 字号 ， 颜色 等 ） 附加 的 提示 线 属性 。 输出 文字 到 屏幕 或 eps 文件 。 扩充 图形 对象 扩充 图形 的 位置 。 扩充 图形 的 形状 参数 。 输出 扩充 图形 到 屏幕 或 eps 文件 。 依赖 对象 此 对象 所 依赖 的 其他 对象 的 标识 。 此 对象 的 轮廓 和 位置 。 设置 此 对象 所 依赖 的 对象 ； 获取 此 对象 所 依赖 的 对象 ； 输出 依赖 对象 到 屏幕 或 eps 文件 。 覆盖 对象 （ 继承 依赖 对象 的 全部 属性 ） 两个 有 覆盖 关系 的 对象 的 上下 顺序 。 交换所 依赖 对象 的 上下 覆盖 关系 ； 输出 覆盖 对象 到 屏幕 或 eps 文件 。 焊接 对象 （ 继承 依赖 对象 的 全部 属性 ） （ 没有 特别 的 属性 ） 输出 焊接 对象 到 屏幕 或 eps 文件 。 桥 对象 （ 继承 依赖 对象 的 全部 属性 ） 两个 具有 桥 关系 的 对象 的 上下 顺序 。 桥 的 具体 参数 。 交换所 依赖 对象 的 上下 关系 ； 修改 桥 的 参数 ； 输出 桥 对象 到 屏幕 或 eps 文件 。 　 定义 结构 和 连接 　 整体 — — 部分 结构 　 　 示意图 对象 包含 了 所有 其他 对象 ， 它 和 其他 对象 的 关系 是 整体 — — 部分 结构 。 用 面向对象 的 分析 图 表示 出来 就是 ： 　 　 　 一般 — — 特殊 结构 　 　 道路 对象 和 带 边界 路 、 黑白相间 路 、 无 边界 路 、 河流 的 关系 是 一般 — — 特殊 结构 。 后 四种 路 继承 道路 对象 的 属性 和 服务 ， 并 重载 其中 的 “ 取 道路 的 轮廓 ” 和 “ 输出 道路 到 屏幕 或 eps 文件 ” 两项 服务 。 　 　 　 另外 ， 依赖 对象 和 覆盖 对象 、 焊接 对象 、 桥 对象 的 关系 也 是 一般 — — 特殊 结构 。 后 三者 重载 依赖 对象 的 “ 输出 依赖 对象 到 屏幕 或 eps 文件 ” 服务 。 图略 。 　 实例 连接 　 　 A 覆盖 对象 　 　 在 各个 依赖 对象 和 道路 对象 之间 存在 着 实例 连接 的 关系 。 这 是因为 ： 每 一个 依赖 对象 都 是 为 某些 道路 对象 提供 服务 的 。 例如 ： 两条道路 发生 了 一个 交叉 ， 则 在 交叉点 处 形成 一个 覆盖 对象 。 该 覆盖 对象 依赖 且 只 依赖于 这 两条道路 。 而 这 两条道路 则 通过 这个 覆盖 对象 来 实现 它们 在 交叉点 处时 谁 在 上面 谁 在 下面 。 　 　 具体 的 实现 机理 是 ： 首先 根据 两条道路 的 骨架 线 计算 出 它们 的 交叉点 ， 然后 再 根据 它们 各自 的 宽度 算 出 它们 在 该 交叉点 处 的 重叠 区 。 该 重叠 区 即 是 覆盖 对象 的 轮廓 。 若想 实现 道路 A 在 该 交叉点 处 盖住 道路 B ， 只 需 在 画 完 道路 A 和 道路 B 时 再 画 覆盖 对象 ， 而 覆盖 对象 的 画 函数 则 是 去 调用 道路 A 的 画 函数 再 重画 一次 ， 画 的 时候 设置 覆盖 对象 的 轮廓 （ 即 道路 A 和 道路 B 在 该处 的 重叠 区 ） 作为 裁剪 区 。 这样 ， 就 实现 了 道路 A 在 该 交叉点 处 盖住 了 道路 B 。 反之 ， 若想 实现 道路 B 在 该 交叉点 处 盖住 道路 A ， 只须 让 覆盖 对象 调用 道路 B 的 画 函数 进行 重画 。 由于 设置 了 裁剪 区 ， 因此 当 覆盖 对象 重画 A 时 不会 使 一些 本来 应该 盖住 A 的 对象 反过来 又 被 A 盖住 了 。 　 　 这样 实现 覆盖 效果 的 好处 是 ： 无论 在 交叉点 处要 实现 谁 覆盖 谁 ， 都 不 需要 移动 两条道路 的 上下 关系 。 从而 能 保证 这 两条道路 和 其他 对象 之间 的 上下 关系 不变 。 更进一步 ， 若 两条道路 有 两个 交叉点 ， 通过 分别 建立 两个 覆盖 对象 ， 还 能 实现 它们 在 不同 的 交叉点 处 具有 相反 的 上下 关系 。 例如 ： A 的 头盖 住 B 的 尾 ， B 的 头 又 盖住 A 的 尾 。 这 在 高 要求 的 地理 示意图 中是 很 可能 出现 的 ， 而 一般 的 绘图 软件 要 做到 这点 会 很 困难 。 这种 方法 的 另 一个 好处 是 便于 用户 操作 ： 由于 覆盖 对象 具有 明确 的 轮廓 （ 重叠 区 ） ， 因此 可以 允许 用户 简单 地用 鼠标 单击 重叠 区 而 实现 切换 该 交叉点 处 的 上下 覆盖 关系 。 　 　 这种 方法 的 一个 主要 要求 是 覆盖 对象 必须 在 道路 A 和 道路 B 画 完 之后 再画 。 这 也 是 它们 之间 的 静态 联系 之一 。 　 　 B 桥 对象 　 　 桥 对象 和 覆盖 对象 非常 类似 。 它们 的 主要 不同 在于 画 覆盖 对象 时 ， 只是 简单 地 调用 道路 的 画 函数 进行 重画 ； 而桥 对象 的 画 函数 稍微 有点 复杂 ： 首先 将桥 本身 的 形状 、 底纹 等 画 好 ， 再调 道路 A 的 画 函数 ， 从而 实现 道路 A 首先 架 在 桥 上 ， 桥 再 盖住 道路 B 的 效果 。 另外 ， 桥 对象 的 轮廓 计算 和 覆盖 对象 的 轮廓 计算方法 不 一样 ， 需要 考虑 桥 本身 的 属性 。 　 　 C 焊接 对象 　 　 焊接 对象 是 用于 实现 将 几条 带 边界 路 的 边界 内 部分 （ 我们 称为 路心 ） 焊接 在 一起 。 （ 对于 另外 三类 道路 ， 无需 考虑 焊接 ） 。 由于 有 可能 多条 道路 在 它们 的 公共 交叉点 处 发生 焊接 ， 因此 焊接 对象 要 能 同时 依赖 两条 以上 的 道路 。 焊接 对象 的 实现 机理 是 ： 当 几条 带 边界 路 在 某个 位置 交叉 在 一起 时 ， 由 用户 通过 鼠标 将 它们 在 交叉点 处 的 重叠 区 标识 出来 （ 用 不规则 多边形 描述 ） 。 该 区域 作为 要 生成 的 焊接 对象 的 轮廓 。 当 将 这 几条 道路 都 画 完后 ， 再 通知 焊接 对象 画出 自身 。 焊接 对象 的 画 函数 则 轮流 调用 每 一个 被 它 依赖 的 带 边界 路 的 画路心 的 函数 ， 并 设置 焊接 对象 的 轮廓 为 裁剪 区 。 由于 每 条带 边界 路 将 自己 的 路心 在 焊接 对象 指定 的 轮廓 内 重画 ， 因而 确保 它们 的 路心 都 可见 ， 也就是说 ， 在 该 区域 内 所有 横越 路心 的 边界 都 会 被 覆盖 掉 ， 从而 实现 将 几条 道路 的 路心 焊接 在 一起 的 效果 。 　 　 这种 焊接 的 好处 就是 不必 将 被 焊接 的 多个 对象 变成 一个 对象 。 因而 仍然 能 对 它们 单独 进行 操作 ， 例如 ： 其中 的 某条 道路 可能 又 会 和 别的 道路 发生 复杂 的 焊接 或 覆盖 关系 。 这 对于 现代 城市 的 地理 示意图 来说 ， 可能 是 一个 非常 重要 的 功能 。 　 　 这种 方法 的 主要 要求 是 带 边界 路 除了 提供 能 将 整个 道路 画 出来 的 服务 以外 ， 还 应该 提供 只画 路心 的 服务 。 另外 ， 和 覆盖 对象 一样 ， 焊接 对象 也 要 在 它 所 依赖 的 各 道路 对象 画 完 之后 才能 画 。 　 　 D 示意图 　 　 以上 三种 联系 用图 表示 出来 如下 ： 　 　 　 消息 连接 　 　 在 依赖 对象 和 道路 对象 之间 还 存在 着 双向 的 消息 连接 。 这 主要 体现 在 两 方面 。 一方面 当 道路 对象 移动 或 删除 时 ， 由于 原来 的 交叉 区域 不再 存在 或 已 改变 位置 ， 导致 依赖于 这 几条 路 的 依赖 对象 也 需要 改变 位置 ， 甚至 有 可能 不再 存在 ， 因而 需要 删除 相应 的 依赖 对象 或 移动 依赖 对象 的 位置 ； 另一方面 当 依赖 对象 在 画 自身 时 ， 又 需要 调用 道路 对象 的 画 函数 来 完成 任务 。 　 结束语 　 　 在 我们 开发 的 地理 示意图 排版 软件 中 运用 OOA 方法 使 我们 的 程序 更 易 理解 ， 也 更易 扩展 和 修改 。 由于 程序 的 结构 与 问题 的 结构 更为 接近 ， 因而 当 问题 发生变化 时 ， 程序 也 更 容易 跟随 进行 修改 ， 从而 延长 程序 的 生存 周期 ， 降低 了 开发成本 。 　 　 伍 　 江 　 博士 研究生 。 主要 研究 方向 ： 文字 和 图形 的 计算机 处理 。 　 　 魏子乐 　 硕士 研究生 。 主要 研究 方向 ： 文字 和 图形 的 计算机 处理 。 　 　 作者 单位 ： 伍 　 江 　 魏子乐 （ 北京大学 计算机 研究所 文字 图形处理 国家 重点 实验室 　 北京 ） 参考文献 ［ ］ 汪 成为 ， 郑小军 ， 彭木昌 面向对象 的 分析 、 设计 及 应用 北京 ： 国防工业 出版社 ， ［ ］ 邵维忠 ， 杨芙清 面向对象 的 系统分析 北京 ： 清华大学出版社 ， 广西 ： 广西 科学技术 出版社 ， 收稿 日期