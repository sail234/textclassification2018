微型机 与 应用 MICROCOMPUTERITSAPPLICATIONSVolNoP 基于 层 CS 结构 的 数据库 管理系统 的 实现 刘 华蓥 　 韩建民 　 薛继伟 　 　 摘 　 要 ： 层 CS 结构 的 应用程序 的 组成 及 优点 说明 了 Delphi 下 开发 层 CS 结构 应用程序 的 方法 。 　 　 关键词 ： 层 CS 结构 分布式 数据库 ActiveXForm 组件 　 　 客户服务器 计算机系统 是 世纪 年代 分布式 处理 的 主流 系统 。 传统 CS 结构 一般 分为 层 客户端 和 服务器端 。 但 随着 应用 系统 的 不断扩大 层 CS 结构 表现 出 效率 低下 、 维护 困难 、 安全性 差 和 伸缩性 差 等 缺点 。 层 CS 结构 的 出现 明显 地 改善 了 层 CS 结构 的 性能 。 本文 论述 了 层 CS 结构 的 组成 及 特点 并 论述 了 一个 基于 层 CS 结构 的 数据库 管理系统 的 设计 方法 。 层 CS 结构 　 　 层 CS 结构 可 分成 部分 其 组成 如图 。 （ ） 客户 。 通常 实现 用户界面 它 提供 了 一个 可视化 接口 用来 表示 信息 和 收集 数据 它 只 与 应用服务器 打交道 确保 用户 与 应用服务器 紧密结合 。 （ ） 应用服务器 。 通常 实现 应用逻辑 （ 又称 商业 规则 ） 是 连接 客户 和 数据库 服务器 的 桥梁 。 它 响应 用户 发来 的 请求 执行 某种 业务 任务 。 它 与 数据库 服务器 打交道 而 客户 不能 直接 与 数据库 服务器 打交道 。 （ ） 数据库 服务器 。 实现 数据 的 定义 、 维护 、 访问 、 更新 以及 管理 并 响应 应用服务器 的 数据 请求 。 它 的 物理 实现 可以 在 某种 数据库 管理系统 中 也 可以 是 一个 异种 数据库 的 集合 这种 数据库 可以 驻留 在 多种 平台 上 。 图层 CS 结构 组成 图 　 　 层 CS 结构 和 层 CS 结构 相比 优势 主要 表现 在 （ ） 效率高 。 应用服务器 减轻 了 客户端 的 负担 也 降低 了 与 数据库 服务器 的 连接 代价 从而 实现 真正 的 “ 瘦 客户 ” 。 （ ） 易于 维护 。 应用逻辑 集中 在 中间层 因而 当 应用逻辑 变化 时仅 需 修改 应用服务器 从而 提高 了 可维护性 也 增强 了 数据 的 一致性 。 （ ） 可伸缩性 。 层 结构 强调 的 是 逻辑 意义 而 不是 物理 意义 它 说明 如何 设计 应用程序 而 不是 如何 具体 部署 。 Delphi 下 开发 层 CS 结构 应用程序 的 方法 MIDAS 技术 　 　 DelphiCSSuite 提供 MIDAS （ MultitierDistributedApplicationServicesSuite 多层 分布式应用 程序 服务 包 ） 技术 它 同时 支持 CORBADCOMENTEROLEnterpriseTCPIP 等 多种 连接 方式 。 高效能 的 SQLLink 驱动程序 与 MIDAS 数据库 连接 管理机制 使 应用服务器 能以 更 快 的 速度 存取 企业级 数据 MIDAS 使 构建 层 分布式应用 变得 容易 。 层 CS 应用程序 的 结构 　 　 Delphi 实现 层 CS 结构 的 原理 如图 。 应用服务器 主要 包含 个 远程 数据 模块 它 通过 数据 集 组件 负责 与 BDE 的 联系 并 利用 Tprovider 组件 提供 Iprovider 接口 在 客户程序 与 应用服务器 之间 传递数据 。 在 层 CS 结构 下 几个 客户 有 可能 同时 与 个 应用服务器 通讯 应用服务器 实际上 充当 了 个 网关 的 作用 。 图 Delphi 下 实现 层 CS 结构 原理图 　 　 客户程序 通常 包含 二类 模块 一类 是 窗体 模块 它们 为 用户 提供数据 维护 的 界面 另一类 是 数据 模块 它 一般 包括 以下 几类 组件 （ ） 连接 组件 负责 连接 应用服务器 （ ） 客户 数据 集 组件 它 一般 从 应用服务器 接口 获取数据 （ ） 数据源 组件 负责 连接 数据 集 组件 与 数据 控制 组件 。 所 涉及 的 组件 　 　 （ ） 远程 数据 模块 （ REMOTEDATAMODULE ） 　 　 它 与 普通 的 数据 模块 有些 相似 不同 的 是 它 可以 作为 COM 服务器 或 CORBA 服务器 让 客户程序 访问 它 的 接口 。 它 提供 了 IdataBroker 接口 客户程序 与 应用服务器 连接 就 通过 IdataBroker 接口 获得 Iprovider 接口 。 　 　 （ ） 提供 器 组件 　 　 有 二种 提供 器 组件 TproviderTdatasetprovider 。 这个 元件 用 在 应用服务器 上 主要 作用 是 提供 Iprovider 接口 通过 它 直接 控制 数据包 中 所 包含 的 信息 响应 客户 数据 请求 更新 数据 定位 记录 并 将 数据 打包 后 传送 给 客户 。 　 　 （ ） 客户 数据 集 组件 （ TClientDataset ） 　 　 它 是 个 从 Tdataset 继承 下来 的 组件 通常 用于 客户端 。 它 最大 的 特点 是 不 依赖 BDE 但 它 需要 个 动态链接库 （ 即 DBCLIENTDLL ） 的 支持 。 它 支持 诸如 编辑 、 查询 、 浏览 、 修改 、 过滤 等 功能 。 由于 TClientDataset 在 内存 中 建立 了 数据 的 本地 副本 使 数据 操作 的 执行 速度 非常 快 。 　 　 （ ） MIDAS 连接 组件 　 　 客户 与 应用服务器 之间 可以 根据 选用 通信协议 的 不同 使用 不同 的 连接 方式 。 Delphi 提供 了 种 连接 组件 。 分别 是 　 　 TDCOMConnection 按 DCOM 方式 连接 。 不 需要 专门 的 运行 期 软件 但 需 安装 DCOM 程序 。 　 　 TSOCKETConnection 按 TCPIP 方式 连接 。 应用服务器 必须 运行 个 专门 的 运行 期 软件 SCKTSRVCEXE 或 SCKTSRVEREXE 。 SCKTSRVCEXE 只 适合 于 WindowsNT 可以 作为 个 服务器 在 后台 运行 。 　 　 TOLEnterpriseConnection 按 OLEnterprise 方式 连接 。 应用服务器 和 客户端 都 必须 运行 个 运行 期 软件 。 　 　 TCORBAConnection 按 CORBA 方式 连接 。 需要 ORB 的 支持 。 　 　 TMIDASConnectionTREMOTEServer 是 为了 兼容 Delphi 的 代码 而 保留 的 。 自定义 应用服务器 　 　 远程 数据 模块 是 应用服务器 的 核心部件 它 提供 了 应用服务器 和 客户程序 通信 的 接口 。 为了 使 客户 能 方便 地 访问 数据 模块 可以 对 数据 模块接口 进行 扩展 添加 一些 方法 让 客户程序 调用 。 　 　 要 向 接口 中 添加 属性 和 方法 首先 应 打开 类型 库 编辑器 利用 工具栏 上 的 NewMethod 或 NewProperty 命令 加入 新 的 方法 或 属性 并 设置 有关 属性 。 再用 InterfaceRepository 注册 接口 。 　 　 对于 基于 DCOM 的 远程 数据 模块 来说 新 的 成员 将 出现 在 接口 的 实现 单元 和 类型 库 的 描述 文件 中 。 调用 服务器 上 的 接口 　 　 在 层 CS 结构 中 客户程序 中 的 TClientDataset 通常 通过 Iprovider 接口 从 远程 数据库 服务器 获取数据 。 调用 Iprovider 接口 有种 方式 　 　 （ ） 通过 TClientDataset 的 Provider 属性 获取 Iprovider 接口 然后 直接 访问 Iprovider 接口 。 　 　 （ ） 通过 调用 TClientDataset 的 属性 和 方法 间接 调用 Iprovider 接口 。 因为 大部分 对 Iprovider 接口 的 调用 已 封装 在 TClientDataset 的 属性 和 方法 中 。 　 　 （ ） 通过 MIDAS 的 连接 组件 的 Appserver 属性 可以 获得 应用服务器 上 的 远程 数据 模块接口 通过 此 接口 可以 调用 远程 数据 模块 中 的 方法 。 教职工 信息管理系统 的 设计 与 实现 总体设计 　 　 教职工 信息管理系统 实现 了 对 教职工 数据库 的 综合 管理 。 主要 完成 对 数据库 的 维护 和 查询 代码 库 、 结构 库及 系统 字典 的 维护 报表 的 打印 等 功能 。 对 数据库 的 查询 要 实现 分布式 查询 包含 单库 查询 和 多库 查询 。 对 代码 库及 系统 字典 的 维护 要 实现 分布式 数据库 的 维护 。 系统 中 客户 与 应用服务器 的 连接 采用 DCOM 协议 。 系统 的 软件 层次结构 如图所示 。 图 教职工 管理系统 结构图 层 CS 结构设计 　 　 创建 数据库 服务器 　 　 数据库 服务器 采用 WindowsNT 上 的 SQLServer 包含 的 库 主要 有 　 　 数据库 存储 教工 信息 的 所有 数据库 包括 教工 基本 信息 表 、 工资表 、 培训 出国 情况表 等 。 　 　 代码 库 系统管理员 管理 的 数据 包含 各个 数据库 中 所用 到 的 代码 含义 。 　 　 结构 库 系统管理员 管理 的 数据 与 数据库 对应 描述 数据库 的 结构 的 数据库 。 　 　 数据库 目录 字典 所有 数据库 及 所在 服务器 的 目录 。 　 　 代码 库 字典 所有 代码 库 的 目录 。 　 　 用户 字典 有关 用户 的 信息 。 　 　 数据库 描述 字典 所有 数据库 的 描述 信息 包含 数据库 与 结构 库 的 对应 关系 各个 数据库 之间 的 关联 关系 。 　 　 应用服务器 的 建立 　 　 创建 个层 的 CS 应用程序 应先 创建 应用服务器 然后 注册 或 安装 应用服务器 只有 在 应用服务器 已 注册 并 正常 运行 的 情况 下 才能 创建 客户程序 。 对于 客户程序 来说 既 可以 在 设计 期 也 可以 在 运行 期 连接 应用服务器 。 　 　 创建 应用服务器 时 首先 创建 个 新 工程 在 工程 中 创建 个 远程 数据 模块 在 远程 数据 模块 上 添加 所 需 组件 包括 （ ） 数据 集 组件 （ ） 提供 器 组件 。 提供 器 组件 必须 与 个 数据 集 组件 对应 。 添加 完 提供 器 组件 后 在 组件 上 单击右键 在 弹出 菜单中选择 “ ExportfromnameinDataModule ” 引出 Iprovider 接口 在 类型 库中 注册 。 然后 编写 代码 实现 业务 规则 。 最后 保存 、 编译 、 注册 或 安装 应用服务器 。 如果 使用 DCOMTCPIP 作为 通信协议 应用服务器 就 好象 个 自动化 服务器 一样 必须 注册 。 如果 服务器 没 使用 DCOM 就 必须 安装 有关 运行 期 软件 。 本 系统 使用 了 DCOM 协议 因此 只 需 安装 DCOM 就 可以 了 。 　 　 客户程序 的 建立 　 　 本 系统 采用 BrowserServer 结构 即 采用 浏览器 Web 服务器 应用服务器 数据库 服务器 的 结构 。 Delphi 提供 了 ActiveXForm 可以 很 容易 地 创建 基于 BrowserServer 结构 的 “ 瘦 客户 ” 应用程序 。 要 创建 这种 应用程序 首先 应 新建 个 ActiveXForm 它 将 显示 在 浏览器 中 。 在 ActiveXForm 中用 程序 创建 主 窗体 主 窗体 和 其它 窗体 应该 用 一般 的 Form 。 然后 编写 代码 保存 和 编译 工程 最后 应该 用 Delphi 的 发布 功能 将 其 发布 到 Web 服务器 上 。 　 　 在 层 体系结构 中 客户程序 至少 需要 个 TClientDataset 组件 其 作用 是 引用 数据 集 。 创建 个 客户程序 首先 新建 个 工程 加入 了 个 数据 模块 。 然后 向 数据 模块 中 加入 组件 包括 （ ） 连接 组件 系统 中 选择 TDCOMConnection 组件 并 设置 它 的 ServerName 属性 指定 和 连接 应用服务器 可以 从 其 下 拉 列表 中 选择 应用服务器 （ ） TClientDataset 组件 设置 其 Remoteserver 属性 为 指定 的 连接 组件 设置 其 ProviderName 属性 指定 应用服务器 上 的 提供 器 组件 可 从 下 拉 列表 中 选择 。 这样 客户程序 就 可以 通过 Iprovider 接口 与 应用服务器 通信 （ ） TdataSource 组件 设置 它 的 Dataset 属性 指定 TClientDataset 组件 连接 数据 集 组件 与 用户界面 的 数据 控制 组件 。 　 　 本 系统 是 在 校园网 的 环境 下 开发 的 采用 分布式 数据库系统 。 本 系统 的 成功 开发 和 应用 证明 了 在 大型 应用 系统 中层 CS 结构 具有 效率高 、 易于 维护 、 可靠性 高等 优点 。 刘 华蓥 （ 大庆 石油学院 计算机科学 系 ） 韩建民 （ 大庆 石油学院 计算机科学 系 ） 薛继伟 （ 大庆 石油学院 计算机科学 系 ） 参考文献 ， 赵立军 张曙光 唐旭章 用 三层 CS 结构 实现 数据库 应用 计算机 应用 研究 ， 郭庆林 陈海强 沈旭升 三层 CS 的 机理 及 在 宾馆 管理 中 的 应用 计算机 应用 研究 收稿 日期 ：