软件 学报 JOURNALOFSOFTWARE 年 　 第卷 　 第期 　 Vol 　 No 　 镜头 频度 用于 视频 检索 的 研究 白雪 生 徐光 祐 史 元春 摘要 　 在 电影 、 电视 等 观赏 类 视频信号 中 情节 的 紧张 程度 一般 都 在 镜头 的 切换 频率 上 得以 体现 而 在 对 此类 视频信号 的 检索 中 ， 用户 往往 希望 能够 根据 情节 紧张 程度 来 进行 检索 文章 提出 了 对 此类 视频信号 的 镜头 切换 频率 进行 度量 并 根据 得到 的 镜头 频度 进行 视频 检索 的 方法 给出 了 视频流 的 镜头 分割 算法 以及 为 减小 漏分 错分 影响 所 采用 的 镜头 频度 度量 — — 镜头 平均 帧 数 的 鲁棒 计算方法 文章 还 阐述 了 利用 镜头 频度 进行 视频 检索 的 基本 思想 及 算法 细节 并 给出 了 对于 实际 影片 视频信号 检索 的 实验 结果 和 分析 关键词 　 视频 检索 镜头 频度 镜头 切变 镜头 渐变 镜头 平均 帧 数 中图法 分类号 　 TPUsingShotFrequencyinVideoRetrievalBAIXueshengXUGuangyouSHIYuanchunNationalKeyLaboratoryofIntelligentTechnologyandSystemsTsinghuaUniversityBeijingDepartmentofComputerScienceandTechnologyTsinghuaUniversityBeijingAbstract 　 InthefilmtelevisionandmanyothervideosexcitingvideosectionsareusuallyreflectedbytheirfrequentshotchangesandsuchsectionsarethemostfrequentlyobjectsinretrievalofthiskindofvideoInthispaperamethodonretrievingvideosaccordingtotheirshotchangefrequenciesispresentedScenetransitionanalysishasdoneonrealvideosandvideosegmentationalgorithmforbothcutanddissolvearedevelopedTolessentheinfluenceoferrorandmissingshotsegmentationsarobustcalculationmethodofshotfrequencyonshotsequenceacquiredisproposedBasicideasandalgorithmmodulesaregivenindetailalsowiththeexperimentalresultsonfilmvideoandanalysisKeywords 　 Videoretrievalshotfrequencyshotcutchromaticeditaverageframenumber 　 　 在 对 视频信号 的 基于 内容 的 检索 中 大多数 情况 下 ， 用户 都 希望 能够 根据 语义 信息 来 检索 视频 片段 然而 从 当前 媒体 理解 技术 的 水平 出发 通用 的 、 能够 自动 对 视频信号 进行 分析 并 建立 语义 描述 的 系统 在 近期内 还 难以实现 但 在 一定 的 场合 或 应用 中 某些 特征 往往 具有 特定 的 语义 含义 利用 这些 特征 建立 专用 的 视频 检索系统 也 就 成为 目前 视频信号 基于 内容 检索 研究 中 的 一个 热点 　 　 对于 视频 检索 目前 常用 的 处理 方法 往往 包括 如下 步骤 ： 将 连续 的 视频流 分割 为 具有 独立 语义 信息 的 视频 片段 — — 镜头 ； （ ） 对 镜头 建立 内容 描述 并 根据 不同 镜头 内容 描述 间 的 相似性 和 相关性 对 镜头 进行 组织 建立 更 高层 的 索引 结构 利用 得到 的 组织 结果 用户 可以 通过 浏览 来 选择 感兴趣 的 视频 片段 进行 检索 ［ ～ ］ 　 　 上述 方法 虽然 提供 了 一种 全面 、 有效 的 视频 检索 手段 但 需要 进行 大量 的 建库 工作 而 在 许多 应用 中以 用户 的 检索 要求 而言 并不需要 对 视频信号 建立 如此 细致 的 描述 例如 对于 电影 、 电视 等 视频信号 来说 用户 一般 希望 能够 根据 情节 如 打斗 、 追逐 、 对峙 、 交锋 等 来 检索 而 情节 往往 通过 镜头 切换 的 频率 得以 体现 许多 其他 编辑 处理 过 的 观赏 类 视频信号 也 具有 类似 的 特性 根据 这个 特点 对 此类 视频信号 建立 一个 反映 镜头 切换 频率 的 度量 — — 镜头 频度 从而 为 用户 提供 一个 灵活 的 、 对 视频信号 根据 其 紧张 程度 进行 检索 的 方法 无疑 具有 相当 重要 的 意义 　 　 在 实际 应用 中 需要 直接 对 镜头 进行 频率 计算 ， 但 因为 用于 统计 镜头 数目 的 单位 时间 不易 确定 而 难以 广泛应用 一种 可 替代 的 度量 是 镜头 的 平均 持续时间 在 实际 应用 中 体现 为 镜头 所含 的 平均 帧 数 由于 目前 的 镜头 分割 方法 不能 确保 得到 正确 的 镜头 分割 结果 在 得到 的 镜头 中 往往 含有 少量 错 分 、 漏分 的 镜头 在 这种 情况 下 直接 计算 平均 帧 数会 给出 错误 的 结果 为了 解决 这个 问题 我们 在 提高 镜头 分割 算法 性能 的 同时 提出 了 鲁棒 的 镜头 平均 帧 数 计算方法 采用 这种 方法 计算 得到 的 平均 帧 数 对于 镜头 分割 中 的 错误 具有 较强 的 抗干扰能力 从而 更能 从 本质 上 反映 视频流 中 镜头 切换 的 频率 （ 即 情节 的 紧张 程度 ） 也 就 能 更好 地 满足用户 的 检索 要求 　 　 本文 第节 对 视频流 的 组成 和 编辑 特性 作 简要 的 介绍 第节 对 采用 的 镜头 分割 技术 以及 提出 的 鲁棒 镜头 平均 帧 数 估计 方法 进行 介绍 第节 给出 了 对 实际 视频流 利用 镜头 频度 进行 检索 的 实验 结果 视频流 的 组成 及 编辑 特性 　 　 根据 视频信号 的 产生 原理 可知 一般 的 视频信号 本身 是 由 多 段 镜头 （ 摄像机 上 从 ON 到 OFF 期间 所 获得 的 一段 连续 视频信号 ） 通过 拼接 编辑 而成 在 镜头 内部 相邻 和 相近 的 视频 帧 特性 相近 变化 很小 ； 但 在 镜头 转换 处 视频 帧 特性 往往 会 发生 明显 的 改变 根据 转换 处 编辑 特性 的 不同 镜头 间 的 转换 可 分为 切变 （ cut ） 和 渐变 （ dissolve ） 两类 镜头 切变 　 　 镜头 切变 是 最 简单 的 视频 编辑 通过 将 两个 镜头 直接 拼接 而 形成 镜头 转换 间 不作 任何 编辑 如图所示 两个 长度 分别 为 t 和 t 的 镜头 At 和 Bt 间 进行 镜头 切变 形成 一个 长度 为 tt 的 镜头 CtCt 的 定义 为 　 　 　 　 　 　 　 　 　 　 　 （ ） 图 　 镜头 切变 　 　 可见 在 镜头 切变 t 处 相邻 帧 特性 发生 突变 而 其他 地方 相邻 帧 特性 则 变化 很小 镜头 渐变 　 　 镜头 渐变 是 一段 视频 镜头 在 镜头 转换 处在 某 段时间 内 渐渐 转变 为 后续 视频 镜头 的 编辑 方式 在 实际 视频信号 编辑 中 镜头 渐变 一般 通过 线性 特性 的 光学 组件 或 相应 的 视频 编辑 设备 来 完成 镜头 渐变 的 信号 构成 方式 如图所示 图 　 镜头 渐变 　 　 图中 在 长度 为 t 的 镜头 At 和 长度 为 t 的 镜头 Bt 间 存在 着 一个 镜头 渐变 过程 镜头 At 在 t 处 终止 经过 长度 为 tet 的 线性 衰减 后 在 te 处 完全 消失 镜头 Bt 信号 在 ts 处 开始 出现 经过 长度 为 tets 的 线性 增长 后 在 te 处 达到 生成 的 新 镜头 Ct 长度 为 tet 渐变 过程 中 的 视频信号 是 镜头 At 的 衰减 信号 和 镜头 Bt 的 渐增 信号 之 和 若 分别 定义 镜头 At 和 镜头 Bt 的 长度 为 tet 的 扩展 镜头 信号 　 　 　 　 　 　 　 　 （ ） 和 　 　 　 　 　 　 　 　 　 （ ） 则 产生 的 新 镜头 ctAtBt 　 　 　 ≤ t ＜ tet 　 　 　 　 　 　 　 　 　 （ ） 　 　 当 At 或 Bt 分别 为 零 信号 时 镜头 渐变 就 退化 为 淡入 fadein 和 淡出 fadeout 这 两种 常见 的 视频 编辑 方式 视频 镜头 的 分割 镜头 切变 的 检测 　 　 针对 镜头 切变 的 编辑 特性 显然 ， 切变 检测 应 针对 帧 特性 的 突变 来 进行 为了 减少 计算 量 加快 检测 速度 我们 采用 了 帧 的 直流 分量 DC 图像 来 作为 帧 特性 的 描述 显然 在 镜头 内部 ， DC 图像 变化 很小 但 在 镜头 切变 处 ， 前后 两幅 DC 图像 分别 对应 于 前 一 镜头 的 末 帧 和 后 一 镜头 的 首帧 图像 特性 将会 出现 较大 的 变化 在 DC 图像 的 差 序列 中则 对应 于 一个 单点 峰值 的 出现 通过 检测 单点 峰值 就 可以 确定 切变 的 位置 　 　 但 当 图像 中 景物 出现 较大 或 比较 明显 的 运动 时 DC 图像 的 特性 也 会 出现 较大 的 变化 导致 DC 图像 差 序列 中 出现 峰值 这样 直接 对 DC 图像 差 设定 阈值 将 导致 大量 的 误检 但 由于 运动 的 连续性 其 峰值 的 出现 也 是 连续 分布 的 而 非 单点 峰值 针对 这个 特点 我们 采取 了 用 DC 图像 差 计算 如下 定义 的 最大 次大 比值 序列 　 　 　 　 　 　 　 　 　 　 　 　 （ ） 并 对 其 进行 阈值 检测 的 方法 　 　 在 公式 中 dt ‖ IDCtIDCt ‖ 为 相邻 帧 的 DC 图像 差 序列 w 为 窗口 半径 和 分别 为 以 t 为 中心 以 w 为 半径 的 窗口 内此 相邻 帧 DC 图像 差 序列 的 最大值 和 次 大值 　 　 对 实际 视频信号 的 切变 检测 如图所示 其中 第行 对应 于 Diff 为 视频信号 DC 图像 差 序列 第行 对应 于 Max 为 经过 计算 而 得到 的 如 上 定义 的 最大 次大 比值 序列 第行 对应 于 Aver 为 如下 定义 的 最大值 均值 序列 w 即 窗口 半径 设置 为 图 镜头 切变 检测 结果 　 　 图中 abd 处 分别 对应 于处 镜头 切变 而 c 处则 对应 于 图像 中 出现 的 较大 运动 从中 可以 看出 最大 次大 比值 序列 可以 给出 很 好 的 切变 检测 结果 镜头 渐变 的 检测 　 　 根据 第节 中 的 模型 在 镜头 渐变 过程 中 各 像素 以 恒定 的 增量 变化 针对 此 特点 ZhangHongjiang 等 人 提出 了 计算 恒定 图像 （ constantimage 简称 CI 的 渐变 检测 方法 ［ ］ 但 由于 实际 渐变 过程 并 不 完全符合 该 模型 （ 渐变 过程 中 图像 仍 在 变化 ） 我们 在 实际 应用 中 发现 该 算法 的 性能 难以 令人满意 通过 分析 我们 提出 了 如下 的 渐变 检测 思想 首先 ， 我们 定义 间隔 w 帧 的 DC 图像 差 序列 ： dwt ‖ IDCtwIDCt ‖ 　 　 　 　 　 　 　 　 　 　 　 （ ） 　 　 相对 于 渐变 而言 在 镜头 内部 DC 图像 IDCt 变化 很小 可 认为 保持 恒定 如图 a 所示 这样 在 序列 dwt 上镜头 渐变 过程 就 对应 于 一个 梯形 形状 的 峰 如图 b 所示 其次 我们 定义 连续 w 帧 的 DC 图像 线性 偏差 序列 　 　 　 （ ） 　 　 在 镜头 内部 当 景物 非 静止 时 局部 运动 使 Ewt 保持 一个 相对 较 高 的 水平 但 在 镜头 转换 处 信号 的 变化 以 线性 变化 为主 将 导致 谷值 的 出现 如图 c 所示 图 　 镜头 渐变 检测 示意图 　 　 根据 以上 分析 我们 采用 了 对 dwt 和 Ewt 分别 检测 宽度 超过 宽度 阈值 wthreshold 的 峰 和 谷 的 算法 在 实现 中 w 设置 为 宽度 阈值 wthreshold 也 设为 检测 结果 如图所示 　 　 图 a 和 b 分别 为 对 两段 视频信号 的 检测 结果 其中 图 a 中 的 a 和 b 为 两处 渐变 过程 而图 b 中 的 c 和 d 则 为 两处 连续 的 渐变 过程 （ 实际上 是 前 一 字幕 淡出 接着 后 一 字幕 的 淡入 ） 图 镜头 渐变 检测 结果 镜头 频度 的 鲁棒 估计 　 　 通过 对 视频流 采用 上述 镜头 分割 算法 可以 得到 一个 镜头 序列 下面 我们 将 对 镜头 序列 中 镜头 切换 频率 度量 — — 镜头 频度 的 估计 进行 讨论 　 　 镜头 频度 的 直接 含义 是 在 单位 时间 内 出现 的 镜头 数目 但 由于 不同 镜头 的 持续时间 相差 很大 在 实际 应用 中 统计 镜头 数 的 单位 时间 就 难以确定 一种 与 镜头 频度 相应 的 度量 是 镜头 的 平均 持续时间 即 计算 以此 镜头 为 中心 的 给定 长度 窗口 内 镜头 持续时间 的 平均值 显然 镜头 频度 越高 镜头 的 平均 持续时间 越小在 实现 中 镜头 的 持续时间 往往 用 镜头 中 包含 的 帧 数 更 方便 地 加以 表示 　 　 值得注意 的 是 镜头 分割 算法 不能 保证 总能 给出 正确 的 分割 结果 而是 不可避免 地 存在 着 漏分 和 错分 现象 若 对 镜头 窗中 所有 镜头 计算 平均 帧 数则 得到 的 结果 将 直接 受到 漏分 和 错分 的 影响 此外 从 人 的 感知 角度 而言 与 情节 紧张 程度 相关联 的 是 镜头 窗中 大多数 镜头 帧 数 的 平均 统计 在 计算 中 也 应 除去 含有 最多 帧 数 和 最少 帧 数 的 一些 镜头 　 　 基于 上述 分析 我们 提出 了 如下 的 镜头 平均 帧 数 计算方法 　 　 将 镜头 序列 记为 fn 其值 代表 第 n 个 镜头 中所含 的 帧 数记 窗口 长度 为 LSLn 为 以 n 为 中心 ， 长度 为 L 的 窗口 中 镜头 帧 数 构成 的 集合 对 SLn 中 的 元素 按 从小到大 的 顺序 排序 将 除去 其中 最小 a 个 和 最大 b 个 元素 ， 得到 的 新 集合 记为 SabLn 则 镜头 平均 帧 数 可 按 如下 公式 计算 　 　 　 　 　 　 　 　 　 　 　 （ ） 即 镜头 的 平均 帧 数 通过 对 长度 为 L 窗口 中 去除 最小 a 个 和 最大 b 个 后 的 元素 计算 均值 得到 显然 由于 漏分 造成 的 长镜头 和 错分 造成 的 短 镜头 对此 平均 帧 数 的 计算 影响 很小 算法 具有 较强 的 鲁棒性 算法 实现 与 分析 　 　 利用 本文 中 提出 的 算法 我们 设计 并 实现 了 一套 镜头 分割 、 计算 镜头 频度 以及 利用 镜头 频度 对 视频 进行 浏览 的 系统 并 利用 此 系统对 实际 的 影片 视频流 进行 了 基于 镜头 频度 的 检索 　 　 系统 提供 了 利用 镜头 帧 数 对 视频 进行 浏览 检索 的 功能 浏览 界面 如图 a 所示 其中 上 行为 分割 得到 的 镜头 帧 数 序列 下 行为 采用 文中 算法 得到 的 镜头 平均 帧 数 序列 在 镜头 平均 帧 数 的 计算 中 我们 将 窗口 长度 L 设定 为 滤去 的 最小 元素 个数 a 和 最大 元素 个数 b 均 设为 为 便于 交互 浏览 Navern 计算 所用 的 窗口 不是 以 n 为 中心 而是 以 n 为 起点 的 窗口 通过 选择 双击 浏览 界面 中 镜头 对应 的 位置 系统 就 可 从 指定 镜头 开始 视频 播放 这样 用户 可以 通过 选择 镜头 平均 帧 数 序列 中 具有 较 小 平均 帧 数 的 镜头 来 选择 镜头 切换 频繁 的 视频 片段 （ 一般 都 对应 于 情节 较为 紧张 的 片段 ） 来 浏览 检索 　 　 a 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 b 图 利用 镜头 频度 对 视频信号 进行 检索 　 　 为了 对 镜头 频度 的 作用 进一步 加以 说明 我们 在 系统 中 提供 了 对 镜头 序列 按 平均 帧 数 从小到大 重新排列 的 功能 以便 于 用户 的 检索 重排 后 得到 的 代表 帧 序列 如图 b 所示 图中 显示 的 是 对 美国 影片 “ 黑衣人 ” （ ManInBlack ） 上 中 的 镜头 代表 帧 重排 得到 的 结果 经 测试 ， 序列 中排 在 前面 的 代表 帧 对应 的 基本 都 是 影片 中 情节 紧张 的 部分 在 图 b 的 重排 序列 中 代表 帧 按 顺序 依次 为 ： 虫族 在 餐馆 的 谋杀 ； 球型 闪电 在 MIB 中心 造成 的 混乱 ； 主人公 J 和 K 调查 枪支 来源 与 外星人 在 百货店 的 对峙 ； 主人公 J 加入 MIB 的 手续 过程 ； 主人公 J 对 外星人 的 追逐 等 其中 除外 都 属于 情节 较为 紧张 的 场面 而是 出于 表现手法 的 需要 而 采用 了 一系列 的 短 镜头 可见 镜头 频度 对于 影片 提供 了 一种 相当 好 的 根据 情节 进行 检索 的 手段 结论 　 　 在 本文 中 根据 影片 等 经过 编辑 处理 过 的 观赏 类 视频信号 中 情节 往往 通过 镜头 频度 — — 镜头 切换 的 频率 来 体现 这一 特点 我们 提出 了 对 此类 视频信号 根据 镜头 频度 进行 检索 的 方法 针对实际 视频信号 中 镜头 切变 和 渐变 的 特点 我们 分别 设计 并 实现 了 相应 的 镜头 分割 算法 ， 在 此基础 上 提出 了 反映 镜头 频度 的 度量 — — 镜头 平均 帧 数 的 鲁棒 计算方法 对 实际 影片 进行 的 浏览 和 检索 显示 出 镜头 频度 可以 很 好 地 满足 对 影片 根据 情节 进行 检索 的 要求 　 本文 研究 得到 国家 高科技 项目 基金 和 国家 “ ” 学科 建设项目 基金 资助 本文 通讯联系 人 ： 白雪 生 ， 北京 清华大学 计算机科学 与 技术 系 信息 教研组 作者简介 ： 白雪 生年生 博士生 主要 研究 领域 为 基于 内容 检索 计算机 视觉 　 　 　 　 　 徐光 祐 年生 教授 博士生 导师 主要 研究 领域 为 计算机 视觉 多媒体技术 ， 基于 内容 检索 　 　 　 　 　 史 元春 女年生 在职 博士生 副教授 ， 主要 研究 领域 为 计算机 支持 的 协同工作 多媒体技术 作者 单位 ： 白雪 生 ， 徐光 祐 ， 史 元春 （ 清华大学 计算机科学 与 技术 系 　 北京 　 ） 　 　 　 　 　 白雪 生 ， 徐光 祐 ， 史 元春 清华大学 智能 技术 与 系统 国家 重点 实验室 　 北京 　 参考文献 ： ［ ］ ZhangHJKankanhalliASmoliarSWAutomaticpartitioningofanimatevideoTechnicalReportInstituteofSystemsScienceNationalUniversityofSingapore ［ ］ YeungMMYeoBLLiuBExtractingstoryunitsfromlongprogramsforvideobrowsingandnavigationIn ： IEEEComputerSocietyedProceedingsoftheInternationalConferenceonMultimediaComputingandSystemsLosAlamitos ： IEEEComputerSocietyPress ～ ［ ］ IraniMAnandanPHsuSMosaicbasedrepresentationsofvideosequencesandtheirapplicationsIn ： IEEEComputerSocietyedProceedingsofthethInternationalConferenceonComputerVisionLosAlamitos ： IEEEComputerSocietyPress ～ ［ ］ ArdizzoneECasciaMLAutomaticvideodatabaseindexingandretrievalMultimediaToolsandApplications ： ～ 收稿 日期 ： ， 修改 日期 ：