微型机 与 应用 WEIXINGJIYUYINGYONG 　 Vol 　 No 　 P 类 汉语 组合 查询器 的 查询 操作 模式 构造 刘秉毅 摘要 ： 讨论 类 汉语 组合 查询器 FIMSFIND 的 查询 操作 模式 构造 方面 的 有关 问题 。 提出 了 以 查询 模式 构造 、 查询 模式 驱动 为 基本 思想 的 、 面向 中文信息处理 的 查询 系统 快速 原型 法 生成 工具箱 ， 对 脚本语言 FimsScript 的 语法 规则 、 语义 描述 、 查询 单元 项 的 重用 概念 等 关键问题 进行 了 详细 讨论 。 关键词 ： 查询 优化 查询器 数据库 技术 泛 模式 接口 查询语言 　 　 对以 查询 和 检索 为 主要 业务 的 信息系统 （ IS ） ， 其 模型 通常 可以 简化 为个 元组 ， 即 ： 　 　 IS ： ＝ ＜ DBS ， QL ， AS ， α ＞ 　 　 其中 ， 数据库系统 DBS 为 所有 对象 实例 的 集合 ； 查询语言 QL 表示 所有 查询 集合 ； 答案 系统 AS 表示 所有 查询 结果 的 集合 ； 查询 计算 函数 α 为 偏序 映射函数 ， 即 　 　 α ： DBS × QL → AS 　 　 对于 关系 型 数据库 信息系统 ， DBS 主要 由 标征 数据 内涵 的 数据库 模式 和 关系数据库 外延 二 部分 构成 ， 为 有限 的 信息 集合 ； QL 通常 为 由 用户 选择 或 指定 的 查询 表达式 ， 借助于 DBMS 查询 系统 完成 查询 检索 操作 （ α 偏序 映射 过程 ） ， 产生 查询 集合 AS ； 由于 QL 是 以 DBS 所有 数据库 （ 表 ） 的 属性 或 数据库 函数 限定 的 属性 构成 的 可 组合 查询 项集 、 关系 运算符 集 （ ＝ 、 ＜ ＞ 、 ＜ 、 ＞ 、 ＞ ＝ 、 ＜ ＝ 等 ） 、 逻辑关系 符集 （ AND 和 OR ） 、 有效 查询 值集 （ 为 无限 集 ） 等 按照 一定 规则 组合而成 的 有效 表达 的 无限 集合 ， AS 为 满足 QL 表达式 条件 的 、 包含 DBS 某一 现有 关系 的 一部分 或 若干 现有 关系 的 重构 数据 ， 即 关系 视图 ， 显然 ， AS 也 应为 无限 集合 。 近年来 ， 以 终端用户 为 使用 对象 的 、 基于 可 组合 查询 项集 的 所谓 任意 组合 条件 查询 机制 是 一直 公认 的 解决 以 有限 的 查询 程序 承担 无限 的 查询 任务 这一 问题 的 有效 方法 之一 ［ ］ ［ ］ ［ ］ 。 　 　 研制 专用 的 查询 机制 或者 集成 工具 来 支持 语义 丰富 的 查询 操作 已 成为 所谓 的 第代 语言 （ GL ， 如 PowerBuilder 、 Informixs 等 ） 的 显著 特色 ， 而 有关 中文 DBMS 的 任意 组合 查询 机制 的 设计 原理 、 性能指标 及 程序实现 等 专题 一直 是 从事 中文 信息系统 （ CIS ） 研制者 讨论 的 重点 、 关心 的 热点 和 开发 的 难点 。 不难 发现 ， 几乎 国内 所有 的 实际 运行 或 大 范围 推广 的 CIS 都 具有 所谓 的 “ 任意 组合 条件 查询 ” 的 功能 ， 并且 取得 了 一定 的 运行 效果 。 但是 ， 对于 相当 数量 的 CIS 而言 ， 所谓 “ 任意 组合 条件 查询 ” 机制 或多或少 存在 以下 问题 ： 　 　 （ ） 对于 终端用户 要求 熟悉 整个 系统 的 数据库 结构 的 设置 ， 掌握 数据库 查询 表达式 或 SQL 语句 的 构造 ， 这 显然 是 不合理 的 。 　 　 （ ） 组合 界面 的 控制 问题 。 对于 由 控件 实现 的 组合 条件 工作 窗口 ， 缺乏 表达式 组合 顺序 的 精确 控制 、 组合 字 段 选择 的 无误 性 约束 机制 、 输入 查询 值 的 有效 检查 、 查询 字段 与 查询 值 匹配 问题 的 适时 判定 等 ， 从而 影响 着 查询 系统 的 正常 运行 。 　 　 （ ） 对于 用户 构造 表达式 的 完整性 、 有效性 由于 无法 在 提交 DBMS 执行 查询 操作前 进行 检查 ， 这 就 要求 终端用户 具有 根据 DBMS 出错 提示 重新 构造 查询 表达式 的 能力 ， 这 对于 办公 业务 娴熟 的 非 计算机专业 用户 而言 ， 要求 显然 是 过 高 了 。 　 　 （ ） 表达式 的 构造 能力 问题 。 表达式 不 允许 使用 括号 ， 查询 能力 不能 满足用户 的 需求 。 FIMSKITS （ OFficeInformationSystemKits ） 是 笔者 研制开发 的 具有 功能 集成化 、 操作 非 过程 化 、 可 嵌入 任何 开发 环境 或 编程语言 的 智能化 工具箱 （ 智能 积 木箱 ） 。 其中 ， 面向 泛关系 接口 的 、 支持 按照 类 汉语 方式 进行 表达式 组合 的 查询器 由 查询 模式 维护 （ FFINDKIT ） 和 模式 驱动 （ FIMSFIND ） 二套 工具 配合 使用 。 本文 主要 讨论 FIMSFIND 终端用户 接口 的 类 汉语 化 界面 、 查询 操作 模式 的 FIMSKITS 脚本语言 FimsScript 的 描述 、 查询 操作 模式定义 等 方面 的 问题 。 类 汉语 组合 查询器 的 用户 操作界面 　 　 FFINDKIT 主要 作用 是 把 系统 开发人员 使用 脚本 描述语言 FimsScript 定义 的 文本 类 查询 操作 模式 TQOS 生成 可 由 FIMSFIND 直接 运行 的 查询 操作 模式 QOS ， QOS 逻辑 上 定义 了 一组 基于 Windows 操作系统 的 可执行程序 的 集合 ， 可 由 FIMSFIND 驱动 完成 特定 的 任务 。 FFINDKIT 功能 如图所示 。 图 FIMSFIND 查询 模式 维护 工具 与 FFINDKIT 功能 示意图 　 　 查询 操作 模式 QOS 逻辑 上 可以 定义 任意 多个 查询 操作过程 ， 实际 使用 中 ， 个 设有 数千 项 查询 功能 的 CIS 通常 只 需个 QOS 模式 （ 文件 ） 即可 。 FIMSFIND 较为 突出 的 特点 是 为 终端用户 提供 了 类 汉语 化 的 任意 组合 条件 查询 的 工作 窗口 （ 如图所示 ） 。 图 FFINDKIT 任意 组合 条件 查询 工作 窗口 　 　 从图 可以 看出 ， FIMSFIND 实现 查询 操作界面 的 类 汉语 化 包括 可 组合 的 查询 项 、 关系 运算符 、 逻辑关系 符等 多方面 的 类 汉语 化 ， 其 查询 操作 类 汉语 化 的 过程 由 FIMSFIND 实现 ， 而 整个 界面 的 组合 内容 、 完整性 限制 等 方面 的 综合 设置 通过 查询 模式 的 构造 来 完成 。 查询 操作 模式 基本 单元 的 FimsScript 描述 　 　 QOS 主要 是 由 查询 项 、 查询 单元 、 数据 查询 源 、 输出 视图 等 描述 信息 组合 的 包 （ PACKAGE ） 构成 ， 个 QOS 可以 包含 多个 包 。 相关 的 TQOS 脚本 描述 可 简述 如下 ： 　 　 （ ） 查询 包 。 TQOS 以 查询 包为 逻辑 单元 ， 个 包可 聚集 任意 多个 查询 单元 ， FIMSFIND 以包 实现 封装 ， 包 体内 可以 定义 全局 对象 、 局部 对象 等 。 个 QOS 文件 可以 包含 任意 多个 查询 包 。 其 格式 为 ： 　 　 PACKAGE ＜ 查询 包名 ＞ ISQUERY 　 　 　 　 　 　 ＜ 查询 包体 ＞ 　 　 ENDPACKAGE 　 　 （ ） 数据 查询 源 和 输出 视图 的 定义 。 为了 实现 数据库 访问 的 物理 无关 性 和 逻辑 无关 性 ， FIMSKITS 引入 敛 使用 了 泛关系 模式 的 概念 ， 提供 了 泛关系 模式 管理 工具箱 ， 允许 用户 建立 基于 多个 数据库 模式 的 泛关系 操作 模式 （ UROS ） ， 借助于 UROS ， 查询 操作 模式 中 引用 的 整个 数据库 的 所有 属性 集合 可以 作为 唯一 关系 模式 上 的 单一 关系 对待 ， 数据 查询 源 和 输出 视图 通常 在 UROS 中 定义 ， 供 TQOS 引用 。 例如 ： 　 　 INPUTRELATIONISrminrel ／ ／ 指定 查询 单元 的 　 　 　 　 　 　 　 　 　 　 　 　 　 　 ／ ／ 缺省 数据 查询 源 　 　 OUTPUTVIEWISrmoutview ／ ／ 指定 查询 单元 的 缺 　 　 　 　 　 　 　 　 　 　 　 　 　 ／ ／ 省 输出 视图 　 　 （ ） 代码 类字 段 和 拼音码 联想 字 段 输入 对象 的 定义 。 FIMSKITS 的 代码 表 、 面向 字段 的 汉字 联想 输入 环境 的 定义 由 其它 工具 承担 ［ ］ ［ ］ ， TQOS 只 需 作为 对象 引用 即可 。 　 　 STATICCODEOBJECTISrmcode ／ ／ 静态 缺 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 ／ ／ 省 代码 对象 　 　 DYNAMICFIELDOBJECTISrmfield ／ ／ 面向 　 　 　 　 　 　 　 　 ／ ／ 数据库 字段 的 联想 输入 对象 名 　 　 （ ） 静态 查询 项 （ SQI ） 的 定义 。 静态 查询 项为 个 不 包含 任何 待 输入量 的 有效 查询 表达式 ， SQI 在 包内 可以 作为 全局 常数 使用 ， 主要 用于 组合 静态 、 动态 及 组合 查询 单元 。 TQOS 把 多个 SQI 定义 为个 静态 查询 项体 （ SQIB ） ， 即个 SQIB 可以 包含 任意 多个 SQI ， 个 查询 包内 可以 包含 多个 SQIB ， 把 个 TQIB 分解成 多个 TQIB 语义上 并 无差别 ， 只不过 是 为了 编写 脚本 方便 而已 。 逻辑 上 ， 所有 TQIB 作为 个 TQIB 看待 。 　 　 （ ） 动态 查询 项 （ DQI ） 的 定义 。 动态 查询 项为 包含 个 （ 且 必须 包含 ） 待 输入量 的 有效 查询 表达式 。 除 定义 中 必须 指定 待 输入量 的 类型 和 长度 外 ， DQI 及 动态 查询 项体 （ DQIB ） 的 定义 、 概念 等 与 SQI （ SQIB ） 基本 类似 。 　 　 （ ） 可 组合 查询 项 （ CQI ） 的 定义 。 CQI 以 泛关系 的 属性 定义 可 组合 项目 。 查询 操作 模式 的 构造 　 　 在 QOS 的 同一 包内 所有 SQI 、 DQI 和 CDI 均 为 全局变量 ， 可以 作为 查询 操作 单元 的 构件 ， FIMSFIND 的 查询 单元 是 由 查询 项集 或者 多个 查询 项用 逻辑关系 符 （ AND 和 OR ） 关联 而成 的 查询 表达式 、 表达式 构造 规则 、 查询 标题 、 查询 数据源 、 输出 视图 、 引用 标识 等 信息 项 构成 的 逻辑 集合 。 查询 单元 的 类别 由 指定 或 逻辑 上 隐含 指定 的 查询 表达式 所 包含 的 查询 项来 决定 ， 当 只 包含 SQI 项时 ， 称为 静态 查询 单元 （ SQU ） ； 当 包含 SQI 和 DSI （ 至少 包含 个 DQI ） 时 ， 称为 动态 查询 单元 （ DQU ） ； 当 至少 包含 个 CQI 时 ， 称之为 组合 查询 单元 （ CQU ） 。 下面 给出 个 简化 的 查询 脚本 ， 脚本 中 附有 注释 ， 本 节 不再 赘述 。 PACKAGEGBRMQUERYISQUERY 　 　 ／ ／ 窗口 对象 、 库 对象 、 视图 对象 、 代码 对象 等 定义 （ 略 ） 　 　 DYNAMICWINDOWSISdywin ／ ／ 指定 动态 查询 单 　 　 　 　 　 　 　 　 　 　 　 　 　 　 ／ ／ 元 的 缺省 工作 窗口 　 　 COMPOSEWINDOWSIScowin ／ ／ 指定 组合 查询 单 　 　 　 　 　 　 　 　 　 　 　 　 　 ／ ／ 元 的 缺省 工作 窗口 　 　 INPUTRELATIONISrminrel ／ ／ 指定 查询 单元 的 缺 　 　 　 　 　 　 　 　 　 　 　 　 　 　 ／ ／ 省 泛关系 　 　 OUTPUTVIEWISrmoutview ／ ／ 指定 查询 单元 的 缺 　 　 　 　 　 　 　 　 　 　 　 　 　 ／ ／ 省 输出 视图 　 　 STATICCODEOBJECTISrmcode ／ ／ 定义 查询 项相 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 ／ ／ 关 的 静态 缺省 代码 对象 　 　 DYNAMICFIELDOBJECTISrmfield ／ ／ 定义 面向 数 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 ／ ／ 据库 字段 的 联想 输入 对象 名 　 　 STATICCONDITIONITEMSAREDEFINEDAS 　 　 　 　 　 　 　 　 　 　 　 　 　 ／ ／ 定义 静态 查询 项 集合 　 　 　 S （ 军官 ） ： FORJGW ＝ ［ ］ 　 　 　 S （ 正军 ） ： FORZWD ＝ ［ ］ 　 　 　 S （ 军 部级 ） ： FOR （ （ ZWD ＞ ＝ ［ ］ ． AND ． ZWD ＜ ＝ ［ ］ ） 　 　 　 　 　 　 　 　 　 　 ． OR ． （ ZWD ＞ ＝ ［ ］ ． AND ． ZWD ＜ ＝ ［ ］ ） ） ENDSTATIC ／ ／ 定义 动态 查询 项 集合 DYNAMICCONDITIONITEMSAREDEFINEDAS 　 　 D （ 入伍 起始 年 月 ） ： DATE （ ） FORRWS ＞ ＝ ﹖ 　 　 D （ 入伍 截止 年 月 ） ： DATE （ ） FORRWS ＜ ＝ ﹖ 　 　 D （ 各层次 军衔 调整 年 月 ） ： DATE （ ） FOR （ （ JXW ＞ ＝ 　 　 　 　 ［ ］ ． ADN ． WHC ＞ ［ ］ ． AND ． AGE （ ﹖ ， JXS ） ＞ ＝ ） ． 　 　 　 　 OR ． （ JXW ＝ ［ ］ ． AND ． WHC ＜ ＝ ［ ］ ． AND ． AGE （ ﹖ ， 　 　 　 　 JXS ） ＞ ＝ ） ． OR ． ； （ JXW ＜ ＝ ［ ］ ． AND ． JXW ＞ ＝ ［ ］ ． 　 　 　 　 AND ． AGE （ ﹖ ， JXS ） ＞ ＝ ） ） 　 　 ENDDYNAMIC 　 　 COMPOSECONDITIONITEMSAREDEFINEDAS 　 　 　 　 　 　 　 　 　 　 　 　 　 ／ ／ 定义 可 组合 查询 项集 　 　 　 C （ 职务 等级 ） ： CHAR （ ） HELP （ ″ ″ ， rmcode ， 　 　 　 　 　 　 　 　 　 TAIL ， HEAD ， STATIC ） FORZWD ﹖ 　 　 　 C （ 单位名称 ） ： CHAR （ ） HELP （ ″ dwm ″ ， rmfield ， 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 DYNAMIC ） 　 　 　 C （ 现职 时间 ） ： DATE （ ） FORZWS ﹖ 　 　 　 C （ 技术 级 ） ： CHAR （ ） HELP （ ″ ″ ， rmcode ， TAIL ， 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 HEAD ， STATIC ） FORJSJ ﹖ 　 　 　 C （ 技级 时间 ） ： DATE （ ） FORJSS ﹖ 　 　 　 C （ 在编 情况 ） ： CHAR （ ） HELP （ ″ ″ ， rmcode ， 　 　 　 　 　 　 　 　 　 　 TAIL ， HEAD ， STATIC ） FORZBQ ﹖ 　 　 　 C （ 是否 领导 ） ： CHAR （ ） HELP （ ″ ″ ， rmcode ， 　 　 　 　 　 　 　 　 　 　 TAIL ， HEAD ， STATIC ） FORSLD ﹖ 　 　 ENDCOMPOSE 　 　 QUERYSETISDEFINEDAS 　 　 　 ／ ／ 下面 定义 查询 集合 　 　 　 　 CREATEQUERY ． ． AS ／ ／ 定义 一个 静态 查询 单元 ， 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 ／ ／ 输入 、 输出 视图 使用 缺省 　 　 　 　 　 TITLEIS ″ 正 军职 查询 ″ 　 　 　 　 　 WHERES ． AND ． S ／ ／ 查询 表达式 　 　 　 　 ENDCREATE 　 　 　 　 CREATEQUERY ． ． AS ／ ／ 定义 一个 动态 查询 单 　 　 　 　 　 　 ／ ／ 元 ， 工作 窗口 、 输入 、 输出 视图 等 均 使用 缺省 指定 　 　 　 　 TITLEIS ″ 按 入伍 时间 查询 正军 情况 ″ 　 　 　 　 WHERES ． and ． S ． and ． D ． and ． D 　 　 ENDCREATE 　 　 CREATEQUERY ． ． AS ／ ／ 同 查询 单元 ． ． 　 　 　 　 TITLEIS ″ 各层次 军官 军衔 调整 查询 ″ 　 　 　 　 WHERES ． and ． D ． and ． D ． and ． D 　 　 ENDCREATE 　 　 CREATEQUERY ． AWITHCOMPOSEAS ／ ／ 定义 　 　 　 　 　 　 　 　 ／ ／ 一个 可 组合 的 查询 单元 ， 工作 窗口 、 　 　 　 　 　 　 　 　 　 　 　 ／ ／ 输入 、 输出 视图 使用 缺省 指定 　 　 　 　 TITLEIS ″ 军官 职务 任意 组合 条件 查询 ″ 　 　 　 　 PREFIXEXPRESSIS （ S ． and ． D ． and ． D ） 　 　 　 　 　 　 　 　 　 　 　 　 　 　 ／ ／ 组合 条件 的 前置 表达式 　 　 　 　 WHEREC ， C ， C ， C ， C ， C ｝ 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 ／ ／ 指定 组合 项 集合 　 　 　 　 ENDCREATE 　 　 　 ENDQUERYSET 　 　 ENDPACKAGE 　 　 借助于 虚拟机 （ VM ） 的 概念 ， FIMSKITS 引入 了 泛关系 模式 （ URS ） ［ ］ ［ ］ ［ ］ 的 机制 ， 对于 多功能 查询器 FIMSFIND ， URS 相当于 个 虚拟 数据库 管理系统 （ VDBMS ） ， 从 数据库 用户 角度看 ， VDBMS 整个 数据库 中 所有 属性 的 集合 构成 个 关系 模式 ， 所有 数据 都 是 由 这 唯一 关系 模式 上 的 结构化 数据 集合 构成 ， 借助于 FIMSFIND ， 经典 关系数据库 复杂 的 查询 演算 都 可以 转换 为 对于 URS 进行 按 条件 选择 的 简单 操作 。 以 FIMSFIND 为 主要 部件 的 FIMSKITS 工具箱 ， 由 TurboC 开发 的 约 多个 功能 积木 构成 ， 以 VC ＋ ＋ 进行 面向 Windows 操作系统 的 移植 转化 工作 已 基本 完成 ， 其中 ， FIMSFIND 新增 了 面向 多媒体 的 自 学习 检索 和 索引 功能 ， 取得 了 较为理想 的 运行 效果 。 刘秉毅 （ 西安 第四军医大学 生物医学 工程系 ） 参考文献 ［ ］ KiferM ， LozinskiiEL ． Oncompile － timeoptimizationindeductivedatabasebymeansofstaticfiltering ． ACMTranondatabasesystems ， ； ［ ］ AtzeniP ． Updatingrelationaldatabasethroughweakinstanceinterface ． ACMTranonDatabaseSystems ， ； ： ［ ］ L ． leeD ． Documentrankingonweight － partitionedsig － naturefiles ． ACMTranoninformationsystems ， ； ［ ］ 刘秉毅 ． 文本 对象 查询 的 相关性 计算 ． 小型 微型 计算机系统 ． ； ［ ］ 刘秉毅 ， 屈景辉 ． 医学 数据库 的 面向对象 数据模型 ． 西安 ： 第四军医大学 学报 ， ； （ ） ： 收稿 日期 ： － －