微型机 与 应用 WEIXINGJIYUYINGYONG 年 月 第卷 第期 volNo 基于 Web 技术 的 新闻 制作 与 管理信息系统 陈福民 　 张志浩 　 冯伟国 　 张晔 　 刘玉莎 　 　 摘 　 要 ： 就 已 实际 开发 的 上海电视台 新闻 制作 与 管理信息系统 在 Web 上 的 实现 为例 ， 介绍 了 设计 新一代 数据库 事务处理 系统 的 开发 背景 、 系统结构 以及 相关 的 技术 ， 着重 讨论 了 如何 在 基于 Web 的 Intranet 应用 中 合理 分配 计算 量 的 问题 。 　 　 关键词 ： CS 模式 　 Intranet 网 　 Web 　 ODBC 接口 　 NCA 　 Java 语言 　 ActiveX 　 开发 及 技术 背景 　 　 上海电视台 新闻 制作 与 管理信息系统 是 一套 反映 电视台 新闻 制作 全过程 、 并 根据 各类 工作人员 的 实际 职责 而 设计 研制 的 事务处理 系统 ， 它 以 Windows 为 平台 ， Develop 为 前台 开发工具 ， Oracle 为 系统 数据库 ， 服务器 则 采用 SunSparcE 小型机 。 自年 投入 运行 以来 ， 反映 良好 。 但 随着 Internet 、 Intranet 的 日益 普及 以及 Web 技术 的 迅速 发展 ， 加之 上海电视台 新闻 业务 要求 的 不断 提高 ， 原有 的 系统 已 显得 “ 力不从心 ” 。 为此 需要 在 原有 系统 的 基础 上 ， 将 部分 功能 转移 到 基于 Web 的 三层 CS 结构 模式 的 新 系统 中 以下 简称 为 新 系统 。 　 　 基于 Web 技术 的 CS 系统 事实上 是 传统 的 二层 CS 模式 的 进一步 发展 ， 通常 被 称为 三层 模式 。 在 二层 模式 中 ， 客户端 集成 了 GUI 和 应用 程序模块 ， 而且 在 设计 时 往往 混为一体 。 而 三层 模式 的 CS 系统 ， 则 把 原来 客户机 一侧 的 应用 程序模块 与 GUI 分开 ， 并 将 之 迁移 到 服务器 上去 。 以 三层 结构 模式 设计 的 系统 ， 其 整体 就是 由个 功能 分工 很 明确 的 “ 层 ” 组成 。 基本 结构 如图所示 。 图 基于 Web 技术 的 CS 模式 的 基本 结构 　 系统结构 　 系统 概述 　 　 客户端 。 采用 微机 Pentium 微机 ； Windows 平台 Windows 操作系统 ； Oracle 客户端 网络通信 软件 SQLNetEasyConfiguration 等 ； Develop 客户端 软件 和 Netscape 浏览器 。 　 　 Web 服务器 。 Compaq 专用 服务器 ； WindowsNT 操作系统 ； WebSite 服务器软件 ； 位 ODBC 管理器 ； Oracle 客户端 网络通信 软件 ； 新 系统 的 所有 应用 ， 包括 所有 页面 、 CGI 程序 以及 JavaApplet 。 　 　 数据库 服务器 。 SUNSparcESolaris 操作系统 ； Oracle 数据库 ； PLSQL 存储 过程 。 　 　 数据库 备份 服务器 。 高档 PC 服务器 ； Windows 操作系统 ； PersonalOracle 数据库 ； SQLPlus 数据库 备份 程序 。 　 　 RAS 服务器 。 高档 PC 服务器 ； COMC 口 ； ModemWindowsNT 操作系统 ； RAS 服务 管理软件 。 　 功能 简述 　 　 查询 。 按照 不同 的 用户 级别 提供 相应 新闻节目 库 的 查询 ， 如对 电视台 的 领导 提供 实时 查询 当天 新闻 串联 单 、 记者 报片 单 的 功能 ， 随时 了解 新闻 制作 的 进展 情况 ； 而 一般 的 Internet 用户 ， 甚至 是 电视台 的 某些 工作人员 ， 也 只 允许 查询 以前 的 新闻 信息 。 所有 的 查询 可以 是 时间 、 档次 等 条件 的 任意 组合 ， 并 支持 模糊 查询 。 　 　 实现 步骤 ： 　 　 ① 客户端 的 JavaScript 程序 对 用户 输入 的 查询 条件 进行 合法性检查 包含 逻辑 错误 的 检查 。 若 正确 ， 将 其 作为 CGI 程序 的 参数 进行 编码 ， 执行 POST 请求 ， 送往 Web 服务器 ； 否则 ， 做出 相应 的 警告 ， 提示 用户 更正 。 ② Web 服务器 上 的 WebSite 启动 相应 的 CGI 进程 。 ③ CGI 进程 取出 存放 于 文件 中 的 参数 并 解码 ， 通过 中间件 ODBC 与 Oracle 数据库 进行 连接 ， 再 将 SQL 查询 传给 数据库 服务器 。 ④ Oracle 数据库 服务器 执行 查询 ， 并 将 结果 传回 CGI 进程 。 ⑤ Web 服务器 上 的 CGI 进程 动态 生成 包含 查询 结果 的 HTML 页面 ， 发 往 客户端 。 ⑥ 用户 经由 浏览器 看到 查询 结果 。 图 基于 Web 的 系统 　 　 报片 。 记者 可 在 任何 地点 ， 以 Internet 或 远程 访问 种 方式 接入 Intranet ， 方便快捷 地 填写 新闻 报片 单 ， 并 及时 传回 位于 新闻 中心 的 Oracle 数据库 ， 供 责编 及时 地 进行 改稿 、 排片 等 工作 。 　 　 实现 步骤 基本 同 上 ， 但 只 需 返回 操作 成功 与否 的 信息 ， 由 CGI 进程 根据 数据库 操作 的 执行 情况 生成 不同 的 HTML 页面 。 　 　 统计 。 对 新闻节目 库 的 各种 信息 进行 统计 ， 并 以 表格 、 直方图 、 饼 图 等 形式 显示 结果 。 　 　 实现 步骤 基本 同 上 ， 但 最后 步 略有不同 ： 　 　 ① ～ ③ 略 。 ④ Oracle 数据库 服务器 执行 有关 统计 的 存储 过程 ， 并 将 统计 结果 传回 CGI 进程 。 ⑤ Web 服务器 上 的 CGI 进程 将 数据库 服务器 的 返回 结果 作为 参数 ， 动态 生成 包含 JavaApplet 引用 的 HTML 页面 并 连同 代码 一起 发 往 客户端 。 ⑥ 浏览器 与 用户 进行 交互 ， 并 触发 相应 的 事件 ， 调用 JavaScript 程序 ， 控制 JavaApplet 的 公共 方法 ， 产生 各种 满足用户 需要 的 图表 。 　 　 安全性 认证 。 为了 使 新 系统 满足 新闻 中心 所 要求 的 安全性 ， 为 每个 工作人员 提供 了 个 用户名 及 口令 ， 并 根据 工作 需要 赋予 不同 的 权限 ， 如 管理员 、 领导 、 记者 等 各种 权限 可任意 组合 。 　 　 实现 步骤 ： 　 　 ① 用户 在 系统 登录 页面 中 ， 填写 自己 的 用户名 及 口令 ， 将 其 作为 CGI 程序 的 参数 进行 编码 ， 执行 POST 请求 ， 送往 Web 服务器 。 ② Web 服务器 启动 身份验证 CGI 进程 ， 并 将 传来 的 用户名 、 口令 及 所 申请 使用 的 功能 与 集中 存放 在 Web 服务器 上 的 用户 权限 表 进行 比较 ， 若 完全符合 则 允许 使用 相应 的 功能 ， 否则 拒绝 登录 。 　 　 智能 代理 。 接收 Internet 用户 所 填写 的 描述 其 感兴趣 的 新闻片 的 定阅 表格 ， 每隔 一定 时间 ， 检索 新闻 数据库 ， 一旦 有 满足条件 的 新闻片 ， 即以 EMail 方式 ， 将 新闻片 的 内容 发给 Internet 定阅 用户 。 　 　 实现 步骤 ： 　 　 ① Internet 用户 在 含有 定阅 表格 的 页面 中 填写 自己 的 EMail 地址 ， 以及 自己 感兴趣 的 新闻片 的 主题词 、 副 主题词 ， 并 传送 给 Web 服务器 。 ② Web 服务器 将 各 用户 的 需求 及 EMail 地址 存入 订阅 数据库 。 ③ 每隔 一定 的 时间 间隔 ， Web 服务器 上 的 JSS 智能 代理服务 程序 负责 检索 数据库 ， 一旦 新闻片 的 主题词 与 用户 的 需求 相符 ， 便 以 EMail 的 方式 ， 将 新闻片 的 内容 发给 Internet 用户 尚 在 开发阶段 。 　 　 其它 。 新闻 中心 概貌 、 电子邮件 、 电子 公告栏 、 管理员 等 服务 ， 初步 实现 了 新闻 中心 的 “ 无纸化 办公 ” ， 限于 篇幅 本文 不再 详述 。 　 有关 技术 的 实现 　 　 目前 在 Web 应用 中 实现 与 数据库 连接 的 方式 相当 多 ， 如 ： Java 、 CGI 、 Microsoft 的 ISAPI 、 Netscape 的 NSAPI 等 。 本 系统 最终 决定 使用 CGI 技术 ， 是因为 CGI 在 需要 时才 加载 ， 完成 后 立即 释放 ， 且 不 保持 与 数据库 的 连接 这样 会 显得 速度 较慢 且 连接 时 占 资源 较 多 。 然而 相 比较而言 ， CGI 应用 极为 广泛 ， 技术 也 十分 成熟 ， 比 其他 技术 更具 通用性 。 新 系统 中 自行 开发 的 CGI 程序 均 使用 VisualC 编写 ， 使用 了 WebSite 所 提供 的 CCGI 类 ， 及 MFC 中 有关 数据库 访问 的 类 。 　 　 JavaScript 一方面 可 用于 响应 特定 的 事件 ； 另一方面 可 用于 控制 下载 到 客户端 的 ActiveX 或 JavaApplet ， 因此 显得 十分 灵活 。 新 系统 中 用于 生成 图表 的 JavaApplet 用 VisualJ 编写 ， 在 JavaScript 控制 下 ， 可 与 用户 进行 交互 ， 由 用户 决定 以 何种 方式 浏览 结果 。 不过 无论是 ActiveX 或是 JavaApplet ， 它们 用于 被 JavaScript 或 VBScript 控制 的 方法 和 属性 必须 是 公共 Public 的 。 　 　 新 系统 中 各个 用户 的 用户名 、 口令 及其 相应 的 权限 以 文件 的 形式 集中 存放 在 Web 服务器 上 ， 便于 维护 和 管理 。 　 　 传统 的 Web 服务 要求 客户端 先 提出 HTTP 请求 ， 再 由 Web 服务器 响应 ， 然而 这种 方式 极大 地 延长 了 Internet 用户 等待 响应 的 时间 。 最后 我们 决定 使用 PUSH 技术 ， 即 由 JSS 以 一定 的 时间 间隔 查询数据库 ， 并 以 发送 EMail 的 方式 将 结果 返回 客户端 。 这种 方式 使 服务器 由 被动 状态 转化 为 主动 状态 ， 大大减少 了 客户端 无目的地 访问 Web 服务器 的 频率 ， 尤其 在 Intranet 中 ， 有些 实时性 不高 的 信息 传输 完全 可以 在 网络 负载 较轻 的 午夜 或 凌晨 进行 ， 这样 便 进一步 平衡 了 网络 的 负载 ， 提高 了 系统 的 整体 性能 。 　 系统分析 　 　 评价 个 大规模 事务处理 系统 的 标准 最 直接 的 方法 是 看 其 成本 与 性能 的 价格比 ， 即 应当 以 尽可能 低 的 成本 实现 尽可能 高 的 系统 性能 。 　 降低 系统 成本 　 　 由于 本 系统 采用 了 基于 Web 的 CS 体系 ， 从而 大大降低 了 系统 在 安装 、 配置 、 维护 和 管理 上 的 成本 ； 另一方面 ， 各种 新 技术 的 有效 集成 所 带来 的 高 开发 效率 ， 又 进一步 压缩 了 系统 的 开发成本 。 　 　 当前 又 出现 了 一种 新 概念 NetworkComputing ， 其 客户端 建议 使用 低 配置 的 NC 或 NPC ， 可令 系统 的 成本 进一步 减少 。 因此 ， 在 将来 的 系统 实现 中 ， 可能 考虑 使用 此 结构 。 　 计算 量 的 分配 　 　 影响 系统 性能 有 诸多 因素 ， 可以 从 硬件 、 软件 和 计算 模式 等 方面 来 考虑 。 由于 各种 硬件 配置 在 总体规划 期间 已经 确定 ， 而 选用 的 Oracle 服务器软件 、 网络通信 软件 在 正确 安装 和 配置 后 ， 也 较 难 再有 大 的 突破 。 因此 ， 只有 通过 合理 地 平衡 计算 量 才能 做到 最大 限度 地 提高 系统 性能 。 　 　 计算 模式 经历 了 大型机 小型机 模式 、 个人 计算 模式 、 网络 文件 服务器 模式 、 CS 模式 传统 的 两层 模式 和 基于 Web 的 三层 模式 和 网络 计算 模式 。 而 其实质 是 计算 量 分配 的 如下 演化过程 ： 　 　 计算 量 全部 由 服务器 承担 → 计算 量 全部 由 客户端 承担 → 计算 量 由 客户端 、 服务器 分担 → 计算 量 由 系统 各个 部件 合理 承担 。 　 　 因此 ， 在 数据库 服务器 、 Web 服务器 及 客户机 间 进行 计算 量 的 合理 分配 是 十分 重要 的 ， 而 合理 分配 工作量 的 主要 依据 便是 网络 的 带宽 和 各 部件 的 负载 能力 计算能力 。 　 　 判断 系统 性能 的 首要 因素 是 其 反应速度 ， 而 决定 系统 反应速度 的 关键 就是 网络通信 量 。 对于 拥挤不堪 的 WAN ， 相信 上过 网 的 人 都 “ 深有体会 ” ， WorldWideWait 的 比喻 更是 形象 生动 。 然而 即使 是 高带宽 的 LAN ， 当 大量 数据库 信息 在 网上 频繁 流动 时 ， 也 往往 会 造成 系统 的 瓶颈 ， 甚至 可能 导致系统 瘫痪 。 　 　 各个 部件 的 负载 能力 是 有限 的 ， 即使 是 高端 服务器 ， 面临 数以万计 的 请求 时 ， 也 将 不再 有求必应 。 因此 ， 只有 通过 合理 地 协调 计算 量 ， 才能 最大 限度 地 发挥 各 部件 的 计算能力 。 　 　 为了 便于 分析 ， 将 数据库 事务 处理程序 抽象 为表 所示 的 几大 功能模块 。 　 　 表 　 数据库 事务 处理程序 功能模块 输入 模块 数据 合法性检查 数据库 存取 模块 输出模块 图形化 显示 事务处理 模块 少量 数据库 数据 计算 模块 大量 数据库 数据 计算 模块 　 　 值得一提的是 ， 新 系统 就是 根据 分配 计算 量 的 个 基本 原则 — — 尽可能少 地 占用 网络带宽 和 平衡 各 部件 负载 ， 来 进行 开发 设计 的 。 　 　 尽可能少 地 占用 网络带宽 　 　 输入 模块 应 在 客户端 执行 计算 。 因为 如果 让 不 正确 的 输入 数据 通过 Web 服务器 传至 数据库 服务器 ， 由 它 提供数据 合法性检查 ， 最后 再 将 出错 信息 经由 Web 服务器 传回 客户端 ， 这样 做 是 可笑 的 。 即使 在 Web 服务器上进行 数据 合法性检查 也 是 完全 没有 必要 的 。 因为 ， 嵌于 HTML 页面 中 的 JavaScript 语言 或 VBScript 语言 完全 有 能力 完成 数据 合法性检查 的 工作 ， 甚至 可 用于 检查 一些 复杂 的 逻辑 错误 。 新 系统 即 是 运用 了 JavaScript 在 客户端 完成 输入 模块 的 工作 。 　 　 当然 ， 不 经 编译 的 描述语言 本身 从 Web 服务器 下载 到 客户端 也 将 占用 一部分 带宽 ， 然而 那仅 是 一小部分 ， 远比 让 错误 数据 在 网络 上 驰骋 要 合理 得 多 。 　 　 由 图示 可知 ， 大量 数据库 数据 计算 模块 在 离 数据库 服务器 愈近 的 层 上 进行 处理 愈 好 。 因为 若 将 应用 集中 在 服务器 中 ， 则 在 网络 上 流通 的 数据 即 为 简单 的 客户 请求 和 返回 的 结果 数据 而 不是 大量 的 SQL 命令 及 无用 的 数据 ， 从而 节省 了 网络 开销 。 对于 大量 数据 的 计算 ， 此 开销 便 相当可观 了 。 最佳 情况 是 使用 数据库 服务器 所 提供 的 存储 过程 来 处理 大量 数据库 数据 的 计算 工作 。 一般来说 ， Web 服务器 和 数据库 服务器之间 通常 都 以 高速 链路 相连接 ， 或 两者 位于 同一 台 服务器 上 ， 因此 ， 该 模块 在 这 两层 上 进行 处理 均 可 。 　 　 少量 数据库 数据 计算 模块 ， 因为 与 网络带宽 无关 ， 因此 可 在 任何 层面 上 进行 处理 。 　 　 除非 在 JavaApplet 中 使用 JDBC 作为 数据库 接口 ， 否则 事务处理 模块 、 数据库 存取 模块 一般 在 Web 服务器 或 数据库 服务器上进行 处理 。 因为 大型 关系数据库 或 对象 数据库 都 能 较 好 地 支持 事务处理 ， 比如 Oracle 提供 了 存储 过程 、 触发器 以及 ROLLBACK 、 COMMIT 、 SAVEPOINT 等 支持 事务 的 语句 。 因此 ， 我们 认为 在 数据库 服务器 上 完成 这些 计算 更为 合适 。 　 　 输出模块 可 在 客户端 或 Web 服务器上进行 处理 ， 然而 如果 需 输出 的 结果 是 图形 ， 则 建议 在 客户端 进行 处理 。 在 实现 新 系统 的 输出模块 时 ， 考虑 到 对应 于 图表 的 图形 资源 文件 较大 ， 下载 到 客户端 必然 会 占用 相当 的 带宽 ， 且 嵌 于 HTML 页面 中 的 JavaApplet 也 更 易于控制 ， 以 完成 与 用户 的 交互 。 因此 本 系统 所 采用 的 方案 为 ： 将 用于 生成 图表 的 ActiveX 控件 或 JavaApplet 嵌入 HTML 页面 ， 根据 统计 结果 生成 相应 的 参数 ， 一起 传回 客户端 ， 再 由 页面 中 的 JavaScript 响应 用户 请求 ， 进而 对 ActiveX 控件 或 JavaApplet 进行 相应 的 控制 ， 在 本地 灵活 地 生成 图表 。 　 　 平衡 各 部件 负载 　 　 就 目前 Intranet 应用 的 环境 和 规模 来看 ， 网络带宽 较 各 部件 负载 而言 ， 更 易于 成为 系统 的 瓶颈 。 因此 尽可能少 地 占用 网络带宽 应当 成为 考虑 网络 计算 量 分配 的 第一 原则 ， 而 只有 在 满足 第一 原则 的 情况 下 ， 才 可 考虑 如何 更好 地 平衡 各 部件 负载 。 　 　 就 Intranet 的 发展趋势 而言 ， 在 不久 的 将来 ， Web 服务器 可能 将 面临 越来越 多 的 客户端 访问 ， 若 再 将 与 数据库 无关 的 其他 计算 工作 也 放在 其上 执行 ， 必将 导致 Web 服务器 的 不堪重负 ； 而 相比之下 ， 客户端 无论是 CPU 的 速度 或是 RAM 的 容量 ， 应该 说 都 有 能力 处理 除 GUI 以外 的 更 多 工作 。 因此 ， 如何 分担 Web 服务器 的 工作 应 成为 平衡 负载 的 重中之重 。 　 　 一种 可行 的 方案 是 ， 将 少量 数据库 数据 计算 模块 和 输出模块 由 ActiveX 或 JavaApplet 实现 ， 存放 于 Web 服务器 ， 并 在 需要 的 时候 ， 下载 到 客户端 执行 ， 从而 减轻 Web 服务器 的 负载 ； 与此同时 ， 将 大量 数据库 数据 计算 模块 和 事务处理 模块 由 数据库 存储 过程 或 触发器 实现 ， 并 在 数据库 服务器 上 执行 ， 从而 进一步 减轻 Web 服务器 的 负载 。 　 结束语 　 　 新 系统 结合 了 当前 一些 最新 的 Web 技术 ， 从而 使得 上海电视台 新闻 中心 的 工作人员 能 在 Intranet 上 访问 数据库 并 获得 相应 的 服务 。 作者 单位 ： 上海 同济大学 计算中心 参考文献 　 　 RaggettDaveHypertextMarkupLanguageSpecificationVersionhttpwwwhphpcoukpeopledsrhtmCoverPagehtml 　 　 BobrowskiSOracleArchitecturehttpwwworaworldcomEXChtm 　 　 LevinRJavaForTheEnterprisehttptechwebcmpcomiwiujavhtm ， ； 　 　 WAsUltimateJavaScriptTutorialhttpwwwabstractsimplenetcomjavascripthtm 　 　 StromDCreatingPrivateIntranets ： ChallengesandProspectsforIShttpwwwstromcompubworkintranetphtml ； 　 　 丁炳光 ， 马应章 ORACLE 应用 开发 使用手册 北京 ： 华北 计算技术 研究所 计算机技术 编辑部 ， 太极 计算机 公司 计算机技术 编辑部 　 　 李谦 ， 廖 卫东 ， 孙毓泉 Web 服务器 技术 指南 北京 ： 机械 工业 出版社 ， 收稿 日期 ：