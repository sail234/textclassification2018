软件 学报 JOURNALOFSOFTWARE 年 　 第卷 　 第期 　 Vol 　 No 　 一个 基于 Web 的 工作 流 管理系统 史 美林 　 杨光信 向 勇伍 尚广 　 　 摘要 　 InternetIntranetWWW 技术 的 日渐 成熟 以及 资源 、 应用 的 日益 丰富 为 工作 流 管理系统 的 构造 提供 了 一个 理想 的 计算环境 在 这种 易于 访问 、 无处不在 的 计算环境 中 人们 可以 通过 工作 流 管理系统 将 各种 分布式 的 信息 资源 有效 地 集成 、 协调 起来 以 促使 企业 业务 目标 的 高效 实现 文章 描述 了 一个 基于 Web 而 构造 的 通用 工作 流 管理系统 Wowwwworkflowontheworldwideweb 详细 讨论 了 其 体系结构 的 设计 、 工作 流 模型 及 过程 实例 的 执行 算法 并 讨论 了 Wowww 为 提高 其 可用性 和 灵活性 而 实现 的 工作 流 过程 定义 的 自 学习 算法 以及 为 提高 系统 的 协作 支持 能力 而 采取 的 对 同步 协作 的 支持 方法 　 　 关键词 　 工作 流 管理系统 计算机 支持 的 协同工作 workflowontheworldwidewebInternetWWW 　 　 中图法 分类号 　 TPAWebbasedWorkflowManagementSystemSHIMeilinYANGGuangxinXIANGYongWUShangguangDepartmentofComputerScienceandTechnologyTsinghuaUniversityBeijing 　 　 Abstract 　 AstheInternetIntranetWWWtechnologiesbecomemoreandmorematureandwebbasedapplicationsbecomericherandrichertheapplicationdevelopersareprovidedwithanidealcomputingenvironmenttoconstructWfMSsworkflowmanagementsystemsWebbasedWfMSscanhelpbusinessgoalstobeachievedeffectivelybymeansofintegratingvariousdistributedresourcesinaneasytoaccessenvironmentAwebbasedgeneralpurposeworkflowmanagementsystemnamedWowwwisdescribedinthispaperdetailingitsarchitecturetheworkflowmodelandthealgorithmsusedforworkflowinstanceexecutiontheselflearningalgorithmforautomaticprocessdefinitiongenerationandthestrategiestosupportsynchronouscooperation 　 　 Keywords 　 WorkflowmanagementsystemcomputersupportedcooperativeworkworkflowontheworldwidewebInternetWWW 　 　 进入 年代 中后期 随着 Internet 技术 的 成熟 以 企业 Intranet 计算环境 为 基础 建立 起 了 各种 信息 资源 如 WWW 、 数据库 、 电子邮件 、 目录 服务 、 电话 、 传真 系统 等 但 这些 资源 基本上 是 相互 独立 的 意即 它们 很少 能够 意识 到 其他 信息 资源 的 存在 （ 除非 用 特定 的 软件系统 将 它们 连接起来 ） 工作 流 管理系统 ［ ］ （ workflowmanagementsystem 简称 WfMS ） 着眼于 协调 企业 内 的 各种 资源 （ 包括 信息 资源 和 人力资源 ） 试图 使 各种 业务 活动 在 一定 程度 上 自动 进行 以 高效 地 达成 企业 的 业务 目标 如果 能够 以 InternetIntranet 为 基础 构造 WfMS 实现 企业 Intranet 环境 下 各种 资源 的 高效 协调 将 能够 最大 限度 地 发挥 这些 资源 的 综合 潜力 为 企业 的 业务 目标 服务 同时 WWW 为 InternetIntranet 资源 的 访问 提供 了 非常 方便 的 手段 Java 技术 的 成熟 为 开发 跨平台 的 交互式 应用 提供 了 理想 的 开发工具 因此 基于 InternetWWW 计算环境 来 构造 WfMS 将 成为 一种 理想 的 选择 本文 介绍 一个 基于 WWW 的 工作 流 管理系统 Wowww — — WorkflowontheWorldWideWebWowww 体系结构 　 　 Wowww 体系结构 的 设计 主要 遵循 如下 几条 原则 　 　 基于 InternetIntranetWWW 分布式计算 环境 面向 跨 企业 或 机构 的 大型 分布式 工作 流 管理 　 　 集成 已有 的 各种 信息 资源 如 WWW 、 数据库 、 电子邮件 、 目录 服务 以及 电话 系统 等 充分发挥 这些 资源 的 综合 潜力 　 　 与 工作 流 管理 联盟 （ workflowmanagementcoalition ） 参考模型 ［ ～ ］ 保持一致 以利于 实现 与 其他 WfMS 系统 的 互连 与 互操作 Wowww 总体 结构 　 　 按照 上述 原则 所 设计 的 Wowww 的 总体 结构 如图所示 图中 各 宽 带状 的 箭头 表示 各 组成部分 之间 的 通信 方式 整个 系统 采用 的 实际上 是 一种 客户机 服务器 结构 在 目前 的 实现 中 Wowww 服务器 以 一种 服务 的 方式 运行 于 WinNT 环境 下 它 将 完成 工作 流 实例 的 执行 、 资源 的 集成 以及 各种 控制数据 和 实例 数据 的 管理 集成式 工作 流 应用 及 开发 环境 （ IWADE ） 给 用户 提供 了 一组 用于 开发 工作 流 应用 、 处理 工作 项 、 对 工作 流 实例 进行 管理 的 工具 具体 包括 过程 及 表单 定义 、 工作 项 处理 、 服务器 管理 、 过程 实例 监控 以及 InternetEMail 客户端 和 联机帮助 它 以 JavaApplet 的 形式 运行 于 支持 Java 的 Web 浏览器 中 并 绕过 Web 服务器 而 直接 与 Wowww 服务器 通信 以 避免 CGI 或 ISAPI 或 NSAPI 实现 所 带来 的 低效率 但 并 不 排除 开发人员 可以 借助 这些 方式 将 工作 流 服务器 中 的 各种 对象 和 数据 通过 WAPI ［ ］ （ workflowAPI ） 以 HTML 的 形式 显示 在 Web 浏览器 中图 Wowww 体系结构 Wowww 服务器 结构 　 　 处于 Wowww 核心 的 是 一个 多线程 的 工作 流 服务器 它 包括 如图所示 的 个 主要 部分 其 主要 作用 是 在 业务流程 的 形式化 表示 的 驱动 下 实现 流程 中 的 各个环节 之间 的 状态 转换 及 数据 的 传递 以 使 这些 环节 按照 一定 的 顺序 在 用户 的 参与 下 依次 完成 通信 管理 模块 接收 网络 数据包 并 将 其 交给 其他 相应 的 模块 进行 处理 会话 管理 模块 负责管理 IWADE 与 服务器之间 的 会 话 连接 以及 同步 协作组 的 维护 以 实现 对 过程 定义 、 表单 和 工作 项 的 同步 编辑 这些 以及 其他 类型 的 数据 都 是 以 C 对象 的 形式 实现 的 并 由 Wowww 服务器 的 面向对象 的 数据管理 模块 维护 这些 对象 被 工作 流 执行 控制 模块 用于 过程 实例 的 执行 控制 中如 实例 的 启动 、 不同 活动状态 之间 的 转换 、 用户 工作 项 的 生成 以及 对外部 资源 的 访问 等 不同 的 功能模块 将 分别 运行 于 不同 的 线程 中 各 模块 之间 通过 消息传递 的 方式 进行 通信 这种 单 进程 、 多线程 的 结构 对于 提高 工作 流 过程 实例 执行 的 并发 性 、 支持 大规模 的 工作 流 管理 起着 至关重要 的 作用 图 Wowww 服务器 结构 服务器端 资源 集成 　 　 前面 提到 过 在 InternetIntranet 环境 下 已 建立 起 大量 的 各种类型 的 信息系统 并且 人们 工作 的 完成 将 依赖于 对 这些 信息系统 的 访问 为了 实现 协调 多 个人 活动 的 目标 工作 流 管理系统 必须 提供 一种 访问 各种类型 异构 资源 的 一致 的 方法 在 Wowww 中 使用 了 一种 被 称做 “ 资源 代理 池 ” 的 机制 资源 代理 池 实际上 充当 的 是 Wowww 工作 流 执行 控制 模块 与 其他 信息系统 的 一个 中介 它 由 一系列 “ 资源 代理 ” 构成 每 一种 类型 的 资源 代理 负责 完成 对 某种 特定 类型 资源 的 访问 并 给 工作 流 执行 控制 模块 提供 相应 的 接口 例如 邮件系统 代理 可 向 其他 SMTP 服务器发送 并 收取 邮件 它 所 提供 的 接口 中 包括 SendMailGetMailListGetMail 等 操作 有 了 邮件系统 代理 之后 工作 流 执行 控制 模块 就 能够 同 邮件系统 进行 交互 以 实现 它 的 一些 关键性 的 功能 如 通知 某个 用户 他 她 需要 处理 某个 亟待 处理 的 工作 项 等 资源 代理 可以 按 同步 及 异步 两种 不同 的 方式 来 处理 执行 控制 模块 发送给 它 的 请求 它们 都 是 以 COM 组件 的 形式 来 实现 的 因此 可 实现 动态 的 “ 插拔 ” 与 配置 这种 可 动态 扩展 的 特点 一方面 让 人们 可以 根据 需要 将 分布 在 InternetIntranet 环境 下 的 资源 纳入 到 Wowww 所 协调 的 范畴 中 另一方面 可以 突破 JavaApplet 只能 访问 它们 所 来自 的 主机 系统 上 的 资源 的 限制 客户端 应用 集成 　 　 在 不同 的 领域 中 人们 用以 完成 他们 的 日常 工作 所用 的 应用程序 也 是 各不相同 的 工程设计 人员 应用 某种 类型 的 CAD 工具 去 建立 一些 工程设计 对象 而 从事 写作 的 人 将 使用 某种 类型 的 字 处理软件 去 输入 文档 内容 并 对 其 进行 格式化 为了 实现 协调 多个 具有 不同 业务 兴趣 与 范围 的 人 的 活动 目标 工作 流 管理系统 必须 能够 尽可能 多地 集成 各种 不同 类型 的 应用 在 Wowww 中 这 一点 是 借助于 “ 应用 表单 ” 的 机制 来 实现 的 应用 表单 实际上 是 供 某个 或 某组 用户 用以 处理 某 特定 任务 的 一组 应用程序 的 集合 所有 这些 应用程序 都 是 以 JavaBean 组件 的 形式 加以 实现 的 应用 开发人员 可以 用 IWADE 所 提供 的 表单 定义 工具 将 这些 应用 组合 起来 并 设置 各 应用 在 表单 中 出现 的 格式 在 过程 实例 的 运行 过程 中 IWADE 将 解释 表单 的 定义 并 根据 相应 的 JavaBean 的 类 定义 生成 相应 的 用户界面 元素 供 用户 完成 他们 的 任务 当然 为了 能够 将 这些 JavaBean 组件 形式 的 应用程序 成功 地 集成 到 应用 表单 中来 它们 必须 实现 一个 特定 的 接口 以便 IWADE 能够 设置 其 初始 数据 并 获得 其 最终 的 处理结果 这种 特点 使得 IWADE 成为 一个 能够 包容 大量 不同 应用 、 并 可 由 用户 进行 扩展 的 框架 但 目前 的 实现 由于 受 JavaApplet 无法访问 本地 应用 资源 的 限制 而 没有 考虑 对 其他 类型 应用 （ 如 各种 桌面 应用 ） 的 集成 Wowww 工作 流 模型 　 　 WfMS 协调 业务流程 的 完成 是 以 业务流程 的 形式化 表示 — — 工作 流 过程 定义 为 基础 的 不同 的 WfMS 用以 描述 过程 定义 的 形式化 模型 各不相同 常用 的 有 有向图 ［ ］ 、 PetriNet ［ ］ 、 对象 模型 ［ ］ 、 带有 约束条件 的 文法 表示 ［ ］ 等 这些 模型 在 描述 能力 、 使用 的 方便 程度 以及 易 修改 程度 等 方面 各不相同 但 一个 好 的 模型 既应 能够 描述 结构化 的 过程 也 应 能够 描述 非 结构化 的 过程 同时 还应 提供 足够 的 灵活性 以便 能够 处理 可能 发生 的 变化 及 例外情况 综合 考虑 这 几 方面 的 因素 Wowww 提出 并 实现 了 一种 “ 条件 化 有向图 ” 的 工作 流 模型 这种 模型 用 有向图 中 的 各 结点 表示 工作 流 过程 中 的 各个环节 而用 有 向 边 来 描述 各 环节 之间 的 控制 及 数据 流动 关系 下面 给出 此 模型 的 形式化 描述 　 　 定义 命名 值 v 为 一个 四元组 〈 ntlv 〉 其中 n 为 一个 字符串 它 表示 值 的 名称 t 为值 类型 l 为值 的 字节 长度 v 为值 命名 值 表示 的 是 某种 类型 的 简单 数据 对象 在 目前 的 实现 中 t 可以 是 种 类型 的 简单 数据类型 （ 即 booleancharshortintlongstringfloatdoubledatetime 和 binary ） 之一 用 表示 所有 命名 值 构成 的 集合 定义 则 Vn φ n 可以 表示 一个 任意 复杂 的 数据 对象 其中 n 为 任意 非负 整数 在 Wowww 中 我们 使用 V （ 简写 为 V ） 来 表示 每 一个 活动 中 待处理 的 数据 对象 　 　 定义 命名 表达式 e 为 一个 三元组 〈 nte 〉 其中 n 为 表达式 名称 t 为 表达式 的 值 类型 （ 可 为 上述 种 基本 类型 以及 一个 特殊 的 void 类型 ） e 为 表示 表达式 的 字符串 表达式 的 构成 元素 可以 是 常量 （ 如 boolean 类型 的 true 和 false 、 字符串 常量 及 各种类型 的 数值 常量 等 ） 、 变量 （ 某个 命名 值 的 名称 ） 、 运算符 、 各种类型 的 预定 义 的 函数 （ 如 字符串 函数 、 日期 函数 、 数值 函数 以及 Wowww 服务器 所 提供 的 系统 函数 等 ） 、 资源 代理 所 提供 的 接口 中 的 操作 、 Wowww 所能 访问 的 Windows 可 执行 模块 或 COMDCOM 组件 所 提供 的 接口 中 的 操作 等 用 E 表示 多个 命名 表达式 构成 的 集合 对于 给定 e 定义 一 算子 EvalEVEvalev 其中 nvnetvtevv 为 根据 ee 计算 得到 的 值 而 lv 则 为此 值 的 长度 　 　 定义 应用 表单 f 为 一个 三元组 〈 npT 〉 其中 n 为 表单 名称 p 为 表单 的 各种 属性 （ 如 大小 、 背景 、 字体 等 ） T 为 包含 在 f 中 的 所有 应用程序 工具 构成 的 集合 对于 T 中 的 每 一个 元素 t （ 称之为 f 中 的 一个 域 ） 可用 一个 三元组 〈 npt 〉 表示 其中 n 为 用户 给 t 指定 的 在 T 内 唯一 的 名称 p 为域 的 格式 而 t 为域 的 类型 每种 可以 包含 到 表单 中 的 域 均 是 以 JavaBean 组件 的 形式 实现 的 并 提供 相应 的 接口 供 IWADE 运行 时 系统 设置 其 初始值 、 取得 其 最终 结果 和 值 类型 以及 处理 键盘 和 鼠标 消息 等 目前 已 实现 的 域 包括 单行 或 多行 编辑框 、 RTF 编辑器 、 HTML 编辑器 、 列表框 、 复选框 、 单选 钮 、 数据库 控件 （ 用以 访问 各种类型 的 数据库 中 数据 ） 、 电子白板 （ 用以 支持 同步 讨论 ） 等 每 一个 域 t 实际上 提供 了 显示 和 修改 某个 命名 值 v 的 一个 用户界面 而 应用 表单 f 则 表示 了 在 某 活动 中 需要 处理 的 一项 任务 对于 给定 的 f 可定义 一 算子 GenValueGenValuefV 并 满足 如下 条件 t ∈ Tf 若 t 所 产生 的 值 不空 则 v ∈ V 使得 nvnttvtGetValueTypevvtGetValue 并且 lv 为 vv 的 长度 　 　 定义 接收者 r 描述 的 是 可以 参加 到 某 活动 中 的 用户 或 用户组 其 形式化 表示 为 一个 四元组 〈 rtna 〉 其中 r 为 接收者 名称 t 为 类型 如 单个 用户 、 工作组 或 角色 工作组 指 的 是 具有 某种 特定 语义 的 一组 用户 的 集合 Wowww 所 支持 的 工作组 包括 普通 工作组 、 带 权重 工作组 （ 工作 任务 按 一定 的 权重 在 成员 之间 分配 ） 、 串行 或 并行 工作组 、 同步 协同 工作组 （ 成员 可以 通过 实时 协作 的 方式 完成 对 某 工作 项 的 处理 ） 等 角色 则 指 系统 中 具有 某种 特定 职责 的 用户 它 实际上 是 一个 由 系统目录 和 Wowww 所 提供 的 系统 函数 所 定义 的 表达式 n 为 通知 方式 它 描述 的 是 在 发生 了 某种 类型 的 事件 时 可 按 什么 方式 （ 如用 电子邮件 或 传呼 ） 发出通知 a 指定 了 可 将 通知 发 至 何处 （ 如 某个 电子邮件 地址 或 传呼 号 等 ） 当 tr 不是 单个 用户 时 rr 可以 是 某个 工作组 的 名称 或 一个 角色 表达式 用 R 表示 可以 参加 到 某个 活动 中 的 所有 用户 的 集合 　 　 定义 活动 a 表示 业务 过程 中 一个 实际 或 抽象 的 工作 步骤 Wowww 将 其 形式化 为 一个 六元 组 〈 ntseRL 〉 其中 n 为 活动 名称 t 为 活动 类型 （ 如 起始 活动 、 原子 活动 或 某个 子 过程 等 ） s 和 e 均 为 一个 布尔 表达式 分别 表示 活动 的 开始 和 终止 条件 R 为 可 参与 到 此 活动 的 所有 用户 集合 L 中 的 每 一个 元素 l 表示 的 是 a 同其 前驱 活动 之间 的 连接 关系 l 可以 形式化 表示 为 一个 三元组 〈 afM 〉 其中 a 表示 前驱 活动 的 名称 f 为 用于 处理 从 a 传到 a 的 数据 对象 的 应用 表单 的 名称 M 描述 的 是 如何 将 这些 数据 对象 映射 到 f 中所 包含 的 那些 域 中 以及 R 中 的 那些 用户 可 按 何种 方式 去 访问 这些 域 对于 m ∈ M 可以 将 其 形式化 表示 为 一个 四元组 〈 teop 〉 其中 t 为 f 中 某个 域 的 名称 e 为 某个 描述 从 a 传到 a 的 数据 对象 的 命名 表达式 的 名称 o 指定 如何 用 e 所 产生 的 值 去 设置 t 的 初始值 （ 例如 可以 用 此值 去 替换 t 的 已有 值 可 将 此值 同 t 的 已有 值 进行 合并 ） p 指定 的 则 是 R 中 的 用户 可 按 何种 方式 去 访问 t （ 如 只读 、 可 修改 等 ） 从 上面 的 定义 可以 看出 L 实际上 描述 的 是从 各 前驱 活动 中 传来 的 数据 可以 按 何种 方式 被 a 中 的 用户 进行 处理 用 A 表示 多个 a 构成 的 集合 　 　 定义 工作 流 w 是 实际 业务 过程 中 的 数学 描述 Wowww 将 工作 流 形式化 为 一个 三元组 〈 nAF 〉 其中 n 为 工作 流 指定 的 名称 A 表示 从 业务 过程 中 抽象 出来 的 所有 活动 构成 的 集合 而 F 为 A × A × C 的 一个 子集 它 描述 的 是 Aw 中 各 活动 之间 的 数据 流动 关系 和 控制 流动 关系 对于 C 中 的 每 一个 元素 c 它 是 一个二元 组 〈 cE 〉 其中 c 为 一个 布尔 表达式 E 为 多个 命名 表达式 构成 的 集合 c 描述 的 是 在 条件 cc 得以 满足 时 激活 后续 的 哪 一个 环节 并 将 什么 数据 对象 传给 它 例如 若 faac ∈ F 并且 cc 的 计算结果 为 真 那么 VEvalEc 将 被 传递 给 a 进行 处理 显然 在 cc 和 Ec 中 可以 引用 的 变量 是 根据 a 中 的 应用 表单 所 生成 的 命名 值 w 满足 如下 两个 条件 a ∈ Awa ′ ∈ Γ al ∈ La 使得 alna ′ 此 条件 说明 不论 哪个 方向 传来 的 数据 都 有 相应 的 应用 表单 对 其 进行 处理 a ∈ Awta “ 起始 活动 ” 即 每个 工作 流都 有 唯一 的 起始 活动 用 W 表示 系统 所 维护 的 所有 工作 流 定义 　 　 从 定义 可以 看出 w 实际上 是 一个 有向图 图中 各 结点 表示 的 是 工作 流中 的 各个 活动 步骤 与 常规 的 有向图 的 区别 在于 与 每 一有 向 边 相对 应 分别 有 一个 逻辑 表达式 和 一个 命名 表达式 集合 我们 使用 此种 条件 化 的 有 向 边 来 表示 活动 之间 的 控制关系 和 数据 流动 关系 此种 模型 的 最大 特点 在于 它 是 以 数据 为 中心 的 即 在 各 环节 之间 传递 的 是 数据 对象 集 并且 数据 流动 是 受 这些 数据 对象 本身 自己 控制 的 应用 表单 只是 提供 了 一个 供 用户 访问 这些 数据 对象 的 手段 与 其他 工作 流 形式化 表示 方法 比较 起来 条件 化 的 有向图 具有 直观 、 灵活 、 易于 修改 、 描述 能力 强 的 特点 同时 充分体现 了 以 对 数据 流动 控制 为 中心 的 工作 流 思想 这种 思想 也 是 我们 构造 协同工作 支撑 环境 的 核心 ［ ］ 　 　 IWADE 中 集成 的 过程 定义 工具 使得 应用 开发人员 可以 按 一种 可视化 的 方式 对 业务 过程 进行 建模 直观 的 图形化 表示 将 被 转换成 上面 所 描述 的 内部 表示 （ 以 C 对象 的 方式 加以 实现 ） 并 被 保存 在 Wowww 服务器 上 在 后面 的 各节 中 我们 将 详细 讨论 这种 内容 表示 是 如何 被 用于 过程 实例 的 执行 的 工作 流 实例 的 执行 　 　 在 得到 业务流程 的 形式化 描述 之后 即可 让 Wowww 使用 此 形式化 表示 来 协调 业务 活动 的 完成 一般 地 我们 将 工作 流 过程 的 一次 执行 称做 一个 工作 流 实例 在 说明 实例 的 具体 执行 细节 之前 我们 先 定义 如下 一些 在 过程 实例 执行 中 会 用到 的 一些 结构 　 　 定义 活动 实例 s 是 过程 实例 中 的 一个 步骤 Wowww 将 其 形式化 表示 为 一个 七元 组 〈 nUPbesV 〉 其中 n 表示 与 此 活动 实例 相应 的 工作 流 活动 名称 U 为 参与 到 此 活动 中 的 所有 用户 的 名称 构成 的 集合 P 为 当前 前驱 活动 的 U 分量 b 和 e 分别 表示 s 的 开始 和 终止 时间 s 记录 的 则 是 s 的 当前 状态 其 可能 的 状态 分别 为 未 就绪 、 就绪 、 正在 运行 以及 完成 等 一般而言 活动 实例 状态 的 转换 是 由 工作 流 执行 服务 根据 过程 实例 的 实际 运行 情况 而 维护 的 V 为 被 s 处理 的 所有 命名 值 构成 的 集合 它 表示 此 活动 实例 中 需要 处理 的 各种 数据 用 S 表示 由 多个 活动 实例 构成 的 集合 　 　 定义 工作 流 过程 实例 p 是 一个 工作 流 的 一次 执行 过程 它 可以 形式化 地 表示 为 一个 六元 组 〈 iwbesS 〉 其中 i 为 过程 实例 名称 w 为 相应 过程 定义 的 名称 b 和 e 分别 为 过程 的 开始 和 结束 时间 s 为 过程 实例 的 当前 运行 状态 这些 状态 可以 是 正在 运行 、 被 禁止 、 暂停 以及 完成 等 S 为 自 p 开始运行 以来 此 工作 流 执行 过程 中 生成 的 所有 活动 实例 构成 的 集合 与 ss 描述 的 是 活动 实例 的 状态 不同 sp 描述 的 是 整个 过程 实例 的 状态 管理人员 可以 使用 管理工具 对 过程 实例 的 状态 人为 地 加以控制 如 暂停 或 恢复 某 过程 实例 的 运行 、 强行 终止 某 实例 等 　 　 定义 工作 项 i 表示 的 是 需要 某个 或 某组 用户 进行 处理 的 一项 任务 它 可以 表示 为 一个二元 组 〈 ps 〉 其中 p 为 相应 的 过程 实例 名称 而 s 为此 过程 实例 中 某 活动 实例 的 名称 用 I 表示 多个 工作 项 构成 的 集合 　 　 定义 用户 工作 项 列表 l 记录 的 是 需要 某个 用户 进行 处理 的 所有 工作 项 的 集合 它 可以 表示 为 一个二元 组 〈 uI 〉 其中 u 为 负责 处理 I 中 那些 工作 项 的 用户 名称 以 上面 的 定义 为 基础 下面 我们 给出 一个 简化 的 工作 流 过程 实例 的 执行 算法 此 算法 可以 分成 两个 部分 首先 是 过程 实例 的 启动 然后 是 活动 实例 的 提交 工作 流 过程 实例 的 执行 过程 实际上 是 实例 启动 后 反复 执行 活动 实例 提交 的 过程 　 　 算法 用户 u 启动 工作 流 w 的 实例 　 　 从 系统 所 维护 的 所有 工作 流 定义 W 中 选择 待 启动 的 过程 w 　 　 根据 用户 指定 的 过程 实例 名称 name 建立 一个 新 的 过程 实例 结构 p 并 使 　 　 　 　 wp ← nwbp ← 系统 当前 时间 ip ← nameSp ← 　 　 根据 w 的 起始 活动 a 建立 一个 新 的 活动 实例 s 并 使 　 　 　 　 ns ← naUs ← uPs ← bs ← bpVs ← ss ← 就绪 　 　 Sp ← s 　 　 建立 一个 工作 项 结构 i 并 使 　 　 　 　 pi ← ipsi ← ns 　 　 Il ｜ ulu ← Il ｜ ulu ∪ i ∥ 将 此 工作 项 加入 到 用户 u 的 工作 项 列表 中 此后 IWADE 将 根据 w 的 定义 生成 与 新 建立 的 工作 项 相应 的 应用 表单 用户 u 可以 同 此 应用 表单 中 的 工具 进行 交互 以 完成 对此 工作 项 的 处理 处理 的 结果 可以 暂存 起来 也 可以 将 其 提交 提交 一个 工作 项 表示 对 它 处理 的 完成 此时 Wowww 将 执行 下面 的 算法 　 　 算法 工作 项 i 〈 ps 〉 的 提交 　 　 计算 VGenValuef 并 将 V 同 Vs 进行 合并 其中 f 为 与 s 相应 的 应用 表单 　 　 对于 每 一个 a ′ ∈ Γ a 其中 a ∈ Aw ∧ nans 　 　 根据 Vs 计算 cc 其中 aa ′ c ∈ Fw 　 　 若 cc 为 true 则 　 　 VnextEvalEc 　 　 若 p 中 不 存在 与 a ′ 相应 的 活动 实例 则 　 　 建立 一个 新 的 活动 实例 s ′ 并 使 　 　 　 　 　 　 　 ns ′ ← na ′ Ps ′ ← UsVs ′ ← Vnextbs ′ ← 系统 当前 时间 ss ′ ← 未 就绪 　 　 Sp ← Sp ∪ s ′ 否则 　 　 根据 La 将 Vnext 同 Vs ′ 进行 合并 　 　 计算 sa ′ 　 　 若 sa ′ 计算结果 为 true 则 ∥ s ′ 可以 被 启动 　 　 建立 一个 新 的 工作 项 结构 i ′ 并 使 　 　 　 　 　 　 　 pi ′ ← pisi ′ ← na ′ 　 　 对于 Ra ′ 中 的 每 一个 u 　 　 Il ｜ ulu ← Il ｜ ulu ∪ i ′ 　 　 Us ′ ← Us ′ ∪ u ∥ U 中 的 所有 用户 均 可 处理 i ′ 　 　 ss ′ 就绪 　 　 ss ← 完成 es ← 系统 当前 时间 　 　 若 对于 Sp 中 的 每 一个 sss 均 为 完成 则 　 　 sp ← 完成 　 　 ep ← 系统 当前 时间 过程 定义 的 自 学习 　 　 协同 应用环境 的 动态 多变 的 特点 要求 协同工作 系统 中 的 控制 知识 能够 随 系统 的 运行 而 动态 地 增长 ［ ］ 工作 流 系统 中 的 过程 定义 实际上 就是 一种 控制 知识 在 传统 的 WfMS 中 过程 定义 一般 是 事先 定义 好 的 对 它 的 修改 只能 由 建模 人员 完成 WfMS 本身 并 不能 根据 工作 流程 的 实际 运行 情况 而 动态 地 修改 、 完善 这些 定义 它 给 用户 带来 的 是 一些 非常 “ 僵硬 ” 的 操作步骤 阻碍 了 WfMS 在 更为 广泛 的 领域 内 的 应用 　 　 过程 定义 自 学习 的 基本 思想 是 将 工作 流 的 有关 参数 推迟 到 工作 流 实例 的 运行 时 再 加以 确定 并 由 WfMS 自动 捕获 这些 参数 而 得到 相应 的 过程 定义 这样 过程 定义 能够 根据 实际 的 工作 流程 而 动态 地 生成 从而 降低 建模 人员 的 工作 负担 提高 系统 的 可用性 由于 自 学习 的 过程 实际上 是 在 运行 时 对 过程 定义 进行 修改 的 过程 因此 可以 通过 此种 机制 而 实现 对 过程 定义 的 动态 修改 WfMS 系统 的 灵活性 将 由此 而 得到 显著 的 提高 　 　 由于 学习 目标 — — 过程 定义 的 结构 是 非常 明确 的 因此 学习 过程 实际上 是 如何 在 合适 的 时机 提取 出 用户 在 实际 执行 工作 流程 时所 提供 的 信息 中 那些 过程 定义 所 需要 的 参数 以 填充 过程 定义 结构 中 的 相应 部分 根据 这种 思想 学习 算法 的 设计 主要 需 考虑 在 何时 提取 出 哪些 参数 下面 给出 Wowww 所 实现 的 过程 定义 自 学习 算法 从 具体 的 算法 过程 可以 发现 自 学习 的 机制 对于 即席 工作 流 也 将 能够 提供 很 好 的 支持 　 　 算法 工作 流 定义 的 自 学习 过程 　 　 生成 一个 空 的 过程 定义 结构 w 〈 nAF 〉 并 使 　 　 　 　 　 n ← 用户 提供 的 过程 名称 F ← A ← aStart 　 　 初始化 aStart 　 　 　 　 　 　 　 n ← 用户 提供 的 起始 活动 名称 　 　 　 　 　 　 　 t ← 起始 活动 　 　 　 　 　 　 　 s ← OnDemande ← OnSubmit 　 　 　 　 　 　 　 L ← 〈 f 〉 　 　 　 　 　 　 　 R ← 〈 开始 此 学习 过程 的 用户 名称 单个 用户 EMAIL 用户 的 邮件地址 〉 　 　 根据 用户 构造 的 起始 活动 中 所用 表单 f 初始化 fLaStartfLaStart ← nf 　 　 aCurrent ← aStart 　 　 在 用户 处理 完 与 aCurrent 相应 的 活动 实例 并 将 其 提交 时向 用户 询问 如下 信息 　 　 一个 条件 表达式 c 一个 命名 表达式 集合 E 下 一个 接收者 名称 u 　 　 生成 活动 aNext 并 初始化 其 ntseR 等 部分 　 　 A ← A ∪ aNext 　 　 Fw ← Fw ∪ 〈 aCurrentaNextcE 〉 〉 　 　 若 没有 指定 任何 向 后续 活动 传送 的 数据 学习 过程 完成 一个 工作 流 分支 的 学习 　 　 生成 与 aNext 相应 的 工作 项待 指定 用户 处理 此 工作 项时 他 可以 定义 一个 表单 fNext 并 指定 如何 将 传来 的 数据 与 fNext 中 的 各域 对应 起来 由此 种 对应 关系 设置 LaNext 　 　 aCurrent ← aNext 转 步骤 值得注意 的 是 由于 上述 算法 需要 多次 会话 过程 才能 结束 并且 一次 只能 学得 工作 流中 的 一个 分支 因此 对于 有 分支 的 工作 流程 在 以后 此 流程 的 实例 执行 过程 中 可能 需要 从 第步 开始 重新 执行 上述 学习 算法 以 最终 得到 完整 的 过程 定义 另外 学习 得到 的 过程 定义 某些 方面 的 信息 可能 仍然 是 不 完全 的 此时 系统 建模 人员 可以 使用 过程 定义 工具 加以 完善 对 同步 协作 的 支持 　 　 在 对 群件 系统 进行 分类 时 通常 是 将 WfMS 划归 为 支持 “ 异地 异步 ” 协作 的 系统 ［ ］ 由于 工作 流 实例 中 的 各 工作 项 一般 是 由 不同 用户 异地 异步 进行 处理 的 因此 这种 划分 是 合理 的 但 出现 了 要求 将 实时 协作 系统 （ 如 桌面 会议 系统 ［ ］ 协同 设计 ［ ］ 、 协同 编著 ［ ］ 等 ） 中 的 一些 特性 引入 到 WfMS 中来 的 新 的 应用 需求 以使 之 成为 一个 支持 各种类型 协作 的 协同工作 环境 　 　 同步 协作 功能 的 引入 可以 从个 不同 的 方面 着手 首先 是 过程 定义 的 设计 由于 应用 系统 的 建模 是 一个 复杂 的 过程 但 现有 WfMS 中 的 建模 工具 无一例外 地均 为 单用户 版本 因此 也 就 无法 支持 多个 具有 不同 业务 专长 的 用户 按 同步 协作 的 方式 完成 过程 的 定义 Wowww 的 过程 定义 工具 提供 了 一个 与 会议 系统 中 “ 电子白板 ” 类似 的 “ 虚拟 设计 板 ” 它 可以 供 多个 应用 系统 建模 人员 共享 使 他们 能够 以 同步 协作 的 方式 共同完成 某个 应用 系统 的 建模 这样 过程 中 不同 步骤 的 建模 可以 由 最 熟悉 此 业务 的 人员 完成 因此 可以 保障 建模 结果 的 准确性 与 全面性 使 所 得到 的 过程 模能 更 准确 地 反映 实际 的 业务 情况 限于 篇幅 “ 虚拟 设计 板 ” 的 具体 细节 此处 就 不再 讨论 了 　 　 需要 引入 同步 协作 能力 的 第个 方面 是 对 工作 项 的 处理 传统 WfMS 中 的 工作 项 都 是 由 某 一个 用户 负责 完成 的 Wowww 则 可以 让 多个 用户 同时 共同 来 完成 对 某个 工作 项 的 处理 为 实现 此种 能力 一方面 Wowww 允许 多个 用户 同时 分别 处理 表单 中 的 各个 域 另一方面 在 表单 中 可以 加上 一种 特殊 类型 的 域 同步 控件 如 协同 编辑框 、 虚拟 绘图板 等 同步 控件 所 维护 的 内容 可以 供 处理 此 工作 项 的 那些 用户 同步 地 加以 处理 这样 他们 将 可用 同步 协作 的 方式 完成 某篇 文档 的 撰写 或 某幅 图纸 的 设计 等 这 两 方面 的 功能 都 是 在 全 复制 的 结构 下 实现 的 IWADE 使 一种 类似 于 CoDesign ［ ］ 所 实现 的 并发 控制 方法 去 保证 多个 用户 访问 同一 对象 时 的 数据 一致性 与 CoDesign 的 不同之处 在于 由于 JavaApplet 无法 实现 数据包 的 多播 因此 Wowww 借助于 其 服务器 上 的 会 话 控制 模块 来 完成 数据包 的 分发 　 　 为了 进一步 增强 同步 协作 的 能力 还 可以 引入 实时 视频 和 音频 服务 这些 服务 可以 通过 单独 的 工具 提供 也 可以 用 Plugin 的 方式 嵌入 到 Web 浏览器 中 但 在 Internet 环境 下 不同 的 机器 上 视频 和 音频 信息 的 采集 方式 、 编码 格式 、 压缩 方式 等 都 有 很大 的 不同 这 给 在 Wowww 中 引入 这些 服务 带来 一定 的 困难 事实上 在 不同 平台 上 有关 会议 系统 互连 的 研究 中 也 同样 遇到 这个 问题 对此 我们 以后 将 另文 详述 结论 　 　 InternetIntranetWWW 及 Java 技术 的 成熟 及 应用 的 日渐 丰富 为 工作 流 管理系统 的 构造 提供 了 一个 理想 的 计算环境 本文 详细描述 了 一个 基于 Web 的 工作 流 系统 Wowww 其 设计 的 基本 出发点 是 集成 各种 已有 的 Internet 资源 使 之 能够 被 一致 地 协调 起来 以 促使 企业 业务 目标 的 高效 实现 文中 讨论 了 Wowww 的 体系结构 、 工作 流 模型 、 工作 流 实例 的 执行 算法 以及 为 提高 其 灵活性 、 可用性 及 协作 能力 而 引入 的 两种 新 特性 工作 流 过程 定义 的 自 学习 方法 及 对 同步 协作 的 支持 我们 的 最终目标 是 将 Wowww 发展 成 一个 能够 支持 各种 协作 方式 的 协同工作 环境 和 协同 应用 的 研究 开发 环境 并 在 此基础 上 进一步 深化 对于 协同工作 本质 的 研究 致谢 本 项目 的 研究 开发 得到 国家 高技术 研究 发展 计划 智能 计算机 主题 专家组 的 大力支持 在 此谨 表示 诚挚 的 谢意 ！ 另外 李红臣 、 郄小虎 、 冯磊 、 颜宏 等 同志 为本 项目 的 开发 做 了 大量 的 工作 在 此 一并 致谢 ！ 基金项目 ： 本文 研究 得到 国家自然科学基金 和 国家 高科技 项目 基金 资助 作者简介 ： 史 美林 年生 教授 博士生 导师 主要 研究 领域 为 计算机网络 及其 应用 CSCW 　 　 　 　 　 杨光 信年生 博士生 主要 研究 领域 为 计算机网络 及其 应用 　 　 　 　 　 向勇 年生 博士 讲师 主要 研究 领域 为 计算机网络 CSCW 　 　 　 　 　 伍尚 广年生 讲师 主要 研究 领域 为 计算机网络 CSCW 作者 单位 ： 清华大学 计算机科学 与 技术 系 　 北京 　 　 　 　 　 　 Emailshiygxinxyongwsgcsnetcstsinghuaeducn 本文 通讯联系 人史 美林 ， 北京 清华大学 计算机科学 与 技术 系 参考文献 　 史 美林 杨光 信向勇 等 WfMS 工作 流 管理系统 计算机 学报 ～ ShiMeilinYangGuangxinXiangYongetalWfMSworkflowmanagementsystemChineseJournalofComputers ～ 　 WfMCWorkflowProcessDefinitionReadWriteInterfaceRequestforComments 　 WfMCWorkflowManagementCoalitionWorkflowStandardinteroperabilityAbstractSpecification 　 WfMCWorkflowManagementCoalitionAuditDataSpecification 　 WfMCWorkflowManagementCoalitionWorkflowClientApplicationInterfaceApplicationProgrammingInterfaceWAPISpecification 　 WfMCTheWorkflowReferenceModel 　 DuWeiminDavisJShanMingchienFlexiblespecificationofworkflowcompensationscopesInHayneSCPrinzWedsProceedingsofACMSIGGROUPConferenceonSupportingGroupWorkPhoenixACMPress ～ 　 EllisCANuttGJModelingandenactmentofworkflowsystemsInAjmoneMarsanedApplicationandTheoryofPetriNetsBerlinSpringerVerlag ～ 　 PeterCLWalterHDObjectorientedprotocolhierarchiesfordistributedworkflowsystemsTheoryandPracticeofObjectSystems ～ NatalieSGDanieleSPRemoPGeneralizedprocessstructuregrammarsGPSGforflexiblerepresentationsofworkInAckermanMSedProceedingsofACMConferenceonComputerSupportedCooperativeWorkBostonACMPress ～ YangGuangxinShiMeilinDicseaplatformfordevelopingCSCWInXueChunpeiedProceedingsoftheInternationalConferenceonCommunicationTechnologyBeijingChinnaConstructionMaterialsPublishingHouseEllisCAGibbsSJReinGLGroupWaresomeissuesandexperiencesCommunicationofACM ～ WuShangguangShiMeilinSupportenvironmentforCSCWresearchdesignandimplementationofadesktopcomputerconferencingsystemInXueChunpeiedProceedingsoftheInternationalConferenceonCommunicationTechnologyBeijingChinnaConstructionMaterialsPublishingHouse ～ 史 美林 杨光信 一个 协同 设计 支撑 系统 原型 — — CODESIGN 清华大学 学报 科学 与 技术 S ～ ShiMeilinYangGuangxinCODESIGNprototypeofacooperativedesignsupportsystemJournalofTsinghuaUniversityScienceandTechnologyS ～ EllisCAGibbsSJConcurrencycontrolingroupwaresystemsInCliffordJLindsayBMaierDedsProceedingsoftheACMSIGMODConferenceonManagementofDataNewYorkACMPress ～ 本文 收到 原稿 收到 修改稿