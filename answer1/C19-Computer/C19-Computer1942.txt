微型机 与 应用 MICROCOMPUTERITSAPPLICATIONS 年 第卷 第期 VolNo 现代 微型 计算机 总线 技术 的 发展 闫 长青 　 吴石增 　 　 摘 　 要 ： 对 现代 微型 计算机 的 总线 技术 进行 了 概述 ， 并 对 随 微型 计算机 不断 发展 所 采用 的 几种 典型 的 总线 进行 了 介绍 ， 重点 介绍 了 新近 应用 较 多 的 PCI 和 AGP 总线 。 同时 对 各种 总线 的 性能 进行 了 综合 对比 。 　 　 关键词 ： 总线 技术 　 PCXT 总线 　 ISA 总线 　 PCI 总线 　 AGP 总线 　 EISA 总线 　 　 近 十几年来 ， 微型 计算机 有 了 迅猛 的 发展 ， 引发 了 新 的 技术 革命 ， 甚至 引起 了 人们 生活 方式 的 巨大 变革 。 微型 计算机 之所以 有 如此 大 的 能力 ， 与 计算机 结构 技术 的 不断 革新 、 发展 是 密切相关 的 。 而 总线 技术 正是 计算机 结构 技术 中 一个 十分 重要 的 组成部分 。 　 　 采用 总线 技术 ， 是 现代 计算机技术 发展 的 必然 。 由于 总线 技术 的 应用 ， 简化 了 系统 设计 ， 便于 组织 各 模块 的 专业化 生产 ， 也 便于 产品 的 升级换代 ， 同时 也 能 得到 众多 计算机 厂商 的 支持 。 　 　 在 一般 的 微型 计算机系统 中 ， 往往 具有 不同 层次 的 总线结构 ， 以 微机 系统 为例 ， 它 就 支持 以下 种 总线 ： 　 　 CPU 总线 ： 具有 位 地址 线 CAB 和 位 数据线 CDB ， 它 用来 连接 CPU 和 外围 芯片 。 　 　 存储 总线 ： 具有 位 地址 线 MAB 和 位 数据线 MDB ， 包括 位 奇偶校验 位 ， 用来 连接 存储 控制器 和 DRAM 。 　 　 系统总线 ： 也 称 IO 通道 总线 ， 用来 与 扩充槽 上 的 各 扩充 板卡 相连 。 系统总线 有 多种 标准 ， 其 数据 地址 线 不同 ， 以 适用 于 不同 的 应用 系统 。 　 　 外部 总线 ： 具有 位 地址 线 XAB 和 位 数据线 XDB ， 用来 与 主机板 上 的 IO 控制器 和 键盘 控制器 相连接 。 　 　 在 以上 几种 总线 中 ， CPU 总线 、 存储 总线 、 外部 总线 在 系统 板上 ， 不同 的 计算机系统 采用 的 芯片组 不同 。 所以 这些 总线 均 不 完全相同 ， 也 没有 互换性 问题 。 　 　 而 系统总线 则 不同 ， 它 是 与 IO 扩展 插槽 相连接 的 。 IO 插槽 中 可以 插入 各种 扩充 板卡 ， 作为 各种 外设 的 适配器 与 外设 连接 。 因此 要求 系统 必须 有 统一 的 标准 ， 以便 按照 这些 标准 来 设计 各类 适配卡 。 　 　 本文 以下 讨论 的 微机 总线 即 指 PC 及其 兼容机 的 系统总线 或称 IO 总线 。 下面 将 对 微机 总线 发展 过程 中 的 几种 典型 总线 技术 进行 逐一 介绍 ， 重点 是 新近 采用 的 PCI 及 AGP 总线 技术 。 　 PCXT 总线 、 ISAAT 总线 、 及 EISA 总线 　 　 这 几种 总线 为 较 早 在 微机 系统 上 采用 的 总线 标准 。 其中 ， ISAAT 总线 至今 仍 有 一定 的 应用 。 　 PCXT 总线 　 　 最早 的 PC机 的 系统总线 是 IBM 公司 于 年 推出 的 基于 准位 机 PCXT 的 总线 ， 也 称 PC 总线 。 PCXT 总线 支持 位 数据传输 和 位 寻址 空间 。 其 特点 是 把 CPU 视为 总线 的 唯一 主控 设备 ， 其余 外围设备 均 为 从属 Slave 设备 ， 包括 暂时 掌管 总线 的 DMA 控制器 或 协处理器 。 　 　 IBMPCXT 总线 是 一种 开放 的 结构 总线 ， 在 其 总线 母板 上 有 数个 系统 插槽 ， 可 用于 IO 设备 与 PC机 连接 。 其 价格低 、 可靠 简便 、 使用 灵活 、 且 对 插板 兼容性 好 ， 因此 有 许多 厂家 生产 该 总线 的 兼容 产品 ， 品种 范围 广泛 。 起初 ， IBMPC 总线 产品 主要 用于 办公自动化 ， 后来 很快 扩大 到 实验室 或 工业 环境 下 的 数据 采集 和 控制 。 　 ISAAT 总线 　 　 年 IBM 公司 推出 了 位 PC机 PCAT ， 其 总线 称为 AT 总线 。 后来 为了 统一标准 ， 便 将 位 和 位位 兼容 的 AT 总线 命名 为 工业 标准 结构 ISA — — IndustrialStandardArchitecture 。 　 　 由于 ISA 是 位和位 兼容 的 总线 ， 故 插槽 有种 类型 ， 即位 和 位 。 位 扩展 IO 插槽 由个 引脚 组成 ， 用于 位 的 插接 板 ； 位 的 扩展 插槽 除了 具有 个 位线 的 连接器 外 ， 还有 个 附加 的 线 连接器 。 这种 扩展 IO 插槽 既 支持 位 的 插接 板 ， 也 支持 位 的 插接 板 。 　 　 ISA 总线 具有 以下 的 主要 性能指标 ： 　 　 IO 地址 空间 H ～ FFH ； 　 　 位 地址 线 ， 可 直接 寻址 的 内存容量 为 MB ； 　 　 位 数据线 ； 　 　 引脚 ； 　 　 最大 传输率 Mbs ； 　 　 中断 功能 ； 　 　 DMA 通道 功能 ； 　 　 开放式 总线结构 ， 能 使 多个 CPU 共享 系统资源 。 　 　 ISA 总线结构 示意图 如图 。 图 　 ISA 总线结构 示意图 　 　 从 表面 看 ， ISAAT 总线 是 在 PCXT 总线 基础 上 增加 了 个线 插座 形成 的 。 但 实际上 ， ISAAT 总线 比 PCXT 总线 不仅 增加 了 数据线 宽度 和 寻址 空间 ， 还 加强 了 中断 处理 和 DMA 传输 能力 ， 并且 具备 了 一定 的 多主 功能 。 故 ISAAT 总线 特别 适合 于 控制 外设 和 进行 数据通信 的 功能模块 。 　 EISA 总线 　 　 扩展 工业 标准 结构 EISA — — ExtendIndustrialStandardArchitecture ， 是 由 COMPAQ 牵头 的 一个 联合 组织 共同 制定 的 一组 总线 标准 。 　 　 EISA 总线 是 一种 位 总线结构 ， 除了 ISA 支持 的 位 或位 数据传输 外 ， 还 支持 位 地址总线 和 位 数据传输 。 与 ISA 总线 相比 ， EISA 总线 数据 传输速度 更 快 ， 且 支持 多 主控 总线 功能 ， 可 使 普通 微机 的 单 处理器 系统 升至 多处理器 工作 状态 ， 使 运行 达到 峰值 ， 其 峰值 总线 数据 传输率 达 Mbs 。 　 PCI 局部 总线 　 　 进入 年 后 ， 由于 微处理器 的 飞速发展 ， 使 ISA 、 EISA 总线 均 显 落后 。 微处理器 的 高速度 和 总线 的 低 速度 不 同步 ， 造成 硬盘 、 图形卡 和 其它 外设 只能 通过 个 慢速 且 狭窄 的 瓶颈 发送 和 接收数据 。 因此 推出 了 一项 新 技术 — — 局部 总线 。 　 　 从 结构 上 看 ， 局部 总线 是 在 ISA 总线 和 CPU 总线 之间 增加 级 总线 。 这样 可 将 一些 高速 外设 ， 例如 网络 适配卡 、 磁盘控制器 等 从 ISA 总线 上 卸下来 而 通过 局部 总线 直接 挂接 至 CPU 总线 上 ， 使 之 与 高速 的 CPU 总线 相匹配 。 局部 总线结构 示意图 如图 。 图 　 局部 总线结构 示意图 　 　 标准 的 局部 总线 中 典型 的 是 PCI 局部 总线 PeripheralComponentInterconnectLocalBus ， 由 Intel 公司 开发 。 其 特点 是 在 CPU 和 外设 之间 插入 个 复杂 的 管理层 ， 以 协调 数据传输 并 提供 总线 接口 。 由于 采用 了 信号 缓冲 ， PCI 能 支持 种 外设 ， 并 在 高 时钟 频率 下 保持 最高 的 传输速率 。 　 　 PCI 局部 总线 允许 在 个 计算机上安装 多达 个 PCI 附加 扩展卡 ， 允许 将 ISA 、 EISA 等 扩充 总线 控制卡 安装 在 上面 ， 以 使 所有 已 安装 的 系统总线 更好 地 同步 。 PCI 控制器 可以 用位 或位 这 取决于 设备 与 系统 的 CPU 交换 数据 。 另外 ， 还 允许 智能化 的 PCI 辅助 适配器 采用 一种 称为 总线 管理 busmastering 的 技术 协助 CPU 执行 各种 任务 。 PCI 规范 允许 复用 ， 即 在 个 时间 内 允许 有个 以上 的 电信号 出现 在 总线 上 。 　 　 PCI 总线 较 以前 的 总线 具有 独特 优点 ： 　 　 高性能 的 多媒体技术 。 高性能 图形 、 视像 、 网络 对 处理器 提出 很 高 的 要求 。 PCI 局部 总线 提供 了 很 宽 的 通路 ， 允许 这些 应用程序 相当 平滑 的 执行 。 　 　 真正 的 兼容性 。 与 其它 总线 标准 不同 ， 任何 与 PCI 相 兼容 的 机器 可 用于 任何 遵从 PCI 的 系统 而 不论 其 总线 类型 或 所用 的 处理器 。 　 　 与 Intel 处理器 一起 工作 。 PCI 总线 可 与 Intel 处理器 协同工作 ， 而 不论 其 兆赫 值 从 IntelSX 处理器 直至 奔腾 及 未来 的 版本 。 　 　 增长 的 余地 。 PCI 能以 Mbs 的 速率 传送数据 ， 远比 ISA 总线 的 Mbs 快 ， 这使 PCI 可 处理 极高 的 容量 ， 如 用于 全屏幕 高质量 视频 的 级别 。 　 　 可见 ， PCI 局部 总线 为 外设 提供 了 访问 微处理器 更 宽 、 更快 的 通路 ， 有效 地 克服 了 数据传输 的 瓶颈 现象 。 在 目前 一段时间 内 ， PCI 局部 总线 接口 是 许多 适配器 的 首选 接口 ， 如 网络适配器 、 内置 MODEM 卡 、 声音 适配器 等 ， 且 目前 绝大多数 主板 上均 带有 PCI 插槽 。 　 AGP 总线 　 　 AGP 加速 图形 端口 AcceleratedGraphicsPort 是 一种 用来 连接 CPU 和 图形 加速器 、 比 PCI 更快 的 总线 。 它 是 由 主要 的 图形 器件 厂商 及 全球 的 PC机 和 OEM 厂商 组成 的 AGP 执行者 论坛 AGP — IF 在 年 月 提出 的 。 Intel 公司 决定 将 AGP 技术 主要 用于 基于 Pentium Ⅱ 处理器 的 平台 上 。 　 AGP 总线 特点 　 　 AGP 是 专门 为 点对点 的 图形 器件 设计 的 ， 并非 为了 替代 PCI 总线 ， 它 是 PCI 总线 的 增强 和 扩充 。 AGP 的 标准 建立 在 PCI 标准 的 基础 上 。 　 　 在 PCI 总线 下 ， 许多 外设 如 高速 硬盘驱动器 、 高速 网络 适配卡 、 调制解调器 、 声卡 等 均 需 使用 PCI 总线 传输数据 ， 而 PCI 的 数据 带宽 有限 峰值 传输率 为 Mbs ， 若 再 加上 个 需 大量 数据传输 的 D 显示卡 ， PCI 总线 就 会 不堪重负 ， 因此 导致 了 AGP 总线 的 产生 。 故 AGP 的 设计 核心 是 在 PC机 上 实现 高性能 的 D 图像 。 　 　 AGP 性能 特点 ： 　 　 为 D 图形 显示 提供 高带宽 为 PCI 的 倍 ， 使 突发 数据 传输率 达 Mbs 。 　 　 采用 了 管线 技术 、 边带 寻址 ， 在 时钟 上升 沿 和 下降 沿可 同时 存取数据 。 　 　 可 直接 对系统 内存 中 的 纹理 图像 进行 处理 。 因为 AGP 允许 图形 控制器 与 系统 内存 的 无缝 连接 ， 不必 将 纹理 数据 预载 到 本地 显存 上 。 　 　 减少 了 总线 阻塞 ， 提高 了 处理 效率 。 PCI 总线 就 像 一条 单行道 ， 其 显示卡 从 内存 中 取得 数据 时 ， 如同 从 显示卡 开出 一辆 空车 到 内存 去 装货 ， 必须 等到 该车 将 货物 运回来 后 ， 才能 发出 下 一趟 车 。 这样 在 发出请求 和 得到 数据 之间 有 很多 时间 是 在 等待 。 AGP 总线 对此 作 了 很大 的 改进 ， AGP 更 像 一条 高速公路 ， 不但 改善 了 路面 质量 提高 了 车速 提高 了 时钟 频率 ， 而且 增强 了 总线 控制器 的 功能 ， 这样 使得 从 AGP 显示卡 可以 连续 发出 多辆 车 ， 减少 了 等待 内存 的 寻址 时间 ， 大大提高 了 处理 效率 。 　 　 AGP 与 PCI 总线 相比 具有 更 高 的 时钟 频率 和 数据 传输率 。 对于 个 系统 基频 为 MHz 的 奔腾 级计算机 来说 ， PCI 的 工作频率 为 基频 的 即 MHz ， 相应 的 峰值 数据 传输率 为 Mbs ； 而 AGP 有种 模式 ： × 模式 、 × 模式 和 × 模式 ， 工作频率 分别 达 MHz 、 MHz 和 MHz ， 相应 的 峰值 数据 传输率 为 Mbs 、 Mbs 和 Gbs 。 　 AGP 的 工作 模式 　 　 AGP 有种 工作 模式 ： 一种 是 直接 内存 访问 DMA ： DirectMemoryAccess 模式 ， 另 一种 是 直接 内存 执行 DIME ： DirectMemoryExecute 模式 。 　 　 当 AGP 总线 工作 在 DMA 模式 时 ， AGP 总线 先 将 系统 内存 中 的 纹理 和 其它 数据 装载 到 图形 加速器 的 本地 内存 中 ， 接着 图形 加速器 的 各种 处理 工作 如 纹理 映射 、 明暗 度 调整 、 Z 向 缓冲 等 都 在 本地 内存 中 执行 。 在 此 模式 下 ， AGP 与 基于 PCI 的 图形 加速器 的 工作 方式 大致 一样 。 图形 加速器 只是 拥有 了 AGP 总线 高速 数据传输 的 优势 。 　 　 当 AGP 总线 处于 执行 模式 时 ， 图形 的 数据 可 直接 在 系统 内存 中 执行 而 不 需要 将 原始数据 全部 传输 到 图形 控制器 。 例如 D 图形 的 一些 特定 操作 如 传输 量 最大 的 纹理 映射 可 在 系统 的 主存 中 直接 处理 ， 然后 图形 控制器 将 处理 过 的 数据传输 到 显示 缓冲区 。 这样 做 的 好处 是 可 减少 主 内存 和 图形 控制器 之间 的 数据传输 量 ， 同时 也 节省 了 图形 控制器 的 本地 内存 。 　 　 为 实现 以上 功能 ， 就 要求 图形 控制器 必须 能 访问 系统 的 主 内存 ， 能 在 主 内存 和 显示 内存 之间 传送数据 。 下面 以 Windows 为例 ， 说明 图形 处理器 访问 系统 内存 的 方法 。 　 　 图形 处理器 要 能 访问 系统 内存 ， 首先 必须 得到 系统 的 支持 ， 目前 Windows 中 的 OSR 能够 支持 AGP 的 执行 模式 ； 还 需要 有 名为 “ USBSUPPEXE ” 的 程序 ， 它 从 表面 看 是 USB 设备 的 支持 程序 ， 实际上 包括 了 个 新 的 虚拟内存 管理器 VMMVXD ， 主要 增加 了 几个 对 AGP 专用 内存 进行 分配 和 管理 的 API 接口 ， 使 AGP 显示卡 的 驱动程序 可 通过 这 几个 API 接口 给 AGP 在 系统 内存 分配 AGP 专用 内存 。 另外 ， 在 微软 提供 的 多媒体 编程 接口 Direct 中 ， 包括 有 DirectDraw ， 其中 新增 了 支持 AGP 的 DIME 功能 ， 使 程序员 不需 直接 访问 硬件 就 可 利用 AGP 的 优点 。 此外 ， 随 AGP 显示 驱动程序 同时 安装 的 还有 “ VGARTDVXD ” 的 虚拟 设备 管理程序 ， 它 是 AGP 执行 DIME 模式 的 关键所在 。 　 　 AGP 的 DIME 执行 过程 如下 ： D 程序 开始运行 ， 先 通过 DirectDraw 的 API 分配 个 足够 大 的 显示 内存 缓冲区 。 DirectDraw 缺省 的 内存 分配 方式 为 ： 先 分配 显示 缓冲器 的 本地 内存 ， 根据 相应 的 显示 分辨率 和 色彩 深度 计算 好 显示 中 常用 的 缓冲区 大小 ， 在 本地 内存 中 优先 分配 ， 然后 将 剩下 的 缓冲区 分配 给 纹理 缓冲区 。 一般 D 应用程序 的 纹理 数据 相当 大 ， 显示 控制器 的 本地 内存 放不下 时 ， 就 在 系统 主 内存 中 给 AGP 分配 “ AGP 主 内存 ” 。 由于 Windows 采用 虚拟 地址映射 方式 ， 所以 可 将 暂时 不用 的 内存 存储 在 硬盘 上 ， 在 需要 时 再 调入 内存 ， 若 AGP 主 内存 也 被 操作系统 存入 硬盘 再 调入 ， 会 影响 图形 显示 效果 ， 故 AGP 主 内存 是 被 操作系统 锁定 的 ， 使 其 不能 被 交换 到 硬盘 。 　 　 　 　 内存 分配 好后 ， 图形 控制器 可 把 在 系统 内存 中 的 AGP 主 内存 当作 显示卡 的 本地 内存 一样 使用 ， 且 AGP 主 内存 是 块 连续 的 内存 区 。 由于 在 PCI 控制 芯片组 中有 个 图形 地址 重 映射 表 GraphicsAddressRemappingTable 的 硬件 ， 它 可 将 图形 控制器 要 寻址 的 内存地址 转换成 相应 的 物理地址 ， 又 因为 图形 地址 重 映射 表 和 CPU 的 地址映射 表均 由 操作系统 来 管理 ， 故 图形 控制器 和 CPU 均 能 访问 相同 的 AGP 主 内存 。 图形 控制器 访问 AGP 主 内存 ， 把 AGP 主 内存 中 显示 需要 的 纹理 转换成 硬件 能 直接 显示 的 格式 ， 存入 显示 缓冲区 ， 再 进行 显示 ， 这样 可 大大减少 数据传输 量 。 　 　 由于 AGP 主 内存 是 动态分配 的 ， 所以 对 不同 的 D 应用程序 和 不同 的 分辨率 ， AGP 主 内存大小 可 重新分配 。 此外 ， 在 D 应用程序 结束 后 ， 可以 释放 AGP 主 内存 。 　 AGP 的 应用 展望 　 　 虽然 AGP 总线 拥有 很 高 的 速度 和 优越 的 性能 ， 但 其 应用 还 有赖于 计算机系统 其它 部分 的 技术 发展 。 目前 AGP 的 峰值 数据 传输率 虽能 达到 Mbs 、 Mbs ， 甚至 Gbs ， 但 目前 系统 内存 的 最快 访问速度 为 Mbs ， 加上 CPU 、 总线 控制器 和 AGP 图形 控制器 均 需 访问 系统 内存 ， 系统 内存 实际 给 AGP 图形 控制器 使用 的 带宽 远远 满足 不了 AGP 的 需要 。 预计 随着 系统 内存 访问速度 的 提高 ， AGP 总线 的 优越性 将 体现 得 更加 明显 ， 其 应用 也 会 越来越 广泛 。 　 总结 　 　 现将 几种 总线 的 性能 列于 表 加以 比较 ， 供 感兴趣 的 同行 参考 。 表 　 几种 总线 性能 总线 PCXTISAATEISAPCIAGP 推出 时间 年 年 年 年 年 带宽 b 总线 类型 系统总线 系统总线 系统总线 局部 总线 管线 最高 时钟 频率 MHz 　 以上 蜂值 数据 传输率 Mbs 　 或 更 高带 外设 能力 　 个 图形 控制器 作者 单位 ： 中国科学院 电工 研究所 参考文献 　 　 何宗琦 PC 总线 技术 概述 电脑报 ， ； 　 　 秦风 评测 实验室 您 了解 AGP 吗 电脑 技术 ， ； 　 　 WilliamSComputerorganizationandarchitecturedesigningforperformancePrenticeHallInc 收稿 日期 ：