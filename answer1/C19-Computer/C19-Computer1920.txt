微型机 与 应用 MICROCOMPUTERITSAPPLICATIONS 　 Vol 　 No 　 PActiveX 控件 在 Intranet 开发 中 的 应用 方澍华 　 杨宗煦 摘要 ： ActiveX 控件 在 Intranet 环境 中 的 一种 巧妙 应用 — — 在 客户端 以 局域网 内 网络 路径 的 形式 注册 服务器端 ActiveX 控件 。 关键词 ： WebActiveX 控件 B ／ S 模式 网络 路径 　 　 MicrosoftActiveX 技术 是 OLE 技术 在 Internet 上 的 重 定义 ， 而 ActiveX 控件 则 是 OLE 控件 在 Internet 上 的 扩展 。 ActiveX 控件 是 基于 组件 对象 模型 COM 的 通用 组件 ， 可以 通过 开发工具 、 浏览器 和 应用程序 方便 地 激活 。 ActiveX 控件 在 Web 中 的 基本 应用 　 　 ActiveX 控件 在 Web 中 的 应用 ， 是 通过 在 HTML 文件 中 引入 Object 标记 实现 的 ， 形式 如下 ： 　 　 ＜ OBJECTID ＝ ″ ActiveXControl ″ WIDTH ＝ ″ ″ HEIGHT ＝ ″ ″ CLASSID ＝ ″ CLSID ： E － EA － D － A － EF ″ ＞ ＜ ／ OBJECT ＞ 　 　 其中 ： CLASSID 的 值 是 ActiveX 控件 注册 后 得到 的 类 ID 号 。 　 　 在 Internet 中 ， ActiveX 控件 是 在 客户机 IE 浏览器 端 自动 下载 而 运行 的 。 只要 在 OBJECT 标记 中 设置 好 CODEBASE 参数 ， 客户端 将 根据 CODEBASE 中 的 URL 地址 找到 ActiveX 控件 的 源文件 ， 并 询问 客户 是否 下载 。 参数设置 形式 如下 ： 　 　 ＜ OBJECTID ＝ ″ ActiveXControl ″ WIDTH ＝ ″ ″ HEIGHT ＝ ″ ″ CLASSID ＝ ″ CLSID ： E － EA － D － A － EF ″ CODEBASE ＝ ″ http ： wwwshfcom ／ controls ／ ctlocx ″ ＞ ＜ ／ OBJECT ＞ 　 　 ActiveX 控件 下载 到 客户端 后 ， 即 作为 客户端 的 一个 应用 程序运行 ， 其 功能 类似 于 Netscape 浏览器 的 控件 。 由于 完全 在 客户端 运行 ， 脱离 了 服务器端 ， 所以 ActiveX 控件 的 这种 应用 形式 并 不是 真正 的 浏览器 ／ 服务器 B ／ S 模式 。 用 ActiveX 控件 开发 Web 应用 的 优点 及 问题 　 　 在 Intranet 环境 中 ， 由于 可以 限制 客户端 的 浏览器 为 IE ， 所以 ActiveX 控件 可以 得到 广泛 的 应用 。 把 传统 MIS 系统 的 全部 或 部分 功能 移植 到 Web 应用 的 B ／ S 模式 下 ， 是 当前 IntranetWeb 应用 开发 的 一个 关键 。 当前 一些 相关 的 技术 如 公共 网关 接口 CGI 、 API 、 SERVER － SIDE － SCRIPT 等 ， 在 开发 完善 的 MIS 应用 方面 不是 功能 不够 强大 就是 开发 过程 过于 复杂 ， 另外 网络 编程语言 Java 在 数据库 应用 开发 方面 也 不够 成熟 ， 所以 在 这种 情况 下 ， ActiveX 技术 确实 是 好 的 解决 途径 。 由于 ActiveX 控件 可以 利用 VisualBasic 、 Delphi 、 VisualC ＋ ＋ 、 C ＋ ＋ Builder 等 任何 一种 支持 COM 规范 的 开发工具 来 进行 开发 ， 其 开发 过程 中 的 细节 与 传统 MIS 系统 开发 相 类似 ， 所以 功能 十分 强大 并且 开发 周期短 。 　 　 目前 ， 以 ActiveX 控件 为 核心 开发 的 IntranetWeb 应用程序 还 不 多 ， 其 主要 原因 是 ActiveX 控件 在 开发 完全 B ／ S 模式 下 的 应用程序 方面 存在 着 二个 根本 问题 ： 　 　 ActiveX 控件 自动 下载 到 客户端 后 ， 作为 独立 于 服务器端 的 客户端 应用 程序运行 。 在 这种 形式 下 ， 利用 ActiveX 控件 开发 的 一个 基于 Web 的 MIS 系统 与 传统 的 MIS 系统 相比 ， 在 运行 模式 上 其实 没有 根本 区别 ， 系统 都 在 很大 程度 上 增加 了 客户端 的 资源 消耗 ， 唯一 的 区别 只是 前者 运行 时嵌 在 浏览器 这个 容器 中 。 ActiveX 控件 的 这种 应用 模式 并非 Web 应用 开发 中 所 要求 的 真正 的 B ／ S 模式 。 　 　 传统 MIS 系统 中 ， 客户端 应用程序 访问 服务器端 网络 数据库 一般 采用 ODBC 接口 ， 这 要求 每个 客户端 都 必须 安装 ODBC 驱动 并 配置 ODBC 连接 。 在 ActiveX 控件 中 访问 服务器端 的 网络 数据库 时 ， 如果 采用 特定 厂商 的 数据库 驱动程序 ， 可以 以 网络 资源共享 的 绝对路径 访问 数据库 ， 但 应用程序 可移植性 较差 ； 如果 采用 ODBC 接口 ， 则 同样 需对 每个 客户端 进行 安装 配置 ， 并 没有 满足 Web 应用 中 客户端 所 需 配置 少 的 要求 。 　 　 这 二个 问题 产生 的 根源 是 ActiveX 控件 完全 运行 在 客户端 ， 虽然 这种 运行 模式 符合 ActiveX 控件 本身 作为 一种 嵌入式 组件 的 概念 ， 但 却 不 符合 Web 应用 开发 中 B ／ S 模式 的 要求 。 在 B ／ S 模式 下 ， 浏览器 端 配置 简单 、 开销 小 ， 应用程序 的 主要 工作 由 服务器端 承担 。 　 　 要 从根本上 解决 这 二个 问题 ， 必须 改变 ActiveX 控件 的 应用 形式 。 在 Internet 中 ， ActiveX 控件 只能 是 下载 到 客户端 运行 ， 而 在 Intranet 中 ， 则 可以 利用 局域网 的 特点 避免 这种 情况 。 所以 ， 问题 解决 的 核心 在于 寻求 一种 方法 ， 使得 嵌入 在 HTML 文件 中 的 ActiveX 控件 运行 在 服务器端 ， 而 客户端 浏览器 又 能够 对 嵌入 的 ActiveX 控件 进行 解释 执行 。 ActiveX 控件 在 Intranet 中 的 妙用 　 　 在 客户端 以 局域网 内 网络 路径 的 形式 手工 注册 服务器端 ActiveX 控件 是 能够 彻底解决 上述 问题 的 一种 好 的 途径 ， 下面 就 来 介绍 这种 方法 。 　 　 使用 ActiveX 控件 ， 必须 先对 ActiveX 控件 进行 注册 ， 应用程序 通过 注册 后 得到 的 类 ID 号 找到 控件 的 数据源 进行 访问 。 ActiveX 控件 可以 由 VB 、 VC 、 Delphi 、 C ＋ ＋ Builder 等 开发工具 生成 OCX 文件 时 自动 进行 注册 ， 也 可以 手工 注册 ， 其实质 都 是 通过 运行 应用程序 Regsvrexe 来 实现 。 Regsvrexe 一般 在 操作系统 的 系统 文件目录 下 ， 如 Windows 的 ＼ Windows ＼ System 目录 、 WindowsNT 的 ＼ Winnt ＼ System 目录 。 　 　 在 WindowsNT 局域网络 环境 内 ， 对 资源 的 共享 既 可以 使用 网上邻居 这样 的 应用程序 ， 也 可以 通过 完整 的 网络 路径 来 访问 。 网络 路径 的 形式 为 ： 　 　 ＼ ＼ 机器 名 ＼ 共享 目录名 ＼ 文件名 　 　 在 Regsvrexe 应用程序 的 命令行 中 输入 网络 资源共享 的 完整 路径 ， 可以 在 客户端 注册 服务器端 的 ActiveX 控件 ， 具体步骤 如下 ： 　 　 存储 ActiveX 控件 在 服务器 的 某个 目录 下 ， 以 常规 方法 在 服务器 上 注册 本地 ActiveX 控件 。 　 　 假定 ， 服务器 名为 Server ， 目录 名为 AllControls ， 控件 名为 Controlocx ， 则 注册 命令 为 ： 　 　 Regsvr ＼ AllControls ＼ Controlocx 　 　 在 客户端 以 网络 路径 的 形式 注册 服务器端 的 ActiveX 控件 。 假定 ， 目录 AllControls 的 共享 名为 Controls ， 则 注册 命令 为 ： 　 　 Regsvr ＼ ＼ Server ＼ Controls ＼ Controlocx 　 　 完成 注册 工作 后 ， 当 客户 浏览器 端 浏览 到 服务器端 包含 ActiveX 控件 Controlocx 的 主页 时 ， 浏览器 端 将 不再 提示 下载 ActiveX 控件 ， 而是 通过 注册表 中 的 类 ID 号 找到 服务器端 的 控件 来 解释 执行 。 这样 ， 整个 ActiveX 控件 的 运行 ， 包括 所有 对 服务器端 网络 数据库 的 访问 ， 都 完全 在 服务器端 进行 ， 极大 地 降低 了 客户端 的 资源 消耗 ， 体现 了 B ／ S 模式 的 优越性 。 　 　 一个 功能 全面 的 管理系统 ， 一般 会 分割 成 很多 小 的 功能模块 ， 而 实现 这样 一个 基于 Web 的 应用 系统 ， 需要 开发 很多 对应 于 各个 功能模块 的 ActiveX 控件 。 为了 提高 客户端 注册 的 简便性 ， 减少 客户端 的 配置 工作 ， 可以 编辑 一个 批处理 文件 来 完成 所有 的 注册 工作 。 假定 ， 某 Web 应用 系统 中 用到 了 个 ActiveX 控件 Controlocx 、 Controlocx ， 则 批处理 文件 RegCtlsbat 内容 如下 ： 　 　 Regsvr ／ s ＼ ＼ Server ＼ Controls ＼ Controlocx 　 　 Regsvr ／ s ＼ ＼ Server ＼ Controls ＼ Controlocx 　 　 注 ： ／ s 参数 用于 指定 注册 过程 中不弹 出 消息 框 。 　 　 接下来 ， 只要 在 每个 客户端 运行 RegCtlsbat 文件 即可 完成 客户端 所 需 的 所有 配置 。 ActiveX 控件 的 应用 启示 　 　 在 IntranetWeb 应用 中 ， 使 ActiveX 控件 完全 运行 在 服务器端 ， 有着 很多 的 优越性 ， 主要 包括 ： 　 　 当 控件 的 运行 需要 取 服务器端 动态 的 资源 文件 时 ， 程序 在 设计 中 可以 以 相对路径 的 形式 对 资源 进行 访问 ， 这样 在 很大 程度 上 提高 了 程序 的 可移植性 。 　 　 控件 中 对 数据库 的 连接 、 访问 都 在 本地 进行 ， 避免 了 网络 线路 速度 的 影响 ， 加快 了 Web 应用程序 的 信息反馈 。 　 　 由于 应用程序 的 主要 工作 在 服务器端 ， 所以 对 客户端 设备 的 性能 要求 不高 ， 这 在 很大 程度 上 节省 了 设备 的 投资 。 　 　 当 开发 一个 全新 的 Web 应用 管理系统 时 ， ActiveX 技术 与 ASP 脚本 以及 其它 Web 开发技术 可以 融合 在 一起 实现 。 而 当 需要 把 一个 用 VisualBasic 或 Delphi 语言 制作 的 庞大 的 传统 MIS 系统 转 到 基于 Web 的 B ／ S 环境 下时 ， ActiveX 控件 技术 则 显示 出 了 前所未有 的 优越性 。 通过 改造 该 MIS 系统 的 源程序 ， 把 各个 相关 模块 制作 成 相应 的 ActiveX 控件 ， 再 根据 需要 制作 一些 各个 模块 之间 连接 的 主页 ， 则 可以 在 非常 短 的 时间段 内 制作 出该 传统 MIS 系统 的 Intranet 版本 。 　 　 本文 所述 ActiveX 控件 的 这种 妙用 已经 在 实际 的 工程项目 中 得到 了 应用 ， 并 解决 了 IntranetWeb 应用 程序开发 中 诸如 报表 绘制 、 打印 支持 等 的 很多 难题 。 方澍华 （ 北京航空航天大学 机械工程 及 自动化 学院 ） 杨宗煦 （ 北京航空航天大学 机械工程 及 自动化 学院 ） 参考文献 ， DesboroughJ ． IntranetWeb 开发 指南 ． 北京 ： 清华大学出版社 ， ， SchmullerJ ． ActiveX 轻松 进阶 ． 北京 ： 电子 工业 出版社 ， 收稿 日期 ： － －