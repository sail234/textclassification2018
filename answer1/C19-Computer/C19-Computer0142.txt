计算机 应用 COMPUTERAPPLICATIONS 年 第卷 第期 VolNoWizcon 组态 软件 报表 功能 的 改进 王宏刚 　 徐玉斌 　 曾建潮 　 　 摘 　 要 　 Wizcon 组态 软件 是 目前 应用 比较 广泛 的 一种 SCADA 软件 ， 但是 它 的 报表 外观 不能 人为 地 进行 控制 。 本文 提出 一种 利用 MicrosoftExcel 对 Wizcon 组态 软件 进行 集成 的 方法 。 这种 方法 已 在 实际 工程 系统 中 得到 验证 。 　 　 关键词 　 Wizcon 组态 软件 ， MicrosoftExcel ， 报表 生成器 ， 系统集成 　 Wizcon 的 报表 生成器 　 　 Wizcon 是 基于 位 结构 、 事件驱动 、 多任务 、 多线程 技术 基础 上 开发 的 组态 软件 ， 因此 ， Wizcon 可 在 Windows 和 WindowsNT 环境 下 运行 。 目前 ， Wizcon 组态 软件 已 被 公认 为 是 世界 上 最 先进 的 SCADA 应用 开发 软件工具 之一 。 Wizcon 已有 种 以上 文字 ， 并 已 在 全世界 范围 的 多个 场 、 站 安装 使用 ， 用户 许可证 已 多达 多套 。 有关 Wizcon 的 具体 介绍 参见 ［ ］ 。 　 　 Wizcon 的 报表 生成器 使 用户 能 利用 历史数据 进入 深入分析 并且 易于 使用 。 利用 Wizcon 报表 生成器 可以 生成 用户 要求 的 各种 数据 ， 并且 可以 按照 用户 的 要求 制作 日报表 、 周 报表 、 月 报表 等 各种类型 的 报表 。 在 Wizcon 报表 生成器 生成 的 报表 中 ， 数据 可以 有 如下 类型 ： 　 　 ⑴ 日期 时间 类型 ： 可以 在 报表 中 的 任何 部分 显示 日期 时间 ； 　 　 ⑵ 当前 值 ： 可以 在 报表 中 的 任何 部分 显示 控点 的 当前 值 ； 　 　 ⑶ 最大 小值 ： 可以 在 报表 中 的 任何 部分 显示 控点 在 某一时间 段 内 的 最大 小值 ； 　 　 ⑷ 平均值 ： 可以 在 报表 中 的 任何 部分 显示 控点 在 某一时间 段 内 的 平均值 ； 　 　 ⑸ 积分 值 ： 可以 在 报表 中 的 任何 部分 显示 控点 在 某一时间 段 内 的 积分 值 ； 　 　 ⑹ 加权 平均值 ： 可以 在 报表 中 的 任何 部分 显示 控点 在 某一时间 段 内 的 对 时间 的 加权 平均值 ； 　 　 ⑺ 范围 总 时间 ： 可以 统计 控点 处于 某个 范围 内 的 时间 总和 ； 　 　 ⑻ 范围 总 计数 ： 可以 统计 控点 在 某一时间 段 内 处于 特定 范围 内 的 次数 ； 　 　 ⑼ 记录 No （ 时间 ） ： 可以 统计 控点 等于 特定 值时 的 第 n 次 记录 的 时间 ； 　 　 ⑽ 记录 No （ 值 ） ： 可以 统计 控点 在 某一时间 段 内 的 第 n 次 记录 的 值 ； 　 　 ⑾ 最后 值 ： 统计 控点 在 某一时间 段 内 的 最后 一个 值 ； 　 　 ⑿ 求和 ： 统计 控点 在 某一时间 段 内 所有 值 的 和 ； 　 　 ⒀ 第 n 次 记录 的 时间 ： 统计 控点 等于 某一 特定 值 的 第 n 次 记录 的 时间 ； 　 　 ⒁ 字符串 类型 ： 显示 类型 为 字符串 的 控点 的 值 。 　 　 利用 以上 报表 生成器 所 提供 的 功能 ， 系统 就 可以 打印 出 满足用户要求 的 数据 。 但是 ， 报表 生成器 有 一个 缺点 ： 报表 的 外观 不能 人为 控制 ， 例如 报表 的 标题 字体 的 选择 、 字体大小 的 选择 、 插入 页码 等等 。 　 集成 的 原理 　 　 报表 生成器 可以 生成 满足用户要求 的 数据 ， 但是 满足 不了 用户 对 报表 中 字体 的 要求 ； MicrosotExcel 电子表格 可以 生成 满足用户 对 报表 中 字体 的 要求 ， 但是 用 Excel 产生 报表 中 的 数据 的 任务 却是 艰巨 的 （ 开发者 要 进行 有关 数据库 方面 的 编程 ） 。 如果 两者 互相 取长补短 ， 则 可 解决 用户 的 要求 。 　 　 Wizcon 所 支持 的 DDE 功能 和 MicrosoftExcel 所 提供 的 DDE 功能 使得 二者 集成 之间 的 桥梁 。 　 　 DDE 是 不同 应用程序 之间 进行 通讯 的 一种 协议 ， 如下 图 所示 。 DDE 的 服务器端 在 接受 到 DDE 客户端 的 数据 请求 以后 ， 按照 DDE 的 地址 将 数据 发送给 客户端 。 图 　 DD E通 讯 示意图 　 　 利用 DDE 不但 可以 在 不同 应用程序 之间 进行 数据通讯 ， 还 可以 进行 命令 通讯 。 例如 ， 服务器端 可以 通知 客户端 执行 某条 命令 。 　 　 报表 生成器 可以 实现 满足用户要求 的 数据 ， 而 Excel 可以 实现 满足用户要求 的 报表 外观 。 在 集成 时 ， 可 将 Wizcon 作为 DDE 的 服务器端 、 Excel 作为 DDE 的 客户端 。 在 定点 打印 或者 用户 要求 打印 时 ， Wizcon 可 通过 DDE 向 Excel 发送打印 命令 ， Excel 接收 到 命令 后 立即 执行 自己 的 打印 操作 。 这样 可 使 用户 感觉 不到 Excel 的 存在 。 　 　 有关 如何 将 报表 生成器 生成 的 数据 转移 到 Excel 的 表格 中 ， 可以 利用 Excel 提供 的 超级链接 的 功能 。 首先 将 报表 生成器 生成 的 数据 存放 在 文件 中 （ 在 该 文件 中 ， 数据 之间 以 逗号 作为 分隔符 ， 文件 扩展 名为 CSV ） ， 在 Excel 中 同时 表格 文件 和 该 文件 后 ， 利用 Excel 提供 的 超级链接 功能 将 该 文件 的 数据链 接到 表格 文件 中 。 　 集成 的 实现 　 　 根据上述 的 集成 原理 ， Wizcon 和 Excel 的 集成 可 按 下述 步骤 实现 。 　 　 在 Wizcon 的 “ 设计 ” 菜单 中 单击 “ 应用 设定 ” ， 添加 运行 “ wizddesexe ” 和 “ Excelexe ” 两个 应用程序 。 wizddesexe 程序 由 Wizcon 提供 ， 主要 作用 为 在 Wizcon 组态 软件 和 其它 应用程序 之间 建立 连接 。 其中 ， Wizcon 为 客户端 、 其它 应用程序 为 服务器端 （ 在 此 为 Excel ） 。 　 　 在 Excel 电子表格 中 ， 进入 VBA 的 设计模式 。 在 工作 表中 放置 WizproClient 控件 （ Wizcon 提供 ） ， 并 在 WizproClient 控件 的 SignalShut 事件 中 填写 代码 ： 　 　 ′ 添加 下列 代码 确保 Wizcon 退出 时 退出 ExcelPrivatesubWizproClient — SignalShutApplicationquitEndsub ′ 下列 代码 关闭 Excel 与 用户 的 交互 功能 PrivateSubWorkbook — OpenApplicationActiveWorkbookSavedTrueEndSub 　 　 上面 代码 的 作用 是 确保 Wizcon 退出 后 Excel 也 退出 。 　 　 用 Wizcon 报表 生成器 制作 Wizcon 报表 ， 假设 报表 名为 wizrep 。 利用 Wizcon 语言 将 报表 打印 到 文件 exccsv ， 并 将 exccvs 中 的 数据链 接到 制作 的 表格 中 ， 假设 报表 表格 的 名为 reportxls 。 　 　 在 Wizcon 中 定义 如下 宏 ： 　 　 宏名 ： LD — CSV ， 内容 ： EXCELSYSTEM ［ openexccsv ］ 　 　 宏名 ： LD — XLS ， 内容 ： EXCELSYSTEM ［ openreportxls ］ 　 　 宏名 ： CLS ， 内容 ： EXCELSYSTEM ［ close ］ 　 　 宏名 ： PRINT ， 内容 ： EXCELSYSTEM ［ print ］ 　 　 宏名 ： REPORT ， 内容 ： 包括 上述 四个 宏 ， 顺序 为 LD — CSV 、 LD — XLS 、 PRINT 、 CLS 、 CLS 。 　 　 其中 前 四个 宏是 Wizcon 中 类型 为 DDE 的 宏 。 第一个 宏 和 第二个 宏 的 作用 是 在 EXCEL 中 打开 文件 exccsv 和 工作 簿 reportxls ； 第三个 宏 的 作用 是 关闭 EXCEL 中 的 活动 的 工作 簿 ； 第四个 宏 的 作用 是 打印 EXCEL 中 的 活动 的 工作 表 ； 第五个 宏是 Wizcon 中 类型 为 Program 的 宏 ， 其 作用 是 将 前 四个 宏 组合 在 一起 。 　 　 编写 Wizcon 语言 　 　 定义 如下 Wizcon 语言 ： 　 　 iftimethenBEGINreportwizrepexccsvflagifflagthenmacroreportEND 　 　 在 完成 上述 步骤 后 ， 系统 即可 在 每天 早上 ： 整 定时 打印 报表 且 报表 的 格式 完全 能够 满足用户 的 需求 。 　 　 该 方法 具有 简单 、 实用 等 特点 ， 已经 在 北方 某 油田 供水 公司 深井 计算机 监控 系统 中 加以 应用 ， 取得 了 令 用户 满意 的 效果 。 作者简介 ： 王宏刚 　 硕士 ， 讲师 。 研究 方向 为 遗传算法 、 离散 事件 动态 系统 仿真 、 工业 过程 控制 。 徐玉斌 　 硕士 ， 副教授 。 现 主要 从事 智能 控制 、 系统 仿真 与 计算机 应用 方面 的 研究 。 曾建潮 　 博士 ， 教授 。 现 研究 方向 为 混合 动态 系统 的 建模 、 控制 、 优化 与 仿真 ， 计算机 集成 控制 与 管理系统 。 作者 单位 ： 太原 重型机械 学院 系统 仿真 与 计算机 应用 研究所 　 山西太原 （ ） 参考文献 ［ ］ 　 王宏刚 ， 徐玉斌 ， 曾建潮 Wizcon 工业 监控 软件 及 应用 年 全国 （ 第四届 ） 工业 控制系统 应用 学术会议 论文集 北京 ： 工业 出版社 ， 收稿 日期 修改稿