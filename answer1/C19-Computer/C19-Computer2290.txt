计算机 应用 研究 APPLICATIONRESEARCHOFCOMPUTERS 　 Vol 　 No 　 PCGI 技术 对 因特网 上 铁路 货运 运价 查询 的 应用 周乐 　 江南 摘要 简要 介绍 CGI 通用 网关 接口 原理 ， 对 如何 应用 CGI 技术 实现 因特网 上 铁路 货运 运价 查询 作 了 详尽 的 分析 ， 并 提出 了 实现 方案 。 关键词 InternetCGI 货运 运价 查询 　 　 随着 Internet 国际互联网络 在 我国 的 飞速发展 ， 充分利用 Internet 扩大 铁路 货运 影响力 ， 开拓 货运 市场 ， 是 铁路 货运业 在 激烈 的 市场竞争 中 切实可行 的 一种 货运 营销 手段 。 笔者 通过 使用 CGICommonGatewayInterface ， 通用 网关 接口技术 ， 实现 了 因特网 上 铁路 货运 运价 的 Web 动态 查询 ， 以下 对此 作 简要 介绍 。 CGICommonGatewayInterface 简介 　 　 在 互联网 上 ， Web 用户 WebClient 和 发布 Web 的 服务器 WebServer 通过 HTTP 协议 建立联系 。 Web 用户 向 服务器发送 一个 包含 URL 题头 字段 和 其它 用户 数据 的 HTTP 请求 ， 而 服务器 则 返回 包含 请求 内容 的 HTTP 应答 。 　 　 当 Web 用户 请求 一个 驻留 在 服务器 上 的 外部 程序 服务 时 ， Web 服务器 就 成为 连接 Web 用户 和 服务器 上 应用程序 之间 的 一个 “ 桥 ” GATEWAY 。 它 将 客户机 的 HTTP 请求 信息 传送 到 应用程序 当中 ， 然后 又 将 应用程序 的 应答 发送给 请求 的 Web 用户 。 CGICommonGatewayInterface ， 通用 网关 接口 就是 定义 Web 服务器 怎样 同 服务器 上 外部 程序 CGI 程序 进行 通讯 的 接口 见图 。 图 　 　 CGI 程序设计 可以 使用 诸如 CC 、 VisualBasic 等 流行 编程语言 。 除 程序设计 的 输入输出 部分 以外 ， CGI 程序 的 设计 与 一般 程序设计 并 无 不同 ， 因此 采用 CGI 是 实现 互联网 用户 与 Web 服务器 信息 交互 的 一种 快速 简洁 的 方案 。 铁路 货运 运价 网上 查询 系统 设计 系统 功能 　 　 通过 CGI 实现 Internet 用户 以 WWW 方式 查询 铁路 货运 运价 信息 的 功能 。 系统结构 　 　 网络 客户 通过 浏览器 提交 托运 信息 表单 ， 经 系统 输入 模块 处理 ， 计算 运价 及 经由 等 信息 ， 通过 输出模块 处理 ， 反馈 给 用户 见图 。 图 系统 环境 与 开发工具 　 　 服务器端 环境 ： WindowsNT 操作系统 ， WebSite 服务器 　 　 客户端 环境 ： Windows 操作系统 ， Web 浏览器 　 　 系统 开发工具 ： WindowsNT 操作系统 ， VisualC ， FrontPage ， WebSite 服务器 系统 输入 与 输出模块 　 　 如前所述 ， CGI 程序设计 与 一般 应用 程序设计 最大 的 不同 就 在于 CGI 程序 的 输入输出 部分 。 Web 服务器 与 CGI 程序 交换 数据 信息 的 方式 有 两种 ： 一种 通过 标准 输入输出 流 STDINSTDOUT 完成 ， 称为 标准 CGI ； 另 一种 方式 则 通过 profile 文件 Windows 的 ini 文件 完成 ， 称为 WINCGI 。 笔者 采用 标准 CGI 接口 ， 以 C语言 作为 CGI 程序设计 语言 。 因此 ， 程序 输入输出 部分 的 设计 重点 就 在于 读取 和 拆解 STDIN 信息 ， 以及 对 STDOUT 的 信息 发送 。 数据 输入 　 　 ． 客户端 设计 　 　 在 Web 页 上 使用 HTML 文本框 、 单选框 、 复选框 等 控件 输入 用户 信息 ， 使用 表单 form 提交 信息 ， 以 客户 输入 到 发站 信息 为例 ： formmethodPOSTactionURLCGI 程序 名 p 发站 inputtypetextnamestaSourcesizepp 到 站 inputtypetextnamestaDestsizeppinputtypesubmitvalue 确定 nameok 　 inputtyperesetvalue 取消 namecancelpform 　 　 注 ： CGI 程序 应 放置 在 服务器 指定 目录 下 ， 并 在 action 中 指定 相应 的 URL 。 本例 WebSite 服务器 设置 标准 CGI 程序 目录 为 CWebSiteCgidos 目录 下 ， URL 地址 为 HTTP 域名 或 IP地址 Cgidos 。 　 　 ． STDIN 信息 分析 　 　 用户 提交 信息 后 ， 服务器 将 信息 放置 在 STDIN 中 。 其 格式 为 以 字符 “ amp ” 分隔 的 namevalue 对 字符串 。 其中 name 为 Web 页 上 的 控件 名 ， value 为 用户 在 该 控件 中 输入 的 信息 如 用户 在 staSource 文本框 中 输入 广州 北 ， 则 相应 的 namevalue 对 为 “ staSource 广州 北 ” 。 需要 注意 的 是 ， 用户 输入 的 空格 被 转换 为 “ ” ； 非 ASCII 字符 以内 的 字符 如 汉字 被 转换 为 特殊字符 ， 需要 转为 进制 码 显示 。 　 　 ． 数据结构 typedefstruct 　 　 charname 　 　 charvalueinputinputinCGIi 　 　 name 存放 项目 名 ， 如 staSource ； 　 　 value 存放 用户 数据 ， 如 “ 广州 北 ” 。 　 　 ． 程序流程 　 　 从 流程图 可以 看出 ， 程序设计 的 关键在于 将 STDIN 字符串 读入 数组 inCGINUM 中 。 其 程序代码 如下 ： 读入 SDTIN 信息 ， 返回 namevalue 对 个数 intreadinputinCGIMAX 从 环境变量 CONTENTLENGTH 读取 STDIN 字符串 长度 lenatoigetenv ＂ CONTENTLENGTH ＂ forilenfeofstdini 　 　 inCGIivaluereadstdin ＇ ＇ lenreturni 以 “ ” 分割 STDIN 字符串 charreadstdincharstopintlen 　 　 whileTRUE 　 　 　 　 wordxgetchar 　 　 len 　 　 ifwordxstopfeofstdinlen 　 　 　 　 Ifwordxstopx 　 　 wordx 　 　 returnword 　 　 　 　 x 　 　 数据 输出 　 　 CGI 程序 向 STDOUT 输出 数据 ， 必须 遵循 HTTP 应答 格式 。 Web 服务器 检查 CGI 程序 输出 文件 第一行 ， 以 确定 输出 文件 MIME 类型 ， 然后 依次 向 客户端 发送信息 。 因此 CGI 程序 的 输出 通常 包括 两 部分 ： 头 header 和体 body ， 头和体 之间 用 一个 空行 隔开 。 　 　 以 发送 最短 路径 信息 为例 ： headerprintf ＂ ContentType ： texthtmlnn ＂ bodyprintf ＂ htmlheadtitle 运价 里程 及 经由 titlehead ＂ printf ＂ 发站 snpp ＂ szSourceprintf ＂ 到 站 snpp ＂ szDestprintf ＂ 里程 dnpp ＂ distprintf ＂ 路径 ＂ printf ＂ bodyhtml ＂ 结论 　 　 综上所述 ， 通过 CGI 来 实现 互联网 上 铁路 货运 运价 信息 的 Web 动态 发布 是 一种 简单易行 的 方案 。 但 CGI 也 有 明显 的 不足之处 ， 每 一个 Web 用户 向 服务器 发出请求 ， 服务器 总是 为 其 单独 开启 一个 进程 ， 因此 ， 当 访问 的 用户 过多时 ， 系统资源 被 大量 占用 ， 服务器 反应 将 明显 变慢 ， 影响 了 信息反馈 的 速度 。 　 　 因此 ， 从 长远 的 角度 来看 ， 要 实现 整个 铁路 货运 业务 的 网上 办理 ， 单靠 CGI 技术 仍 不能 完全 胜任 。 此时 可以 采用 其它 的 解决办法 ， 如 ： JAVA 、 ASP 、 ISAPI 等 ， 在 此 方向 可 作 进一步 的 开发 。 周乐 长沙 铁道 学院 经管院 长沙 江南 长沙 铁道 学院 经管院 长沙 参考文献 ， 蔡玉奇 等 CGI 编程 指南 北京 ： 机械 工业 出版社 ， ， GunnitSKhurana 等 Web 数据库 的 建立 与 管理 北京 ： 机械 工业 出版社 ， 收稿 日期 ：