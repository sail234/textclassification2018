软件 学报 JOURNALOFSOFTWARE 年 第卷 第期 VolNo 三阶 Bzier 曲线 的 三类 节点 缩减 算子 曹锋 张克君 摘 　 要 　 研究 曲线拟合 和 编辑 中 的 分段 Bzier 曲线 的 简化 问题 定义 了 类 Bzier 曲线 的 节点 缩减 算子 以及 基于 其上 的 算法 实现 了 分段 曲线 的 最简 B é zier 表示 并 给出 严格 的 数学 证明 上述 方法 已 被 应用 到 所 开发 的 软件 中 关键词 　 Bzier 曲线 曲线 延展 节点 缩减 算子 最简 B é zier 表示 中图法 分类号 　 TPThreeKindsofNodereduceOperatoronrdOrderBzierCurveCAOFengZHANGKejunNationalKeyLaboratoryofTextProcessingInstituteofComputerScienceandTechnologyBeijingUniversityBeijingAbstract 　 ThesimplificationofBziercurvesinfittingandeditingisdiscussedthreekindsofnodereduceoperatorsaredefinedandthealgorithmsbasedonthemaregiveninthispaperThesimplestBzierexpressioncanbegottenthroughthealgorithmsandastrictproofisgivenThesealgorithmshavebeenalreadyusedinthedevelopingsoftwareKeywords 　 BziercurveextensionofcurvesnodenodereduceoperatorsimplestB é zierexpression 　 　 随着 计算机辅助 图形 设计 的 迅速 发展 人们 经常 需要 将 大量 的 图像 数据 转化 为 图形 数据 以便 于 修改 与 操作 字模 图像 经 扫描 后 转成 TrueType 字形 广告设计 中 草稿 的 图形化 处理 等 就是 应用 的 实例 图形化 处理 中 最 关键 的 技术 就是 曲线 追踪 与 最佳 拟合 就 面向 出版 方面 的 应用 来说 由于 目前 国际 出版界 的 标准 PostScript 支持 三次 B é zier 曲线 经常 需要 利用 三次 B é zier 曲线 来 拟合 所 获得 的 图像 数据 因此 怎样 用 尽量少 的 点 尽量 精确 地 拟合 就 成 了 核心 问题 在 一般 的 图形 设计 与 编辑 中 也 大多 利用 三次 B é zier 曲线 来 表示 如果 所用 的 B é zier 曲线 有太多 的 控制点 将会 有 极大 的 不便 本文 给出 了 类 B é zier 曲线 节点 缩减 算子 高效 地 实现 了 B é zier 曲线 的 简化 在 方正 底纹 辅助设计 系统 中 我们 应用 了 这些 技术 取得 了 比 国外同类 软件 更好 的 效果 一些 概念 与 记号 　 　 我们 将要 研究 的 是 平面 上 的 三次 B é zier 曲线 段 对于 更高次 的 B é zier 曲线 可 将 其 转化 为 三次 B é zier 曲线 段 ［ ］ 关于 B é zier 曲线 的 一般 性质 可 参阅 文献 ［ ］ 它 可以 用个 点 加以 表示 我们 以 pppp 来 标记 其中 p 为 起始 点 p 为 终止 点 pp 为 控制点 pp 又 称为 节点 它 的 参数 方程 为 Cttpttpttptp ≤ t ≤ ， 从而 集合 B ｛ bpppp ｜ pppp ∈ R ｝ 表示 了 平面 上 所有 的 三次 B é zier 曲线 段 　 　 为了 方便 论述 在 本文 的 某些 地方 采用 了 C语言 的 记号 “ ． ” 来 表示 B é zier 曲线 段 中 的 节点 例如 如果 b 为 B é zier 曲线 段 即 b ∈ B 则 b ． p 表示 b 的 初始 点 b ． p 表示 b 的 第个 控制点 其余 类推 另外 对于 B é zier 曲线 段 bpppp 在 不 引起 歧义 的 情况 下 为 简单 起 见 用来 表示 ； 在 可能 引起 歧义 的 情况 下 用来 表示 　 　 集合 Bk ｛ bkbbbk ｜ bi ∈ Bik 且 bi ． pbi ． pik ｝ 称为 k 段 连续 B é zier 曲线 为 平面 上 所有 分段 B é zier 曲线 的 集合 本文 的 论述 都 排除 B é zier 曲线 的 退化 情形 即个 控制 节点 共线 的 情况 　 　 定义 B é zier 曲线 段 的 延展 如果 bb ∈ B 且 b 为 b 的 一部分 则 称 b 为 b 的 延展 如果 还 满足 　 　 （ ） b ． pb ． p 即 bb 有 共同 的 始点 则 称 b 为 b 的 正 向延展 　 　 （ ） b ． pb ． p 即 bb 有 共同 的 终点 则 称 b 为 b 的 负 向延展 数学 基础 　 　 定理 延展 基本 定理 　 　 若 bb ∈ B 则 b 为 b 的 正 向延展 的 充分 必要条件 为 存在 k ∈ （ ］ 使得 （ 这里 我们 记 bppppbp ′ p ′ p ′ p ′ ） 　 　 p ′ p 　 　 p ′ p ′ pp 　 　 p ′ p ′ p ′ ppp 　 　 p ′ p ′ p ′ p ′ pppp 　 　 证明 （ ） 充分条件 如果 bb 的 控制 节点 满足 上述 个 条件 则 对于 b 上 的 每 一个点 ttCbttpttpttptp 我们 均 能 找到 b 上 的 点 参数 tkt 与 之 对应 Cbktktp ′ ktktp ′ ktktp ′ ktp ′ 容易 验证 CbktCbt 故 B é zier 曲线 段 b 为 b 的 一部分 且 条件 满足 故 b 为 b 的 正 向延展 　 　 （ ） 必要条件 按照 定义 如果 b 为 b 的 正 向延展 即 为 曲线 段 的 一部分 设 b 的 终止 点 p 在 B é zier 曲线 段 b 上 的 参数 为 k 则 可得 b 的 参数 方程 为 Cbktp ′ ktktp ′ ktktp ′ ktp ′ tpttpttptp 比较 ttt 的 系数 和 常数 即 可知 条件 ～ 成立 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 □ 　 　 定义 如果 b 为 b 的 正 向延展 且 定理 中 的 k 值为 t 则 称 b 为 b 的 t 正 向延展 　 　 为了 表述 方便 我们 定义 从 B é zier 曲线 段 B 到 平面 的 个 算子 DDDD 设 bpppp ∈ B 如果 定义 　 　 Dbp 　 　 Dbpp 　 　 Dbppp 　 　 Dbpppp 那么 定理 可 简单 地 描述 为 bb ∈ B 则 b 为 b 的 正 延伸 的 充要条件 是 存在 k ∈ （ ］ 使得 DbDbDbDbDbDbDbDb 　 　 命题 若 bkbkb ∈ B 且 bk 为 b 的 k 正 向延展 bk 为 b 的 k 正 向延展 且 k ＞ k 则 bk 为 bk 的 kk 正 向延展 （ 由 定理 易证 ） 　 　 命题 表明 B é zier 曲线 段 的 延展 方向 是 唯一 的 不会 出现 如图所示 的 现象 图 　 　 定义 曲线 段 （ 其中 bk 为 B é zier 曲线 段 b 的 k 正 向延展 ） 称为 b 的 完全 正 向延展 曲线 　 　 推论 b 上 的 任一 有限 连续 曲线 段 均 为 三次 B é zier 曲线 　 　 对于 上面 的 任一 有限 连续 曲线 段 c 取 足够 小 的 k 使得 cbk 由于 bk 为 三次 B é zier 曲线 故 c 亦 为 B é zier 曲线 　 　 定义 若 bb ∈ B 且 均 为 平面 上 某 一 完全 正 向延展 曲线 的 一部分 则 称 bb 为 同胞 同胞 关系 为 等价关系 由 定义 可知 同胞 关系 满足 反身 性 和 对称性 下面 验证 同胞 关系 的 传递性 　 　 命题 同胞 关系 为 等价关系 　 　 下面 只 需 证明 同胞 关系 满足 递推 性 即可 假设 bb 为 同胞 bb 为 同胞 由 同胞 关系 的 定义 bb 均 在 一 完全 正 向延展 曲线 （ 设为 C ） 上 显然 从 b 起点 （ 或 终点 ） 开始 的 C 正向 部分 即为 b （ 如图所示 ） 同理 从 b 的 起点 （ 或 终点 ） 开始 的 C 那 部分 曲线 即为 b 由于 bb 均 为 C 的 一部分 且 bb 均 沿 C 无限 延伸 故 我们 有 bb 或 bb 对于 bb 我们 也 有 同样 结果 即 bb 或 bb 从而 总共 可能 有 下列 种 情形 图 　 　 （ ） bbbb 则 bbbbb 从而 bb 均 为 b 中 的 一部分 bb 为 同胞 　 　 （ ） bbbb 则 bb 同 （ ） 我们 有 bb 为 同胞 　 　 （ ） bbbb 则 bb 均 为 b 的 一部分 从而 bb 均 为 b 的 一部分 bb 为 同胞 　 　 （ ） bbbb 如果 bb 或 bb 则 bb 为 同胞 下面 证明 必然 有 bb 或 bb 假设 bb 且 bb 由于 b 为 b 与 b 的 共同 部分 则 记 bbpppp 记 b 的 起点 为 pb 记 b 的 起点 为 pb 如图所示 图 　 　 由此可知 为 的 正 向延展 亦 为 的 正 向延展 由 命题 可知 或者 为 的 延展 或者 ppb 为 的 延展 与 所 假设 的 bb 且 bb 矛盾 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 □ 第类 节点 缩减 算子 及 算法 第类 节点 缩减 算子 N （ 精确 节点 缩减 算子 ） 　 　 我们 定义 B 上 的 第类 节点 缩减 算子 N 如下 对 B 上 的 分段 B é zier 曲线 （ bb ） 其中 bb ∈ B （ ） 如果 b ． pb ． pbb 为 同胞 且 b 与 b 在 点 b ． p 的 两侧 则 Nbb 其中 B é zier 曲线 段 ｖ 为 b 上 b ． p 至 b ． p 的 那 一部分 此时 称 （ bb ） 可 N 合并 （ ） 否则 N （ bb ） （ bb ） 基于 结点 缩减 算子 的 B é zier 曲线 段 简化 算法 　 　 对 属于 Bk 中 的 k 段 B é zier 曲线 （ bbbk ） 置 Result ∈ B 为空 变量 CurB 为 当前 B é zier 曲线 段 算法 描述 如下 　 　 （ ） 置 CurBbi 　 　 （ ） 如果 i ＞ k 转 　 　 （ ） 将 节点 缩减 算子 N 应用 到 （ CurBbi ） 上 　 　 （ a ） 如果 N （ CurBbi ） （ CurBbi ） 则 将 B é zier 曲线 段 CurB 添加 至 Result 中 并 置 CurBbii 转至 （ ） 　 　 （ b ） 否则 N （ CurBbi ） 可约 减为 B é zier 曲线 段 b 则 置 CurBbi 转 （ ） 　 　 （ ） 结束 （ bbbk ） 的 约简 结果 存储 于 Result 中 　 　 定理 对 任意 b ∈ Bk 经过 上述 算法 简化 后 的 分段 B é zier 曲线 的 节点 数 最少 　 　 证明 （ 反证法 ） 设 Result （ bbbn ） 为 上述 算法 所得 结果 如果 存在 另 一种 分段 B é zier 曲线 表示 （ b ′ b ′ b ′ k ） 其段 数 k ＜ n 　 　 由于 Result （ bbbn ） 为 上述 算法 的 结果 bibi 不 可能 成为 某一 B é zier 曲线 的 相邻 两段 否则 将会 被 算法 第 （ ） 步所 合并 　 　 由于 k ＜ n 则 至少 有 一段 B é zier 曲线 b ′ ii ≤ k 跨越 了 Result 中 的 节点 bj 的 终点 如图所示 我们 有 与 bj 为 同胞 为 b ′ i 的 同胞 （ b ′ i 为 的 延展 ） b ′ i 与 为 同胞 与 bj 为 同胞 图 　 　 从而 由 同胞 关系 的 递推 性 可知 bj 与 bj 为 同胞 且 bjbj 在 节点 bj ． p 的 两侧 故 （ bjbj ） 可 被 节点 缩减 算子 约简 与 Result （ bbn ） 为 算法 N 的 结果 相 矛盾 　 　 由 定理 对 任意 分段 B é zier 曲线 我们 可以 利用 算法 求得 最简 的 分段 表示 B 上 的 N 算子 的 具体 实现 　 　 对 B 上 的 曲线 段 （ bb ） 设 bppppbpppp 如果 bb 可以 N 合并 则 由 定义 p ∈ b 为 的 正 向延展 　 　 设为 的 k 正 向延展 则 由 定理 可知 k 满足 ppppkpppkppkpp 取 方程 的 x 方向 投影 由卡当 公式 可 求得 k 验证 上式 的 y 方向 投影 若 不 满足 方程 则 （ bb ） 不可 N 合并 即 N （ bb ） （ bb ） 若 满足 方程 则 表示 p 在 的 完全 正 向延展 线 b 上 求得 b 上 B é zier 曲线 段 的 控制点 p ′ p ′ 　 　 如果 pp ′ pp ′ 则 N （ bb ） 否则 N （ bb ） （ bb ） 至此 我们 完整 地 给出 了 B é zier 曲线 的 最优 简化 算法 第 、 类 节点 缩减 算子 　 　 在 实际 应用 中 节点 缩减 算子 N 有着 很大 的 局限性 我们 需要 引入 带 误差 的 节点 缩减 算子 第类 节点 缩减 算子 N δ 　 　 对 给定 误差 δ ＞ 对于 （ bb ） ∈ B 设 bppppbpppp 由 三次 方程 求出 k 值 ［ ppppkpppkppkpp ］ x 若 k 值 之一 满足 ‖ ppppkpppkppkpp ‖ ＜ δ 其中 ‖ p ‖ 表示 点 p 到 原点 的 距离 且 设 b 的 k 正 向延展 为 b 终点 为 p ′ 曲线 b 的 部分 设为 b 的 控制点 为 p ′ p ′ 如果 ‖ pp ′ ‖ ＜ δ ‖ pp ′ ‖ ＜ δ 则 N δ （ bb ） b 否则 N δ （ bb ） （ bb ） 　 　 第 类算子 N δ 可说是 N 的 实际 应用 中 的 变体 在 实际 应用 中 特别 是 对 B é zier 曲线 的 交互 编辑 中 还 需要 保证 在 曲线 光滑 的 情况 下 强行 缩减 节点 对于 此类 要求 我们 给出 了 第类 节点 缩减 算子 第类 节点 缩减 算子 N 　 　 对于 （ bb ） ∈ B 我们 定义 算子 N 设 bbppppbbpppp 　 　 （ ） 若 存在 B é zier 曲线 段 b 且 起点 为 p 终点 为 p 且 与 （ bb ） 在 pp 处有 相同 的 单位 切矢 与 曲率 则 N （ bb ） b 　 　 （ ） 否则 N （ bb ） （ bb ） 　 　 下面 讨论 算子 N 的 具体 实现 　 　 记为 b 在 起点 p 的 曲率 为 b 在 终点 p 的 曲率 　 　 令 向量 若 存在 b ∈ B 使得 N （ bb ） b 则 设 b 的 两个 控制点 为 p ′ p ′ 由 N 定义 可 假设 由 曲率 相等 我们 有组 可 化为 一个 四次 方程 求解 若 存在 正 实根 L ≥ L ≥ 则 N （ bb ） b （ b 的 控制点 可由式 求得 ） 否则 N （ bb ） （ bb ） 　 　 将 N δ 或 N 替换算法 N 就 得到 了 基于 N δ 或 N 的 节点 缩减 算法 结论 　 　 针对实际 应用 中 对 分段 B é zier 化简 的 需要 我们 给出 了 类 B é zier 曲线 的 节点 缩减 算子 以及 基于 这 类算子 的 算法 对于 基于 N 算子 的 算法 我们 证明 了 经 它 化简 后 的 分段 B é zier 曲线 为 最 简 的 B é zier 曲线 表达 为 便于 实用 我们 给出 了 N 的 修正 算子 N δ 以及 强行 缩减 算子 N 在 实际 应用 中 取得 了 很 好 的 效果 　 　 作者 曹锋 年生 博士 主要 研究 领域 为 彩色 系统 图形图像 处理 张克君 年生 博士生 主要 研究 领域 为 多媒体系统 　 　 本文 通讯联系 人 曹锋 北京 北京大学 计算机 科学技术 研究所 作者 单位 ： 北京大学 计算机 科学技术 研究所 文字 信息处理 技术 国家 重点 实验室 　 北京 参考文献 ［ ］ EckMLeastsquaresdegreereductionofB é ziercurvesComputerAidedDesign ～ ［ ］ 唐荣锡 汪嘉业 彭 群生 计算机 图形学 教程 北京 科学出版社 TangRongxiWangJiayePengQunshengACourseonComputerGraphicsBeijingSciencePress ［ ］ 孙家 广杨长 贵 计算机 图形学 第版 北京 清华大学出版社 SunJiaguangYangChangguiComputerGraphicsndedBeijingTsinghuaUniversityPress （ 收稿 ）