微型机 与 应用 MICROCOMPUTERITSAPPLICATIONS 年 第卷 第期 VolNo 多国 语言 PDF 软件包 的 设计 — — Java 技术 在 电子商务 领域 的 应用 徐 　 鹏 　 柳 　 菁 　 王克宏 　 孟 　 杰 　 　 摘 　 要 ： 用 Java 语言 进行 PDF 软件包 的 设计 框架 及 实现 此 软件包 中 的 关键技术 ， 并 对此 软件 在 电子商务 领域 的 应用 前景 做 了 分析 。 　 　 关键词 ： 电子数据交换 　 Java 语言 　 PDF 文件 　 电子商务 　 　 多年 以来 ， 电子数据交换 EDIElectronicDataInterchange 在 工商业界 应用 中 不断 得到 发展 和 完善 ， 在 当前 电子商务 中 占据 重要 的 地位 。 EDI 旨在 实现 票据 传送 的 电子化 ， 所以 有人 称 EDI 为 无纸化 贸易 。 但 EDI 的 意义 不 在于 节约 纸张 ， 而 在于 其 快速 比如 从 邮寄 的 几天 变成 几分钟 甚至 实时 、 避免 重复劳动 不必 反复 打印 和 录入 票据 、 提高效率 、 降低成本 等 方面 。 　 　 PDF 可以 在 EDI 的 无纸化 贸易 中 充当 重要 的 角色 。 利用 Java 语言 编写出 实现 电子 票据 填写 功能 的 Applet 程序 ， 并 将 此 程序 嵌入 HTML 文件 中 ， 这样 用户 就 可以 通过 浏览器 访问 此 网页 并 填写 票据 。 当 填写 完成 后 ， 服务程序 将 调用 由 Java 语言 编写 的 PDF 软件包 ， 将 用户界面 中 的 内容 直接 转换成 PDF 格式 的 文件 ， 并 从 服务器 中将 生成 的 PDF 文件传送 到 客户端 。 由于 PDF 文档 能够 集成 多媒体信息 ， 可移植性 强 并 非常 便于 阅读 ， 因此 其 成为 最 流行 的 网络 文档 格式 。 目前 ， 国际 上 各大 企业 均 采用 PDF 格式 制作 文档 来 介绍 企业 及其 产品 ， 并 在 各自 的 网页 上 建立 了 与 这些 文档 的 链接 ， 供 全球 的 访问者 下载 。 而 利用 Java 语言 实现 PDF 软件包 有助于 程序员 在 网页 上 直接 生成 PDF 文件 ， 而 不必 再 通过 专用 的 PDF 工具 来 编写 PDF 文件 了 ， 这样 就 实现 了 种 PDF 文件 的 实时 编写 和 传送 过程 。 此 软件包 的 实现 将 在 电子商务 飞速发展 的 时代 发挥 重要 的 作用 ， 且 是 实现 EDI 的 核心 环节 。 本文 在 分析 PDF 文件 结构 的 基础 上 ， 提出 用 Java 语言 实现 PDF 软件包 的 设计 框架 ， 并 展望 此 软件包 的 应用 前景 。 　 PDF 文件 的 基本 结构 　 　 PDFPortableDocumentFormat ， 即可 移植 的 文档 格式 。 用户 可以 以 一种 简便 、 可靠 的 方式 来 浏览 PDF 格式 的 电子 文档 ， 同时 这种 文档 格式 还 独立 于 生成 它 的 应用软件 、 硬件 和 操作系统 ， 因此 这种 文档 具有 可移植性 。 PDF 文件 依靠 PostScript 语言 来 描述 文字 和 图形 。 为了 增强 浏览 的 交互性 ， PDF 还 定义 了 比 PostScript 程序 更 多 的 结构化 格式 。 PDF 文档 还 包含 了 很多 对象 ， 例如 注解 、 超文本 链接 等等 。 　 　 与 PostScript 语言 类似 ， PDF 文档 是 通过 一系列 对象 序列 来 构造 的 ， 而 构成 页面 内容 的 文本 、 图形 和 图像 是 使用 基于 PostScript 语言 中 的 一些 特定 操作符 来 描述 的 。 个 PDF 文档 包含 了 个 或 多个 页面 ， 而 每 一页 都 可以 包含 文档 、 图形 和 图像 。 　 　 一个 典型 的 PDF 文件 包含 个 部分 ， 分别 是 ： 文件 头 、 文件 主体 、 交叉 引用 表 和 文件 尾 ， 如下 所示 ： 　 　 PDFfileheaderbodycrossreferencetabletrailer 　 　 其中 PDF 文件 的 第行 就是 文件 头 Header 。 它 表明 了 当前 文件 所 使用 PDF 规范 的 版本 ， 我们 在 设计 PDF 软件包 过程 中 使用 的 是 版 的 规范 ， 因此 生成 的 PDF 文件 头部 应当 是 “ PDF ” 。 PDF 文件 的 主体 Body 中 应当 包括 构成 文件 间接 对象 的 个 序列 ， 这些 对象 代表 了 文档 中 的 各个 组件 ， 例如 字体 、 页 树 和 图像 等等 ， 文件 主体 的 结构 如图所示 。 而 在 交叉 引用 表 CrossReferenceTable 中 需要 给出 所有 当前 文件 使用 对象 的 入口 地址 ， 即 字节 偏移量 ， 这样 系统 就 可以 随机 访问 不同 的 对象 了 。 文件 尾 Trailer 中 包含 了 交叉 引用 表 的 起始 地址 和 其中 的 对象 总数 、 文档 中 Catalog 目录 对象 的 对象 号 等 信息 ， 这样 一个 读取 PDF 文件 的 应用程序 就 可以 通过 PDF 文件 的 文件 尾来 快速 地 找到 当前 文件 的 交叉 引用 表 和 特定 对象 了 。 图 PDF 文件 主体 的 结构 　 用 Java 实现 PDF 软件包 的 设计 框架 　 　 由于 PDF 文件 中 通过 特定 的 标识符 和 语法 来 描述 不同 的 对象 ， 并 通过 诸多 对象 来 组成 文件 ， 而 对象 之间 又 存在 调用 关系 ， 因此 对于 一般 用户 来说 掌握 PDF 语法 比较 困难 ， 同时 编写 各个 对象 也 是 非常 烦琐 的 事情 。 因此 ， 我们 利用 Java 语言 的 面向对象 特性 和 向量 、 图像处理 、 压缩 处理 等 功能 ， 实现 了 PDF 软件包 。 这样 ， 程序员 只 需要 调用 PDF 软件包 中 的 类 和 方法 ， 就 可以 直接 生成 PDF 对象 并 完成 相应 的 属性 设置 ， 同时 系统 还 可以 自动 将 所 生成 的 对象 按照 用户 指定 的 设置 组合成 个 PDF 文件 。 　 　 下面 ， 具体 阐述 在 PDF 软件包 中 实现 的 几种 主要 功能 。 　 具有 多种 字体 的 文字处理 　 　 首先 ， 需要 解决 的 一个 重要 的 问题 就是 如何 来 处理 文字 。 文字 是 PDF 文件 中 最 主要 的 内容 。 PDF 规范 要求 在 文件 中 不但 要 说明 文字 的 内容 ， 还要 描述 出 文字 的 字体 信息 。 我们 在 PDF 软件包 中 生成 了 个 Text 类 ， 主要 用于 处理 有关 文字 及其 字体 方面 的 内容 。 通过 调用 其中 的 setTextStringtext 、 setXYintxinty 、 setColorColorcolor 和 setRenderingintmode 等 方法 可以 直接 设置 文字 的 内容 、 坐标 、 颜色 以及 显示 模式 。 在 PDF 语法 中 并 没有 提供 用于 为 文字 添加 下划线 和 边框 的 标识符 ， 而 我们 在 这个 软件包 中 提供 了 相应 的 方法 setUnderLine 和 setcirRectangle ， 通过 绘制 直线 的 方式 来 形成 下划线 和 边框 。 在 方法 的 实现 过程 中 ， 利用 了 Java 语言 的 多态 特性 ， 系统 将 根据 用户 调用 这些 方法 时 使用 参数 的 不同 ， 来 决定 所 进行 的 操作 包括 设置 下划线 或 边框 的 颜色 、 坐标 、 长度 或者 使 系统 根据 当前 文字 的 宽度 对 相应 参数 进行 自动 设置 。 　 　 文字处理 的 难点 在 字体 的 实现 上 。 根据 PDF 规范 规定 ， 读取 PDF 文件 的 应用软件 例如 AcrobatReader 只能 是 种 Typel 类型 的 基本 英文 字体 ， 而 如果 要 在 PDF 文件 中 使用 其他 字体 ， 则 用户 必须 通过 使用 字体 描述符 对象 来 对 当前 字体 下 每个 字符 的 宽度 矩阵 进行 描述 并 定义 字符 代码 与 Unicode 编码 的 映射 关系 ， 系统 将 根据 这些 数据 来 勾画出 具体 字符 的 形状 。 然而 普通 的 用户 并不需要 了解 这些 内容 。 因此 ， 我们 在 PDF 软件包 中 生成 了 Fonts 类 ， 用户 只 需要 调用 方法 TextsetfontStringfontname ， 其中 作为 参数 的 fontname 可以 取值 为种 基本 的 英文 字体 的 名称 ， 也 可以 取值 为种 日 文字 体和种 中文字体 的 名称 日 文字 体 包括 gothic 、 msmintyo 等 ， 中文字体 包括 黑体 、 宋体 、 楷体 和 仿宋 等 ， 同时 还 可以 将 FontITALIC 和 FontBOLD 作为 方法 的 参数 使用 ， 来 设置 黑体 和 斜体字 。 如果 用户 使用 的 是非 基本 字体 ， 那么 PDF 软件包 将 根据 参数 fontname 的 取值 来 构造 FontDescriptor 和 DescendantFonts 对象 ， 并 调用 其中 的 方法 来 自动 构造 新 字体 的 矩阵 关系 。 同时 ， 我们 还 在 PDF 软件包 中 代表 PDF 文件 主体 的 Body 类 和 代表 每个 页面 的 Page 类中 运用 了 Java 语言 独创 的 Vector 向量 类型 的 变量 font ， 并 将 其 属性 设置 为 public 。 Java 语言 独创 的 类 Vector 实现 了 动态 可 扩充 数组 ， 在 使用 时 类似 普通 数组 ， 它 不但 能够 将 普通 类型 的 变量 作为 元素 进行 存储 ， 而且 可以 将个 对象 作为 元素 ， 因此 利用 Vector 变量 存储 当前 PDF 文件 和 当前 页面 中 存在 的 字体 对象 ， 这样 当 每次 调用 方法 setfont 设置 字体 时 ， 程序 首先 在 Body 和 Page 中 的 font 变量 中 查找 ， 如果 在 font 中 存在 相同 字体 名称 的 对象 ， 表明 这种 字体 在 当前 的 文件 中 已经 被 使用 过 ， 这样 可以 直接 获得 已经 生成 的 字体 对象 和 字体 编号 “ Fn ” 其中 n 为 可变 整数 ， 随着 当前 PDF 文件 中 字体 种类 的 增加 ， n 随之 增大 ； 如果 在 font 中 没有 找到 具有 相同 名称 的 对象 ， 则 表明 此 字体 在 当前 的 文档 中 还 没有 被 使用 过 ， 这样 程序 就 会 构造 个 新 的 Fonts 对象 ， 并 完成 字体 属性 的 设置 。 　 图形 功能 的 实现 　 　 在 PDF 软件包 中 增加 图形 功能 相对 比较 容易 。 我们 构造 了 个 类 Line ， 程序员 通过 调用 此类 中 的 各个 方法 可以 实现 在 PDF 文件 中 添加 直线 包括 带 箭头 的 直线 和 虚线 、 矩形 、 圆形 和 Bezier 曲线 见图 的 功能 。 由于 PDF 规范 中 并 没有 提供 为 绘制 圆形 专用 的 标识符 ， 但是 它 提供 了 对 Bezier 曲线 的 支持 ， 因此 根据 图形学 的 原理 ， 利用 多条 Bezier 曲线 组合 成为 个 圆形 ， 而 这个 组合 过程 对于 用户 来说 却是 透明 的 ， 用户 只 需要 调用 Line 类中 的 方法 drawCircleintxintyintradius 即可 绘制 出个 圆形 参数 为 圆心 坐标 和 半径大小 。 图 　 Bezier 曲线 　 　 实现 图形 的 目的 主要 是 为了 勾画出 特定 的 线条 ， 同时 由于 PDF 规范 中 没有 提供 针对 表格 功能 的 操作符 ， 因此 需要 通过 直线 的 组合 来 形成 表格 。 　 图像 功能 的 实现 　 　 为了 使 PDF 文件 的 内容 更加 充实 ， 同时 也 为了 避免 用户 在 阅读 文件 时 感到 枯燥 ， 必须 要 在 PDF 文件 中 增添 一些 相应 的 图像 。 这里 通过 Images 类 以及 其中 的 方法 来 提供 给 用户 在 PDF 文件 中 添加 图像 的 功能 。 用户 只 需 构造 个 Images 对象 ， 并 将 所 选择 图像 的 相应 存储 路径 及其 名称 作为 参数传递 给 构造方法 ， 系统 就 可以 直接 利用 Java 类库 中 的 javaio 和 javaawtimage 包 获取 图像文件 的 内容 。 对于 GIF 或 JPEG 格式 的 图像文件 来说 ， 每个 象素 点 都 由 RGB 三元 色 组成 ， 每种 元色 又 是 由位 进制 数 表示 的 ， 而 PDF 文件 中 的 图像 需要 将 象素 点 三元 色 的 取值 转换成 由 、 、 或位 二进制 数 表示 。 因此 程序 还 实现 了 根据 用户 设置 的 参数 将 每个 象素 点 的 颜色 转换成 不同 位数 二进制 数 的 功能 。 　 数据压缩 处理 方法 的 实现 　 　 在 网络 传输 过程 中 ， 文件大小 直接 影响 到 传输 的 速度 。 为了 使 生成 的 PDF 文件 在 容纳 所有 必需 信息 的 同时 ， 能 尽量 缩小 文件 占用 空间 ， PDF 文件 支持 对 数据 进行 压缩 处理 。 　 　 在 PDF 软件包 中 ， 实现 了 Encoding 类 ， 它 是 一个 基础 类 ， 用来 对 PDF 的 数据 进行 编码 和 压缩 。 目前 Encoding 类中 实现 了 种 压缩 方法 ： LZW 、 Flate 和 RunLength 行程 。 这些 压缩 方法 都 可以 对 图像 二进制 数据 和 文本 ASCII 数据 进行 压缩 ， 它们 在 各种 信号处理 中 都 是 很 常用 的 ， 但 由于 它们 在 PDF 中 的 应用 有 其 一定 的 特殊性 ， 还要 对 其 进行 适合 PDF 的 具体 处理 。 在 Java 中 ， javautilzip 包 提供 了 专门 对 Flate 方法 进行 处理 的 Deflater 类 ， 所以 Encoding 类 利用 Deflater 类来 完成 最底层 的 压缩算法 。 而 其它 几种 压缩 方法 则 由 Encoding 类来 亲自 完成 。 另外 ， Encoding 类 还 实现 了 种 将 二进制 数据 转换成 ASCII 码 数据 的 编码方法 ： ASCII 和 ASCIIHex 。 由于 个 字节 可 表示 位 二进制 数据 ， 而 只能 表示 位 ASCII 码 数据 ， 所以 使用 这种 编码方法 会 增大 数据量 ， 但是 由于 ASCII 是 移植性 最好 的 形式 ， PDF 手册 建议 最终 PDF 文件 以 文本文件 形式 表示 。 所以 ， PDF 文件 中 可以 进行 压缩 处理 的 图像 内容 和 页面 内 文本 、 图形 描述 信息 ， 通常 先由 Encoding 类中 压缩 方法 LZW 、 Flate 和 RunLength 进行 压缩 ， 再 由 编码方法 ASCII 和 ASCIIHex 转换成 文本 形式 。 　 其他 功能 　 　 除了 上述 主要 的 类 和 方法 以外 ， 我们 还 设置 了 Outlines 和 SubOutlines 类 。 用户 可以 直接 调用 类中 的 方法 来 为 每个 页 设置 个 名字 ， 这个 名字 将 作为 前 页面 在 PDF 规范 中 Outlines 属性 的 取值 来 对待 。 当 生成 个 PDF 文件 后 ， 用户 只 需要 用 鼠标 点击 在 AcrobatReader 窗口 左部 显示 的 Outline 图标 ， 即 可以 直接 跳转 到 相应 的 页面 上 ， 实现 了 浏览 过程 的 交互性 。 在 将 所有 页面 的 Outlines 属性 写入 PDF 文件 的 过程 中 ， 使用 了 递归 调用 的 方法 ， 从 根页 树到 子页 树 逐层 设置 对象 号 和 具体 属性 的 调用 关系 。 　 　 利用 Java 语言 面向对象 的 特性 ， 将 数据 封装 起来 ， 使 开发人员 可以 把 设计 的 主要 注意力 集中 到 对 对象 和 方法 的 调用 上 。 所有 有关 PDF 文件 内部 对象 构造 和 文件组织 的 技术细节 对于 此 软件包 的 使用者 来说 都 是 透明 的 。 这样 ， 用户 在 不必 了解 PDF 程序设计 语法 的 基础 上 就 可以 直接 编写出 PDF 文件 了 。 　 应用 前景 　 　 PDF 是 一种 实用 的 电子出版 文件 。 各种 不同 的 企业 可以 根据 自己 的 需要 ， 设计 特定 的 JavaApplet 用户 接口 和 服务器程序 。 客户端程序 由 用户 使用 appletviewer 、 HotJava 、 IE 或 Netscape 等 浏览器 运行 。 用户 可以 通过 访问 这个 主页 来 填写 特定 的 定单 。 服务程序 根据 用户 设置 的 字体 名称 宋体 、 楷体 等 、 风格 斜体 、 黑体 等 、 大小 以及 颜色 ， 考虑 页面 大小 的 限制 ， 以 最好 的 效果 显示 文字 ， 并 从 数据库 中 获取 记录 ， 生成 相应 的 PDF 文件 。 客户 最终 利用 辅助 应用程序 AcrobatReader 观看 服务器端 生成 的 PDF 结果 文件 。 服务器端 程序 由 管理员 使用 JDK 运行 ， 监听 客户端 请求 ， 根据 用户 提供 的 数据 要求 ， 通过 调用 PDF 软件包 ， 把 数据格式 转换成 PDF 文件格式 。 同时 由于 此 软件包 支持 英文 、 中文 和 日 文字 体 ， 因此 全球 使用 不同 语言 的 用户 都 可以 利用 它 来 直接 生成 电子 票据 。 Java 语言 和 PDF 文件 都 具有 可移植性 ， 两者 的 结合 可以 说 是 相 得益 影 。 　 　 EDI 正 迅速 应用 于 WWW ， 使得 众多 的 中小企业 可以 利用 EDI 从事 商务活动 ， 这 必将 促进 商业界 和 工业界 的 发展 。 通过 开发新 一代 的 标准 ， EDI 的 应用 将 扩大 到 服务性 行业 。 总之 ， 电子商务 是 未来 信息 商业 社会 运作 的 核心 ， 电子 商业 的 平台 是 Internet ， 工具 就是 Java 。 作者 单位 ： 清华大学 计算机系 参考文献 　 BienzTCohnRMeehanJRPortableDocumentFormatReferenceManualVersionAdobeSystemsIncorporated 　 GoslingJJavaProgrammingGuideJavaSoftCorpSunMicrosystems 　 　 BienzTCohnRMeehanJRCIDKeyedFontTechnologyOverviewTechnicalNoteAdobeSystemsIncorporated 　 BienzTCohnRFontNamingIssuesTechnicalNoteAdobeSystemsIncorporated 　 王克宏 Java 语言 编程技术 北京 ： 清华大学出版社 ， 　 吴乐南 数据压缩 的 原理 与 应用 北京 ： 电子 工业 出版社 ， 收稿 日期 ：