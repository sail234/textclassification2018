软件 学报 JOURNALOFSOFTWARE 年 第卷 第期 　 NoVol 基于 边界 表示 的 体 抽壳 算法 左 　 征 　 胡事民 　 孙家 广 　 　 摘要 　 形体 的 抽壳 是 构造 具有 薄壁 外壳 形状 物体 的 一种 有效 方法 文章 基于 边界 表示 的 正则 形体 给出 体 抽壳 运算 的 数学 定义 并 提出 实现 体 抽壳 运算 的 算法 该 算法 把 形体 的 三维 运算 转化 到 曲面 的 参数 域 上 进行 二维 环 之间 的 合并 运算 从而 降低 了 问题 的 复杂度 　 　 关键词 　 CADCAM 系统 抽壳 边界 表示 实体 造型 　 　 中图法 分类号 　 TPAShellAlgorithmforSolidonBoundaryRepresentationZUOZhengHUShiminSUNJiaguangDepartmentofComputerScienceandTechnologyTsinghuaUniversityBeijing 　 　 Abstract 　 TheshelloperationofsolidisaneffectivemethodtoconstructasolidwithshapeofthinshellInthispapertheauthorsdescribethemathematicaldefinitionofshelloperationonregularsolidwithboundaryrepresentationandpresentanalgorithmforshelloperationThealgorithmimplementsthesolidsDoperationbyDmergingoperationofloopsinsurfacesparametricregionSothecomplexityofproblemisreduced 　 　 Keywords 　 CADCAMsystemshellboundaryrepresentationsolidmodeling 　 　 在 CADCAM 领域 有关 实体 造型 技术 的 研究 一直 是 非常 重要 的 课题 实体 造型 的 目标 是 将 物体 模型 的 形状 在 计算机 中 明确 地 表示 出来 在 实体 造型 中 两类 最 重要 的 实体 表示 方法 是 构造 的 实体 几何 CSG 法 和 边界 表示 BRep 法 许多 实体 造型 系统 都 是 以 这 两种 表示 方法 为 基础 而 构造 的 　 　 在 一个 实际 的 造型 系统 中 除了 系统 内部 应该 具备 实体 的 表示 能力 以外 还 应该 给 用户 提供 一些 直接 而 有效 的 造型 方法 如 拉伸 、 旋转 、 扫描 、 蒙面 等 方法 使 用户 可以 构造 出 各种 基本 体 素体 素 拼合 集合 运算 方法 可以 完成 形体 的 拼接 和 分割 还有 一些 局部 造型 的 功能 可以 完成 对 形体 形状 的 局部 修改 　 　 在 机械 产品 的 设计 中 存在 一类 具有 薄壁 外壳 形状 的 物体 如 各种 注塑件 类 、 模具 类 零件 提供 一种 抽壳 运算 是 构造 这 类 形状 物体 的 好 方法 在 构造 这 类 形体 时先 构造 出外 表面 为 所 要求 形状 的 形体 然后 通过 抽壳 运算 挖去 形体 的 内部 形成 中空 的 具有 薄壁 结构 且 外部 形状 符合要求 的 形体 　 　 本文 首先 给出 了 基于 边界 表示 的 形体 抽壳 运算 的 数学 定义 和 与 算法 相关 的 一些 术语 在 此基础 上 描述 了 抽壳 算法 的 流程 并 给出 了 由 具体 实现 中 得到 的 实例 在 抽壳 算法 中 要求 出 曲面 的 offset 曲面 ［ ］ 要 进行 曲面 之间 的 求交 运算 ［ ］ 关于 这些 运算 有 许多 专门 的 研究成果 在 计算 保留 面 的 offset 面和非 保留 面 的 环 的 步骤 中 运用 了 一些 形体 集合 运算 算法 中 的 技术 ［ ］ 由于 在 曲面 的 参数 域 上 定义 界定 曲面 边界 的 环 结构 环 的 生成 也 是 在 曲面 的 参数 域 上 进行 算法 中 采用 了 类似 GardanPerrin 的 三维 集合 运算 的 处理 方法 ［ ］ 把 问题 的 复杂度 由 三维 降低 到 二维 用 AthertonWeller 的 二维 集合 运算 的 思想 构造 出面 的 环 结构 　 体 抽壳 运算 的 定义 　 　 这里 的 体 抽壳 运算 定义 在 边界 表示 的 正则 形体 之上 假设 OR 是 三维空间 中 的 正则 形体 O 的 边界 是 一个 面集 记为 FO 　 　 首先 定义 空间 中任 一点 P 到 形体 O 某 一边 界面 FF 是 有界 的 的 距离 ： 　 　 　 　 　 　 　 　 　 　 LFPmin ｜ PQ ｜ Q ∈ F 　 　 上面 规定 的 距离 为 非 负数 没有 考虑 面 F 的 两面 中 哪 一面 指向 形体 外部 如果 规定 在 面 F 上任 取 一点 Q 其法 向量 NFQ 为 指向 体外 一侧 则 可以 规定 点 P 到 边界 面 F 的 有 向 距离 ： 　 　 　 　 　 　 　 对于 进行 抽壳 运算 的 形体 O 其 边界 面集 FO 分为 两类 FOFRO ∪ FDOFRO 中 的 面 称为 保留 面 该类 面 的 有效 区域 在 结果 形体 中 保持 不变 ； FDO 中 的 面 称为 非 保留 面 该类 面 的 有效 区域 在 结果 形体 中需 重新 计算 对于 FRO 中 的 每 一个 保留 面 F 规定 一个 偏移 厚度 hF 　 　 有 两种 方向 上 的 抽壳 ： 向 内 延伸 式 和 向 外 延伸 式 向 内 延伸 式 抽壳 定义 为 　 　 　 　 　 　 　 　 ShellOP ｜ 存在 面 F ∈ FRO 使得 hF ≤ DFP ≤ 　 　 向外 延伸 式 抽壳 定义 为 　 　 　 　 　 　 　 　 ShellOP ｜ 存在 面 F ∈ FRO 使得 ≤ DFP ≤ hF 　 　 为了 使 问题 简单化 下面 的 讨论 和 给出 的 算法 都 针对 向 内 抽壳 进行 对于 向外 抽壳 的 情况 算法 是 类似 的 只 需 在 某些 步骤 作出 调整 　 　 抽壳 操作 是 一种 实用性 很强 的 造型 方法 如果 严格 按照 上面 给出 的 抽壳 运算 的 数学 定义 在 某些 情况 下当 偏移 厚度 太大时 形体 的 抽壳 结果 不 存在 或 很 不 符合实际 情况 例如 边长 为 a 的 正方体 如果 取 其中 一个 面为 非 保留 面 其余 个面 为 保留 面 它们 的 偏移 厚度 相同 为 h 当 ha 时 按 定义 抽壳 结果 仍 是 这个 正方体 但 在 实际 应用 中不应 出现 这种 情况 所以 下面 的 算法 是 假定 在 偏移 厚度 不太大 的 情况 下 给出 的 　 算法 中 的 术语 描述 　 　 形体 采用 边界 表示法 BRep 表示 形体 O 由 给出 的 O 的 边界 面集 FO 确定 每 一个 面 一般 采用 参数 曲面 定义 其 形状 在 参数 域 内 给定 环 一个 外环 和 任意 多个 内环 来 确定 面 的 有效 区域 环是 由 有 向 边围 成 的 封闭 区域 规定 外环 为 逆时针 方向 内环 为 顺时针 方向 　 　 在 定义 抽壳 运算 时 将 形体 边界 面集 FO 划分 为 保留 面 FRO 和 非 保留 面 FDO 两大类 保留 面 的 offset 面将 成为 结果 形体 边界 的 一部分 面 F 的 offset 面记 为 offsetFh 其中 h 为 偏移 厚度 所有 保留 面 FRO 的 offset 面 构成 的 面集 记为 FOO 　 　 我们 可以 得出结论 ： 在 偏移 厚度 不太大时 边界 表示 的 形体 O 的 抽壳 结果 ShellO 的 边界 面集 由 FROFDOFOO 构成 其中 FRO 中 的 面 的 环 保持 不变 FDOFOO 中 的 面 的 环需 重新 计算 抽壳 算法 的 重点 在于 计算 FDO 和 FOO 中 的 面 的 环 结构 　 　 对 形体 O 的 任 一边 E 由于 O 为 正则 形体 E 必有 两个 邻面 F 和 F 如 F ∈ FRO 则 取 F ′ offsetFhF 否则 F ∈ FDO 取 F ′ F 同样 可得 F ′ F ′ 与 F ′ 的 交线 形成 的 边 E ′ 称为 边 E 的 offset 边记 为 E ′ ＝ offsetE 　 　 对 形体 O 的 任 一面 F 上 的 环 L 外环 或 内环 L 的 每 一边 E 的 offset 边 E ′ 围成 的 环 L ′ 称为 环 L 的 offset 环记 为 L ′ offsetL 　 体 抽壳 算法 算法 基本 思想 　 　 根据 抽壳 运算 的 定义 在 偏移 厚度 不太大 的 情况 下 正则 形体 经过 抽壳 之后 在 保留 面处 要 形成 一个 指定 厚度 的 薄壁 薄壁 的 两侧 为 保留 面 和 它 的 offset 面 相应 地 在 结果 形体 中 就 会 形成 一个 对应 的 面该 面 的 形状 为 表示 保留 面 的 曲面 的 offset 曲面 界定 该面 区域 的 环是 保留 面 的 环 的 offset 环在 非 保留 面处 抽壳 运算 使 该面 的 有效 部分 被 挖 去 一块 挖 去 的 部分 由 该面 的 环 的 offset 环 确定 需要 在 参数 域 上 对 该面 原有 的 环 和 offset 环作 归并 之后 确定 抽壳 后 非 保留 面 的 有效 环 区域 算法 描述 　 　 PROCEDUREMainProcedureOShellO 　 　 BEGIN 　 　 　 FOReachfaceFinFRODOcalculateF ′ offsetFhFENDFOR 　 　 　 FOReachedgeEofODOcalculateE ′ offsetEENDFOR 　 　 　 FOReachloopLofeachfaceDOcalculateL ′ offsetLENDFOR 　 　 　 RemoveFaceProcessingFaceSet 　 　 　 ReserveFaceProcessingFaceSet 　 　 　 ResultBodyCreationFaceSetFaceSetShellO 　 　 END 　 　 在 上述 算法 中 第步 求面 的 offset 面 只是 求 出 表示 面 的 形状 的 参数 曲面 的 offset 曲面 而 offset 面 的 环 将 在 过程 ReserveFaceProcessing 中求 出 第步 中求 每 一边 E 的 offset 边 根据 offset 边 的 定义 要用 E 的 两个 邻面 或 它们 的 offset 面求 交求 出 的 交线 在 形成 边 结构 之前 要 进行 裁剪 运算 如图所示 裁剪 的 依据 是 利用 E 的 翼 边 表示 方法 中 的 上 邻面 和 下 邻面 用 上下 两邻面 或 其 offset 面由 该面 是否 为 非 保留 面 决定 裁去 交线 的 多余 部分 保留 两面 之间 的 部分 形成 边 这样 在 第步 计算 环 的 offset 环时 只要 按 原环 各边 的 顺序 依次 把 各边 的 offset 边 取出 构成 环 即可 　 　 过程 ResultBodyCreation 由 计算 出 的 两个 面 集合 拼 合成 一个 体在 这个 过程 中 利用 了 面 集合 中面 之间 共边 的 信息 从面 集合 中任取 一面 开始 把 与 这个 面相 连接 的 所有 面 取出 构成 一个 体 如果 拼成 一个 体后 剩余 面 集合 非空 则 说明 抽壳 运算 使 原体 形成 了 分离 的 几个 部分 可以 用 同样 的 方法 构造 出 所有 的 结果 形体 　 　 过程 RemoveFaceProcessing 对非 保留 面 进行 处理 ReserveFaceProcessing 对 保留 面 进行 处理 这 两个 过程 是 抽壳 算法 的 重点 可以 描述 如下 　 　 PROCEDUREReserveFaceProcessingFaceSet 　 　 BEGIN 　 　 　 FaceSet 　 　 　 FOReachfaceFinFDODO 　 　 　 　 addallFslooptoLoopSet 　 　 　 　 addallLoopSetsloopsoffsetlooptoLoopSet 　 　 　 　 getFsoffsetfaceF ′ 　 　 　 　 FormFaceF ′ LoopSetNewFaceSet 　 　 　 　 FaceSetFaceSet ∪ NewFaceSet ∪ F 　 　 　 ENDFOR 　 　 END 　 　 　 　 PROCEDURERemoveFaceProcessingFaceSet 　 　 BEGIN 　 　 　 FaceSet 　 　 　 　 FOReachfaceFinFDODO 　 　 　 　 　 addallFslooptoLoopSet 　 　 　 　 　 addallLoopSetsloopsoffsetlooptoLoopSet 　 　 　 　 　 MergeRemoveFaceLoopLoopSetLoopSetLoopSet 　 　 　 　 　 FormFaceFLoopSetNewFaceSet 　 　 　 　 　 FaceSetFaceSet ∪ NewFaceSet 　 　 　 ENDFOR 　 　 END 　 　 这 两个 算法 的 实现 过程 都 是 对 原体 的 每个 面 的 每个 环 取出 计算 出 的 offset 环 经过 环 之间 的 运算 形成 一些 环组 其中 的 每 一个 环组 都 是 一个 外环 中 包含 任意 个 内环 的 形式 的 集合 再 由 原面 的 参数 曲面 形式 及 环组 集合 来 形成 面集 形成 面时 要 对 环 的 方向 作 判断 对于 外环 是 顺时针 方向 的 情况 要 对 形成 的 面 的 法向 取反 并 把 环 方向 改为 逆时针 在 环 之间 的 运算 中 对 非 保留 面要 对 其 初始 环 和 offset 环 进行 归并 归并 过程 是 一个 难点 由于 初始 环 的 边 保存 了 在 曲面 参数 域 中 的 表示 offset 环 的 边 由求 交 运算 产生 同样 存在 曲面 参数 域 中 的 表示 因而 可以 在 曲面 的 参数 域 上 进行 环 的 归并 其中 的 运算 都 是 二维 运算 下面 详细 说明 该 归并 过程 　 　 第步 是 对 offset 环作 预处理 使 每个 环 与其 初始 环 方向 相反 即 外环 的 offset 环为 顺时针 方向 内环 的 offset 环为 逆时针 方向 第步 为 边边 求交 初始 环 与 offset 环两 两 之间 进行 边边 求交 在 交点 处 将 边 分割 如 有 两边 重合 则 删除 这 两条 边 经过 这一 步骤 之后 形成 一些 在 公共 点处 连接 在 一起 的 有 向 边 第步 搜索 边 形成 环从 某 一 顶点 出发 顺着 边 行进 遇到 某个 顶点 发出 多条 边时 选择 离上 一边 方向 顺时针 旋转 最近 的 一边 直至 回到 初始 顶点 处 就 形成 了 一个 环 如此 可 形成 多个 互不 相交 在 边 端点 处 相交 除外 的 环 第步 环 排序 根据 环 的 包含 关系 如 A 环 包含 B 环则 B 环 成为 A 环的子 环 排序 后 形成 一个 树形 结构 取 树形 结构 中 奇数 层上 的 环 作为 外环 它 的 子环 作为 内环 形成 一个 环组 由此 可 得到 多个 环组 作为 归并 的 结果 图是 环 归并 过程 的 实例 第步 ： 初始 环 及其 offset 环第步 ： 边边求 交和边 分割 第步 ： 搜索 边 形成 个环 第步 ： 排序 形成 两个 环组图 　 非 保留 面环 的 归并 步骤 结论 和 实例 　 　 本文 的 体 抽壳 算法 基于 边界 表示 的 正则 形体 算法 的 目的 是 构造 边界 表示 形体 经 抽壳 运算 后 的 边界 表示 算法 的 重点 在于 构造 结果 形体 的 边界 面 的 形状 和 界定 面 的 有效 范围 的 环此 算法 所 采用 方法 的 基本 思想 是 ， 逐级 构造 体 的 各 几何 元素 的 offset 元素 从边 的 offset 边 、 环 的 offset 环到 面 的 offset 面 通过 二维 区域 上环 的 归并 来 构造 结果 形体 的 环 算法 已经 在 一个 通用 的 实体 造型 系统 中 实现 图是 一个 体经 抽壳 运算 的 实例 　 　 F 和 F 为 非 保留 面图 　 体 抽壳 运算 的 实例 　 　 本文 研究 得到 国家自然科学基金 资助 作者 左征 年生 博士生 主要 研究 领域 为 计算机辅助 几何 设计 计算机 图形学 胡事民年生 博士后 讲师 主要 研究 领域 为 计算机辅助 设计 计算机 图形学 分形 几何 及 应用 孙家 广年生 教授 博士生 导师 主要 研究 领域 为 计算机 图形学 CADCAMPDMSCIMS 　 　 本文 通讯联系 人 左征 北京 清华大学 计算机科学 与 技术 系 　 　 作者 单位 ： 清华大学 计算机科学 与 技术 系 　 北京 　 参考文献 　 　 FaroukiRTTheapproximationofnondegenerateoffsetsurfacesComputerAidedGeometricDesign ～ 　 　 PhamBOffsetcurvesandsurfacesabriefsurveyComputerAidedDesign ～ 　 　 BarnhillREKerseySNAmarchingmethodforparametricsurfacesurfaceintersectionComputerAidedGeometricDesign ～ ～ 　 　 BarnhillREFarinGJordanMetalSurfacesurfaceintersectionComputerAidedGeometricDesign ～ 　 　 KrishnanSManochaDEfficientrepresentationsandtechniquesforcomputingBRepsofCSGmodelswithNURBSprimitivesInJohnEedSettheoreticSolidModelingTechniquesandApplicationsCSGConferenceWinchesterUKInformationGeometersLtd ～ 　 　 ChiyokuraHiroakiKimuraFumihikoDesignofsolidswithfreeformsurfacesComputerGraphics ～ 　 　 GardanYPerrinEAnalgorithmreducingDBooleanoperationstoaDproblemconceptsandresultsComputerAidedDesign ～ 收到 原稿 收到 修改稿