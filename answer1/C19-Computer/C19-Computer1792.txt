软件 学报 JOURNALOFSOFTWARE 年 　 第卷 　 第期 　 Vol 　 No 　 软件 Agent 的 继承性 研究 樊晓聪 徐殿祥 侯建民 郑国梁 　 　 摘要 　 Agent 作为 一种 受限 的 智能 对象 对 Agent 的 继承 特性 进行 深入研究 并 将 继承 机制 嵌入 到 AOPagentorientedprogramming 中则 具有 重要 意义 文章 基于 BDIAgent 模型 对 软件 Agent 的 继承性 和 复制 行为 进行 了 研究 从单 继承 和 多 继承 两个 方面 给出 了 Agent 继承 的 语义 将 Agent 实例 的 动态 复制 机制 形式 地 划分 为 功能 分割 、 逻辑 分割 、 择优 分割 和 返祖 分割 这 类 分析 了 每类 分割 方式 的 作用 并 基于 电子市场 系统 应用 背景 给出 了 相应 的 实例 　 　 关键词 　 软件 Agent 继承 复制 行为 BDI 模型 规划 　 　 中图法 分类号 　 TPResearchonInheritanceofSoftwareAgentFANXiaocongXUDianxiangHOUJianminZHENGGuoliangStateKeyLaboratoryforNovelSoftwareTechnologyNanjingUniversityNanjingDepartmentofComputerScienceandTechnologyNanjingUniversityNanjing 　 　 Abstract 　 BeingakindofrestrictedintelligentobjectsagentisanaturalwaytoresearchtheinheritancefeatureofsoftwareagentandintegrateinheritancemechanismsintoAOPagentorientedprogrammingBasedonBDImodelofagentsthesemanticsofinheritanceandcloningbehaviorofagentsareaddressedinthispaperThesemanticsofinheritancearediscussedfromtwoaspectssingleinheritanceandmultipleinheritanceForcloningbehaviortheauthorsidentifyandformallyclassifythedynamiccloningmechanismsofagentinstancesintofourtypesfunctionsplitlogicsplitpreferencesplitandretrogresssplitTheprincipleofeachcloningmechanismispresentedandtheexamplesareprovidedbasedontheelectricalcommercesystems 　 　 Keywords 　 SoftwareagentinheritancecloningbehaviorBDImodelplan 　 　 AOPagentorientedprogramming 是 一种 特殊 的 OOPobjectorientedprogramming ［ ～ ］ Agent 的 心智 状态 、 通信 机制 和 能力 分别 对应 于 对象 的 状态 、 消息 收发 和 操作 Wooldridge ［ ］ 认为 利用 言语 行为 协议 （ speechacttheory ） 进行 协作 的 Agent 既 是 推理 系统 又 是 认知 实体 它 为 AOP 提供 了 自治 和 认知 两层 抽象 自治 抽象 揭示 了 Agent 与 主动 对象 之间 的 关系 在 自治 性 、 并发 性 和 应激 性上 两者 具有 近似 对应 关系 认知 抽象 与 人们 通常 利用 大众 心理学 来 解释 和 预测 复杂 系统 行为 的 方法 相 耦合 　 　 但是 Agent 在 自治 程度 上 优于 主动 对象 虽然 主动 对象 可以 根据 它 所处 的 环境 来 决定 自身 行为 从而 实现 控制 的 局部 化 但 其 行为 集是 预先确定 的 并且 缺乏 协商 和 学习 能力 Agent 的 预动性 proactive 赋予 其 独有 的 规划 特征 使 其 可以 通过 对 底层 原 动作 的 动态 规划 控制 自身 行为 能 对 不可 预知 的 事件 作出 合理 反应 因而 Agent 能 更 自然 、 更 真实 地 模拟 和 解决 客观 世界 中 的 问题 　 　 另一方面 OOP 的 日益 成熟 也 为 AOP 的 发展 提供 了 契机 AOP 能否 普及 并 像 OOP 那样 焕发 强大 的 生命力 取决于 其 能否 提供 OOP 目前 所 具有 的 特性 并 在 某些 方面 （ 诸如 易 理解 性 、 易维护性 等 ） 能否 超越 OOP 而 提供 独具 的 优点 由于 继承性 是 OOP 的 基石 AOP 能否 具有 继承性 很 自然 地 便 成为 首先 要 解决 的 问题 Crnogorac ［ ］ 意识 到 这 一点 并 初步 探讨 了 AOP 中 的 继承 问题 使 Agent 的 对象 属性 研究 作为 Agent 方法学 的 一个 重要 方面 重新得到 重视 从而 在 一定 程度 上 缓解 了 Agent 研究 领域 两极分化 的 现象 ［ ］ 但 Crnogorac 仅 局限于 其中 的 行为 保持 和 继承 异常 问题 对 Agent 继承 中 的 许多 细节 没有 充分考虑 　 　 本文 试图 从单 继承 和 多 继承 两 方面 对 Agent 的 静态 继承 进行 研究 并 深入探讨 Agent 的 动态 继承 动态 复制 行为 cloning 第节 介绍 改进 的 BDI 模型 第 和 第节 分别 讨论 Agent 的 静态 继承 和 动态 复制 行为 第节 对 与 Agent 继承 有关 的 问题 进行 分析 最后 概括 本文 的 主要 工作 BDI 模型 与 规划 表示 　 　 在 Agent 理论 研究 领域 BDI 模型 ［ ］ 是 最 富有成果 的 Agent 模型 处于 动态 环境 中 的 BDIAgent 通过 对 外界 变化 的 不断 感知 基于 自身 的 信念 产生 目标 对 某些 目标 作出 承诺 从而 产生 意念 通常 将 一个 BDIAgent 表示 为 〈 〉 其中 和 分别 表示 知识 集 （ 为 真的 信念 ） 、 初始 信念 集 、 初始 目标 集 和 静态 规划 集 它们 由 特定 的 Agent 语言 描述 用来 规范 Agent 的 静态 心智 特征 　 　 在 语法 上 规划 由 激发 事件 集 、 语境 条件 集 和 规划 体 组成 可 将 规划 p 表示 为 元组 〈 pEpCpG 〉 pE 和 pC 分别 对应 于 p 的 激发 事件 集 和 语境 条件 集 pG 为 规划图 规划图 的 节点 表示 状态 弧 表示 状态 转换 弧上 的 标记 为 一个 三元组 〈 ECA 〉 分别 表示 激发 转换 的 事件 、 转换 发生 的 条件 和 转换 伴随 的 动作 规划图 中有类 节点 个 初始 节点 种叶 节点 （ “ 成功 ” 、 “ 失败 ” 和 “ 放弃 ” ） 和 内 节点 内 节点 可以 是 具体 节点 （ 原 动作 、 通信 语句 、 不 确定 语句 等 ） 也 可以 是 代表 子 规划 体 的 抽象 节点 抽象 节点 有 一 指针 指向 其 扩展 子图 　 　 定义 （ 服务 簇 ） Agent 的 一个 规划图 与 其中 所有 抽象 节点 的 扩展 子图 共同 构成 该 Agent 的 一个 服务 簇 服务 簇 实例 化后 得到 具体 的 服务 　 　 定义 （ 规划 等价 类 ≈ ） 规划 p 和 q 属于 同一 规划 等价 类 （ 记作 p ≈ q ） 当且 仅 当 pEqEpCqC 　 　 属于 同一 规划 等价 类 的 规划 可以 合并 表示 为 一个 类 规划图 规定 其中 最 左子 规划图 的 优先级 最高 向 右 依次 降低 并且 优先级 可以 动态 调整 （ 规划 的 成功 执行 使 自身 的 优先级 增加 反之 则 减少 ） 静态 继承 　 　 当 通过 静态 继承 从 Agent 父类 产生 子类 时 子类 可以 增加 新 的 或 取消 父类 中 已有 的 信念 、 目标 和 规划 也 可以 修改 或 重定 义父 类 的 规划 但 新 增加 的 信念 和 目标 可能 与 父类 的 信念 和 目标 存在 矛盾 新 定义 的 规划 若 与 父类 的 规划 同属 一个 等价 类 也 存在 尝试 执行 的 先后 次序 问题 按照 信念修正 的 观点 由于 新 知识 获取 的 途径 已经 过 严格 审视 从而 是 可以 确信 的 因此 当 新旧 知识 存在 矛盾 时 总是 放弃 那些 旧 知识 中 与 新 知识 矛盾 的 部分 这 与 开放 逻辑 ［ ］ 中 信息 的 非 单调 更新 思想 也 相吻合 据此 可以 解决 父类 与 子类 之间 信念 和 目标 的 矛盾 而 对 属于 同一 等价 类 的 父子 规划 的 优先级 问题 存在 不同 观点 Crnogorac 认为 父类 的 行为 总能 经过 严格 证明 是 正确 的 （ 规划 总能 正确 执行 ） 而 子类 的 行为 尚未 确定 如果 优先 采用 子类 规划 可能 导致 失败 （ 在 高 安全 实时 系统 中 不能 回溯 ） 但是 通过 继承 后 父类 中 经过 验证 为 可靠 的 行为 在 子类 的 环境 中 能否 可靠 运行 ？ 文献 ［ ］ 指出 继承 并 不能 简化 验证 反而 使 验证 工作 复杂化 因此 对 高 安全 实时 系统 中 能否 赋予 Agent 继承 特性 存在 置疑 而 在 允许 失败 重试 的 应用 中 赋予 子类 规划 以高 优先级 在 实现 上 是 可行 的 在 效率 上 也 是 必要 的 因为 与 父类 规划 相比 实现 同一 行为 的 子类 规划 在 算法 上 可以 针对 子类 的 新 特性 进行 优化 为此 我们 采用 赋予 子类 规划 高 优先级 的 方法 　 　 定义 （ 静态 单 继承 的 语义 ） 设 〈 〉 是 〈 〉 的 子类 在 类 B 的 规范 中若 其 知识 新 定义 集 为 信念 取消 集和新 定义 集为 和 目标 取消 集和新 定义 集为 和 G 规划 取消 集和新 定义 集为 和 记 和 分别 表示 集合 的 并 、 差 运算 ） 则 和 可 根据 下列 约束 从 和 得到 　 　 若 　 　 若 　 　 若则 （ 表示 规划 的 优先级 关系 ） 　 　 例在 一个 电子市场 系统 中 Bob 的 计算机 上 有 一个 Agent 软件 aide 可为 其 提供 娱乐 代理服务 aide 接受 Bob 的 指令 并 进行 目标 分解 然后 进入 电子市场 与 其他 Agent （ 餐饮 代理 、 影视 代理 等 ） 会晤 协商 电子市场 则 为 各 Agent 提供 调度 等 服务 设在 Bobaide 的 规范 中 分别 定义 了 kk 其中 k 表示 “ 工作日 不能 娱乐 ” k 表示 “ 星期一 ～ 星期五 是 工作日 ” bbb 其中 b 表示 “ 主人 喜欢 流行乐 ” b 表示 “ 主人 不爱 科幻片 ” b 表示 SMaster 即 “ 主人 喜欢 看 晚报 ” ppp 其中 p 进行 电影票 预订 p 进行 餐馆 预约 p 进行 报纸 预购 gg 表示 “ 星期日 看 一场 电影 然后 在 附近 吃顿 晚餐 ” 　 　 Alice 可以 通过 继承 Bobaide 生成 自己 的 娱乐 代理 Aliceaide 若 Alice 不 喜欢 流行乐 不 喜欢 看 晚报 喜欢 摇滚乐 （ b ） 星期日 去 听 音乐会 g 并且 在 Aliceaide 的 规范 中 定义 信念 取消 集为 b 和 信念 新 定义 集 ～ b ～ bb 目标 取消 集 为 目标 新 定义 集为 g 规划 取消 集 为 规划 新 定义 集为 p （ p 用来 订 音乐会 门票 ） 则 静态 继承 后 Aliceaide 的 规范 为 gg 在 Aliceaide 的 信念 集 和 目标 集中 存在 不 一致 根据 定义 进行 修正 后 　 　 在 多 继承 时 为了 对 信念 和 目标 进行 一致 化 处理 我们 采用 在 子类 中 记录 信念 和 目标 的 继承 来源 的 方法 例如 类 B 的 信念 bv 在 其子 类 A 中 变为 bAbBv 　 　 当 父子 信念 （ 目标 ） 集 不 一致 时以 满足 子类 信念 （ 目标 ） 为 前提 去除 父类 信念 （ 目标 ） 集中 与其 矛盾 的 部分 主要 问题 在于 两个 父类 的 信念 （ 目标 ） 集 存在 矛盾 时 如何 处理 我们 知道 Agent 的 多 继承 是 为了 实现 知识 、 信念 和 规划 的 共享 以及 功能 上 的 互补 但 当 一个 Agent 类 具有 两个 以上 父类 时 行为 性质 的 增加 必然 降低 其 规划 调度 和 执行 的 效率 由于 在 实际 应用 中 一个 实体 通常 存在 主要 功能 和 辅助 功能 之 分为 了 提高 Agent 解决问题 的 效率 有 必要 为 其父 类 划分 出 优先级 在 其 能够 满足 自身 新 定义 的 行为 性质 和 优选 父类 的 行为 性质 的 前提 下 再 考虑 满足 其他 父类 的 行为 性质 （ 在 动态 继承 中 根据 不同 行为 性质 具有 不同 优先级 这一 特点 可以 通过 择优 分割 产生 多个 Agent 实例 从而 有效 地 提高 Agent 的 快速反应 能力 ） 在 静态 规范 中用 preB 表示 B 是 优选 父类 我们 有 如下 定义 　 　 定义 （ 静态 多 继承 的 语义 ） 设 〈 〉 是 ≤ i ≤ k 的 子类 其他 说明 同 定义 记则 和 可 根据 下列 约束 从 和 得到 　 　 若 如果 有 则 有 （ 同级 父 信念 相悖 时 取消 非 优选 父类 的 信念 ） 　 　 若 如果 有 则 有 （ 同级 父 信念 相悖 时若均 非 优选 父类 则 同时 取消 ） 　 　 若 如果 有 则 有 （ 父子 信念 相悖 时 取消 父 信念 ） 　 　 若 如果 有 则 有 （ 同级 父 目标 相悖 时 取消 非 优选 父类 的 目标 ） 　 　 若 如果 有 则 有 （ 同级 父 目标 相悖 时若均 非 优选 父类 则 同时 取消 ） 　 　 若 如果 有 则 有 （ 子类 目标 优先 ） 　 　 若则 若 并且 有 preAj 则 　 　 例设 Bob 的 计算机 上 有 另 一个 Agent 软件 Bobmeeting 可为 其 提供 会议 日程安排 及 代理服务 在 Bobmeeting 的 规范 中 定义 了 kk 其中 kk 表示 有关 会议 的 常识 bb 表示 即 “ 开会 时 不能 看报 ” pp 其中 p 表示 进行 会议室 预订 p 与 Bobaide 的 p 一样 也 表示 进行 餐馆 预约 但 因为 是 集体 用餐 需要 从 特殊 的 帐号 上 结帐 现在 Bob 要 继承 Bobaide 和 Bobmeeting 生成 一个 娱乐性 会议 代理 Bobshedule 设 Bobshedule 的 初始 规范 g 表示 “ 星期日 开会 ” 则 通过 静态 多 继承 后 Bobshedule 的 规范 为 由于 b 与 b 存在 矛盾 因此 应 删除 bbbb 由于 g 和 g 存在 时间 冲突 根据 子类 目标 优先 的 约束 得到 g 由于 p 与 p 属于 同一 规划 等价 类 根据 子类 规划 优先 的 约束 p 的 优先级 比 p 高 只有 p 执行 失败 后 才能 尝试 执行 p 动态 复制 行为 　 　 在 多 Agent 系统 中 个体 Agent 之间 存在 着 功能 互补 关系 当 个体 Agent 不 具有 某种 能力 时 就 需要 与 其他 Agent 进行 协商 和 协作 如果 不 进行 负载 均衡 必然 会 导致 某些 Agent 负载 过重 而 有些 Agent 长时间 处于 空闲 状态 对此 通常 有 两种 解决 途径 一是 在 多 Agent 中 设置 具有 路由 、 协调 功能 的 Facilitator 在 Facilitator 中 记录 各 局部 Agent 的 能力 信息 由 Facilitator 动态控制 各 Agent 的 任务分配 但 Facilititor 本身 可能 成为 系统 的 瓶颈 如果 Facilitator 出现 运行 故障 则 整个 多 Agent 系统 可能 无法 正常 工作 另 一种 方法 就是 当 一个 Agent 负载 过重 时 允许 该 Agent 进行 自我 复制 从而 生成 多个 并发 运行 的 Agent 实例 我们 将 Agent 的 自我 复制 行为 看做 Agent 的 动态 继承 这种 利用 Agent 动态 继承 来 进行 负载 均衡 的 方法 不 依赖于 外部 因素 充分体现 了 Agent 的 自治 性是 一种 较 好 的 解决方案 　 　 Agent 的 自我 复制 涉及 到 其 信念 集 、 目标 集及 规划 集 的 处理 我们 根据 多 Agent 系统 的 特点 及 实际 需要 将 Agent 实例 的 复制 机制 划归 为种 方式 设 a 为 Agent 类 A 的 实例 我们 有 如下 定义 　 　 定义 （ 功能 分割 ） 设 （ pj ≤ j ≤ k 是 Agent 实例 a 的 服务 簇 ） ai ≤ i ≤ n 是 a 的 功能 分割 如果 满足 ≤ l ≤ m ≤ k 当 lm 时 每个 ai ≤ i ≤ n 只 负责 执行 一个 服务 簇中 的 功能 　 　 以 服务 簇为 单位 进行 分割 可以 保证 规划 的 完整性 以 避免 实现 个 功能 需要 多个 ai 协作 的 情况 例如 若 ppp 在 规划 p 中 调用 了 子 规划 p 如果 进行 功能 分割 时 将 p 和 p 分别 赋予 a 和 a 则 每次 执行 p 时 都 需要 与 p 协作 反而 降低 了 Agent 的 反应速度 　 　 对 a 进行 功能 分割 时 为了 保证 ai 之间 协作 的 平滑 性 ai 应 全部 继承 a 的 信念 集 和 目标 集 当然 视 具体情况 也 可以 部分 继承 这 需要 在 具体 实现 时 在 Agent 的 个体 反应 能力 和 解决问题 能力 上 进行 折衷 分解 后 的 操作 集越 小该 Agent 的 个体 反应 能力 就 越强 但 自身 解决 复杂 问题 的 能力 也 就 越 低 对 协作 的 要求 则 越 高 　 　 定义 （ 逻辑 分割 ） 设 a 的 信念 集 （ Bj ≤ j ≤ k 是 具有 逻辑 封闭性 的 信念 子集 ） ai ≤ i ≤ n 是 a 的 逻辑 分割 如果 满足 ≤ l ≤ m ≤ k 当 lm 时 每个 ai ≤ i ≤ n 具有 最小 的 协调 信念 集 　 　 以 具有 逻辑 封闭性 的 信念 子集 为 单位 进行 逻辑 分割 也 是 为了 避免 因 自身 信息 不足 而 需要 频繁 地向 其他 Agent 询问 的 情况 例如 若 Bbb → b 如果 进行 逻辑 分割 时 将 b 和 b → b 分别 赋予 a 和 a 则 当 a 需要 知道 b 是否 成立 时 必须 向 a 或 a 询问 b 是否 成立 因而 增加 了 不必要 的 协作 　 　 逻辑 分割 的 优点 是 每个 实体 的 推理 集 减少 降低 了 局部 推理 的 复杂性 有利于 提高 局部 的 执行 效率 由于 知识 集中 包括 全域 信息 （ 网络拓扑 知识 等 ） 是 个体 Agent 之间 协作 的 前提 因此 在 对 a 进行 逻辑 分割 时 ai 应当 全部 继承 a 的 知识 集 规划 集 可以 全部 继承 也 可 与 功能 分割 相结合 同时 减少 Agent 的 推理 集 和 操作 集 　 　 定义 （ 择优 分割 ） ai ≤ i ≤ n 是 a 的 择优 分割 如果 满足 aai