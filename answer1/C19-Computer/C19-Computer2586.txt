软件 学报 JOURNALOFSOFTWARE 年 第卷 第期 VolNo 基于 行为 的 动态 负载 分配 算法 勇军 　 王意洁 　 李思昆 　 胡守仁 摘要 　 将 复杂 行为 引入 共享 虚拟环境 提出 了 一个 基于 行为 的 动态 负载 分配 算法 该 算法 综合 考虑 了 结点 的 处理 能力 、 网络通信 能力 以及 行为 计算 的 特性 能 有效 地 调节 系统 负载 在 提高 用户 实时 交互 能力 的 前提 下 尽量 保持 行为 的 真实感 关键词 　 共享 虚拟环境 多用户 行为 建模 负载 分配 中图法 分类号 　 TPDynamicLoadDistributionAlgorithmBasedonBehaviorWANGYongjun 　 WANGYijie 　 LISikun 　 HUShourenDepartmentofComputerScience 　 ChangshaInstituteofTechnology 　 Changsha 　 Abstract 　 　 InthispaperthecomplexbehaviorsareintroducedintosharedvirtualenvironmentandadynamicloaddistributionalgorithmbasedonbehaviorisproposedThisalgorithmcanconsidertheprocessingcapabilityofCPUcommunicationcapabilityofnetworkandcharacteristicofbehaviorstunethesystemloadefficientlytokeepthebehaviorsfidelitywhilepromotingtherealtimeinteractivityofusersKeywords 　 Sharedvirtualenvironmentmultiuserbehaviormodelingloaddistributing 　 　 目前 分布式 虚拟环境 技术 的 研究 多 集中 于 虚拟现实 设备 、 虚拟 场景 的 图形 建模 及其 真实感 和 实时 性能 的 改善 、 网络 环境 中多 结点 间 的 通信协议 等 但 分布式 虚拟环境 软件开发 平台 在 提供 给 用户 从 行为 建模 到 系统 实现 的 更 高层 支持 方面 的 工作 还 不够 有效 国外 的 一些 典型 系统 如 AVIARY ［ ］ MRminimalreality ［ ］ BrickNet ［ ］ 等 虽然 带有 较为 通用 的 建模语言 但是 这些 建模语言 仅 支持 较为简单 的 行为 模型 和 低 计算 复杂度 的 行为 在 我国 对 分布式 虚拟环境 软件开发 平台 的 研究 几乎 还是 空白 浙江大学 虽然 开展 了 对 分布式 虚拟环境 支持 的 研究 但 也 仅 侧重于 分布式 图形处理 技术 ［ ］ 　 　 为了 将 现实 世界 中 丰富多采 的 真实 特性 在 虚拟环境 中 表现 出来 人们 在 计算机 动画 、 机器人 、 人工智能 等 领域 都 进行 了 深入 的 研究 出现 了 一些 较为 复杂 的 行为 模型 ［ ～ ］ 在 这类 应用 中 由于 行为 的 复杂 程度较高 甚至 单个 实体 的 行为 计算 量 都 会 很大 需要 分布 并行处理 来 支持 实体 间 的 并行性 和 实体 内 的 并行性 为了 适应 这一 需求 我们 研制 了 分布式 虚拟环境 软件开发 平台 YHVRPYHvirtualrealityplatform 该 平台 基于 当前 通用 的 硬件平台 PC 工作站 、 软件平台 NTUnix 和 高速 以太网 Mbps 以上 环境 提供 虚拟环境 建模语言 YHVML 进行 复杂 行为 的 建模 同时 该 语言 的 解释器 支持 对 虚拟环境 状态 及 实体 的 动态 修改 、 增加 和 删除 YHVRP 还 允许 多个 用户 动态 地 加入 共享 同一个 虚拟环境 　 　 对于 拥有 复杂 行为 的 虚拟环境 而言 计算 负载 大大提高 了 而且 用户 对 虚拟环境 的 动态 修改 也 带来 了 较大 的 负载 变化 为了 保证系统 的 实时 交互性 对 计算 负载 的 动态分配 就 显得 尤其 重要 但是 由于 当前 分布式 虚拟环境 软件开发 平台 通常 不 支持 虚拟 实体 数量 及 状态 的 动态 改变 仅仅 考虑 了 简单 行为 的 情况 因此 只 支持 或 部分 支持 基于 空间 划分 的 实体 间 的 并行 尚 没有 合适 的 动态 负载 分配 策略 如 AVIARYDIVEdistributedinteractivevirtualenvironment ［ ］ 提供 了 基本 的 虚拟 实体 迁移 机制 但 控制 工作 需由 应用 开发者 完成 WAVESwaterloovirtualenvironmentsystem ［ ］ 提供 负载 均衡 功能 但 它 的 执行 原则 较为简单 而 我们 从前 的 工作 ［ ］ 也 仅 从 空间 视点 的 变化 角度 来 考虑 行为 计算 与 系统 的 负载 相结合 　 　 基于 上述 考虑 本文 提出 了 一个 基于 行为 的 动态 负载 分配 算法 它 从 行为 计算 的 特性 分析 出发 综合 考虑 结点 的 处理 能力 和 网络通信 能力 支持 拥有 复杂 行为 的 虚拟环境 的 行为 计算 并行 化在 优先 保证 虚拟环境 的 实时 交互性 的 前提 下 尽量 保证 行为 的 真实感 　 基于 行为 的 虚拟环境 计算 　 行为 　 　 从 面向对象 的 观点 来看 虚拟环境 是 由 若干 公共 属性 和 若干 虚拟 实体 组成 的 虚拟 实体 则 由 若干 行为 和 局部 属性 组成 所谓 行为 是 指 实体 对 公共 属性 、 局部 属性 或 调用 其他 行为 的 操作 在 具有 复杂 行为 的 虚拟环境 中 我们 认为 虚拟环境 的 计算 主要 由 虚拟 实体 的 行为 构成 行为 必须 由 某些 事件 触发 才能 被 激活 执行 这些 事件 包括 时钟 事件 、 条件 触发 事件 、 行为 调用 事件 等等 　 　 定义 实体 集合 设有 一 虚拟环境 VE 由 N 个 虚拟 实体 组成 实体 集合 可记 为 EntitysetEntityi ｜ iN 　 　 定义 行为 行为 behavior 可以 记 为 三元组 ： 〈 InputAttrSetOutputAttrSetProcessingProc 〉 其中 处理过程 ProcessingProc 是 行为 计算 程序 ； 输入 属性 集合 InputAttrSet 是 行为 计算所 需 的 实体 属性 或 公共 属性 ； 输出 属性 集合 InputAttrSet 是 行为 计算 进行 修改 的 实体 属性 或 公共 属性 　 　 我们 将 行为 分为 两类 ： 　 　 表现 属性 行为 ： 即 对 实体 表现 属性 进行 操作 的 行为 所谓 表现 属性 是 指 与 仿真 效果 输出 的 有关 属性 如 三维 几何 、 速度 、 位置 等 ； 　 　 非 表现 属性 行为 ： 对 实体 非 表现 属性 进行 操作 的 行为 如 涉及 到 智能 属性 的 行为 等 　 基于 行为 的 虚拟环境 计算 　 　 考虑 单 处理机 的 情况 虚拟环境 的 运行 可以 看做 是 由 一个个 仿真 步 组成 的 每个 仿真 步 一般 又 可以 看做 由段 操作 组成 ： 第段 采样 用户 实体 的 输入 数据 ； 第段 计算 当前 步 处于 活跃 状态 的 所有 实体 行为 修改 相应 的 实体 属性 和 公共 属性 ； 第段 表现 感兴趣 的 属性 如 绘制 当前 步 用户 视野 内 的 实体 它们 的 计算 延迟时间 分别 以 InputLagSimuLagRenderLag 来 表示 文献 ［ ］ 将 用户 执行 一个 动作 和 在 屏幕 上 显示 出来 之间 的 时间差 称为 端端 延迟 EndEndLag 它 是 各段 计算 延迟时间 之 和 　 虚拟环境 的 性能需求 　 　 虚拟环境 运行 的 主要 性能需求 是 实时 交互性 和 真实感 实时 交互性 是 指 虚拟环境 计算 要 足够 快 使得 用户 的 输入 能 实时 地 在 输出 上 反映 出来 如 视点 的 变化 引起 的 场景 变化 即 要求 EndEndLag ＜ δ δ 为 特定 应用 所 指定 的 时间 而 对 行为 而言 虚拟环境 的 真实感 是 指 在 δ 内 实体 行为 具有 行为 的 真实感 　 　 应用 编程 者 通常 期望 在 逻辑 上 行为 在 哪个 仿真 步 被 执行 因此 每个 行为 都 有 一个 理论 修改 率 所谓 理论 修改 率 即 逻辑 上 行为 距 上次 执行 的 仿真 步 间隔 的 倒数 例如 如果 行为 在 每个 仿真 步 周期 执行 则 理论 修改 率为 如果 行为 达到 了 理论 修改 率 我们 就 称 其 具有 行为 真实感 　 基于 行为 的 共享 虚拟环境 动态 负载 分配 　 　 我们 知道 传统 的 负载 分配 的 主要 目标 是 均衡 各个 结点 的 负载 进而 实现 并行计算 以 减小 任务 平均 响应 时间 从而 使 系统 拥有 最大 的 吞吐 率 但是 虚拟环境 的 负载 分配 有 一个 更 高 的 要求 是 首先 保持 实时 交互性 其次 保证 行为 计算 具有 一定 的 真实感 　 基本 思想 　 　 在 拥有 复杂 行为 的 虚拟环境 中 处于 活跃 状态 的 行为 计算 可以 在 本地 进行 也 可以 被 调度 到 远 地 进行 它们 被 分别 称为 局部 行为 和 远程 行为 局部 行为 可以 确保 理论 修改 率 但 很 可能 引起 计算 时间 过长 破坏 了 实时性 远程 行为 的 目的 是 通过 并行 的 方法 降低 计算 时间 为了 保证 理论 修改 率 与 远程 行为 的 信息 交换 需要 同步 我们 称该 远程 行为 为 同步 行为 但是 可能 由于 网络 拥塞 的 原因 同步 行为 的 等待时间 会 很长 同样 破坏 了 实时性 在 这种 情况 下 如果 结点 计算能力 允许 可以 将 相应 的 远程 行为 调入 成为 局部 行为 否则 我们 就要 在 实时性 和 真实感 之间 进行 选择 　 　 当 实时性 和 真实感 相冲突 时 我们 以 牺牲 部分 真实感 来 获取 更 重要 的 实时性 允许 某些 远程 行为 的 信息 交换 可以 不需 同步 等待 该种 行为 被 称为 异步 行为 人们 通常 认为 表现 属性 行为 对 时间 敏感 程度 高而非 表现 属性 行为 则 敏感 程度 低 因此 我们 遵循 的 一条 原则 是 ： 表现 属性 行为 尽量 同步 而 非 表现 属性 行为 异步 的 优先级 更高 　 多用户 的 一致性 　 　 当 多个 用户 共享 一个 虚拟环境 时 由于 每个 用户 所 感知 的 场景 是 相同 的 因此 通常 存在 相同 的 活跃 实体 行为 需要 计算 如果 不 建立 共享 的 远程 行为 来 获取 所 需 的 虚拟环境 信息 就 会 出现 多个 局部 的 行为 副本 这会 引起 共享 虚拟环境 状态 的 一致性 问题 　 　 显然 共享 的 同步 行为 可以 保证 相关 用户 所在 结点 每一 仿真 步 的 状态 一致 但是 很 可能 破坏 实时性 ； 而 异步 行为 将会 带来 状态 的 弱 一致性 我们 遵循 的 一条 原则 是 ： 表现 属性 行为 比非 表现 属性 行为 要求 的 一致性 程度 更高 ； 由于 非 表现 行为 的 弱 一致性 通常 为 用户 所 容忍 因此 非 表现 属性 行为 不 建立 多 副本 另外 由于 各个 结点 的 硬件 性能 的 差别 仿真 推进 的 速度 不同 多个 行为 副本 引起 的 一致性 问题 需要 用 特殊 的 结点 间 同步 的 方法 来 解决 如 保持 每个 用户 所在 结点 的 EndEndLag 的 恒定 　 相关 概念 　 　 每个 实体 的 行为 分为 两类 ： 表现 属性 行为 集合 和 非 表现 属性 集合 实体 Entityi 的 两组 行为 分别 记为 PresentationBehSet （ Entityi ） 和 NonPresentationBehSet （ Entityi ） 　 　 设有 一个 处理机 集合 供 虚拟环境 运行 我们 将 集合 中 的 处理机 统一 称为 结点 结点 集合 可 划分 为 两类 ： 用户 结点 集合 UserNodeSet 和 非 用户 结点 集合 NonUserNodeSet 用户 结点 是 用户 参与 虚拟环境 的 处理机 通过 它 用户 可以 实时 地 与 虚拟环境 交互 并且 可 对 虚拟环境 进行 动态 修改 它 通常 带有 用户 输入 设备 （ 如 三维 鼠标 、 键盘 等 ） 和 输出设备 （ 如 高级 图形 加速卡 、 高质量 显示器 等 ） 虚拟环境 的 三段 计算 在 用户 结点 表现 得 最为 充分 非 用户 结点 是 用来 支持 对 虚拟环境 计算 的 分布 并行处理 的 用户 结点 无法 满足 的 行为 计算 可以 迁移 到 非 用户 结点 来 处理 非 用户 结点 集合 按 分配 到 其 上 的 行为 计算 也 分为 两类 ： 非 表现 属性 行为 结点 集合 NonPresentationBehNodeSet 和 表现 属性 行为 结点 集合 PresentationBehNodeSet 　 　 在 虚拟环境 运行 过程 中 结点 P 上 的 虚拟 实体 Entityi 在 仿真 步 st 有 一个 活跃 行为 表 ActiveBehaviorTablePEntityist 用户 结点 上 的 活跃 行为 按 执行 计算 所在 的 地点 可 分为 局部 行为 集合 LocalBehSetPEntityist 和 远程 行为 集合 RemoteBehSetPEntityist 非 用户 结点 上 只有 局部 行为 集合 用户 结点 上 的 远程 行为 集合 按 等待 计算 输出 属性 值 的 方式 分为 同步 行为 集合 SyncBehSetPEntityist 和 异步 行为 集合 AsyncBehSetPEntityist 类似 地非 用户 结点 上 的 局部 行为 集合 按 等待 计算 输入 属性 值 的 方式 分为 同步 行为 集合 SyncBehSetPEntityist 和 异步 行为 集合 AsyncBehSetPEntityist 　 　 定义 行为 开销 行为 开销 可以 记 为 二元 组 ： 〈 CompCostbehaviorCommCostbehavior 〉 其中 行为 计算 量 CompCost 可以 用 行为 计算 程序 中 的 指令 数来 估算 ； 行为 通信量 CommCost 可以 用 行为 的 输入 、 输出 属性 值 类型 的 大小 总量 来 估算 　 　 定义 行为 输出量 行为 输出量 是 指当 该 行为 被 作为 多个 其他 用户 的 远程 行为 时 每 一 仿真 步 需要 输出 到 其他 用户 结点 的 通信量 可记 为 OutputCostbehaviorijUserNumberbehaviorijst × OutputAttributeCostbehaviori 其中 behaviorij 表示 Entityi 的 第 j 个 行为 behaviorij ∈ LocBehSetPEntityist ； UserNumberbehaviorijst 表示 行为 behaviorij 在 仿真 步 st 时 被 作为 远程 行为 的 其他 用户 个数 ； 行为 输出 属性 量 OutputAttributeCost 可以 用 行为 的 输出 属性 值 类型 的 大小 总量 来 估算 　 　 定义 结点 通信量 用户 结点 P 在 仿真 步 st 的 通信量 可记 为 其中 behaviorij ∈ RemoteBehSetPEntityist ； behaviormn ∈ LocBehSetPEntitymst 用户 状态 通信量 UserStateCostPst 表示 结点 P 在 仿真 步 st 接收 的 感兴趣 的 其他 用户 的 状态 信息量 　 　 非 用户 结点 P 在 仿真 步 st 的 通信量 可记 为 CommCostPstCommCostbehaviorijOutputCostbehaviorij 其中 behaviorij ∈ LocBehSetPEntityist 　 　 现在 我们 来 定义 仿真 计算 延迟 SimuLag 　 　 定义 局部 行为 计算 时间 结点 P 在 仿真 步 st 的 局部 行为 计算 时间 LocBehCompTime 可记 为 LocBehCompTimePstiCompCostbehaviorijsp 其中 behaviorij ∈ LocBehSetEntityist 结点 P 处理 指令 的 平均速度 为 sp 条 指令 s 　 　 定义 行为 等待时间 对 用户 结点 P 而言 行为 behaviorij 的 等待时间 是 指 从 该 仿真 步 开始 到 从 网络 上 得到 相应 行为 计算 输出 属性 值 的 时间 对非 用户 结点 P 而言 行为 behaviorij 的 等待时间 是 指 从 该 仿真 步 开始 到 从 网络 上 得到 下 一 仿真 步 相应 行为 计算 输入 属性 值 的 时间 二者 都 可 记为 WaitTimebehaviorij 其中 behaviorij ∈ SyncBehSetPEntityist 　 　 定义 同步 行为 等待时间 结点 P 在 仿真 步 st 的 同步 行为 等待时间 可记 为 SynBehWaitTimePstMaxWaitTimebehaviorij 其中 behaviorij ∈ SyncBehSetPEntityist 　 　 定义 仿真 计算 延迟 结点 P 在 仿真 步 st 的 仿真 计算 延迟 SimuLag 为 SimuLagPst ＝ MaxLocBehCompTimePstSynBehWaitTimePst 　 　 定义 结点 开销 结点 P 在 仿真 步 st 的 开销 记 为 〈 SimuLagPstCommCostPst 〉 　 　 根据 行为 真实感 的 讨论 每个 结点 都 有 一个 仿真 计算 延迟 上限 时间 MaxSimuLag 如果 超过 了 上限 时间 就 会 造成 实时 交互性 能 的 下降 ； 另外 如果 网络 上 的 通信 负载 过大 必然 会 带来 大 的 网络 延迟 和 主机 开销 （ 尤其 在 以太 网络 条件 下 ） 因此 我们 给 每个 结点 界定 一个 通信量 上限 MaxCommCost 二者 构成 结点 的 性能指标 　 　 定义 结点 性能指标 结点 P 的 性能指标 表式 为 〈 MaxSimuLagPMaxCommCostP 〉 　 　 我们 设 用户 结点 和 非 用户 结点 中 的 表现 属性 行为 结点 的 仿真 计算 延迟 的 上限 时间 为 ST 非 用户 结点 中 的 非 表现 属性 行为 结点 的 仿真 计算 延迟 的 上限 时间 为 ST ′ 则 存在 着 ST ′ ST 　 　 定义 结点 的 性能 潜力 结点 P 在 仿真 步 st 的 性能 潜力 包括 计算 潜力 和 通信 潜力 计算 潜力 是 指 仿真 计算 延迟 上限 时间 与 局部 行为 计算 时间 的 差额 （ 即 MaxSimuLagP － LocBehCompTimePst ） 通信 潜力 是 指 通信量 上限 与 结点 通信量 的 差额 （ 即 MaxCommCostP － CommCostPst ） 　 基于 行为 的 动态 负载 分配 算法 　 　 在 多用户 虚拟环境 中 基于 行为 的 动态 负载 分配 算法 由 一组 算法 组成 启动 的 时机 有 ： 用户 加入 、 退出 虚拟环境 以及 用户 对 虚拟环境 的 修改 引起 的 负载 变化 等 限于 篇幅 下面 我们 仅 介绍 虚拟环境 运行 过程 中 的 动态 负载 分配 算法 　 　 在 虚拟环境 运行 过程 中当 用户 向 虚拟环境 中 增加 新 的 实体 或 改变 实体 的 行为 或 由于 虚拟环境 实体 间 的 交互 激活 了 新 的 行为 、 中止 了 旧 的 行为 时 用户 结点 上 的 负载 将 发生变化 如果 结点 的 仿真 计算 延迟 超过 上限 时间 MaxSimuLag 就要 启动 基于 行为 的 动态 负载 分配 算法 根据 其 原因 进行 相应 的 行为 调度 我们 调度 的 行为 都 是 周期性 行为 或 长时间 的 行为 因为 非 周期 行为 的 不 可预测性 对 其 进行 调度 将会 使 系统 极 不 稳定 而 系统 在 运行 时 可以 判定 周期 行为 和 长时间 行为 为了 防止 行为 调度 的 抖动 我们 设置 了 一个 时间 阈值 只有 当 结点 的 仿真 计算 延迟 SimuLag 超过 上限 时间 MaxSimuLag 所 延续 的 时间 超过 了 阈值 才 启动 基于 行为 的 动态 负载 分配 算法 　 　 设 用户 结点 P 在 仿真 步 st 启动 了 基于 行为 的 动态 负载 分配 算法 算法 描述 如下 ： 　 　 确定 各 实体 在 仿真 步 st 的 活跃 行为 表 ActiveBehaviorTablePEntityistiN 　 　 IFLocBehCompTimePstST 　 引起 负载 增大 的 主要 原因 是 同步 远程 行为 的 等待时间 太 长 　 　 　 THEN 对于 behaviorbehavior ∈ SyncBehSetPEntityist 且 WaitTimebehaviorSTDO 　 　 　 IF 将 behavior 调入 PSimuLagPstST 　 　 　 THEN 对于 表现 属性 行为 创建 behavior 的 局部 副本 ； 对于 非 表现 属性 行为 则 将 远程 行为 改为 异步 行为 ； 　 　 ENDDOELSE 　 引起 负载 增大 的 主要 原因 是 局部 行为 的 计算 时间 过长 限于 篇幅 我们 不 同时 考虑 同步 远程 行为 等待时间 太长 的 情况 在 选择 调出 行为 时非 表现 属性 行为 比 表现 属性 行为 的 优先级 高 　 〈 〉 ［ 非 表现 属性 行为 的 调出 ］ 　 非 表现 属性 行为 不 存在 其他 副本 将 所有 实体 的 所有 局部 非 表现 属性 行为 behavior 按 CompCostbehaviorCommCostbehavior 的 值 进行 从大到 小 排序 DO 　 　 从 NonUserNodeSet 选择 新 的 非 表现 属性 结点 Q 或 将 NonPresentationBehNodeSet 中 的 结点 按 性能 潜力 从大到 小 的 优先 顺序 选择 结点 Q 如果 将 behavior 分配 到 Q 上 SimuLagQst ′ ST ′ 且 CommCostQst ′ MaxCommCostQ 其中 st ′ 是 与 st 相对 应 的 Q 的 仿真 步则 将 behavior 分配 到 Q 上 ； 　 　 IFSimuLagPstSTTHEN 算法 结束 ELSE 继续 循环 ； ENDDO 　 〈 〉 ［ 表现 属性 行为 的 调出 ］ 　 表现 属性 行为 可能 存在 其他 副本 将 所有 实体 的 所有 局部 表现 属性 行为 behavior 按 CompCostbehaviorCommCostbehavior 的 值 进行 从大到 小 的 排序 DO 　 　 IF 存在 behavior 的 其他 副本 　 　 THEN 选择 通信 潜力 最大 的 结点 Q 作为 远程 行为 来 计算 所在 结点 ； 　 　 　 　 　 IFCommCostQst ′ MaxCommCostQ 其中 st ′ 是 与 st 相对 应 的 Q 的 仿真 步 　 　 　 　 　 THEN 共享 Q 上 的 远程 behavior 计算 ； 　 　 　 　 　 IFSimuLagpstSTTHEN 算法 结束 ELSE 继续 循环 　 　 从 NonUserNodeSet 选择 新 的 表现 属性 结点 Q 或 将 PresentationBehNodeSet 中 的 结点 按 性能 潜力 从大到 小 的 优先 顺序 选择 结点 Q 如果 将 behavior 分配 到 Q 上 SimuLagQst ′ ST 且 CommCostQst ′ MaxCommCostQ 其中 st ′ 是 与 st 相对 应 的 Q 的 仿真 步则 将 behavior 分配 到 Q 上 ； 　 　 IFSimuLagPstSTTHEN 算法 结束 ELSE 继续 循环 　 　 ENDDO 　 　 算法 结束 　 测试 　 　 我们 用 YHVML 编写 了 一个 动画 程序 一个 几何 模型 较为简单 的 智能 体 具有 个 周期性 行为 一个 是 表现 属性 行为 MOVE 和 TURN 一个 是 智能 行为 THINKMOVE 在 一个 三维空间 移动 THINK 则 是 进行 一个 大 数据 集合 的 排序 每次 排序 成功 调用 TURN 改变 移动 方向 MOVE 估算 的 执行 时间 是 msTURN 估算 的 时间 为 msTHINK 估算 的 时间 约 ms 我们 取 用户 结点 的 ST 为 ms 非 用户 结点 的 ST ′ 为 ms 虚拟环境 运行 在 以 Mbps 高速 以太 网络 相连 的 两台 PC （ 奔腾 Mhz 主频 MB 内存 SV 的 图形 加速卡 ） 上 在 负载 预 分配 时 THINK 被 分配 到 非 用户 结点 上 运行 等待 方式 设 为 异步 MOVE 的 实际 运行 时间 约 为 msTHINK 的 运行 时间 为 ms 场景 绘制 时间 约 为 ms ～ ms 则 端端 延迟 为 ms 左右 我们 通过 一台 同样 配置 的 PC 作为 新 的 用户 结点 加入 通过 负载 分配 在 新 的 用户 结点 上 产生 了 MOVE 和 TURN 的 行为 副本 两个 用户 看到 的 智能 实体 的 动作 几乎 同步 在 新 的 用户 结点 上 我们 又 动态 地 产生 了 一个 同样 的 智能 实体 放入 虚拟环境 结果 是 该 智能 实体 的 THINK 行为 计算 也 被 分配 到 非 用户 结点 上 运行 而 MOVE 和 TURN 在 两个 用户 结点 上 都 有 副本 运行 两 用户 结点 的 端端 延迟 都 约 为 ms 左右 视觉效果 良好 　 　 测试 结果 证明 了 基于 行为 的 动态 负载 分配 能 综合 考虑 结点 的 处理 能力 、 网络通信 能力 以及 行为 计算 特性 有效 地 调节 系统 负载 在 优先 保证 了 虚拟环境 的 实时 交互性 的 基础 上 尽量 维持 了 行为 的 真实感 这 也 说明 了 YHVRP 在 支持 分布式 虚拟环境 的 应用 开发 方面 具有 较 高 的 灵活性 　 作者 王勇军 年生 博士 助理 研究员 主要 研究 领域 为 虚拟现实 和 并行 分布 处理 技术 王意洁 女年生 博士 助理 研究员 主要 研究 领域 为 数据库 并行 分布 处理 技术 李思昆 年生 教授 博士生 导师 主要 研究 领域 为 CAD 技术 虚拟现实 技术 胡守仁 年生 教授 博士生 导师 主要 研究 领域 为 高性能 机 体系结构 并行 分布 处理 技术 本文 通讯联系 人 ： 王勇军 长沙 长沙 工学院 计算机系 教研室 作者 单位 ： （ 长沙 工学院 计算机系 　 长沙 　 ） 参考文献 　 　 SnowdonDNAVIARYdesignissuesforfuturelargescalevirtualenvironmentsPresenceTeleoperatorsandVirtualEnvironments ～ 　 　 ChrisSMarkGetalDecoupledsimulationinvirtualrealitywiththeMRtoolkitACMTransactionsonInformationsystems ～ 　 　 SinghGSerralPugWetalBrickNetasoftwaretoolkitfornetworkbasedvirtualworldsPresenceTeleoperatorsandVirtualEnvironments ～ 　 　 PanZhigengShiJiaoyingZhangMingminDistributedgraphicssupportforvirtualenvironmentsComputersandGraphics ～ 　 　 BruceMBTinsleyAGMultileveldirectionofautonomouscreaturesforrealtimevirtualenvironmentsInRobertCookedComputerGraphicsProceedingsAnnualConferenceSeriesNewYorkACMSIGGRAPH ～ 　 　 TuXYDemetriTArtificialfishesphysicslocomotionsperceptionbehaviorInAndrewSGMikeKedsComputerGraphicsProceedingsAnnualConferenceSeriesNewYorkACMSIGGRAPH ～ 　 　 JohnsonMBWAVESworld ［ PhDThesis ］ MassachusettsInstituteofTechnology 　 　 CarlssonCHagsandODIVEaplatformformultiuservirtualenvironmentsComputersandGraphics ～ 　 　 KazmanRLoadbalancinglatencymanagementandseparationofconcernsinadistributedvirtualworldInZomayaAedParallelComputerPardigmsandApplicationsVanNostrand ～ 　 　 王勇军 胡守仁 网络 虚拟环境 的 计算 分布 与 调度 计算机 学报 增刊 ～ WangYongjunHuShourenComputationdistributionandschedulingofnetworkedvirtualenvrionmentChineseJournalofComputerssupplement ～ 　 　 WlokaMMLaginmultiprocessorvirtualrealityPresenceTeleoperatorsandVirtualEnvironments ～ 本文 收到 原稿 收到 修改稿