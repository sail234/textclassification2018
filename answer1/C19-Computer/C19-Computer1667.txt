软件 学报 JOURNALOFSOFTWARE 　 Vol 　 No 　 Pk 着色 问题 及其 均场 退火 求解 算法 胡卫明 　 徐俊 华 　 何志均 摘 　 要 ： 均场 退火 方法 既 可以 看作 是 一种 新 的 神经网络 计算 模型 又 可 视为 是 对 模拟退火 的 重大 改进 该文 把 具有 相邻 约束 的 多层 通孔 最小化 问题 转换 为 更具 广泛 意义 的 k 着色 问题 并 提出 了 k 着色 问题 的 均 场 退火 求解 算法 算法 在 线段 相交 图 模型 的 基础 上 提出 了 相邻 矩阵 和 交叠 矩阵 等 概念 并 利用 换位 矩阵 将 问题 映射 为 相应 的 神经网络 再 构造 了 该 问题 的 能量 函数 能量 函数 中 的 目标 项 、 违背 交叠 约束 的 惩罚 项 、 违背 相邻 约束 的 惩罚 项 和 神经元 归一化 处理 保证 了 网络 能够 求解 到 一个 合法 解 实验 结果表明 这是 一个 有效 的 算法 关键词 ： 多层 通孔 最小化 k 着色 问题 均场 退火 方法 分类号 ： TPAMeanFieldAnnealingBasedAlgorithmforkColorableProblemHUWeiming 　 XUJunhuaNationalKeyLaboratoryofTextProcessingTechnologyInstituteofComputerScienceandTechnologyBeijingUniversityBeijingHEZhijunDepartmentofComputerScienceandEngineeringZhejiangUniversityHangzhouAbstract ： ThemeanfieldannealingapproachisanewneuralnetworkmodelwhichimprovesthesimulatedannealingapproachgreatlyInthepapertheviaminimizationprobleminmultilayerroutingwithadjacentconstraintsistranslatedtoakcolorableproblemwhichhasmoregeneralmeaningsandameanfieldannealingalgorithmforthekcolorableproblemisproposedOnthebasisofthesegmentcrossinggraphmodeltheadjacentmatrixandthecrossingmatrixareintroducedApermutematrixofbinaryvariablesisusedtomaptheproblemtotheneuralnetworkandthentheenergyfunctionispresentedTheobjectitemcrossingconstraineditemandadjacencyconstraineditemintheenergyfunctionandthenormalizationofneuronsprovethattheeffectiveresultcanbegottenTheexperimentalresultsshowthatitisaneffectivemethodKeywords ： Viaminimizationinmultilayerroutingkcolorableproblemmeanfieldannealingapproach ▲ 　 　 在 超大规模 集成电路 VLSI 设计 中 减少 通孔 是 一个 具有 现实意义 的 问题 最初 通孔 最小化 的 研究 只 局限 在 双层 布线 上 ［ ］ 三层 布线 出现 后 三层 布线 的 通孔 最小化 问题 也 得到 了 研究 ［ ～ ］ 随着 VLSI 技术 的 发展 三层 以上 的 布线 技术 已经 逐渐 成熟 目前 已 发展 到 了 七层 布线 布线 层数 的 增多 是 集成电路 工艺 发展 的 重要 标志 之一 集成电路 工艺 的 发展 对 CAD 技术 提出 了 许多 新 的 要求 本文 将 多层 通孔 最小化 问题 转换 为 更具 广泛 意义 的 k 着色 问题 并 提出 了 一种 均场 退火 求解 算法 取得 了 较 好 的 效果 有关 用 神经网络 解决 k 着色 问题 的 研究 国内外 尚无 报道 　 图 模型 与 k 着色 问题 　 相交 图 模型 　 　 一个 通孔 最小化 前 的 多层 布线图 可以 用 一个 多层 线段 相交 图来 描述 ［ ］ 多层 线段 相交 图用 GVEV ∪ EC 表示 其中 V 表示 布线图 中 的 线段 图 的 边 由 通孔 边 EV 和 交叠 边 EC 组成 对于 两条 直接 相联 的 属于 同一 线网 的 线段 在 EV 中 就 有 一条 通孔 边 连接 表示 这 两条 线段 的 顶点 在 EC 中若 有 一条 边 连接 两个 顶点 就 意味着 这 两个 顶点 表示 的 线段 相交 或 重叠 　 相邻 矩阵 和 交叠 矩阵 　 　 本文 用 相邻 矩阵 A 表示 组成 各 线网 的 线段 的 连接 情况 用 交叠 矩阵 C 表示 不同 线网 的 线段 的 交叠 情况 当边 ij ∈ EV 时 矩阵 A 的 元素 aij 等于 “ ” 否则 等于 “ ” 当边 ij ∈ EC 时 矩阵 C 的 元素 Cij 等于 “ ” 否则 等于 “ ” 　 相邻 约束 　 　 相邻 约束 限制 了 通孔 只能 连接 相邻 两层 的 线段 　 k 着色 问题 　 　 每 一层 用 一种 颜色 表示 可以 将 k 层 通孔 最小化 问题 描述 为 k 着色 问题 在 相交 图上 用 k 种颜色 对 每个 顶点 进行 着色 由 一边 交叠 边 连接 的 两个 顶点 不能 着 同 一种 颜色 否则 两个 不同 线网 的 线段 将会 在 同 一层 上 相交 或 重叠 相邻 约束 要求 由 通孔 边 连接 的 两个 顶点 只能 着 相同 的 颜色 或 相邻 的 颜色 由 EV 边 连接 的 两个 顶点 尽可能 着 相同 的 颜色 　 均场 退火 方法 　 　 均场 退火 方法 既 可以 看作 是 一种 新 的 神经网络 计算 模型 又 可 视为 是 对 模拟退火 的 重大 改进 均场 退火 只 需要 在 某个 关键 温度 附近 实施 退火 过程 以 达到 某个 热平衡 状态 就 可以 得到 一个 最优 解 或 较 好 的 次优 解 因此 计算 时间 大为 减少 同时 又 具有 模拟退火 相 类似 的 优点 均场 退火 方法 可以 用 神经元 归一化 的 方法 解决 行 约束 问题 均场 退火 方法 可 由 下面 个 方程 表示 其中 V 是 能量 函数 中 的 N 维 状态 矢量 φ i 为均场 g 是 神经元 的 IO 特性 函数 T 是 温度控制 参数 　 神经计算 　 映射 方法 　 　 对于 n 个 顶点 、 k 种颜色 的 着色 问题 可用 n × k 阶 换位 矩阵 ［ vix ］ n × k 表示 行 代表 需要 着色 的 顶点 列 代表 着色 的 种类 换位 矩阵 是 一个 值为 “ ” 或 “ ” 的 矩阵 一个 换位 矩阵 对应 于 一种 可行 的 着色 方案 该 问题 需要 n × k 个 神经元 神经元 ix 的 输出 vix 表示 第 i 个 顶点 应着 颜色 xvix 表示 顶点 i 不能 着 颜色 x 　 能量 函数 与 均 场 　 　 能量 函数 定义 为 其中 　 　 能量 函数 中 的 第项 为 优化 目标 项 它 最小化 通孔 总数 若边 ij ∈ EV 且 顶点 i 和 顶点 j 着 不同 颜色 即 有 通孔 则 否则 　 　 能量 函数 中 的 第项 为 惩罚 项 它 限制 由 交叠 边 相连 的 两个 顶点 不能 着 相同 的 颜色 若 由 交叠 边 相连 的 两个 顶点 着 相同 的 颜色 则 此项 不 为 也就是说 表达式 cijvixcjx 表示 ， 当边 ij ∈ EC 时 cij ≠ 顶点 i 和 顶点 j 不能 着 相同 的 颜色 即 vix 和 vjx 不能 同时 为 “ ” 　 　 能量 函数 中 的 第项 为 违背 相邻 约束 的 惩罚 项当且 仅 当 由 通孔 边 相联 的 两个 顶点 着 相同 颜色 或 相邻 颜色 时 它 为 颜色 “ ” 的 相邻 颜色 只有 颜色 “ ” 颜色 k 的 相邻 颜色 只有 颜色 k 而 颜色 x ≤ x ≤ k 的 相邻 颜色 有 颜色 x 和 颜色 xA 和 B 即起 这种 控制 作用 　 　 若 参数 α 和 β 取 较大 值 网络 能 较 快 收敛 到 一个 可行 解 但解 的 质量 不 一定 好 若 α 和 β 取较 小值 网络 能 求得 更好 的 解 但 要 用 更长 的 计算 时间 为 代价 根据 经验 α 和 β 取是 合适 的 均 场 退火 网络 都 能 求得 可行 解 　 　 能量 函数 E 对 vix 求一阶偏 导数 即得 均场 　 神经元 归一化 　 　 由于 每个 顶点 只能 着 一种 颜色 所以 换位 矩阵 中 每行 的 神经元 只有 一个 为 “ ” 称为 行 约束 在 均 场 退火 网络 中 可以 采用 神经元 归一化 的 方法 来 解决 行 约束 问题 神经元 的 输出 状态 矢量 vix 可以 看作 是 当 顶点 i 在 随机 平衡 扰动 中着 颜色 x 的 概率 它 服从 Boltzmann 分布 即 vix ≈ exp φ ixT 为了 获得 实际 概率 对 神经元 的 输出 vix 进行 归一化 即 它 保证 了 每个 顶点 只能 着 一种 颜色 从而 也 就 满足 了 行 约束 　 算法 过程 　 　 综上所述 均场 退火 过程 的 主要 步骤 可 描述 如下 　 　 随机 选取 vix 的 值 并 进行 归一化 处理 即 　 　 repeat 　 　 　 随机 选择 任一 顶点 iTotal 　 　 　 forxtok 　 　 　 　 　 　 　 　 　 　 TotalTotalexp φ ixT 　 　 　 　 　 　 forxtokvixexp φ ixTTotal 　 　 untill Δ E ＜ ε 其中 Δ E 是 相邻 两次 E 的 差 Δ E 是 热平衡 条件 ε 越小 求得 的 解越 好 但 迭代 时间 也 就 越长 　 时间 复杂性 　 　 由于 kn 所以 在 均 场 退火 过程 中 每次 迭代 的 时间 复杂性 为 On 为了 使 网络 达到 热平衡 状态 需要 进行 On 次 迭代 所以 均场 退火 过程 的 时间 复杂性 为 On 　 定色 约束 　 　 在 实际 应用 中 有时 规定 某些 顶点 只能 着 某些 特定 的 颜色 称为 定色 约束 可以 考虑 两种 定色 约束 方式 第种 情况 某一 特定 的 顶点 只能 着 某 一 特定 的 颜色 如 顶点 n 只能 着 颜色 k 顶点 n 只能 着 颜色 k 等 本文 用 了 一个 定色 矩阵 P 来 表示 这种 关系 矩阵 的 行 表示 顶点 矩阵 的 列 表示 颜色 当 顶点 i 必须 着 颜色 x 时 pix 否则 均 为 pix 第种 情况 所有 特定 的 顶点 可以 着 特定 的 m 种颜色 kkkmm ＜ kk 着色 中 的 任何 一种 对于 这种 情况 可用 线段 相交 图来 处理 在 线段 相交 图上 加上 km 个 哑 顶点 哑 顶点 分别 着 上 km 个 特定 的 顶点 所 不能 着 的 颜色 将 这些 顶点 与 所有 哑 顶点 用 交叠 边 连接 再 将 哑 顶点 所 着 的 颜色 加到 定色 矩阵 中 对于 定色 约束 需在 能量 函数 中 增加 约束 项当且 仅 当 在 换位 矩阵 与 定色 矩阵 中为 “ ” 的 元素 位置 相对 应 的 元素 都 为 “ ” 时 它 为 这项 约束 使得 某些 顶点 能够 着 上 特定 的 颜色 　 实验 与 结论 　 　 本 算法 已用 VisualC 编程 在 Founder 计算机 上 实现 我们 用 一些 已 发表 文献 的 布线 例子 来 验证 本 k 着色 问题 求解 算法 表列出 了 几个 实例 的 执行 结果 对于 三层 布线 的 实例 即 着色 问题 本 算法 的 结果 要 好 于 文献 ［ ］ 和 文献 ［ ］ 的 启发式 三层 通孔 最小化 算法 一个 来自 文献 ［ ］ 的 五层 布线图 即 着色 问题 也 作为 例子 运行 其 结果 令人满意 Table 　 Experimentalresultsformultilayerconstrainedlayerassignment 表 　 多层 通孔 最小化 实验 结果 Numberofexamples ① Numberoflayers ② Numberofnets ③ Numberoforiginalvias ④ Numberofviasrequiredfrom ⑤ Runtime ⑨ sSourceofexamplesAlgorithminRef ［ ］ ⑥ AlgorithminRef ［ ］ ⑦ Ouralgorithm ⑧ sFiginRef ［ ］ FiginRef ［ ］ FiginRef ［ ］ FiginRef ［ ］ ① 例号 ② 层数 ③ 线网 数 ④ 原 通孔 数 ⑤ 所 需 通孔 数 ⑥ 文献 ［ ］ 中 的 算法 ⑦ 文献 ［ ］ 中 的 算法 ⑧ 本 算法 ⑨ 运行 时间 例子 来源 文献 ［ ］ 中 的 图 文献 ［ ］ 中 的 图 文献 ［ ］ 中 的 图 文献 ［ ］ 中 的 图 　 　 综上所述 本文 将 具有 相邻 约束 的 多层 通孔 最小化 问题 转换 为 更具 一般 意义 的 k 着色 问题 并 应用 均场 退火 方法 求解 该 问题 在 线段 相交 图 的 基础 上 建立 了 相邻 矩阵 、 交叠 矩阵 并 据此 建立 了 问题 的 能量 函数 能量 函数 中 的 目标 顶 、 违背 交叠 约束 的 惩罚 项 、 违背 相邻 约束 的 惩罚 项 和 神经元 归一化 处理 保证 了 网络 能够 求解 到 一个 合法 解 算法 具有 较 快 的 收敛 速度 和 较 高 的 求解 质量 ■ 基金项目 ： 本文 研究 得到 国家自然科学基金 No 和 中国 博士后 科学基金 资助 作者简介 ： 胡卫 明年 生 博士 工程师 主要 研究 领域 为 ICCAD 人工神经网络 GIS 　 　 　 　 　 徐俊 华女 年生 工程师 主要 研究 领域 为 人工神经网络 　 　 　 　 　 何志均 年生 教授 博士生 导师 主要 研究 领域 为 人工智能 智能 软件开发 环 　 　 　 　 　 境 CAD 作者 单位 ： 胡卫明 北京大学 计算机 科学技术 研究所 文字 信息处理 技术 国家 重点 实验室 　 北京 　 　 　 　 　 　 徐俊 华 北京大学 计算机 科学技术 研究所 文字 信息处理 技术 国家 重点 实验室 　 北京 　 　 　 　 　 　 何志均 浙江大学 计算机科学 与 工程学系 　 杭州 　 参考文献 ： ［ ］ HeJianganHongXianlongAnefficienttwolayerrouterbasedonunconstrainedviaminimizationJournalofSoftware ～ 何 江安 洪先龙 一个 基于 无约束 通孔 优化 的 的 双层 布线 算法 — — FOREST 软件 学报 ～ ［ ］ ChangKCDuHCLayerassignmentproblemforthreelayerroutingIEEETransactionsonComputerC ～ ［ ］ ChangKEJyuHFFengWSConstrainedviaminimizationforthreelayerroutingComputerAidedDesign ～ ［ ］ FangSCChangKEFengWSViaminimizationwithassociatedconstraintsinthreelayerroutingproblemInProceedingsofIEEEISCAS ～ ［ ］ AhnKSahniSConstrainedviaminimizationIEEETransactionsonCAD ～ ［ ］ FangSCChangKEFengWSetalConstrainedviaminimizationwithpracticalconsiderationsformultilayerVLSIPCBroutingproblemsInProceedingsofIEEEthDAC ～ ［ ］ ChenYKLiuMLThreeLayerchannelroutingIEEETransactionsonCADCAD ～ ［ ］ BraunDBurnsJRomeoFetalTechniquesformultilayerchannelroutingIEEETransactionsonCAD ～