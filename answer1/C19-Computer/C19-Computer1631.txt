信息 与 控制 INFORMATIONANDCONTROL 年 第卷 第期 VolNo 进化 算法 在 jobshop 调度 问题 中 的 应用 研究 翁妙 凤王 　 直 　 　 摘 　 要 ： 研究 了 应用 进化 算法 遗传算法 GA 和 进化 规划 EP 以及 混合 模拟退火 进化 算法 SAGA 和 SAEP 求解 jobshop 调度 问题 ． 仿真 实验 结果表明 这 四种 算法 是 可行 的 ． 文中 最后 对 它们 的 优劣 作 了 比较 ． 　 　 关键词 ： 进化 算法 ， 模拟退火 法 ， 调度 问题 　 　 中 图 分类号 ： TP 　 　 　 　 　 　 文献 标识码 ： BASTUDYONAPPLICATIONOFEVOLUTIONARYALGORITHMSTOJOBSHOPSCHEDULINGPROBLEMSWENGMiaofengWANGZhiEastChinaShipbuildingInstituteZhenjiangAbstractTheimprovedmethodssolvingjobshopschedulingproblemsusingevolutionaryalgorithmsGAandEPandcombinedevolutionaryalgorithmswithsimulatedannealingalgorithmSAGAandSAEParediscribedinthispaperComuputersimulatedresultsshowthatthefourmethodsarepossibleIntheendacomparisonfortheirefficiencyispresented 　 　 Keywordsevolutionaryalgorithmssimulatedannealingalgorithmschedulingproblem 　 引言 　 　 进化 算法 遗传算法 GA 和 进化 规划 EP 以及 混合 模拟退火 进化 算法 SAGA 和 SAEP 是 求解 jobshop 调度 问题 JSP 的 有效 方法 ． 四种 算法 均 采用 了 统一 简单 的 二维 矩阵 编码 使 遗传操作 在 基因 的 移动 区内 进行 基因 交换 故 算法 的 收敛 速度 非常 快见 仿真 ． 　 问题 的 描述 　 　 JSP 的 目标 是 n 个 工件 在 m 台 机器 上 的 加工 路线 不同 如何 安排 每台 机器 上 工件 的 加工 顺序 在 满足 不 超期 交货 的 条件 下 使得 n 个 工件 总 的 完工 时间 最小 ． JSP 的 约束条件 如下 ： 　 　 设 n 个 工件 分成 r 类 ： JJJ … JnJi ∈ r ； 每 类 工件 的 操作 顺序 不同 ． m 台 机器 MMM … Mm 各自 能 加工 的 操作 不全 相同 且 完成 相同 操作 的 加工 时间 也 不 相同 ． 机器 加工 各 操作 所 需 的 安装时间 与 此 机器 前 一 加工 操作 有关 ． 文中 的 安装时间 是 指 刀具 更换 时间 ． 当 机器 最初 和 加工 结束 后 处于 空闲 等待 状态 时 视为 操作 ； 空闲 等待 时 可以 先 更换 刀具 ． 每 类 工件 有 各自 的 交货 期限 要求 ． 工件 在 零 时刻 都 可得且 不 考虑 当 加工 完工 件 的 每 一 操作 放入 相应 缓冲区 中 的 时间 ． 　 JSP 的 进化 算法 GA 和 EP 实现 染色体 个体 的 表示 　 　 GA 和 EP 的 染色体 个体 均 用 二维 矩阵 Ssijm × l 表示 基因 sij … l ； 其中 m 表示 机器 数 l 表示 n 个 工件 的 总 操作数 ． 任一 非零 矩阵 元素 称非 零 元素 值均 不 相等 其 表示 n 个 工件 的 所有 工序 统一 编号 ． 如 文中 的 仿真 实例 将个 工件 的 总个 工序 统一 编号 见表 l 则 等于 ． 在 S 中 无用 零 矩阵 元素 称 零 元素 都 在 行右 ： 即 siki ≠ ， 有 siui … muki … ldi 为 S 中 第 i 行上 的 非 零 元素 个数 ． 表个 工件 的 总个 工序 统一 编号 表 ACBDACBDACBDBDEBDEBDEBAFBAFBAFBAF 　 　 注 ： 表中 字母 A ～ F 表示 操作 类型 ， 其 右上角 数字 表示 工件 号 　 　 染色体 个体 满足 可行 解 的 约束条件 为 ① 机器 约束 ： 每一 操作 非零 元素 必须 在 可供使用 的 机器 上 加工 ． ② 操作 顺序 约束 ： 对 任一 工件 其 第个 工序 在 矩阵 中 的 列 号 小于 第个 工序 的 列 号 中间 工序 的 列 号 大于 前 一 工序 的 列 号 而 小于 后 一 工序 的 列 号 最后 工序 的 列 号 大于 前 一 工序 的 列 号 文中 所述 工序 次序 皆 指 同一 工件 而言 ． 　 　 设 sijskfj ≠ f 为 一 工件 的 二个 工序 ． 当 sij 时称 sij 有 空闲 等待 ； 当 skfsij － 且 f ＜ j 时称 skf 为 sij 的 前 一 工序 ； 当 skfsij 且 f ＞ j 时称 skf 为 sij 的 后 一 工序 ． GA 和 EP 的 初始 群体 设定 　 　 先给 任 一个 体矩阵 S 置 零 然后 按 如下 步骤 随机 给 l 个 矩阵 元素 置 不同 ～ l 的 整数 值且 满足 可行 解 的 约束条件 ： forptoldo 　 　 查表 如 查表 判 p 在 工件 中 的 工序 次序 ； 如果 p 是 第个 工序 则 根据 p 的 操作 类型 随机 产生 可供使用 的 行号 机器 i 并 在内 随机 产生 列号 j 置 sijp 否则 即 p 为 中间 工序 或 最后 工序 根据 p 的 操作 类型 随机 产生 可供使用 的 行号 机器 k 并 在 S 中 找到 p 的 前 一 工序 的 列 号 g 在 gl 中 随机 产生 一列 号 fg ≤ f ≤ l 置 skfp ． 　 　 在 建立 初始 群体 时 由于 顺序 将 到 l 个 工序 给 个体 的 基因 置 初值 每个 工序 的 后 一 工序 必定 在 该 工序 之后 出现 故 不必 找后 一 工序 的 列 号 ． 　 　 通过 立体 搜索 前移 个体 矩阵 中 的 非 零 元素 　 　 对 个体 矩阵 S 逐行 行号 i 从 到 imodm 逐列列 号 j 从 或 断点 到 l 扫描 非零 元素 sij 若 sij 是 第个 工序 则 前移 到 本行 的 第个 零 元素 处 互换 并 置 前移 标志 否则 判 工序 sij 的 前 一 工序 sij 是否 前移 过 ， 若 前移 过则 由 j 向 左 找 sij 的 列 号 ff ＜ j 将 sij 前移 到 i 行 f 列后 的 第个 零 元素 处 互换 ； 若 sij － 未 前移 过则 把 sij 作 断点 扫描 下 一行 … 直到 S 中 的 l 个 非 零 元素 全部 前移 而 无用 零 都 后移 到 行右 ． GA 和 EP 的 个体 适应 值 计算 　 　 在 通过 立体 搜索 前移 个体 的 非 零 元素 过程 中 求得 其 适应 值 ． 设 as ′ ijs ′ ijtsij 和 Lsij 分别 为 个体 S 中 工序 sij 在 机器 i 上 的 安装时间 运行 时间 和 完工 时间 ； s ′ ijs ′ ij 和 s ′ ij 分别 为 sijsij 和 sij 的 操作 类型 ； aAB 为 操作 A 变为 操作 B 的 安装时间 换刀 时间 ； 令当 j － 且 sij 为 第一个 工序 时 s ′ ijLsij ； 当 j － 且 sij 为 非 第一个 工序 时 s ′ ijsijLsij ． 　 　 求 任一 工序 sij 的 完工 时间 Lsij ： ① sij 为 第个 工序 ： LsijLsijas ′ ijs ′ ijtsij ； ② sij 为 非 第个 工序 ： i 当 sij 有 空闲 等待 时若 sij ≠ 且 Lsijminas ′ ijas ′ ij ， as ′ ijs ′ ijLsij － 则 LsijLsijminas ′ ijas ′ ijas ′ ijs ′ ijtsij 否则 LsijLsij － tsij ； iisij ≠ 无 空闲 等待 时 Lsijmaxtsij ． 　 　 求 任一 机器 i 上 最右 后 一个 操作 非零 元素 的 完工 时间 Ti 和 任一 工件 k 的 完工 时间 LLk ： TiLsijsif ≠ 有 f ＜ u ≤ l 时 siu ． 由 工序 统一 编号 表中查 得 任一 工件 k 的 最后 一个 工序 x 求出 x 的 完工 时间 Lx 置 LLkLx ． 　 　 求 染色体 个体 S 的 适应 值 ． 其中 β 为 合适 的 惩罚 系数 Dk 为 工件 k 的 交货 时间 ． 群体 中 求得 的 个体 最小 适应 值 即 为 n 个 工件 的 加工 时间 ． GA 的 遗传 算子 　 　 选择 算子 最佳 个体 保存 ： 将 每代 群体 按 适应 值 升序 排序 取排 在 前 最佳 的 个体 复制到 下一代 然后 取排 在 前 的 个体 进行 交叉 和 变异 ． 　 　 为了 使 个体 经 交叉 变异 后能 满足 操作 顺序 约束 要求 须 先求 需要 移动 的 工序 之 移动 区 ： 设 个体 S 中 的 元素 sij 的 移动 区为 开区间 WlWr ； Wl 为 sij 的 前 一 工序 sij － 在 S 中 的 列 号 Wr 为 sij 的 后 一 工序 sij 在 S 中 的 列 号 ． 只有 Wr － Wl 时 才能 对 该 个体 进行 交叉 变异 否则 重选 待 移动 工序 非零 元素 直到 其 移动 区 的 长度 时 为止 ． 　 　 交叉 算子 实现 两个 数对 的 交换 ： ① 根据 交叉 率 文中 PC 随机 地 在 匹配 集中 选取 两个 父 个体 A 和 B ． 在 A 中 随机 选取 一个 非零 基因 aij 获其 移动 区 aa ； 在 B 中 找 一个 与 aij 值 相等 的 基因 bkf 获 bkf 的 移动 区 bb ． ② 在 bb 内 随机 产生 一列 号 eb ＜ e ＜ b 并 随机 产生 可 加工 aij 操作 类型 的 行号 机器 g 找到 bge 的 移动 区 bb ． 若 bkf 在 bb 内即 b ＜ f ＜ b 且 行号 k 为 bge 的 操作 类型 可 加工 的 机器 置 flag ． ③ 在 A 内 找 与 bge 值 相等 的 基因 atv 获 atv 的 移动 区 aa ． 若有 iaij 在 aa 内即 a ＜ j ＜ a 且 atv 在 aa 内即 a ＜ V ＜ aii 行号 i 为 工序 atv 的 操作 类型 可 加工 的 机器 且 行号 t 为 aij 的 操作 类型 可 加工 的 机器 置 flag ． ④ 若 flag 与 flag 则 将 数 对 aij 与 bge 交换 atv 与 bkf 交换 ． 　 　 根据 变异 率 文中 Pm 随机 找 一个 交叉 后 的 新 个体 S ． 在 S 中 随机 找 一非 零 基因 sij 获 sij 的 移动 区 aa 在 aa 内 随机 产生 一列 号 fa ＜ f ＜ a 并 随机 产生 一可 加工 sij 的 操作 类型 行号 机器 k ． 求得 skf 的 移动 区 aa 包含 sija ＜ j ＜ a 且 行号 机器 i 可 加工 skf 的 操作 类型 ， 则 将 数 对 sij 与 skf 交换 ． 　 　 上 交叉 或 变异 算子 产生 的 新 个体 均 满足 可行 解 条件 但 还 必须 进行 立体 搜索 前移 个体 中 的 非 零 元素 使 无效 零移 后 然后 将 这些 新 个体 以及 交叉 和 变异 不 成功 的 父 个体 放入 下一代 ． EP 的 选择 算子 和 变异 算子 　 　 选择 算子 ： 置 初始 群体 规模 为 偶数 将 每代 群体 按 适应 值 升序 排序 ． 取排 在 前 最佳 的 个体 复制到 下一代 余下 的 个体 进行 变异 ． 　 　 变异 算子 ： 进化 规划 只有 变异 算子 而 没有 交叉 算子 将 需要 变异 的 个体 随机 选择 如下 种 变异 算子 详见 文献 基因 只能 在 其 移动 区内 移动 中 的 一种 进行 变异 ： ① Win 互换 个体 同行 上 的 两个 矩阵 元素 ； ② Wbt 互换 个体 两个 不同 行上 的 矩阵 元素 ； ③ Sin 将 个体 中 的 一个 非零 元素 与其 移动 区内 同行 零 元素 互换 WinSin ； ④ Sbt 将 个体 中 操作 数最多 行上 的 一个 非零 元素 与其 移动 区内 的 另 一 可 加工 其 操作 类型 行上 的 零 元素 互换 ； ⑤ Tin 将 个体 中 某行 最右 一个 有 空闲 等待 工序 的 前 一 工序 前移 到 其 移动 区内 同行 的 第一个 零 元素 处 ； ⑥ Tbt 将 个体 中 某行 最右 一个 有 空闲 等待 工序 的 前 一 工序 移到 其 移动 区内 并 可 加工 其 操作 类型 之 另 一行 上 的 第一个 零 元素 处 ． 　 　 上述 变异 算子 产生 的 新 个体 均 满足 可行 解 条件 但 还 须 将 这些 新 个体 进行 立体 搜索 前移 个体 中 的 非 零 元素 然后 将 这些 新 个体 以及 变异 不 成功 的 父 个体 放入 下一代 ． 　 JSP 的 混合 模拟退火 进化 算法 SAGA 和 SAEP 实现 　 　 由于 模拟退火 法 SA 在 搜索 过程 中 随机 接受 某些 劣 化解 因而 具有 较强 的 全局 搜索 能力 能够 跳出 局部 极小 点 ． 而 上 进化 算法 的 最佳 个体 保存 选择 算子 会 导致 局部 最优 个体 急速 增加 进化 有 可能 过早 收敛 ． 因此 文中 混合 使用 SA 和 进化 算法 即 产生 SAGA 和 SAEP 来 改善 上 GA 和 EP 遗传操作 后 的 选择 机制 SAGA 和 SAEP 的 其它 遗传操作 分别 同 GA 和 EA ． 文中 的 仿真 实例 中 初始 温度 TTtTt 每代 降温 率为 由于 收敛 判据 为代故 没有 设置 终止 温度 ． 接受 概率 依 Metrolis 准则 ： y ＜ y 或 expyyT ＞ ρ 时子 个体 替换 其父 个体 y 是 父 个体 的 适应 值 y 是子 个体 的 适应 值 T 是 温度 系数 ρ 是 和 之间 均匀分布 的 随机数 ． 令 ① 在 交叉 中设 i 和 i 交叉 成 i 和 i 若 i 的 适应 值比 i 的 适应 值小则 用 i 替换 i 否则 i 按 概率 替换 i ； 同样 地若 i 的 适应 值比 i 的 适应 值小则 用 i 替换 i 否则 i 按 概率 替换 i ． ② 在 变异 中设 i 变异 为 i 若 i 的 适应 值比 i 的 适应 值小则 用 i 替换 i 否则 i 按 概率 替换 i ． 将 交叉 或 变异 后 替换 过 的 父 个体 进行 立体 搜索 前移 非零 元素 然后 将 全部 父 个体 保存 到 下一代 中 去 ． 　 仿真 结果 　 　 设有 个 工件 在 四台 机器 上 加工 ； JJ 为 第类 工件 JJ 为 第类 工件 JJ 为 第类 工件 ． 各类 工件 所 需 的 操作 为 第类 ： ACBD ； 第类 ： BDE ； 第类 ： BAF ． 这 类 工件 的 交货 期限 分别 为 ． 个 工件 的 工序 总数 为 其 统一 编号 见表 ． 四台 机器 加工 各 操作 所 需 安装时间 见表 各 操作 在 机器 上 的 运行 时间 见表 ． 表 还 反映 了 四台 机器 各自 能 加工 的 操作 类型 ． 仿真 实例 的 群体 规模 收敛 判据 惩罚 系数 β 实验 得到 ． 四种 算法 的 调度 结果 参见 文献 略 仿真 结果 比较 见表 CPU 时间 算法 得到 最优 解 收敛 时 在 机上 所 需 的 时间 s ． 表 四台 机器 加工 各 操作 所 需 安装时间 　 MMMMABCFBCDEBDFEFABCD 　 E 　 F 　 表 各 操作 在 机器 上 的 运行 时间 　 ABCDEFM 　 M 　 M 　 　 M 　 表 四种 算法 的 结果 比较 　 GAEPSAGASAEP 最佳 适应 值 收敛 代数 CPU 时间 ssss 注 ： 表和表中 无 数字 的 表项 为 无 意义 、 非法 表项 　 　 实验 表明 这 四种 算法 均 能 找到 较为 满意 的 调度 结果 各 工件 的 完工 时间 均 能 满足 交货 期限 要求 ． 由表 可知 ： ① SAEP 得到 的 解 最优 即 工件 的 加工 时间 最短 ； 而 EP 得到 的 解 最差 即 工件 的 加工 时间 最长 ． ② EP 的 CPU 时间 为 S 收敛 最快 而 SAGA 的 CPU 时间 为 S 收敛 最慢 ． ③ 混合 模拟退火 进化 算法 SAGA 和 SAEP 得到 的 解均 优于 进化 算法 GA 和 EP 但 收敛 速度 均 慢得 多 SAGA 的 CPU 时间 为 GA 的 倍 而 SAEP 为 EP 的 倍 ． ④ 进化 规划 EP 和 SAEP 的 收敛 速度 比 遗传算法 GA 和 SAGA 快得多 GA 的 CPU 时间 为 EP 的 倍 SAGA 为 SAEP 的 倍 ． 从 上 比较 结果 分析 SAEP 优于 其它 三种 算法 解 最优 收敛 也 较 快 ． 　 结论 　 　 四种 算法 求解 JSP 都 是 有效 可行 的 ． 由于 SA 以 一定 的 概率 接受 较差 的 个体 改进 了 进化 算法 的 选择 机制 克服 了 GA 和 EP 的 “ 过早 收敛 ” 问题 但 进化 算法 比 混合 模拟退火 进化 算法 的 收敛 速度 快得多 ． 进化 规划 EP 或 SAEP 的 收敛 速度 比 遗传算法 GA 或 SAGA 快得多 ． 文中 用 惩罚 函数 法 处理 了 工件 的 交货 期限 约束 ； 用 抛弃 不 可行 解法 处理 了 机器 约束 和 操作 顺序 约束 ． 算法 在 对 个体 交叉 和 变异 时使 需要 移动 的 基因 只能 在 其 移动 区内 移动 进行 基因 交换 大大 地 提高 了 搜索 效率 加快 了 遗传操作 的 速度 从而 使 算法 收敛 非常 快见表 由此 说明 本 算法 求解 JSP 的 有效性 ． 作者简介 　 　 翁妙 凤女 副教授 ． 研究 领域 为 计算机软件 及 人工智能 ． 　 　 王 　 直 ， 男 ， 副教授 ． 研究 领域 为 自动控制 ． 作者 单位 ： 华东 船舶工业 学院 　 镇江 　 参考文献 　 GoldingDEGeneticAlgorithmsinSearchOptimizeandMachineLearningNewYork ： AddisoWesley ， ～ 方剑 等 ． 基于 事件驱动 的 JobShop 仿真 调度 系统 ． 系统 仿真 学报 ： ～ 翁妙凤 ． 解 Jobshop 调度 问题 的 混合 模拟退火 进化 规划 ． 信息 与 控制 ： 收稿 日期