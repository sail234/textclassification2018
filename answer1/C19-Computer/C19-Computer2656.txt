软件 学报 JOURNALOFSOFTWARE 年 　 第卷 　 第期 　 Vol 　 No 　 形态 模板 分解 的 逼近 算法 与 应用 邹荣金 　 蔡士杰 　 张福炎 摘要 　 文章 描述 了 一种 获取 形态 模板 分解 的 逼近 算法 ， 实现 了 二维 形态 模板 的 双向 正交 分解 ， 使 算法 具有 较 快 的 处理速度 形态 模板 分解 对于 提高 形态 图像处理 计算 的 效率 是 一种 非常 有用 的 技术 文章 还 针对 图像 中 的 直线 交点 、 端点 形态 模板 检测 进行 了 试验 研究 关键词 　 模板 分解 ， 卷积 运算 ， 最小 二乘 逼近 ， 计算机 图形学 ， 图像识别 中图法 分类号 　 TPAnApproximateAlgorithmandItsApplicationoftheMorphologicalTemplatesDecompositionZOURongjinCAIShijieZHANGFuyanStateKeyLaboratoryforNovelSoftwareTechnologyNanjingUniversity 　 Nanjing 　 DepartmentofComputerScienceJiangsuUniversityofScienceandTechnology 　 Zhenjiang 　 Abstract 　 InthispaperanapproximatealgorithmofobtainingmorphologicaltemplatesisdescribedandthebidirectionalorthogonaldecompositionofthetwodimensionalmorphologicaltemplatesisrealizedThedecompositionofmorphologicaltemplatesisausefultechniqueforenhancingthecomputationalefficiencyofmorphologicalimageprocessingoperationsTherecognitionalgorithmoftheintersectionpointsandtheendpointsofthelinesinengineeringdrawingsbasedonthemorphologicaltemplatesisalsoproposedinthispaperKeywords 　 Templatedecompositionintervolveproductoperationleastsquaresapproximationcomputergraphicsimagerecognition 　 　 在 过去 的 年 中 ， 形态 模板 作为 一种 强有力 的 工具 ， 已 广泛 用于 图像处理 和 分析 ［ ～ ］ 基本 形态 扩张 和 侵蚀 以及 它们 的 组合 的 图像 运算 操作 也 对 形态 模板 元素 的 分析 、 提取 起 了 很大 的 作用 对于 形态 模板 分解 的 需求 是 基于 下面 两种 要求 提出 的 第 ， 几种 专门 的 支持 形态 运算 图像处理 模式 （ 结构 ） 对 模板 的 大小 和 形状 有 一些 约束条件 ， 如 典型 的 × 模板 但是 形态 模板 并 无 必要 限制 在 这样 小 的 一个 邻域 内 对于 这种 情况 ， 将 形态 模板 分解 为 小 邻域 模板 的 方法 为 形态 模板 的 操作 运算 提供 了 有效 手段 许多 学者 ［ ～ ］ 已经 注意 到 了 关于 二值 图像 或 灰度 图 形态 模板 分解 的 问题 第 ， 它 有助于 降低 计算 一个 特定 的 图像 形态 变化 的 复杂度 　 　 一个 可分解 的 模板 是 指 ， 该 模板 可 做成 一个 具有 水平 向量 和 垂直 向量 的 向量 矩阵 模板 ， 并且 这个 模板 的 分离 部分 在 最小 二乘 意义 上 与 原始 模板 逼近 本文 提出 的 这种 方法 的 实质 是 找出 可 分离 模板 的 一组 在子 空间 正交 的 基 ， 然后 将 指定 的 模板 投影 到子 空间 的 基 模板 中 ， 所 产生 的 模板 与 原始 模板 具有 最小 二乘 意义 上 的 逼近 对于 原始 模板 可分解 的 情况 ， 这种 方法 产生 了 模板 的 精确 分解 ， 但 其 要求 的 计算 量 很大 ， 特别 是 取得 N × N 模板 的 最小 二乘 分解 ， 需要 NNNN 次 乘法 和 NNNN 次 加法 　 　 本文 提出 了 一种 简化 算法 ， 用于 实现 形态 模板 的 最小 二乘 逼近 的 分解 ， 并 降低 计算 复杂度 同时 ， 针对 图像 中 直线 交点 、 端点 的 形态 模板 检测 进行 了 试验 研究 　 用于 图像 信息提取 的 形态 模板 与 卷积 运算 　 　 为了 对 图像 空间 的 各种 结构 信息 进行 提取 ， 常常 使用 某种 特定 的 二维 形态 模板 进行 空间 卷积 运算 ， 以 达到 突出 某种 信息 或 抑制 另 一种 信息 的 目的 空间 卷积 是 对 邻域 的 各点 进行 线性 （ 加权 ） 运算 ， 卷积 的 权函数 可以 表示 成 一个 矩阵 ， 通常 称为 形态 模板 根据 选择 ， 模板 N × N 的 大小 可以 为 × ， × 或 × 等 空间 卷积 的 一般 形式 为 　 　 　 　 　 　 式 中 Q 为 输出 图像 阵列 ， F 为 输入 图像 阵列 ， W 为 卷积 阵列 　 　 平滑 算子 是 一种 常用 的 消除 图像 噪声 的 形态 模板 ， 以下 是 种 典型 的 模板 算子 　 　 对于 线状 物体 ， 根据 所 要 检测 的 方向线 ， 可以 设计 一些 方向 算子 ， 用以 分别 检测 纵向 、 横向 、 左 对角线 和 右 对角线 方向 的 线状 物体 ， 如下 所示 。 　 　 　 　 　 　 a 横向 　 　 b 右 对角线 方向 　 　 　 c 纵向 　 　 　 　 　 d 左 对角线 方向 　 　 由于 在 形态 模板 移动 运算 过程 中 ， 每个 像素点 需要 进行 n × n 区域 的 局部 运算 ， 其 计算 量 很大 ， 尤其 对于 大幅面 工程图纸 扫描 图像 以及 实时性 要求 较 高 的 应用 系统 ， 其 影响 较为 显著 同时 ， 随着 目前 扫描 分辨率 的 显著 提高 ， 图像 的 精细 程度 也 在 明显提高 ， 使用 小 的 形态 模板 ， 一方面 限制 了 图形 结构 的 完整性 分析 ， 另一方面 计算 量 也 显著 增加 ， 因此 越来越 多 的 各种 扩展 形态 模板 （ n ） 使用 到 实际 的 图像 结构 分析 之中 考虑 到 相邻 点 的 相关性 ， 如何 找到 两组 正交 的 一 维基 来 取代 这种 二维 的 局部 运算 是 本文 考虑 的 关键 之 所在 即 通过 对 图像 进行 两个 正交 的 方向 各 只 进行 一次 的 一维 运算 ， 来 完成 形态 模板 的 二维 运算 功能 　 形态 模板 的 分解 逼近 算法 　 　 设有 一个 N × N 的 矩阵 形态 模板 　 　 　 　 　 　 　 　 　 　 　 这里 的 关键 是 确定 两个 模板 ， 一个 是 起 垂直 作用 的 ， 另 一个 是 起 水平 作用 的 ， 即 　 　 　 　 　 　 　 　 　 　 　 　 　 并且 要求 这些 分离 的 模板 与 原 模板 具有 最小 二乘 逼近 该 模板 在 平方 误差 意义 上 逼近 ， 即 　 　 　 　 　 　 　 　 　 　 因此 ， 逼近 误差 为 　 　 　 　 　 　 　 　 　 　 　 　 由于 该 误差 ε 要求 最小 （ 最小 二乘 准则 ） ， 则 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 将式 展开 并 简化 ， 则 得到 　 　 　 　 　 　 　 　 　 　 　 同样 地 ， 由式 展开 并 简化 ， 则 得到 　 　 　 　 　 　 　 　 　 　 　 式 和 式 的 集合 表示 了 NN 个 线性方程组 ， 并且 有 NN 个 变量 ， 但是 ， 其中 只有 NN 个 方程 是 线性 无关 的 ， 因此 ， 可 任选 rN ， 则 其余 方程 用 矩阵 表示 为 PQS ， 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 其中 ， 　 　 　 　 　 　 　 这里 IN 是 N × N 单位矩阵 ， ZN × M 是 一个 N × M 的 矩阵 ， 其 元素 由式 算出 CN 是 一个 N 个 元素 的 列 向量 cccNT ， RN 是 N 个 元素 的 列 向量 rrrNT 类似 地 ， XN 和 YN 也 是 列 向量 ， 其 元素 由 下列 公式 算 出 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 上面 NN 个 线性方程 所 表示 的 矩阵 方程 可以 通过 计算 矩阵 P 的 逆 矩阵 获得 求解 考虑 到 矩阵 P 是 对称 矩阵 ， 其逆 矩阵 也 是 对称 矩阵 为 计算 矩阵 P 的 逆 矩阵 ， 本文 使用 下面 两个 矩阵 理论 的 结论 　 　 结论 设 A ， D 为 对称 矩阵 ， 则 出现 在 表达式 中 的 逆 矩阵 存在 即 　 　 　 　 　 　 　 　 这里 EDBTABFAB 　 　 结论 设 G 是 一个 非 奇异 矩阵 ， 且 U ， V 是 两个 列 向量 　 　 　 　 　 　 　 　 　 　 该式 给出 了 从 矩阵 G 的 逆阵 计算 ［ GUVT ］ 的 逆阵 的 一种 方法 　 　 本文 运用 结论 ， 其 相应 的 元素 表示 为 ANINBZN × NDNIN 　 　 　 　 　 　 　 　 　 　 　 这样 就 可以 得到 ANINFNZN × N ， ENINNNZNN 　 　 　 　 　 　 为了 计算 矩阵 E 的 逆阵 ， 使用 结论 ， 则 　 　 　 　 　 　 代入 上面 结论 公式 ， 并 加以 简化 ， 则 有 EN ［ INZN × N ］ 　 　 　 　 　 　 　 　 　 　 因此 ， 可以 得到 FENZN × N 　 　 　 　 　 　 　 　 　 　 　 　 　 AFEFTNINNNNZN × N 　 　 　 　 　 　 　 　 　 　 　 所以 ， 式 中 矩阵 P 的 逆阵 可 由 下式 给出 ． 　 　 　 　 　 　 在 最小 二乘 逼近 条件 下 的 模板 分解 的 分量 公式 可 简单 地 由 QPS 求出 这样 ， 模板 分解 的 垂直 向量 为 ciNxi α ， ≤ iN 　 　 　 　 　 　 　 　 　 　 　 　 　 其中 　 　 　 　 　 　 　 　 　 　 类似 地 ， 模板 水平 向量 为 riNyiyN ， ≤ iN 　 　 　 　 　 　 　 　 　 　 　 　 　 形态 模板 分解 算法 过程 如下 　 　 〈 〉 计算 　 　 　 　 　 　 　 　 　 　 　 　 　 　 〈 〉 计算 　 　 　 　 　 　 　 　 　 　 　 　 　 　 〈 〉 计算 　 　 　 　 　 　 　 　 　 　 　 　 　 〈 〉 由式 计算 　 　 　 　 　 　 　 ci ≤ iN ． 　 　 〈 〉 由式 计算 　 　 　 　 　 　 　 ri ≤ iN ， 其中 rN ． 以上 算法 需要 NN 次 乘法 和 NNNN 次 加法 　 应用 实例 — — 基于 形态 模板 的 交点 搜索算法 　 　 本文 以 图纸 矢量化 技术 中 的 交点 测试 试验 为 应用 实例 ， 导出 以 距离 测试函数 为 依据 的 二维 形态 模板 ， 通过 形态 模板 的 分解 计算 来 实现 交点 的 快速 计算 和 检测 ， 具体 描述 如下 　 　 在 工程图纸 扫描 图像 中 ， 大量 的 图形 是 以 直线 表示 的 ， 若能 准确 识别 直线 的 交点 中心 位置 及 直线 端点 ， 则 采用 任意 两点 之间 的 光栅 点 检测 算法 就 可以 判定 直线 的 存在 性 　 　 图 列出 了 扫描 图像 中 直线 交点 的 存在 形态 现在 的 问题 是 ： 如何 建立 一种 模板 对 每个 像素 的 邻域 进行 形态学 运算 ， 并 产生 一个 新 的 图像 在 这个 新 的 图像 中 ， 直线 的 交点 、 端点 信息 应 充分 表现 出来 从 视觉 的 角度 来看 ， 直线 的 交点 总是 表现 为 较 黑 的 区域 ， 即 黑色 线素 密度 较 高 的 区域 ， 如图 中 b ～ d 、 g 、 i 、 j 中 的 中心 区域 即 为 高密度 区域 直线 的 端点 位置 一般 位于 局部 高密度 线 的 截断 点 位置 普通 直线 的 中间 部位 不 存在 这种 截断 点 位置图 　 图纸 扫描 图像 中 的 直线 交点 形态 　 　 实现 这一 思想 的 方法 是 计算 每 一个 像素点 （ 邻域 内 ） 的 密度 值 ， 该 密度 值 反映 了 以 该 像素点 为 中心 的 小 窗口 （ 邻域 ） 内 的 黑度 情况 为此 ， 建立 一个 距离 权函数 wt ， 如图所示 ， 愈 是 靠近 中心点 的 像素 （ 即 邻域 内 t 值 愈小 的 像素点 ） ， 其 密度 贡献 愈大 ， 一般 可 表示 为 wtitni ， n ， n 为 收敛 指数 ， 　 　 　 　 　 　 　 　 　 　 　 　 　 　 式 中 ρ i 为 密度 函数 距离 权函数 wt 的 选择 方式 很多 ， 可以 是 指数 衰减 函数 、 对数 衰减 函数 或 倒数 衰减 函数 等 ， 距离 t 值 的 计算 一般 用 欧几里德 距离 表示 以 一个 × （ m ） 的 距离 函数 为例 ［ ］ ， 设 距离 模板 为 使用 以上 模板 分解 算法 ， 可 得到 其中 为 由式 得到 的 逼近 的 分离 模板 ， 由式 可 计算 逼近 误差 为 ε ＝ 图 　 距离 权函数 ω t 　 　 由于 和 为 两组 正交 的 基 ， 在 两个 方向 所 进行 的 计算 是 线性 无关 的 ， 并且 λ 和 λ 也 是 线性 无关 的 （ λ 为 任意 比例 系数 ） 因此 分别 在 x 和 y 方向 使用 向量 模板 和 所 产生 的 累计 密度 函数 ρ 与 直接 使用 二维 模板 计算 的 结果 是 一致 的 ， 仍然 满足 最小 二乘 逼近 　 　 这样 ， 由式 、 可 计算 图像 中 每个 像素点 上 的 密度 值 ， 对于 孤立 的 直线 或 直线 的 非 相交 部分 ， 高密度 值 反映 了 直线 的 中心 位置 ， 这 一点 所 产生 的 效果 与 细化 算法 产生 的 效果 是 一致 的 但 在 直线 相交 的 地方 ， 则 明显 产生 较 高密度 值 ， 而 局部 最高 密度 值 的 位置 正好 是 交点 的 中心 ， 由此 可以 确定 直线 交点 的 中心 位置 直线 的 交点 和 端点 位置 是 在 密度 图像 上 局部 搜索 完成 的 　 　 判断 一个 像素点 p 为 交点 的 必要条件 是 ： 　 　 〈 〉 在 p 邻域 窗口 内 ， 满足 ρ p ρ i ， iN ， 且 p ≠ i 　 　 〈 〉 由 p 向外 延伸 的 搜索 最远 密度 值 相近 点 j ∈ （ ρ p ρ j δ ） ， 满足 两点 距离 j η 　 　 判断 一个 像素点 p 为 端点 的 必要条件 是 ： 　 　 〈 〉 在 p 邻域 窗口 内 ， 满足 ρ p ρ i ε （ ε 可取 负数 ， ε ） ， iN ， 且 p ≠ i 　 　 〈 〉 由 p 向外 延伸 的 等 高密度 线 j （ ρ p ρ j δ ） 只有 一个 方向 ， 且 位于 同一 方向 ， 即 α jpjp μ （ 呈 直线 向外 延伸 ） 　 　 在 直线 交点 及 端点 确定 的 基础 上 ， 对 任意 两点 之间 直线 的 存在 性 进行 光栅 、 矢量 混合 检测 ， 采用 递归 求中点 的 方法 （ Fractal 算法 ） ， 判别 中 点 是否 落 在 黑色 像素点 上 ， 满足 两点 间 所有 像素 都 在 黑色 像素 上 ， 则 两点 构成 直线 由于 采用 逐次 迭代 算法 ， 两点 间 不 构成 直线 的 中点 一般 只 迭代 ～ 次 即可 终止 ， 因此 ， 实际 计算 量 较 小 　 结 　 论 　 　 本文 提出 一种 形态 模板 的 分解 逼近 算法 ， 它 将 局部 二维 运算 改变 为 两个 正交 方向 的 一维 线性 运算 ， 满足 最小 二乘 逼近 准则 ， 对于 提高 形态 图像处理 的 计算 效率 是 一种 非常 有用 的 技术 同时 ， 文章 结合 图像识别 中 的 线 矢量化 问题 提出 了 一种 应用 形态 模板 处理 技术 识别 直线 的 交点 和 端点 ， 它 与 细化 算法 相比 具有 较 高 的 定位精度 和 较 快 的 运算 速度 目前 这种 算法 还 只是 针对 直线 的 情况 ， 进一步 的 研究 将 扩展 到 对 一般 图素 的 特征 点 识别 上该 技术 的 难度 在于 需要 找到 一种 或 几种 正交 的 理想 形态 模板 ， 用于 检测 各种类型 的 特征 点 　 本文 研究 得到 香港 有利 集团 基金 资助 本文 通讯联系 人 ： 邹荣金 ， 南京 南京大学 计算机软件 新 技术 国家 重点 实验室 作者简介 ： 邹荣金 ， 年生 ， 博士 ， 副教授 ， 主要 研究 领域 为 计算机 图形学 ， 图像识别 　 　 　 　 　 蔡士杰 ， 年生 ， 教授 ， 博士生 导师 ， 主要 研究 领域 为 计算机 图形学 ， CAD 技术 　 　 　 　 　 张福炎 ， 年生 ， 教授 ， 博士生 导师 ， 主要 研究 领域 为 多媒体技术 ， 计算机 图形学 作者 单位 ： 邹荣金 ， 蔡士杰 ， 张福炎 （ 南京大学 计算机软件 新 技术 国家 重点 实验室 　 南京 　 ） 　 　 　 　 　 邹荣金 ， 蔡士杰 ， 张福炎 （ 江苏 理工大学 计算机科学 系 　 镇江 　 ， Emailzjzrjpubliczjjscn ） 参考文献 ： ［ ］ ShihFYMitchellORDecompositionofgrayscalemorphologicalstructuringelementsPatternRecognition ～ ［ ］ ChangJYChenCCDecompositionofadditivelyseparablestructuringelementswithapplicationPatternRecognition ～ ［ ］ ZhuangZHaralickRMMorphologicalstructuringelementsdecompositionComputerVisionGraphicsImageProcessing ～ ［ ］ DavidsonJLNonlinearmatrixdecompositionsandanapplicationtoparallelprocessingJournalofMathematicsImageVision ～ ［ ］ GaderPDSeparabledecompositionsandapproximationsofgrayscalemorphologicaltemplatesComputerVisionGraphicsImageProcessing ～ ［ ］ GoutsiasJMorphologicalrepresentationofdiscreteandbinaryimageIEEETransactionsonImageProcessing ～ ［ ］ 吴敏金 图像 形态学 上海 上海 科学技术 文献 出版社 ， ～ WuMinjinImageMorphologicShanghaiShanghaiScientificandTechnologicalLiteraturePublishingHouse ～ 收稿 日期 ： ， 修改 日期 ：