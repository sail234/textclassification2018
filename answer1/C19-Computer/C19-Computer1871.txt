微型机 与 应用 MICROCOMPUTERITSAPPLICATIONSVolNoP 建立 层 结构 企业 信息 平台 的 方法 与 研究 刘茂诚 　 　 摘 　 要 ： 提出 了 二种 层 结构 信息 平台 Unix 操作系统 下 的 ORACLEWEBSERVER 和 WINDOWSNT 上 的 IISInternetInformationServer 的 应用 实例 阐述 了 层 结构 的 实用性 和 科学性 并 提出 了 一些 技术 疑难 的 解决 方法 。 　 　 关键词 ： 层 结构 企业 信息 平台 数据库 　 　 世纪 年代 兴起 的 客户机 服务器 （ ClientServer 简称 为 CS ） 结构 应用 是 伴随 着 网络 数据库 技术 的 应用 发展 起来 的 。 它 将 个 复杂 的 网络应用 和 生动 、 直观 的 用户界面 相 分离 将 大量 数据 运算 交给 了 后台 去 完成 提高 了 用户 交互 反应 的 速度 应用 开发 简单 开发工具 种类 多 而 成熟 对 网络 数据库 的 应用 起到 了 较大 的 推动 作用 。 　 　 随着 信息技术 的 进一步 发展 CS 结构 暴露出 一些 问题 即 客户端 需要 安装 大量 的 软件 机器 需要 较 高 的 配置 客户端 的 维护 频繁 用户 需要 进行 专门 培训 才能 操作 。 这样 系统 运行 成本 就 一直 呈上升 趋势 从 某种程度 上 限制 了 网络 的 应用 范围 必须 对 原来 基于 CS 的 MIS 进行 改进 。 为此 我们 建立 了 目前 流行 的 层 结构 应用 既 充分利用 原来 的 资源 又 排除 了 原 系统 的 弊端 达到 科学性 、 实用性 和 经济性 三 统一 的 目的 。 层 结构 简介 　 　 随着 InternetIntranet 技术 的 发展 人们 已 不再 满足 于 静态 的 信息 发布 开始 将 Web 与 数据库 相结合 形成 了 基于 数据库 的 Web 计算 模型 并 将 这种 计算 模型 应用 到 InternetIntranet 中 最终 成为 层 客户机 服务器 的 应用 结构 。 可以 说 没有 数据库 也 就 没有 层 结构 的 应用 。 　 　 层 结构 实际上 就是 要 建立 增加 WEB 服务 的 CS 模式 即 把 传统 的 CS 模式 中 的 服务器 分解成 个 Web 服务器 和 个 或 多个 数据库 服务器 如图所示 。 图层 结构图 　 　 层 结构 是 这样 划分 的 第层 是 表示层 浏览器 主要 完成 用户 和 后台 的 交互 及 最终 查询 结果 的 输出 功能 。 客户端 向 由 URL （ UniformResourceLocator 统一 资源 定位器 ） 所 指定 的 Web 服务器 提出 服务 申请 Web 服务器 用 HTTP 协议 把 所 需 的 文件 资料 传送 给 用户 客户端 接收 文件 信息 并 在 浏览器 上 输出 。 第层 是 具有 CGI 或 ODBC 接口 的 Web 服务器 属于 功能 层 。 主要 利用 服务器 完成 客户 的 应用 功能 。 Web 服务器 接受 客户 申请 首先 需要 执行 CGI 或 其它 服务程序 与 数据库 连接 进行 申请 和 运算 最后 将 处理结果 返回 Web 服务器 再 由 Web 服务器 传至 客户端 。 第层 数据库 服务器 是 数据 层 。 数据库 服务器 接受 客户 请求 后 独立 地 进行 各种 运算 。 由于 处理 完全 交给 了 数据 层 完成 功能 层 发生变化 不会 影响 到 数据 层 的 改变 因此 层 结构 在 软 、 硬件 环境 发生变化 时 的 适应能力 比 CS 模式 的 层 结构 强得 多 即 具有 更强 的 可伸缩性 。 层 结构 的 开发 、 运行 平台 的 选择 　 　 解决 应用 系统对 后台 数据库 的 访问 是 层 结构 的 开发 中 的 核心 问题 我们 通过 深入 调研 结合 自己 的 网络应用 实际 确定 了 种 平台 下面 做 详细 介绍 。 OracleWebServer （ 以下 简称 Web ） 的 应用 　 　 我们 在 原来 的 MIS 开发 中 数据库 平台 选用 了 Oracle 所以 首选 的 层 结构 开发 平台 是 WebWeb 是 Oracle 数据库 厂商 年 推出 的 专用 Web 服务器 它 采用 了 WRB （ WebRequestBrokerWeb 请求 代理 ） 技术支持 基于 Oracle 数据库 的 WEB 开发 应用 。 Web 是 一个 高性能 、 多线程 和 多 进程 的 HTTP 服务器 直接 通过 WRB 提供 动态 的 HTML 页面 WRB 将 所有 的 服务器 扩展 都 作为 个 单独 的 进程 执行 。 客户机 的 请求 直接 分布 到 Oracle 服务器 执行 而 不 需 编写 繁琐 的 CGI 程序 。 OracleWebServer 的 工作 过程 　 　 OracleWebServer 的 工作 原理 示意图 如图所示 。 图 OracleWebServer 工作 原理图 　 　 （ ） 在 Web 浏览器 上 用户 单击 包含 后台 应用 的 URL 。 　 　 （ ） Web 监听器 （ WebListener ） 接收 用户 请求 并 进行 分析 如果 只是 一般 静态 页面 （ 请求 的 文件 是 ＊ htm ） 请求 则 调用 简单 转接器 （ simplyDispatcher ） 进一步 通过 服务器 的 文件系统 将 所 需 页面 返回 给 用户 。 如果 是 需 调用 Web 请求 代理 （ WRB ） 的 统一 资源 定位 符 （ 缺省 目录 是 owa ） 它 将 请求 的 执行 送给 Web 请求 代理 转接器 （ WRBDispatcher ） 处理 。 　 　 （ ） 转接器 负责 和 叫做 WRB 执行 引擎 （ WRBXsWRBExecutableEngines ） 的 进程 池 通信 。 转接器 会 找个 空闲 的 、 配置 成 运行 所 需要 的 WRB 服务 执行 引擎 并 把 执行权 交给 该 引擎 结果 是 监听器 能 接收 并 确认 请求 的 统一 资源 定位 有效 而 每个 请求 被 传递 到 在 后台 执行 该 请求 的 进程 。 　 　 （ ） 每个 WRB 执行 引擎 使用 WRB 应用 编程 接口 和 Web 请求 代理 组件 （ WRBCartridge ） 接口 。 Web 请求 代理 组件 可以 是 PLSQL 代理 组件 （ AgentCartridge ） 、 JAVA 解释器 、 LiveHTML 解释器 及 第三方 厂商 开发 的 扩展 组件 。 　 　 PLSQL 代理 （ PLSQLAgent ） 该 组件 执行 存储 在 数据库 中 的 PLSQL 命令 。 它 比 Java 组件 更 优化 了 对 数据库 的 访问 但 它 不 具有 Java 的 全部 功能 。 　 　 Java 解释器 该 组件 允许 在 服务器 上 执行 Java 来 产生 动态 的 Web 页面 。 使用 它 可以 从 Java 中 执行 PLSQL 命令 。 　 　 LiveHTML 解释器 该 组件 是 Oracle 在 工业 标准 服务器端 内置 （ SSIServerSideIncludes ） 功能 的 实施 和 扩展 。 LiveHTML 可以 将 用户 操作系统 能 运行 的 任何 程序 的 输出 结果 包含 在 用户 的 Web 页面 之中 。 　 　 （ ） 利用 PLSQL 代理 组件 执行 存储 在 数据库 中 的 PLSQL 包将 输出 的 数据库 操作 结果 返回 给 浏览器 用户 。 　 　 在 实际 开发 、 应用 中 需要 做 的 开发 工作 是 　 　 （ ） 配置 数据库 连接 描述 文件 DCD （ DatabaseConnectionDescriptor ） 。 个 统一 资源 定位 （ URL ） 在 请求 PLSQL 代理 时 必须 在 其中 指明 相应 的 与 数据库 连接 的 描述 文件 这个 文件 是 个 由 WebServer 维护 的 系统文件 该 文件 提供 建立 数据库 连接 的 用户名 、 口令 、 数据库 名 及其 它 一些 访问 数据库 所 需要 的 信息 。 该 描述 文件 决定 了 PLSQL 代理 在 执行 该 请求 时能 访问 哪 一个 数据库 以及 能 访问 数据库 中 的 哪 一部分 。 在 统一 资源 定位 中 给出 该 文件名 PLSQL 代理 就 按 该 文件 提供 的 内容 进行 配置 。 例如 配置 的 DCD 文件名 是 “ glxx ” 那么 统一 资源 定位 就 应该 是 httpservername （ 或 地址 ） owaglxxpackagename 。 　 　 （ ） 创建 可以 在 Oracle 数据库 中 执行 的 PLSQL 程序包 （ Package ） 可以 使用 任何 文本编辑 工具 完成 该 包体 包括 二 部分 一部分 对 数据库 进行 操作 另 一部分 将 操作 结果 按 HTML 标准 格式 转化成 可 供 浏览 的 页面 。 　 　 （ ） 在 OracleSQLPLUS 下 运行 并 生成 程序包 。 在 系统 应用 过程 中 返回 给 用户 的 是 HTML 文件 不 产生 额外 的 物理 文件 。 OracleWebServer 的 应用 分析 　 　 （ ） Web 上 的 编程 思路 依托 于 Oracle 库对 Oracle 访问速度 快 所以 对 Oracle 应用 密集 的 区域 和 精通 Oracle 的 开发者 来说 选择 Web 作为 层 结构 平台 是 一个 理想 的 选择 。 　 　 （ ） 如果 数据库 是 Oracle 通过 Web 进行 高效率 的 访问 时 系统可靠性 和 稳定性 差 。 尤其 在 多用户 对 其 并发 访问 时 容易 产生 难以 释放 的 进程 大大降低 了 服务器 的 吞吐能力 甚至 可能 导致 数据库 停止 工作 这是 Web 的 一个 致命 弱点 。 而 选用 Oracle 没有 发生 过 上述 故障 。 　 　 （ ） OracleWebServer 只 能够 为 Oracle 的 数据库 提供 Web 服务 在 实际 应用 中 限制 了 WebServer 对 异构 数据库 的 访问 这是 一个 大 的 不足 。 应用程序 无 可移植性 如果 数据库 平台 变更 开发 的 应用程序 就 作废 。 　 　 （ ） OracleWebServer 对系统 的 软 、 硬件平台 要求 严格 系统 运行 成本 较 高 。 　 　 （ ） 应用 系统 开发 过程 复杂 效率 低 。 动态 页面 间 的 衔接 不 完善 。 WEBSERVERIIS 的 应用 　 　 IIS 及其 ASP （ ActiveServerpages ） 技术 的 应用 运行 在 WindowsNT 平台 上用 活动 数据 对象 ADO （ ActiveXDataObject ） 组件 并 通过 ODBC （ OpenDatabaseConnectivity ） 标准 数据库 界面 访问 多种 数据库 解释 并 发布 信息 。 这种 模式 在 WEB 开发 中 应用 得 越来越 广泛 。 　 　 微软 的 NT 内置 IIS 由 其 负责 接收 客户端 的 WEB 请求 调度 每 一个 请求 进程 并 给予 应答 。 IISWeb 服务器 增加 的 数据库 访问 能力 是 通过 在 IIS 服务器 上 增加 了 扩展 的 应用程序 ASP 服务 以及 能 完成 对 各种 数据源 进行 访问 的 活动 数据 对象 （ ADO ） 组件 实现 的 。 　 　 这种 应用 的 特点 是 服务程序 和 ADO 组件 以 动态链接库 （ DLL ） 的 形式 工作 减少 了 在 通用 网关 接口 （ CGI ） 中为 产生 并发 进程 所 付出 的 额外 开销 个 DLL 可以 在 第次 收到 请求 时 装入 然后 就 驻留 在 内存 中 等待 其它 请求 其 具体 工作 过程 如下 　 　 （ ） 在 Web 浏览器 上 用户 单击 包含 后台 应用 的 URL 将 请求 发往 Web 服务器 。 　 　 （ ） Web 服务器 判断 用户 请求 如果 请求 的 是 一般 的 静态 页面 （ 后缀 是 htm ） 则 在 服务器 文件系统 找到 所 需 的 页面 作为 最终 结果 返回 给 用户 。 如果 用户 请求 的 是 内嵌 在 服务器端 执行 的 脚本语言 的 程序 调用 （ 后缀 是 ＊ asp ） 则 启动 相应 的 ASP 服务程序 动态 生成 页面 返回 给 用户 。 　 　 （ ） ASP 程序 使用 ADO 来 完成 对 各种 数据源 的 存取 。 ADO 作为 Web 服务器端 的 一种 扩展 它 允许 基于 Web 的 应用程序 的 开发人员 编写 服务器端 的 脚本 以 扩展 基于 Web 的 应用程序 的 能力 。 当 Web 服务器 得到 的 请求 是 含 SQL 语句 的 程序 时由该 对象 组件 负责 处理 页面 中 内嵌 的 SQL 语句 访问 数据库 并 返回 处理 信息 将 结果 组织 成 标准 的 HTML 文本 返回 给 浏览器 用户 。 用户 得到 的 页面 中不含 “ ” 标记 也 看不到 SQL 语句 这些 语句 已 被 中间件 用 其 执行 结果 取代 了 。 服务器端 的 脚本 一般 用 VBScript 来 写 这些 用 高级 语言 编写 的 脚本 在 服务器端 执行 所以 它们 不 依赖于 任何 客户端 的 操作系统 或 浏览器 。 　 　 （ ） 在 服务器端 基于 VBScript 建立 ADO 页面 。 具体步骤 是 创建 ADO 中 的 ADODB 对象 打开 与 ADODB 对象 的 连接 在 打开 的 连接 上 创建 数据 结果 集对 数据 结果 集里 的 数据 进行 操作 最后 关闭 连接 。 　 　 应用程序 对 数据库 的 访问 是 通过 数据库 访问 ADO 实现 的 主要 包含 启动 Web 服务器 和 数据库 服务器之间 的 会 话 定义 数据库 服务器 的 调用 即 分析 SQL 语句 的 语法 有效性 为 SQL 语句 打开 光标 （ Cursor ） 把 Web 应用程序 中 的 变量 粘接 起来 送入 数据库 服务器 共享 的 存储器 中 说明 要 返回 字段 的 内容 这些 字段 以 服务器 的 数据结构 中 的 值 为 依据 在 光标 存储器 空间 内 执行 SQL 语句 取个 或 多个 数据 行 送入 Web 应用程序 页面 中 关闭 光标 。 　 　 下面 一小 段 程序代码 可以 说明 上述 步骤 。 　 　 Setconnservercreateobject （ ″ ADODBConnection ″ ） 　 　 Connopen ″ infosource ″ ″ orauser ″ ″ orapasswd ″ 　 　 SetRSconnexexcute （ ″ select ＊ fromauthors ″ ） 　 　 … … 　 　 ConnClose 　 　 可见 应用 系统 是 通过 ADO 对 数据库 的 访问 而 实现 的 。 一般 情况 下 ADO 并 不 直接 对 数据库 访问 而是 通过 对 ODBC 数据源 的 访问 实现 对 数据库 的 访问 。 具体操作 可 通过 ODBC 接口 的 驱动程序 完成 。 因此 要 访问 不同 的 数据库 只 需 创建 相应 的 ODBC 就行了 。 这样一来 为 开发者 提供 了 简单 、 标准 、 透明 的 数据库 连接 的 公共 编程 接口 而 由 数据库 厂商 根据 ODBC 标准 去 实现 各自 底层 的 驱动程序 并 根据 不同 的 数据库 管理系统 采用 不同 的 技术 加以 优化 实现 。 ODBC 为 异构 数据库 的 互连 提供 了 保证 。 创建 ODBC 的 过程 如下 　 　 首先 在 WEB 服务器 WINDOWSNT 上 安装 访问 数据库 的 ODBC 驱动程序 利用 ODBC 检测工具 软件测试 与 数据库 是否 连通 （ 如 运行 ORACLEODBCTEST ） 。 在 控制 面版 中 参考 表对 ODBC 进行 配制 。 表 MicrosoftODBCMicrosoftODBCforOracle 安装 数据源 名称 Nglxx 描述 D 管理 信息 用户 名称 Uuseriis 服务器 SOra 　 　 选择 该 平台 的 优点 之一 是 ADO 对象 组件 提供 了 相当 多 的 数据 对象 操作方法 服务器端 的 VB 脚本语言 也 提供 了 相当 多 的 CGI 接口函数 应用 系统 功能 的 实现 比较 灵活 、 容易 可以 将 应用程序 移植 于 异种 数据库 平台 环境 中 。 但 编程 比较 繁琐 没有 较 好 开发工具 访问 速度慢 。 系统 开发 过程 中 的 技术 问题 建库 （ 表 ） 过程 　 　 无论 用 什么 工具 进行 层 结构 的 开发 建库 过程 是 必需 的 一步 如果 在 浏览器 上 建立 原始 库 （ 表 ） 结构 就 显得 有些 迟钝 了 。 最好 的 方法 还是 用 CS 下 的 开发工具 来 帮忙 。 我们 就是 选择 了 用 POWERBUILDER 建库 速度 快 操作 又 特别 简单 。 　 　 在 IISWEBSERVER 上 需要 安装 Oracle 的 通信软件 SQLNET 或 NET 其中 可能 遇到 汉字 不能 正常 显示 的 现象 这 是因为 安装 过程 中 选择 了 错误 的 字符集 所致 。 即 与 后台 Oracle 数据库 使用 的 字符集 不 相符 。 解决 的 方法 是 在 WINNT 下 运行 注册表 编辑 程序 REGEDIT 选择 HKEYLOCALMACHINE 再 选择 SOFTWARE 再 选择 Oracle 然后 选择 NLSLANG （ 语言 的 国际 支持 ） 键入 和 服务器端 相同 的 字符集 。 例如 服务器端 的 字符集 为 AMERICANAMERICANUSASCII 在 此 也 输入 此项 就行了 。 选择 FRONTPAGE 建立 页面 框架 　 　 好 的 开发工具 可以 大大 加快 系统 的 开发 进程 降低 开发成本 它 是 影响 应用 系统 开发周期 的 重要 因素 。 基于 ASP 技术 的 开发 目前 还 没有 理想 的 工具 。 有 一些 工具 如 Frontpage 可以 编辑 HTML 页面 但 难以实现 和 后 端 数据库 之间 的 复杂 交互 。 在 IIS 上 的 开发 可用 Frontpage 编写出 页面 框架 再 将 VBScript 嵌入 这样 既能 使 页面 美观 又 能 访问 数据库 。 WEB 页面 中帧 （ Frame ） 的 使用 　 　 巧妙 使用 帧 可以 使 界面 布局 更加 合理 带来 好 的 视觉效果 。 下面 是 在 开发 的 页面 中 使用 的 一个 例子 　 　 framesetrows ″ ＊ ″ frameborder ″ ″ framespacing ″ ″ border ″ ″ 　 　 framesrc ″ glxxasp ﹖ ″ name ″ Buttons ″ scrolling ″ AUTO ″ 　 　 framesrc ″ coverpagehtml ″ name ″ Main ″ scolling ″ AUTO ″ 　 　 frameset 　 　 将 整个 Web 页面 分成 上下 帧 上 帧 页面 占 总 页面 的 下 帧 页面 占 。 上半 部分 是 用户 对话 界面 下 半 部分 是 返回 的 输出 结果 页面 如 统计 结果 。 如 不 采取 分帧 方式 用户 需 退出 结果 页面 后 再 进入 条件 输入 页面 影响 效率 。 层 结构 上 的 Java 开发 　 　 Java 已 发展 成为 InternetIntranet 异构 网络 环境 的 最 热门 的 程序设计 语言 我们 主要 用 Java 小 应用程序 （ JavaApplet ） 绘制 各种 统计 图形 数据 由 OracleWEBSERVER 或 IIS 提供 根据 这些 数据 用 Java 绘出 对比 图形 可用 J 编程 。 　 　 表达 统计数据 最 直观 的 方式 是 根据 数据 绘制 曲线 曲线 可以 是 直方图 或 折线图 。 在 绘制 时 主要 考虑 绘制 算法 的 通用性 显示 数据 的 大小 和 个数 （ 数据分布 的 疏密 ） 随着 每 一组 数据 都 不 相同 如果 用 绝对 坐标 来 显示 很难 找到 个 合适 的 值 适用 于 许多种 情况 。 而且 如果 采用 个 绝对 的 值 要 满足 大 数据 的 显示 小 的 数据 看起来 就 接 近于零 了 无法 对 它们 再 进行 比较 。 因此 采用 相对 坐标 。 对 Y 轴先 选出 这 一组 数据 中 最大 的 它 的 高度 是 固定 的 然后 根据 它 的 值 计算 出 坐标 Y 轴 的 刻度 并 绘制 出 其它 数据 的 高度 。 对 X 轴 根据 每组 数据 的 个数 来 划分 X 轴 刻度 。 采用 的 方法 是 标题 和 统计数据 由 HTML 的 param 参数 标注 提供 统计 的 数据 个数 没有 限制 根据 数据 的 个数 （ 可能 是 随机 的 ） 和 取值 画出 带 刻度 的 X 、 Y 轴用 折线 法 连接 每个 数据 点 的 同时 标出 该点 的 数据 值 或 用 直方图 表示 出 每个 数据 点 的 值 。 系统 的 安全措施 　 　 系统 的 安全性 可以 从 二 方面 加强 一是 使用 Web 服务器 提供 的 安全 机制 对 Web 服务器 的 访问 基于 确定 的 主机 （ IP地址 ） 和 合法 的 用户 （ 用户 在 访问 时 必须 提供 用户名 和 口令 ） 另一方面 开发者 通过 对 应用 系统 增加 安全性 功能 来 实现 。 具体 在 本 系统 中是 通过 在 数据库 中 增加 合法 用户 表 记录 合法 用户 的 单位 等 信息 以便 应用程序 按照 数据 的 单位 代码 属性 划分 数据 具体 过程 如下 　 　 （ ） 用户 输入 单位名称 、 用户名 、 口令 并且 将 输入 值 进行 复杂 运算 然后 提交 Web 服务器 验证 用户 的 合法性 避免 从 URL 栏里 显示 出 用户 口令 。 　 　 （ ） Web 服务器 查询 后 端 数据库 中 合法 用户 表 验证 个 输入 数据 正确 无误 后 提供 给 用户 正常 的 使用 界面 。 　 　 （ ） 当 用户 转 去 使用 其它 页面 功能 时 Web 服务器 负责 将 加密 的 用户 信息 传至 下页 该页 在 执行 时 同样 要 验证 用户 的 合法性 无误 后 用户 可以 使用 该页 功能 。 这种 做法 主要 考虑 到 Web 计算 松散 的 缺点 防止 非法 用户 从 中间 切入 。 刘茂诚 （ 山东省 东营市 胜利 石油 管理局 信息中心 ） 收稿 日期 ：