软件 学报 JournalofSoftwareVolNoP 基于 活动 仿射 标架 反求 Nurbs 曲线 曲面 参数 胡事民 　 孙家 广 　 金通 光 　 汪国昭摘 　 要 　 Nurbs 曲线 曲面 在 反求 参数 上 的 数值 不稳定性 是 Nurbs 曲线 曲面 的 致命 缺点 该文 介绍 了 用于 参数 曲线 曲面 求交 的 活动 仿射 标架 movingaffineframe 简称 MAF 方法 基于 MAF 方法 的 原理 提出 了 反求 Nurbs 曲线 曲面 参数 的 一种 新 方法 该 方法 在 数值 稳定性 和 效率 上均 高于 各种 传统 的 迭代法 并 已 应用 于 商品化 三维 CAD 系统 GEMS 关键词 　 活动 仿射 标架法 Nurbs 曲面 CAD 系统 中图法 分类号 　 TPComputingtheParametersofPointsonNurbsCurvesandSurfacesviaMovingAffineFrameMethodHUShimin 　 SUNJiaguangNationalCADEngineeringCenter 　 TsinghuaUniversity 　 Beijing 　 HUShimin 　 SUNJiaguangDepartmentofComputerScienceandTechnology 　 TsinghuaUniversity 　 Beijing 　 JINTongguang 　 WANGGuozhaoDepartmentofAppliedMathematics 　 ZhejiangUniversity 　 Hangzhou 　 Abstract 　 ThenumericalinstabilityincomputingtheparametersofthepointsonNurbscurvessurfacesisafataldisadvantageofNurbsmethodsInthispapertheauthorsintroducethemovingaffineframeMAFmethodforintersectioncalculationofparametriccurvesandsurfacesBasedontheprincipleofaMAFmethodanewmethodforcomputingtheparametersofthepointsonNurbscurvesandsurfacesispresentedThenumericalstabilityandtheefficiencyofthemethodarebetterthanalltraditionaliterativemethodsThenewmethodhasbeenappliedtothecommercialDCADsystemGEMSKeywords 　 MovingaffineframeMAFmethodNurbssurfaceCADsystem 　 　 众所周知 给定 参数 计算 曲线 、 曲面 的 点 在 CAGDcomputeraidedgeometricdesign 中是 最 基本 的 算法 这方面 已有 许多 经典 的 算法 如 B é zier 曲线 曲面 的 deCasteljau 算法 、 Nurbs 曲线 曲面 的 deBoor 算法 等 这些 算法 非常 简洁 属于 割角 算法 比较稳定 效率 很 高 ［ ］ 现在 我们 考虑 其反 问题 对于 给定 曲线 曲面 上 的 点 如何 反求 其 相应 的 参数值 在 几何 造型 中反求 参数 非常 重要 这有 两 方面 原因 ： ① 在 集合 运算 中反求 参数 是 必不可少 的 ② 在 真实感 显示 中为 避免 实体 在 交线 处 出现 裂缝 需对 三维空间 中 的 交点 反求 其 参数 以便 在 离散 成 三角 片时 体 的 两个 面在 交线 处 相吻合 　 　 Nurbs 方法 有 许多 公认 的 优点 在 CAD 及 计算机 图形学 中正 获得 越来越 广泛 的 应用 但 也 有 许多 缺点 正如 Piegl ［ ］ 所 总结 的 ： ① 需要 额外 的 存储 以 定义 传统 的 曲线 曲面 ② 权 因子 的 不 合适 的 应用 可能 导致 很坏 的 参数 化 ③ 某些 技术 用 传统 形式 可能 比 Nurbs 更好 ④ 某些 基本 算法 比如 反求 曲线 曲面 上点 的 参数 存在 数值 不稳定性 关于 反求 曲线 曲面 参数 传统 的 方法 大多 是 采用 Newton 迭代法 效率 低且 易 出错 　 　 本文 作者 之一 在 年 曾 提出 曲面 求交 的 活动 仿射 标架 movingaffineframe 简称 MAF 法 ［ ］ 基于 MAF 方法 的 原理 本文 提出 反求 曲线 、 曲面 参数 的 一种 新 方法 该 方法 具有 较强 的 几何 直观性 其 稳定性 和 效率 均 高于 传统 的 迭代法 　 MAF 方法 简介 　 　 已知 参数 曲面 　 　 假设 已 由 离散 法 求得 初始 交点 如何 求取 下 一个 交点 呢 ？ 　 　 设 初始 交点 为 MT 其中 M 为 三维空间 中 的 交点 其 对应 参数 为 uuuvvvT 为 该 点 的 单位 切 矢量 而 TN × NN 和 N 为 S 和 S 分别 在 u 和 v 处 的 法 向量 　 先由 M 点 沿切 向 T 前进 δ 步长 令 PM δ T 于是 有 　 则 上式 两边 同时 点 乘 可 得到 　 于是 其中 同理 可 求得 Δ v Δ v 以 Δ u Δ u Δ u 和 Δ v Δ v Δ v 作为 增量 得到 新 的 参数 u ← u Δ u 和 v ← v Δ v 于是 得到 两张 曲面 上 的 点 X ∈ S 和 Y ∈ S 若 ｜ XY ｜ ＜ ε 以 作为 M 后 的 下 一 交点 这里 ε 为求 交 精度 　 　 以上 由 P 求得 X 和 Y 的 过程 称为 球 变换 　 　 若 ｜ XY ｜ ＞ ε 则 需要 迭代 修正 首先 由 X 和 Y 得到 一点 P 方法 如下 ： 过 X 点 在 S 上作切 平面 Π 过 Y 在 S 上作切 平面 Π Π ∩ Π 于 直线 L 如图所示 过 X 作 XXT 垂直于 L 过 Y 作 YYT 垂直于 L 取 上述 由 X 和 Y 得到 一点 P 的 过程 称为 中 点 变换 然后 再 由 P 作球 变换 得到 两张 曲面 上 的 点 X ∈ S 和 Y ∈ S 若 ｜ XY ｜ ＜ ε 以 作为 M 后 的 下 一 交点 否则 中 点 变换 和 球 变换 交替 进行 直至 ｜ XnYn ｜ ＜ ε 关于 MAF 方法 的 收敛性 参见 文献 ［ ］ Fig 图 　 反求 Nurbs 曲线 曲面 参数 　 反求 曲线 参数 　 　 对于 一条 给定 的 Nurbs 曲线 ： 　 其中 Pi 是 控制顶点 Wi 是 相应 控制点 的 权 因子 Nikt 为 定义 在 节点 向量 Ttttktntnk 上 的 k 阶 B 样条 基 函数 通常 取 tttktntntnkS 为 曲线 Pt 上 的 一个点 我们 希望 求 参数 u 使 Pus 　 　 先 确定 一个 近似 参数 u 方法 如下 　 　 利用 插 节点 算法 将 Nurbs 曲线 Pt 转化 为 nk 条 B é zier 曲线 若 在 曲线 Pt 的 节点 向量 中有 重 节点 则 曲线 条数 相应 减少 　 　 对 每 一条 B é zier 曲线 判断 P 是否 在 其 凸 包内 如果 在 凸 包内 离散 该 B é zier 曲线 离散 层数 一般 取为 再 判断 P 是否 在 这些 子 曲线 的 凸 包内 以 估计 近似 参数 u 　 　 有 了 近似 参数 u 我们 作 迭代 修正 　 　 过 Pu 沿切 向 P ′ u 作 直线 L 将点 S 投影 到 L 上 记为 Q 由于 Q 在 L 上 我们 有 　 于是 可以 求 出 Δ u 即令 u ← u Δ u 重复 上述 过程 直至 ｜ PuQ ｜ ＜ ε 　 　 一般来说 迭代 ～ 次 即可 得到 较为 精确 的 参数 　 反求 曲面 参数 　 　 对于 一张 给定 的 Nurbs 曲面 ： 　 其中 Pij 是 控制顶点 Wij 是 相应 控制点 的 权 因子 NikuNikv 为 定义 在 节点 向量 Uuuukununk 和 Vvvvkvmumk 上 的 k 阶 B 样条 基 函数 S 为 曲线 Puv 上 的 一个点 我们 希望 求 参数 uv 使 PuvS 　 　 先 确定 一个 近似 参数 uv 方法 如下 　 　 利用 插 节点 算法 将 Nurbs 曲面 Puv 转化 为 nk × mk 片 B é zier 曲面 片若 在 曲面 Puv 的 节点 向量 中有 重 节点 则 B é zier 曲面 片 的 片数 相应 减少 　 　 对 每 一张 B é zier 曲面 片 判断 P 是否 在 其 凸 包内 如果 在 凸 包内 离散 该 B é zier 曲面 离散 层数 一般 取为 再 判断 P 是否 在 这些 子 面片 的 凸 包内 以 估计 近似 参数 uv 　 　 有 了 近似 参数 uv 我们 作 迭代 修正 　 　 过 Puv 曲面 Puv 的 切 平面 Π 将点 S 投影 到 Π 上 记为 Q 由于 Q 在 Π 上 我们 有 　 式 两端 同时 点 乘 P ′ uuv 和 P ′ vuv 即得 　 求解 上述 二元 一次 方程组 即得 其中 令 u ← u Δ uv ← v Δ v 重复 上述 过程 直至 ｜ PuvQ ｜ ＜ ε 实际上 得到 了 新 的 近似 参数 这是 一个 球 变换 的 过程 其 几何 直观性 要 比较 传统 迭代法 好该 方法 的 收敛性 证明 与 MAF 方法 类似 在 此 不再 赘述 　 反求 曲线 曲面 参数 的 实例 　 　 例反求 曲线 参数 　 　 一条 四阶 Nurbs 曲线 其个 控制顶点 分别 为 ： 节点 向量 为权 因子 分别 为 对于 给定 的 曲线 上 的 点 由 离散 法 可以 求得 该点 的 近似 参数 为 再 由次 迭代 即 得到 精确 参数 为 迭代 情况 见表 Table 表 Times ① Approximateparameter ② Error ③ ① 次数 ② 近似 参数 ③ 误差 　 　 例反求 曲面 参数 　 　 一条 × 阶 Nurbs 曲面 按 × 分布 的 个 控制顶点 分别 为 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 节点 向量 分别 为 和 按 × 分布 的 个权 因子 分别 为 对于 给定 的 曲面 上 的 点 由 离散 法可 求得 近似 参数 为 再 由 迭代 得到 精确 参数 为 迭代 情况 见表 Table 表 Times ① Approximateparameter ② ① 次数 ② 近似 参数 　 　 以上 例子 表明 该 方法 具有 较 高 的 效率 以 曲线 为例 传统 迭代法 通常 需要 迭代 数次 才能 由 近似 参数 收敛 到 精确 参数 本文 研究 得到 国家自然科学基金 （ No ） 、 国家 高科技 项目 基金 （ No ） 和 国家 “ 九五 ” 科技 攻关项目 基金 （ NoA ） 资助 。 胡事民 （ 清华大学 国家 CAD 工程 中心 　 北京 　 ； 清华大学 计算机科学 与 技术 系 　 北京 　 ） 孙家 广 （ 清华大学 国家 CAD 工程 中心 　 北京 　 ； 清华大学 计算机科学 与 技术 系 　 北京 　 ） 金通 光 （ 浙江大学 应用 数学系 　 杭州 　 ） 汪国昭 （ 浙江大学 应用 数学系 　 杭州 　 ） Emailshimintsinghuaeducn 参考文献 ． FarinGNURBCurvesandSurfacesfromProjectiveGeometrytoPracticalUseWellesleyMAAKPetersLtd ． HoschekJLasserDFundamentalsofComputerAidedGeometricDesignWellesleyMAAKPetersLtd ． PieglLOnNURBSasurveyIEEEComputerGraphicsandApplications ～ ． JinTongguangWangGuozhaoMAFmethodforintersectioncalculationbetweenparametricsurfacesTechnicalReportNoZhejiangUniversity 收稿 修稿