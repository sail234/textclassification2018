计算机 工程 COMPUTERENGINEERING 年 第卷 第期 volNo 电子系统 设计 的 低功耗 技术 卫国 伍 　 钱德沛 　 　 随着 电子器件 集成度 的 不断 提高 和 功耗 的 减少 ， 大量 便携式 的 智能 仪器仪表 应运而生 。 便携式 仪器仪表 的 核心 是 各种各样 的 低功耗 单片机 应用 系统 ， 在 设计 这 类 应用 系统 时 ， 低功耗 特性 如何 是 系统 能否 成功 的 关键因素 。 如何 才能 获得理想 的 低功耗 特性 是 广大 工程 技术人员 关心 的 问题 。 低功耗 系统 的 设计 并 没有 定式 可 拿来 套用 ， 但 还是 有 规律 可循 的 。 我们 认为 系统 设计 时 一般 要 考虑 如下 因素 ： 选择 合适 的 单片机 型号 并 充分利用 它 提供 的 低功耗 特性 ； 选用 低功耗 外围 元器件 ； 根据 应用 的 具体 要求 选取 够用 的 晶振 频率 ； 设计 合理 的 供电 回路 ； 除了 硬件 措施 外 ， 程序设计 技巧 也 很 重要 。 下面 根据 我们 多年 来 MCS 系列 单片机 应用 系统 的 设计 实践 ， 介绍 软硬件 两 方面 的 低功耗 设计 。 电路设计 要 考虑 的 问题 器件 选择 　 　 在 设计 单片机 应用 系统 时 ， 首先 确定 系统 的 功能 ， 接着 进行 器件 选择 和 电路设计 。 要 设计 出 低功耗 的 电子系统 ， 构成 系统 的 元器件 应是 低功耗 的 。 随着 微电子 技术 的 发展 ， 几乎 在 每 一个双 极性 器件 出现 的 同时 就 有 相同 功能 、 管脚 兼容 、 可 直接 互换 使用 的 CMOS 器件 出现 。 可以 设计 出 全部 用 CMOS 电路 组成 的 低功耗 系统 。 　 　 单片机 的 选择 　 　 选择 单片机 除了 要 考虑 功能 和 开发 环境 外 ， 在 低功耗 系统 设计 中要 关注 单片机 本身 的 功耗 和 提供 的 节能 措施 。 单片机 分为 HMOS 和 CHMOS 两种 工艺技术 芯片 ， HMOS 芯片 功耗 大 ， 不宜 使用 在 低功耗 系统 中 ； 而 CHMOS 工艺技术 既 可 满足 高集成度 又 可 满足 高 运行 速度 要求 ， 其 功率 相当于 CMOS 电路 ， 因此 ， 用 CHMOS 工艺技术 制成 的 单片机 称为 低功耗 型 单片机 ， 是 低功耗 系统 设计 的 唯一 选择 。 常用 的 CHMOS 单片机 中 主要 有 Intel 公司 的 CCC 八位 单片机 ， C 十六位 单片机 ； ATMEL 公司 的 C 衍生 系列 单片机 ； Philips 公司 的 C 衍生 系列 单片机 ； Motorola 公司 的 MCHC 、 MCHC 系列 单片机 等 。 具体 选用 哪 一家 的 芯片 可 根据 系统 功能 要求 、 自己 的 使用 经验 、 具备 的 开发 条件 及 价格 等 因素 ， 选择 往往 因人而异 。 　 　 外围 器件 选择 　 　 在 低功耗 电子系统 设计 中 可 供选择 的 外围 低功耗 器件 有 ： HC 系列 高速 CMOS 数字 集成电路 ； 系列 低速 CMOS 电路 ； HCMOS 技术 的 存储器 和 带 C 标志 的 接口 扩展 芯片 。 常用 的 存储器 芯片 有 ROM 芯片 Cxxx 系列 ； 静态 RAM 有 、 、 、 C 等 ； EEPROM 芯片 有 C 、 C 等 ； FLASH 有 Cxxx 系列 等 。 接口 扩展 芯片 如 C 、 C 、 C 、 C 等 。 外围 器件 的 选择 主要 考虑 实现 的 功能 、 使用 的 方便性 、 工作 速度 及 价格 等 因素 。 器件 节能 状态 的 利用 　 　 利用 外围 器件 的 维持 Standby 状态 　 　 在 电路设计 过程 中 ， 要 充分利用 外围 芯片 提供 的 节电 功能 ， 最大 限度 地 利用 它们 的 维持 状态 。 例如 ， ATMEL 公司 生产 的 ATc ， 工作 时 的 电流 约 为 mA ， 而 其 维持 状态 的 电流 最大 不 超过 μ A ， 所以 在 系统 设计 时要 充分利用 芯片 提供 的 这 一 特性 。 若 把 ATc 和 MCS 系列 单片机 配套 使用 ， 只要 在 一定 的 晶振 频率 范围 内 ， 可以 把 芯片 的 片 选端 CE 和 输出 使能 端 OE 都 连 到 单片机 的 片 外取 指 控制 信号 PSEN 端 ， 这样 ATc 在读 操作 以外 的 时间 均 处于 维持 状态 ， 比 常规 接法省 电 。 这种 连接 方法 在 单片机 工作 状态 和 闲置 Idle 状态 能 最大 限度 地 节约 电源 ， 但 在 单片机 掉电 PowerDown 状态 就 有 问题 。 这是 由于 MCS 系列 单片机 在 掉电 状态 时 ， PSEN 引脚 输出 低电平 ， 使 ATc 处于 选通 状态 。 为了 解决 这个 问题 ， 在 系统 设计 时 可以 采用 分区 供电 的 方法 ， 在 单片机 进入 掉电 状态 前 ， 切断 ATc 的 供电 回路 。 　 　 单片机 的 节能 状态 　 　 在 任何 时候 ， CMOS 器件 所 消耗 的 功率 都 与 开关 速度 成正比 。 不 工作 时 CMOS 单片机 不 消耗 功率 ， 一旦 该 芯片 或 其 内部 一部分 开始 工作 ， 功耗 就 随着 工作 模块 的 增加 、 速度 的 加快 而 上升 。 所以 有些 单片机 具有 几种 使 芯片 的 不同 部分 停止 工作 以 不同 程度 地 减少 功率 的 闲置 模式 。 如 MCS 系列 低功耗 单片机 就 有 两种 节电 方式 IDLE ， PowerDown 两种 方式 ， TexasInstrumentsTMCX 提供 了 种 空闲 模式 。 还 有些 单片机 如 东芝公司 的 TLCS 提供 了 双 时钟 工作 方式 内部 有 高频 和 低频 两个 时钟 发生器 为 芯片 节能 提供 了 更 多 的 选择 。 例如 ， TLCS 系列 单片机 的 工作 状态 可 分为 ： 单 时钟 的 正常 运行 方式 Normal 、 空闲 方式 Idle 、 停机 方式 Stop ， 以及 双 时钟 的 正常 运行 方式 Normal 、 空闲 方式 Idle 、 慢速 方式 Slow 、 睡眠 方式 Sleep 和 停机 方式 Stop 。 如何 利用 这些 不同 级别 的 节能 方式 ， 可 根据 任务 运行 情况 进行 选择 。 供电 回路 设计 　 　 电源 电路设计 的 好坏 不但 影响 系统 的 功耗 还 严重 影响 系统 的 可靠性 ， 下面 给出 一个 实用 的 供电 方案 。 　 　 主 电源 　 　 系统 的 主 电源 如图所示 ， 图中 JP 端 用来 外接 DC 电源 ～ VmA 电阻 R 欧 、 R 欧 、 RK 欧及 三极管 KSTQ 、 Q 起 限流 保护 作用 ； JP 端 与 节号 电池 相连 ； JP 端接 V 镍 锰 电池 ， 从图 中 可以 看出 为 它 设计 了 两条 充电 回路 。 LPM 是 Motorola 公司 的 低压 差 高效率 的 V 直流 稳压器 件 。 系统 处于 掉电 状态 时 由 Vbat 向 系统 的 核心 部分 供电 一般 由 单片机 、 RAM 、 实时 时钟 芯片 等 组成 ； 当 产生 上电 复位 或 按键 复位 时 ， 单片机 通过 P 端口 接通 Vcc 启动 系统 的 最小 系统 部分 和 核心 部分 工作 。 图中 二极管 D 、 D 、 D 为 IN ； D 、 D 为 IN ； 三极管 Q 、 Q 、 Q 为 KST 。 图主 电源 电路 　 　 电源 分配 　 　 电源 分配 部分 可 由 一片 HC 和 多个 PNP 三极管 组成 ， 电路 示意图 如图 。 图 模块电源 分配 电路 　 　 电源 分配 电路 ， 用来 分别 对 各 独立 模块 如 RS 接口 电路 、 红外接口 电路 等 的 电源 设施 控制 。 控制 方法 简单 ， 只要 给 HC 的 相应 输出 端清 或 置 即可 。 当 单片机 的 P 口 够用 时 就 不要 扩充 HC 。 　 　 电源 异常 检测 电源 异常 检测 部分 可 由 电压 比较 器 LM ， 基准 电源 LM 及个 电阻 组成 ， 如图所示 。 图 电源 检测 电路 　 　 通过 电阻 分压 和 基准 电源 产生 两级 报警 输出 ， 它们 可以 与 单片机 的 INT 及 INT 端 相连 。 当 电源 电压 下降 到 一定 的 值时 比如 V 比较 器 输出 为 低电平 ， 触发 外 中断 INT ， 中断 程序 点亮 相应 的 发光 二极管 或 通过 LCD 向 用户 显示 提示信息 ； 若 电源 电压 继续 下降 到 一定 的 值时 比如 V ， 比较 器 输出 为 低电平 ， 产生 INT 中断 ， 中断 程序 保护 工作 现场 ， 设置 标记 ， 切断 外围 总 电源 Vcc ， 使 系统 进入 掉电 状态 。 其它 因素 　 　 引脚 与 工作电压 幅度 　 　 CMOS 器件 是 电压 型 器件 。 它 的 输入电阻 很大 ， 因而 CMOS 器件 的 输入 引脚 不能 悬空 。 如果 输入 引脚 悬空 ， 在 输入 引脚 上 很 容易 积累 电荷 产生 感应 电动势 ， 造成 引脚 电位 处于 与 之间 的 过度 区域 ， 这时 内部 反向 器 的 上 、 下 两个 场效应管 均会 导通 ， 使 电路 功耗 大大增加 。 　 　 CMOS 器件 电源 供电 的 电压 范围 比较 宽 ， 而且 随着 供电 电压 的 降低 ， 功耗 也 随之 降低 。 目前 已有 工作电压 在 V 、 V 甚至 V 的 外围 芯片 和 单片机 可 供 选用 。 　 　 上拉 电阻 　 　 上拉 电阻 一般 与 连接 到 总线 的 CMOS 单片机 引脚 一起 使用 ， 因为 这些 引脚 在 总线 未 被 驱动 或 禁用 时 往往 处于 高 、 低电平 之间 的 中间 态 ， 若 使用 位 或位 总线 时 损耗 功率 相当可观 。 上拉 电阻 可用 来 使 总线 保持 在 高电位 状态 减少 这种 不必要 的 功耗 。 但 这种 设计 需要 附加 功率 使 总线 处于 低电平 状态 ， 也 会 白白 在 电阻 上 消耗 功率 。 为了 解决 这一 问题 ， 有些 单片机 采用 了 内部 多级 上拉 电阻 ， 如 C 单片机 的 个位 IO 口中 ， P 、 P 、 P 口 存在 内部 上拉 电阻 ， P 口 没有 内部 上拉 电阻 ， 在 不同 的 工作 方式 下 ， 它 的 使用 就 比较复杂 ， 要 根据 具体情况 选用 上 拉 或 下 拉 电阻 。 　 　 ROM 与 RAM 的 问题 　 　 为了 得到 最低 的 功耗 ， 存储器 的 配置 在 应用 中将 对 功耗 产生 很大 的 影响 。 如果 要外 扩 存储器 ， 在 单片机 与 外部 存储器 的 接口 上 就要 消耗 功率 ， 这种 情况 下 一般 采用 单片机 与 存储器 分开 供电 的 办法 。 所以 ， 在 设计 应用 系统 时 ， 最好 选用 内部 有 足够 ROM 和 RAM 的 单片机 芯片 ， 这种 芯片 不但 能 减少 系统 功耗 、 体积 ， 往往 还 能 减少 成本 并 提高 可靠性 。 由于 CMOS 电路 的 动态 功耗 与 该 电路 改变 逻辑 状态 的 频率 及 速度 相关 。 电路 逻辑 状态 改变 的 频率 越高 ， 改变 的 速度 越低 ， 电路 的 动态 功耗 就 越 大 。 故 访问 片上 SRAM 将 比 访问 片上 ROM 多 耗用 ～ 的 能量 ， 所以 要 尽量少 访问 SRAM 。 程序设计 时要 考虑 的 因素 　 　 一个 低功耗 系统 ， 光靠 低功耗 的 硬件 设计 技术 还 不够 ， 必需 有 相应 的 软件 措施 配合 才能 取得 最佳 效果 。 在 程序设计 方面 ， 要 关心 两个 方面 的 问题 ： 一是 对 模块 供电 进行 控制 ， 即 根据 工作 需要 接通 相应 功能模块 的 电源 。 例如 ， 进行 通信 时 ， 才 给 RS 接口 部分 接通 电源 ； 结束 通信 ， 立即 切断 电源 。 利用 这种 办法 系统 不 通信 时 可 节省 mA 左右 的 电流 ， 可以 说 模块 供电 方法 是 节能 的 好 措施 。 二是 充分利用 单片机 提供 的 闲置 、 掉电 方式 。 下面 给出 了 一个 应用 事例 。 　 　 MCS 系列 的 低功耗 单片机 ， 设置 了 一个 电源 控制 寄存器 PCON ， 当 送入 立即 数 H 时 ， 单片机 则 进入 闲置 方式 。 此时 ， 单片机 在 MHz 的 晶振下 的 工作 电流 由 mA 下降 到 mA ， 在 闲置 方式 ， 若有 允许 的 中断 源 申请 中断 时 ， 单片机 立即 响应 中断 ， 唤醒 单片机 恢复 到 工作 状态 。 当向 PCON 中 送入 立即 数 H 时 ， 单片机 则 进入 掉电 方式 。 此时 ， 单片机 的 维持 电流 仅为 几十 μ A 左右 ， 要 解除 掉电 方式 只能 采用 按键 复位 或 上 电 复位 。 为了 充分利用 上述 方式 在 应用 系统 程序设计 时 ， 可以 采用 如下 措施 ： 　 　 lms 定时 中断 ： 系统 上电 复位 或 按键 复位 后 ， 不 进入 实际 的 工作 过程 时 ， 主控 程序 不断 查询 键盘 和 读取 实时 时钟 并 在 LCD 上 进行 动态显示 。 大家 知道 实时 时钟 在 LCD 上 显示 只要 s 刷新 一次 就行 ， 键盘 操作 ms 响应 一次 也 来得及 ， 所以 可 充分利用 单片机 提供 的 闲置 方式 来 降低功耗 。 基于 上述 分析 ， 可以 把 定时器 设置 为 ms 定时 中断 ， 把 主控 程序设计 成 每 循环 执行 一次 就 休眠 ms ， 定时 中断 不 作 任何 操作 只起 唤醒 Idle 的 作用 。 因为 主控 程序执行 时间 很 短 ， 再 加长 休眠 时间 节能 效果 不 明显 反而 影响 按键 响应 。 　 　 s 自动 掉电 方式 ： 利用 实时 时钟 ， 在 连续 s 内 无 键盘 、 通信 等 操作 ， 则 自动 进入 掉电 方式 ， 使 系统 的 功耗 降到 最低 。 　 　 合理 组织 程序模块 ： 当片 内 带有 ROM 的 单片机 如 ATC 和 片外 ROM 混合 使用 时 ， 要 注意 组织 程序模块 。 应该 把 系统 中 的 常用 程序模块 放在 单片机 内部 ， 使得 系统 在 绝大多数 时间 内 ， 程序 在 单片机 内部 运行 ， 使外 扩 ROM 处于 Standby 状态 。 根据 以上 的 分析 ， 主控 程序 流程图 可以 归纳 为 图 。 图 程序 流程图 结束语 　 　 低功耗 单片机 应用 系统 的 设计 方法 及其 电源 供电 方法 与 模块化 电源 控制 方式 在 我们 设计 的 一台 基于 ATC 的 手持 系统 中 得到 实现 ， 取得 了 理想 的 效果 。 当然 ， 用 MCS － 家族 单片机 设计 低功耗 应用 系统 并 不 理想 ， 在 设计 超 低功耗 应用 系统 时有 很多 厂家 的 单片机 可 供选择 ， 如 ， NEC 、 Toshiba 、 华邦 等 公司 的 LL 单片机 LL ： Lowvoltage 、 Lowpowerconsumption 芯片 。 但 本文 所 论述 的 设计 方法 也 可 应用 于 其他 类似 的 低功耗 系统 设计 中 。 近年来 ， 微处理器 CPU 向 嵌入式 微处理器 MPU 发展 ； 近期 ， 采用 智能 集成 技术 IntelligentIntegrationtechnology 采用 这种 技术 的 单片机 也 称为 I 单片机 的 片 上 系统 PConachip 也 初露头角 。 在 这种 形势 下 ， 由 MCU 、 MPU 、 PConachip 构成 的 电子系统 有人 称为 现代 电子系统 将会 在 各种 领域 中 取代 传统 的 非 智能 的 电子系统 。 作者 单位 西安交通大学 计算机科学 与 技术 系 西安 参考文献 CHMOSComponentsHandbookIntelCorporationbitMicrocontrollerTLCSSeriesDataBookToshiba 何立民 MCS 系列 单片机 应用 系统 设计 北京 ： 北京航空航天大学 出版社 何 为民 低功耗 单片微 机系统 设计 北京 ： 北京航空航天大学 出版社