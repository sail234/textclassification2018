计算机 应用 研究 APPLICATIONRESEARCHOFCOMPUTERSVolNoP 利用 数据 管道 技术 实现 管理网络 的 资源共享 石晓龙 　 吕 汉兴 摘 　 要 ： 根据 作者 在 数据库 管理系统 设计 中 遇到 的 实际 问题 ， 讨论 了 企业 网中 子系统 数据 资源 的 共享 问题 及其 实现 方案 ， 并 结合 系统 方案 的 具体实施 介绍 了 数据 管道 技术 的 应用 。 关键词 ： 企业 网 数据库 管理系统 ODBC 数据 管道 　 　 在 进行 大型 数据库 管理系统 的 设计 与 开发 时 ， 经常 会 遇到 这样 的 情形 ： 用户 已经 使用 了 某些 专用 的 商业化 管理软件 或是 使用 了 一些 自己 开发 的 小 系统 ， 并 要求 在 不 改变 原有 系统 正常 运行 的 情况 下 获得 这些 数据 管理系统 的 数据 。 　 　 通过 开放式 的 数据库 连接 ODBC 我们 可以 使用 标准 的 SQL 语句 访问 提供 了 ODBC 驱动程序 的 特定 的 数据库 。 然而 如果 客户端 设计 为 直接 通过 ODBC 访问 这些 独立 子系统 并 获取 所 需 的 数据 的 查询 方式 ， 则 显然 将 遇到 以下 几个 难点 ： 　 　 各 子系统 数据库 均 有 其 独立 的 数据结构 、 数据类型 ， 因而 难以 在 客户端 按照 用户 的 要求 实现 数据 查询 。 　 　 由于 不同 的 子系统 采用 了 不同 的 数据库 ， 在 访问 各类 数据 时 必须 频繁 地同 各类 数据库 建立 连接 。 因而 增加 了 系统 开销 ， 降低 了 管理网络 的 工作效率 。 　 　 有些 单机 的 子系统 采用 的 是 不 支持 网络 访问 的 本地 数据库 ， 无法 将 其 作为 数据库 服务器 访问 。 　 　 由于 上面 所 讲 的 这些 问题 特别 是 第三点 是 无法 克服 的 ， 我们 决定 不 采用 通过 ODBC 直接 访问 的 方式 ， 而 采取 以下 方式 来 设计 系统 。 　 　 通过 使用 数据 管道 技术 将 所 需 的 各 子系统 的 数据 分别 灌入 数据库 服务器 ， 这样 做 首先 解决 了 第三点 无法 通过 网络 使用 ODBC 直接 访问 单机 子系统 的 问题 。 通过 对 数据 灌入 的 设计 可以 屏弃 原有 数据库 的 结构 ， 而 完全 按照 用户 的 要求 来 选择 所 需要 的 数据 ， 并 建立 相应 的 数据库 结构 ， 从而 为 客户端 软件 的 设计 提供 了 极大 的 便利 。 同时 在 用户 访问 这些 子系统 数据 的 时候 ， 只 需要 同 我们 的 数据库 服务器 建立 一次 连接 就 可以 访问 所有 子系统 中 各 相关 的 数据 ， 同 直接 通过 ODBC 连接 子系统 数据库 相比 大大减少 了 系统 开销 ， 从而 提高 了 网络 的 工作效率 。 　 　 下面 通过 一个 管理网络 软件设计 的 实例 来 谈谈 这种 设计 思想 的 具体 实现 。 　 　 在 武汉 管道 煤气公司 的 信息管理系统 设计 中 ， 按照 用户 要求 它 必须 包含 财务 、 人事 、 材料 、 设备 、 生产 等等 子系统 的 信息 。 但是 公司 已经 有 了 自己 独立 的 财务 、 人事 、 设备 、 材料 系统 。 其中 财务 系统 使用 的 是 用友 软件 ， 人事 系统 使用 的 是 人事部门 统一 规定 的 人事管理 软件 ， 材料 系统 则 使用 的 是 一个 自己 用 FOXPRO 开发 的 管理软件 ， 设备 系统 是 购买 的 专用设备 管理软件 。 而且 设备 、 人事 系统 均 为 单机版 。 　 　 我们 使用 的 是 前台 PB 后台 SQLSERVER 数据库 服务器 的 开发 平台 。 对于 各 子系统 均 提供 一套 用 PB 开发 的 客户端 软件 ， 使用 PB 的 数据 管道 功能 在 客户端 实现 数据 向 数据库 服务器 的 灌入 。 　 　 在 程序 中 使用 PB 提供 的 数据 管道 来 实现 数据库 之间 的 数据 转换 与 传输 十分 方便 ， 首先 必须 创建 一个 标准 的 PB 类 用户 对象 ， 这个 标准 类 用户 对象 是 对 PB 数据 管道 系统 对象 的 继承 。 　 　 如上图 ， 选择 OK 即 完成 了 数据 管道 用户 对象 的 创建 。 选择 存盘 输入 用户 对象 的 名称 ， 存储 完毕 后 就 可以 在 程序 中 使用 此 用户 对象 。 　 　 在 使用 数据 管道 进行 数据 的 转换 与 传送 之前 ， 必须 通过 ODBC 分别 与 作为 源 的 本地 的 数据库 以及 作为 目的 的 数据库 服务器 建立 连接 。 具体 编程 如下 ： 　 　 首先 定义 两个 事务 型 全局变量 ： transactionclienttransservertrans 　 　 在 数据 灌入 窗口 的 open 事件 中 分别 与源 数据库 、 目的 数据库 连接 的 程序 ： clienttransCREATETRANSACTIONservertransCREATETRANSACTION 定义 源 数据库 参数 clienttransDBMSprofilestringpipelineiniclientDBMSclienttransDatabaseprofilestringpipelineiniclientDatabaseclienttransLogIDprofilestringpipelineiniclientLogIDclienttransLogPassprofilestringpipelineiniclientLogPassclienttransServerNameprofilestringpipelineiniclientServerNameclienttransUserIDprofilestringpipelineiniclientUserIDclienttransDBPassprofilestringpipelineiniclientDBPassclienttransLockprofilestringpipelineiniclientLockclienttransDbParmprofilestringpipelineiniclientDbParmconnectusingclienttrans 与源 数据库 建立 连接 定义 目的 数据库 参数 servertransDBMSprofilestringpipelineiniserverDBMSservertransDatabaseprofilestringpipelineiniserverDatabaseservertransLogIDprofilestringpipelineiniserverLogIDservertransLogPassprofilestringpipelineiniserverLogPassservertransServerNameprofilestringpipelineiniserverServerNameservertransUserIDprofilestringpipelineiniserverUserIDservertransDBPassprofilestringpipelineiniserverDBPassservertransLockprofilestringpipelineiniserverLockservertransDbParmprofilestringpipelineiniserverDbParmconnectusingclienttrans 与 目的 数据库 建立 连接 settransobjectdwldtrans 　 　 上述 源 、 目的 数据库 的 ODBC 参数 我们 可以 在位 ODBC 数据源 管理器 中 获得 ， 若 子系统 的 客户机 ODBC 管理器 上 没有 此 数据源 ， 则 必须 安装 相应 数据库 的 ODBC 驱动程序 ， 并 在 其位 ODBC 数据源 管理器 中 建立 相应 的 数据源 。 　 　 然后 ， 就 可以 在 PB 中 定义 将要 在 程序 中 应用 到 的 数据 管道 ， 建立 一个 新 的 数据 管道 分别 与 上述 源 数据库 、 目的 数据库 相连接 。 选择 所 要 传输 的 数据表 ， 并 选择 所 需要 的 字 段 ， 定义 目的 数据库 表中字 段 的 数据类型 。 同时 选择 合适 的 灌入 方式 ， 在 这里 PB 提供 了 创建 、 更新 、 刷新 、 追加 、 提交 五种 灌入 方式 ， 提交 的 记录 条数 一般 选择 全部 all 。 　 　 完成 上述 工作 后 ， 就 可以 使用 PB 提供 的 函数 操作 数据 管道 了 。 PB 提供 了 三个 对 数据 管道 进行 操作 的 函数 ： start ； repair ； cancel 。 分别 用于 启动 、 修正 、 取消 数据 管道 的 操作 。 　 　 启动 数据 管道 的 程序 如下 ： intpipemsglongstimeetimemypipelinecstransmypipeline 为 自定义 的 数据 管道 用户 对象 cstranscreatemypipelinecstransdataobjectclientserver 　 　 　 　 　 　 　 　 　 　 　 clientserver 为 用户 定义 的 数据 管道 stimecpu 　 　 　 　 　 获取 数据传输 执行 时间 pipemsgcstransstartservertransclienttransdw 　 　 　 　 　 　 　 　 　 　 　 　 启动 数据 管道 etimecputranstimetextstringetimestimesecs 　 　 当 执行 数据 管道 出错 时 ， 可以 使用 repair 函数 通过 全局 事务 变量 servertrans 连接 目的 数据库 ， repair 函数 通过 获取 出错 信息 窗口 的 修正 信息 来 更新 目标 数据库 。 运用 实例 如下 ： cstransrepairservertrans 　 　 当然 ， 通过 cancel 函数 我们 可以 随时 停止 一个 正在 执行 的 数据 管道 的 运行 ： cstranscance 　 　 通过 使用 数据 管道 将 各 子系统 数据库 的 数据 灌入 数据库 服务器 ， 管理网络 中 的 各个 PB 客户端 只 需要 访问 SQLServer 数据库 服务器 就 可以 迅速 获得 财务 、 人事 、 设备 、 材料 等 各个 子系统 的 数据 。 通过 规定 定期 的 数据 灌入 ， 保证 了 服务器 上 数据 的 有效性 。 实践证明 ， 通过 数据 管道 解决 企业 管理网络 中 共享 各 子系统 数据 的 问题 是 十分 方便 而且 有效 的 。 石晓龙 华中理工大学 自控 系 武汉 吕 汉兴 华中理工大学 自控 系 武汉 参考文献 lSQLServer 开发 指南 侯志平 徐 常胜 珠联璧合 PowerBuilder 与 数据库 配合 开发技术 收稿 日期 ： 年月日