微型机 与 应用 WEIXINGJIYUYINGYONG 　 Vol 　 No 　 P 在 中文 VFP ． 中 使用 OLE 自动 服务 李元 摘要 ： 使用 OLE 自动化 服务 在 VFP 中 调用 Excel 或 Word ， 完成 报表 的 制作 。 关键词 ： OLEVFP 数据库 应用软件 报表 制作 　 　 制作 各种各样 的 报表 是 VisualFoxPro ． 数据库 应用 程序设计 必不可少 的 任务 。 VFP 本身 的 报表 功能 虽然 已经 很 不错 ， 但 有时 难以 满足用户 的 各种 特殊要求 。 这时 可以 使用 OLE 自动化 服务 在 VFP 中 调用 Excel 或 Word 来 完成 这种 特殊任务 （ VFP 数据库 应用软件 作为 客户 ， Excel 或 Word 作为 服务器 ） 。 Excel 有 强大 的 数据处理 功能 ， 而 Word 有 强大 的 图文 处理 功能 ， 不管 什么样 的 报表 任务 都 可 很 好 完成 。 下面 简单 的 例子 说明 如何 在 VFP 应用软件 运行 中将 数据库 中 的 数据 交给 Word 来 完成 个 报表 的 制作 。 　 　 为 简单 起 见 ， 假定 在 个 VFP 项目 中有 关于 科研经费 开支 情况 的 数据表 ： kyjf ． dbf （ 其中 不 录入 合计 数 ） ， 如表 所示 。 表 科研经费 开支 情况表 费用 项目 一季度 二季度 三季度 四季度 合计 科研 材料 　 科研 出差 　 其它 费用 　 合计 　 　 　 　 　 　 　 我们 希望 在 VFP 的 这个 项目 运行 时 ， 调用 Word 来 制作 这个 数据表 的 “ 科研经费 开支 情况 报表 ” ， 并 在 处理 时 自动 计算 合计 数 ， 最后 将 报表 以 Word 文件 存盘 。 下面 的 程序 Word ． prg 实现 了 这些 要求 。 程序 中用 CreateObject （ ） 函数 启动 Word ， 并 新建 个 Word 工作 稿 （ 用 通常 方式 或 模板 方式 均 可 ） ， 先 设置 报表 的 标题 ， 然后 根据 数据库 的 字 段 与 记录 在 这个 文稿 中 编程 设置 个 表格 ， 打开 数据库 table ． dbf ， 取得 该表 的 记录 数 ， 将 数据表 table ． dbf 的 记录 数据 逐条 送到 Word 文稿 的 表格 中 （ 同时 计算 合计 ： 各 费用 项目 的 合计 各 季度 开支 的 合计 以及 全年 开支 的 合计 ） ， 在 Word 中 稍加 修改 这个 报表 ， 并用 templ ． doc 文件名 存盘 。 　 　 ＊ ＊ 源程序 ： word ． prg ： 　 　 SETDEFAULTTOd ＼ myvfp ＼ kwsjk 　 　 Clear 　 　 SETDEFAULTTOd ＼ myvfp ＼ kwsjk 　 　 oleApp ＝ CREATEOBJECT （ ″ Word ． Application ″ ） 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 ＆ ＆ 启动 Word 　 　 oleApp ． Visible ＝ ． T ． 　 ＆ ＆ 显示 Word 　 　 oleApp ． Documents ． Add 　 ＆ ＆ 创建 一个 缺省 设置 工 　 　 　 　 　 　 　 　 　 　 　 　 　 　 ＆ ＆ 作 文稿 （ A ） 　 　 ＊ ＊ oleApp ． Documents ． Add （ ″ Nomal ″ ， ． T ． ） 　 　 　 　 　 　 　 　 　 　 　 　 　 　 ＆ ＆ 使用 模板 创建 个 工作 文稿 　 　 ＊ ＊ 设置 字体 、 字号 　 　 oleApp ． Selection ． Font ． Bold ＝ ． T ． 　 　 oleApp ． Selection ． Font ． Size ＝ oleApp ． Selection ． Font ． Name ＝ ″ 幼圆 ″ 　 　 ＊ ＊ 　 　 　 　 oleApp ． Selection ． TypeText （ ″ 贵州大学 计算机软件 与理 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 论 研究所 ″ ） 　 　 oleApp ． Selection ． TypeParagraph 　 　 　 ＆ ＆ 换行 　 　 oleApp ． Selection ． TypeText （ ″ 科研经费 使用 报表 ， 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 年 月 ″ ） 　 　 oleApp ． Selection ． TypeParagraph 　 　 　 ＆ ＆ 换行 　 　 oleApp ． DisplayAlerts ＝ ． F ． 　 　 oleApp ． Selection ． Font ． Size ＝ 　 　 oleApp ． Selection ． Font ． Name ＝ ″ 宋体 ″ 　 　 ＊ ＊ 打开 数据表 ， 取得 该表 的 记录 数 　 　 usekyjf ． dbf 　 　 j ＝ RECCOUNT （ ） － 　 　 ＊ ＊ 在 Word 工作 文稿 中 增加 个 表格 （ 表格 的 列数 与 数 　 　 ＊ ＊ 据表 table ． dbf 的 字 段数 相同 为 ； 行数 比 记录 数多 　 　 ＊ ＊ ， 因 第行 用来 做 表头 ） 　 　 oleApp ． ActiveDocument ． Tables ． Add （ oleApp ． Selection ． 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 Range ， j ＋ ， ） 　 　 loTable ＝ oleApp ． ActiveDocument ． Tables （ ） 　 　 ＊ ＊ 填写 报表 头 ： 　 　 loTable ． Cell （ ， ） ． Range ． InsertAfter （ ″ 费用 项目 ″ ） 　 　 loTable ． Cell （ ， ） ． Range ． InsertAfter （ ″ 一季度 ″ ） 　 　 loTable ． Cell （ ， ） ． Range ． InsertAfter （ ″ 二季度 ″ ） 　 　 loTable ． Cell （ ， ） ． Range ． InsertAfter （ ″ 三季度 ″ ） 　 　 loTable ． Cell （ ， ） ． Range ． InsertAfter （ ″ 四季度 ″ ） 　 　 loTable ． Cell （ ， ） ． Range ． InsertAfter （ ″ 合计 ″ ） 　 　 ＊ ＊ 将 数据表 table ． dbf 的 记录 放入 Word 文稿 的 表格 　 　 ＊ ＊ 中 ， 自动 计算 总分 ： 　 　 FORi ＝ TOj － 　 　 　 　 goi ＋ ＆ ＆ 第 i ＋ 条 记录 　 　 　 　 loTable ． Cell （ i ＋ ， ） ． Range ． InsertAfter （ kyjf ． 费用 项目 ） 　 　 　 　 loTable ． Cell （ i ＋ ， ） ． Range ． InsertAfter （ kyjf ． 一季度 ） 　 　 　 　 loTable ． Cell （ i ＋ ， ） ． Range ． InsertAfter （ kyjf ． 二季度 ） 　 　 　 　 loTable ． Cell （ i ＋ ， ） ． Range ． InsertAfter （ kyjf ． 三季度 ） 　 　 　 　 loTable ． Cell （ i ＋ ， ） ． Range ． InsertAfter （ kyjf ． 四季度 ） 　 　 　 　 　 ＊ ＊ 计算 各项 费用 的 合计 数 loTable ． Cell （ i ＋ ， ） ． Range ． InsertAfter （ kyjf ． 第一季度 ＋ kyjf ． 第二季度 ＋ kyjf ． 第三季度 ＋ kyjf ． 第四季度 ） 　 　 ENDFOR 　 　 ＊ ＊ 计算 各 季度 费用 的 合计 数 　 　 hj ＝ ＆ ＆ 第一季度 的 合计 　 　 hj ＝ ＆ ＆ 第二季度 的 合计 　 　 hj ＝ ＆ ＆ 第三季度 的 合计 　 　 hj ＝ ＆ ＆ 第四季度 的 合计 　 　 FORi ＝ TOj 　 　 　 　 goi ＋ ＆ ＆ 第 i ＋ 条 记录 　 　 　 　 　 ＊ ＊ 计算 各 季度 的 合计 数 　 　 　 　 hj ＝ hj ＋ kyjf ． 一季度 ＆ ＆ 计算 第一季度 的 合计 　 　 　 　 hj ＝ hj ＋ kyjf ． 二季度 ＆ ＆ 计算 第一季度 的 合计 　 　 　 　 hj ＝ hj ＋ kyjf ． 三季度 ＆ ＆ 计算 第一季度 的 合计 　 　 　 　 hj ＝ hj ＋ kyjf ． 四季度 ＆ ＆ 计算 第一季度 的 合计 　 　 ENDFOR 　 　 loTable ． Cell （ j ＋ ， ） ． Range ． InsertAfter （ ″ 合计 ″ ） 　 　 loTable ． Cell （ j ＋ ， ） ． Range ． InsertAfter （ hj ） 　 　 loTable ． Cell （ j ＋ ， ） ． Range ． InsertAfter （ hj ） 　 　 loTable ． Cell （ j ＋ ， ） ． Range ． InsertAfter （ hj ） 　 　 loTable ． Cell （ j ＋ ， ） ． Range ． InsertAfter （ hj ） 　 　 ＊ ＊ 计算 全年 费用 的 合计 数 　 　 loTable ． Cell （ j ＋ ， ） ． Range ． InsertAfter （ hj ＋ hj ＋ hj ＋ hj ） 　 　 OleApp ． ActiveDocument ． SaveAs （ ″ D ＼ myvfp ＼ kwsjk ＼ temp ． doc ″ ） ＆ ＆ 保存 Word 报表 文件 　 　 OleApp ． Quit 　 　 　 　 ＆ ＆ 退出 Word 　 　 程序 在 安装 有 Office 的 WIN ／ ／ NT ， 中文 VFP ． 下 通过 。 图即 为 程序运行 的 结果 。 图 程序运行 结果 李元 （ 贵阳 贵州大学 计算机软件 与 理论 研究所 ） 参考文献 ［ ］ 李元 ． VisualFoxPro ． 中 调用 AutoCAD 的 应用 实例 ． 中国 计算机 报 ， 年月日 ［ ］ MicrosoftCorporation ． MicrosoftVisualFoxPro ． 程序设计 员 指南 ． 北京 ： 希望 电脑公司 ， ［ ］ BazianM ． VisualFoxPro ． 开发 使用手册 ． 北京 ： 机械 工业 出版社 ， 收稿 日期 ： － －