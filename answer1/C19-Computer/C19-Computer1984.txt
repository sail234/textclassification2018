微型机 与 应用 MICROCOMPUTERITSAPPLICATIONS 年 第卷 第期 VolNo 用 微机 载波 实现 实时 抄表 收费 系统 何晓春 　 　 摘 　 要 ： 介绍 了 个 实用 的 住宅区 水 、 电 、 气 实时 收费 系统 ， 对 其 功能 及 实现 进行 了 比较 详细 的 描述 。 　 　 关键词 ： 实时 收费 　 单片机 　 载波 　 　 随着 我国 城市 建设 的 不断 发展 ， 城镇 出现 了 各种 住宅小区 。 尽管 小区 规划 越来越 科学 ， 但是 上门 抄表及 月 次 的 水 、 电 、 气 交费 仍旧 很 麻烦 。 现在 计算机 和 电子 技术 的 高速 发展 ， 为 实现 实时 收费 系统 奠定 了 基础 。 　 系统 功能 及 总体方案 　 　 总体方案 　 　 自动 实时 收费 系统 的 框图 如图所示 。 图 系统 原理 框图 　 　 该 系统 利用 输电线 进行 载波 传送 ， 每一 用户 家中 采用 台 位 单片机 及 外围 电路 进行 数据 采集 、 初步 计算 及 数据 传送 ， 每 一台 小区 变压器 上 由 台位 单片机 进行 数据 汇编 ， 并 将 处理 后 的 数据 传送 至 变配电 站 主机 。 在 主机 上 可以 完成 各 用户 的 水电 气 等 费用 的 查询 及 交费 工作 ， 并 能 对 各 用户 的 用量 进行 实时 监控 。 　 　 从 框图 可以 看出 该 系统 采用 了 分布式 计算机 监测 方案 ， 由台 主机 与 多台 位 单片机 及 用户 家中 的 位 单片机 组成 级 分布式系统 。 主机 及位 单片机 考虑 到 工作 环境 是 较 强 的 电磁场 ， 主要 的 工作 是 数据 传送 、 采集 及 少量 的 运算 ， 因此 选用 工业 机做 主机 ， 位 单片机 选用 Intel 。 位 单片机 主要 是 数据 采集 — — 采集 经过 数字化 改造 的 水 、 煤 、 气 模拟 表 数字化 改造 可 采用 红外 、 电磁 、 机械 等 方式 的 数值 ； 初步 计算 — — 将 采集 的 数值 减去 底数 为 当前 消耗量 ； 数据 传送 — — 定时 将 计算 的 结果 编码 后 通过 V 输电线 载波 传送 至 变压器 低压 侧 。 根据 此 要求 及 低成本 限制 ， 位 单片机 选用 单片机 ， 配合 EPROM 以 存储系统 程序 ， EEPROM 用于 对 采集 的 数据 及 计算 的 结果 进行 存储 查询 。 位 单片机 装在 变压器 上 ， 将位 单片机 定时 载波 传送 至 变压器 低压 侧 的 波形 滤波 整形 后 加以 采集 、 计算 、 存储 ， 在 变压器 高压 测定 时 将 数据编码 后 通过 高压 输电线 载波 传送 至 主机 接口 。 主机 安装 在 电控 室 ， 可以 进入 管理网络 。 各 用户 的 电 、 水 、 气 用量 可以 实时 地 反映 在 相应 公司 有关 的 计算机 报表 中 。 　 　 系统 功能 　 　 位 单片机 主要 完成 数据 采集 、 计算 、 存储 及 通信 功能 。 　 　 数据 采集 、 计算 、 存储 功能 ： 自动 采集 电能表 、 水表 、 煤气表 脉冲 信号 并 进行 计算 ， 得到 当时 的 消耗量 ， 将 消耗量 与 该 单片机 的 唯一 号码 组合 起来 存储 在 EEPROM 中 ， 等待 上位 机 的 通信 信号 。 　 　 数据通信 功能 ： 在 收到 上位 机位 单片机 的 通信 信号 后 将 存储 的 数据 送 至 信号 转换 电路 ， 将 数字信号 经 光电 隔离 及 信号 耦合 网络 转换成 V 载波 信号 ， 经 输电线 送到 上位 机 通信 口 。 　 　 由于 用户 电压 不 稳定 且 高频 干扰 较 多 ， 故 增加 套 看门狗 电路 ， 以 防止 应用程序 跑 飞 。 　 　 位 单片机 简称 节点机 主要 完成 个 变压器 内 所有 位 单片机 载波 信号 的 接收 、 处理 、 转发 功能 。 　 　 变压器 低压 侧 载波 信号 的 接收 功能 ： 由 程序 定时 如 每 小时 次 向 每 一个 位 单片机 发出 通信 信号 ， 以便 其 将 采集 的 数据 发出 。 由于 载波通信 机 接收 的 载波 信号 来自 V 输电线 ， 信号 必须 经 信号 耦合 网络 滤波 后 ， 经 光电 隔离 再 转换成 单片机 能 处理 的 信号 。 考虑 到 该 系统 主要 用 在 住宅小区 ， 通信 距离 较近 ， 故对 二种 单片机 通信 时 的 信号 不作 太高 要求 。 　 　 编号 处理 、 存储 功能 ： 单片机 要 完成 对 所有 收集 到 的 数据 的 编号 工作 ， 将 各个 位 单片机 的 信号 已含 该机 的 编 号码 处理 后 加上 自身 编 号码 及 结束 信号 ， 经 处理 后 将 结果 存储 在 存储芯片 EEPROM 中 ， 等待 上位 机 的 通信 信号 ， 处于 待发 状态 。 　 　 数字信号 的 发送 及 载波 处理 功能 ： 存储 在 芯片 中 的 信息 在 收到 上位 机 的 许可 信号 后 ， 经 光电 隔离 及 信号 耦合 网络 转换成 高压 载波 信号 ， 通过 载波通信 机加 在 高压线 路上 ， 经 长途 传送 后 送 至 变 、 配电站 主 变压器 低压 侧 。 　 　 主控 机 主要 用于 集中管理 ， 其 功能 如下 。 　 　 变压器 低压 侧 载波 信号 的 接收 、 处理 功能 ： 由 载波通信 机 接收 的 载波 信号 经 信号 耦合 网络 滤波 后经 光电 隔离 再 转换成 主机 能 处理 的 信号 。 考虑 到 主机 与 位 单片机 节点机 通信 距离 较 远 ， 设计 机 通信 时 信号 要求 较 高 ， 故 在 通信 时 采取 一些 抗干扰 及 纠错 功能 ， 如 重复 发送至 次 接收数据 相同 为止 ， 加入 抗干扰 编码 等 。 　 　 　 　 集中处理 功能 ： 在 主机 中 主要 是 对 整个 数字 系统 进行 集中控制 、 处理 。 ① 控制 采集 时间 ， 对 节点机 的 信号 每隔 一定 时间 采集 次 ， 采集 时 通过 载波 线路 依次 向 各 节点机 发出 通信 信号 ， 激活 节点机 ， 使 其 存储 在 EEPROM 中 的 待发 信息 发送至 主机 。 ② 接收 的 信息 经 解码 后 将 信息 中 的 编号 与 相对 应 的 各种 消耗量 送入 主机 相应 的 数据库 中 ， 对 数据库 中 信息 进行 及时 更新 ， 并 通过 显示 程序 反映 在 主机 屏幕 上 。 ③ 控制 及 报警 功能 ： 利用 此 实时 收费 系统 可以 及时 了解 各 节点机 至 最终用户 的 消耗量 。 如 某处 消耗量 超标 ， 可 向 主机 及 该处 节点机 发出报警 ， 通知 工作人员 适当 减少 负荷 。 如 各 节点机 消耗 总量 与 变配电 站 消耗 总量 不 等 ， 可知 中途 存在 跑 、 冒 、 滴 、 漏 或 偷窃行为 等 。 如 电路 发生 短路 ， 反映 在 消耗量 上 即 出现异常 ， 可 实时 发出 报警信号 并 在 主机 网络 上 反映 出 故障 点 ， 以便 于 及时 采取措施 加以 维护 。 　 　 主程序 ： 主程序 主要 包括 以下 几项 功能 ： 定时 通信 功能 、 接收 功能 、 发送 功能 、 解码 功能 、 编制 修改 数据库 功能 、 显示 功能 、 报警 功能 、 异常情况 处理 功能 。 　 　 　 软件 框图 　 　 位 单片机 程序框图 如图所示 。 图位 机 程序框图 　 　 位 单片机 框图 如图所示 。 图位 机 程序框图 　 　 主机 框图 如图所示 。 图 主机 程序框图 　 经济效益 及 社会效益 　 　 该 系统 采用 了 技术 成熟 、 价廉物美 的 单片机 硬件 、 高可靠性 的 工控机 ， 系统 性能 稳定 、 实时性 强 ， 可 节省 大量 的 人力物力 ， 彻底 免除 了 上门 抄表 的 工作 ， 并 可 及时 预报 各种 线路 和 人为 故障 ， 进行 线路 监测 ， 并 为 以后 进行 自动控制 留有 充足 的 扩展 余地 。 作者 单位 ： 滁州市 经贸委 收稿 日期 ：