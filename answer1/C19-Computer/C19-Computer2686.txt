软件 学报 JOURNALOFSOFTWARE 年 　 第卷 　 第期 　 Vol 　 No 　 嵌套 谓词 等式 系 与 弱互 模拟 林 惠民 　 　 摘要 　 带 赋值 符号 迁移 图是 一般 传值 进程 的 语义 模型 其强 互 模拟 等价 可以 归结为 谓词 等式 系 的 最大 解 该文 将 这 一 结果 推广 到 弱互 模拟 等价 为此 引入 嵌套 谓词 等式 系 的 概念 并 提出 算法 将 带 赋值 符号 迁移 图 的 弱互 模拟 等价 归结为 形如 E μ E 的 嵌套 谓词 等式 系 的 最大 解 　 　 关键词 　 传值 进程 互 模拟 谓词 等式 系 　 　 中图法 分类号 　 TPNestingPredicateEquationSystemsandWeakBisimulationsLINHuiminLaboratoryofComputerScienceInstituteofSoftwareTheChineseAcademyofSciencesBeijing 　 　 Abstract 　 SymbolictransitiongraphswithassignmentisageneralsemanticalmodelforvaluepassingprocessesStrongbisimulationequivalencesbetweensuchgraphscanbereducedtothegreatestsolutionstosimplepredicateequationsystemsTheaimofthispaperistogeneralisethisresulttoweakbisimulationequivalencesForthispurposethenotionofnestingpredicateequationsystemsisintroducedandalgorithmsarepresentedtoreduceweakbisimulationequivalencestothegreatestsolutionstonestingpredicateequationsystemsoftheformE μ E 　 　 Keywords 　 Valuepassingprocessesbisimulationpredicateequationsystems 　 　 文献 ［ ］ 中 引入 了 带 赋值 的 符号 迁移 图 （ symbolictransitiongraphswithassignment 简称 STGA ） 作为 一般 传值 进程 的 计算 模型 STGA 在 符号 迁移 图 ［ ］ 的 基础 上 扩充 了 赋值 运算 ， 可以 表示 进程 内部 状态 的 改变 ， 因而 很大 一类 传值 进程 都 可以 表示 为 有 穷 状态 STGA 以 CCS 为例 ， 任一 正则 （ 即 递归 定义 体中 不 出现 并行 复合 ） CCS 传值 进程 都 对应 于 一有 穷 状态 STGA 有穷 状态 STGA 的 另 一个 优点 是 在 并行 复合 下 封闭 ， 即 两个 有穷 状态 STGA 并行 复合 的 结果 仍然 是 有 穷 状态 STGA ［ ］ ， 因此 STGA 足以 表示 并发 进程 网络 networksofparallelprocesses 两个 不带 赋值 有穷 符号 迁移 图 的 强互 模拟 等价 可以 用 一阶 公式 刻画 ， 即 两个 图强 互 模拟 当且 仅 当 相应 的 公式 为 真 ［ ］ 对带 赋值 的 符号 迁移 图 这 一 结论 一般 不再 成立 ， 因此 文献 ［ ］ 中 引入 谓词 等式 系 的 概念 ， 在 一阶 谓词演算 的 正子 集中 引入 不动点 ， 并 设计 了 算法 将 有 穷 STGA 的 强互 模拟 归结为 谓词 等式 系 的 最大 解 　 　 强互 模拟 等价 主要 具有 理论 上 的 意义 ， 在 实际上 使用 的 等价关系 是 将 表示 内部 通信 的 不 可见 动作 τ 抽象 后 得到 的 弱互 模拟 等价 ［ ］ 本文 的 目的 是 将 文献 ［ ］ 的 结果 推广 到 弱互 模拟 等价 由于 简单 的 谓词 等式 系 不足以 刻画 弱互 模拟 为此 首先 引入 嵌套 谓词 等式 系 的 概念 ， 证明 其 极大 、 极小解 的 存在 性 ， 然后 讨论 如何 将 有 穷 STGA 的 弱互 模拟 等价 归结为 交错 深度 为 的 嵌套 谓词 等式 系 的 最大 解 　 　 为 节省 篇幅 对 文献 ［ ］ 第 和 第节 中 的 基本 记号 及 定义 本文 不再 重复 嵌套 谓词 等式 系 　 　 假定 数据 变量 集 DVxyz ， 数据 变量 集上 的 数据 表达式 集 DExp 和 布尔 表达式 集 BExp ， 谓词 变量 集 PVXYZ ， 可如 文献 ［ ］ 第节 定义 合式 命题 Φ 和 谓词 Λ 注意 在 命题 和 谓词 的 构造 中 没有 使用 否定词 ， 并且 谓词 变量 不 在 蕴涵 式 的 左部 出现 给定 数值 集 Val ， 并令 Ttruefalse 对 数据 变量 的 赋值 ρ 将 数据 变量 映射 为 Val 中 的 元素 ρ 可 延伸 到 DExp 和 BExp 上 对 任一 e ∈ DExp ρ e ∈ Val ； 对 任一 b ∈ BExp ρ b ∈ T 对 谓词 变量 的 赋值 将 谓词 变量 映射 为 函数 空间 Valn → T 中 的 元素 n 为 谓词 变量 的 型 给定 ρ 和 ， 可定义 公式 Φ 和 谓词 Λ 的 语义 ， 详见 文献 ［ ］ 中 的 第 节令 falsetrue ， 序 可 逐点 扩充 到 函数 空间 Val → T 上 ， 并 进一步 扩充 到 谓词 变量 的 赋值 ， 详见 文献 ［ ］ 中 的 第节 容易 验证 全体 谓词变元 赋值 在 序下 构成 完备 格设 Xii ∈ I 是 谓词 变量 的 有限 集 ， 称 E ： Xi Λ ii ∈ I 为 一 谓词 等式 系 ， 若 Λ i 与 Xi 有 相同 的 型 ， 且 对 i ≠ j 有 Xi ≠ Xj 用 向量 形式 Xi Λ ii ∈ I 可 简写 为 对 k ∈ n ， 设 σ k ∈ μ ， σ k ≠ σ kk ， Ekkk 是 谓词 等式 系 ， 且 对 k ≠ j ， k ∩ j ， 则 称 是 交错 深度 为 n 的 嵌套 谓词 等式 系为 方便 书写 ， 我们 用 k 表示 Ek σ kEk σ E 给定 ρ 和 ， n 的 解 ζ 归纳定义 如下 这里 表示 相对 于 ρ 和 的 最大 解若 σ ≡ 或 最小 解若 σ ≡ ， n 的 解 也 就是 泛函 的 不动点 这个 定义 的 合理性 由 下述 命题 保证 　 　 命题 给定 ρ 和 ， 任意 嵌套 谓词 等式 系 存在 最大 解 和 最小 解 　 　 证明 由于 全体 对 谓词 变量 的 赋值 在 下 构成 完备 格 ， 完备 格上 的 单调 函数 有 最大 和 最小 不动点 ［ ］ ， 所以 只 需 证明 泛函 关于 序 单调 ， 其中 我们 假定 ζ ′ ζ ″ ， 往证 对 n 施 归纳 　 　 基始步 n 这时 等式 系非 嵌套 ， η ζ ′ 和 η ζ ″ 都 是 空解 ， 所以 η ζ ′ ζ ′ ζ ′ η ζ ″ ζ ″ ζ ″ 由 ζ ′ ζ ″ 知 ζ ′ ζ ″ ， 由于 ‖ ‖ 中 谓词 变量 不 出现 在 蕴涵 式 左部 ， 所以 　 　 归纳 步设 结论 对 嵌套 深度 为 n 的 等式 系 成立 ， 考虑 nEn σ nn ， 不妨 设 σ n ≡ μ ， 由 归纳 假设 λ ζ 关于 单调 ， 因此 n 有 关于 ρ ζ ′ 的 最小 不动点 和 关于 ρ ， ζ ″ 的 最小 不动点 ， 从 ζ ′ ζ ″ 知 ζ ′ ζ ″ η ζ ′ η ζ ″ 故有 η ζ ′ ζ ′ η ζ ″ ζ ″ ， 由于 ‖ n ‖ 中 谓词 变量 不 在 蕴涵 式 左部 出现 ， 得 　 　 预备 定理 设有 谓词 等式 系 ， Φ i 不含 中 的 谓词变元 ， η 是 E 相对 于 ρ 和 的 最小 解则 η Yiitruei ∈ I 当且 仅 当 存在 iikk ≥ iik 不必 互不 相同 ， 满足 il ∈ Jil 其中 ρ ρ ρ l ρ lil → ilil ρ lil 　 　 证明 ： 由 η Yiitrue 知若则 预备 定理 已得证 由于 Φ i 不含 中 的 谓词变元 ， 否则 有 i ∈ Ji 使得 即 ρ bi ∧ η Yiitrue 对 η Yiitrue 可 继续 同样 推理 由 最小 不动点 的 性质 ， 必有 某个 k ， 使得 ‖ Φ ik ‖ ρ kVtrue ， 且 对 所有 ≤ l ＜ k ， 都 有 ρ lbil ∧ η YililtrueSTGA 的 弱互 模拟 及其 逻辑 刻画 　 　 关于 带 赋值 符号 迁移 图 的 详细 定义 请 参看 文献 ［ ］ 第节 　 　 定义 ． 带 赋值 符号 迁移 图 （ 简称 STGA ） 是 一个 有向图 ， 其 每个 结点 n 标有 自由 变量 的 有 穷集 fvn ， 每条 边 标有 由 布尔 表达式 、 赋值 和 动作 组成 的 三元组 ， 满足 ： 如果 nm 是从 n 到 m 的 一条 边 ， 则 有 fvbfvnfv α fvm ∪ bv α 　 　 这里 b 是 布尔 表达式 e 是 数据 表达式 ， α ∈ τ cxcec 是 通道 ， cx 称为 输入 动作 ， ce 称为 输出 动作 ， τ 是 表示 内部 通信 的 不 可见 动作 给定 一个 带 赋值 的 符号 迁移 图上 的 状态 空间 是 的 结点 ， ρ ∈ EValSTGA 的 迟 操作 语义 是 状态 上 的 迁移 关系 ， 由 下列 规则 给出 　 　 为了 定义 迟弱 互 模拟 ， 先 引入 双 箭头 迁移 令当且 仅 当 ， 对 a ∈ τ ′ c υ 当且 仅 当 对 　 　 定义 称 状态 上 的 对称 二元关系 R 是 迟弱 互 模拟 ， 如果 m ρ ne ∈ R 蕴涵 　 　 只要 ， 就 有 ， 并且 对 任意 υ ∈ Val ， 存在 n ″ e ″ ［ υ y ］ n ′ e ′ 满足 m ρ ［ υ x ］ n ′ e ′ ∈ R 　 　 对 其他 动作 a ， 只要 m ρ m ′ ρ ′ ， 就 有 nen ′ e ′ ， 满足 m ′ ρ ′ n ′ e ∈ R 令 ≈ ∪ RR 是 一个 迟弱 互 模拟 　 　 刻画 弱互 模拟 需要 交错 深度 为 的 嵌套 谓词 等式 系 E μ E ， 直观 地说 外层 等式 系 E 刻画 互 模拟 ， 内层 等式 系 E 则 用于 吸收 τ 动作 　 　 设 和 是 两个 变量 名字 空间 不 相交 的 STGA 的 结点 用 mm ′ mi 表示 的 结点 用 nn ′ nj 表示 mm ′ mi 的 变量 记为 inn ′ nj 的 变量 记为 j 下面 的 算法 中 的 算法 生成 形如 E μ E 的 等式 系 算法 中 用 集合 VisitedVisited τ mnVisited θ cemnVisitedcxmn 保证 对 每 一 相应 的 环路 只 访问 一次 这些 集合 由 过程 init 置 为 空集 另外 在 匹配 输入 动作 时 使用 函数 newVar 生成 一个 新 的 数据 变量 过程 emit 产生 谓词 等式 id 表示 恒等 替换 　 　 由 上述 算法 产生 的 谓词 等式 有类 ， 分别 形如 XmnV Φ 　 　 （ 由 close 产生 ） （ 由 close τ 产生 ） （ 由 match ′ c 产生 ） （ 由 match ′ c 产生 ） 　 　 令 E 为 由 第类 等式 组成 的 等式 系 E 为 由 其余 类 等式 组成 的 等式 系称 E μ E 为 上述 算法 产生 的 嵌套 谓词 等式 系 不难看出 E μ E 是 闭 的 ， 并且 在 E 的 各 等式 中 ， 右边 的 第个 析取 项 Φ 中不含 在 E 左部 出现 的 谓词变元 　 　 算法 迟弱 互 模拟 算法 　 　 bisimm θ n σ init 　 　 　 　 　 　 　 　 　 　 　 closem θ n σ 　 　 closem θ n σ 　 　 　 　 　 if 〈 mn 〉 Visitedthen 　 　 　 　 　 　 　 　 　 Visited 〈 mn 〉 ∪ Visited 　 　 　 　 　 　 　 　 　 emitXmnVmatchmn 　 　 　 　 　 returnXmn θ σ 　 　 matchmnmatch γ mn ∧ match γ nm 　 　 match τ mnbimatch ′ τ θ imin ′ 　 　 closeTm θ n σ 　 　 　 　 Bclosem θ n σ 　 　 　 　 foreachnnl 　 　 　 　 　 　 if 〈 mnl 〉 Visited τ mnthen 　 　 　 　 　 　 　 　 Visited τ mn 〈 mnl 〉 ∪ Visited τ mn 　 　 　 　 　 　 　 　 emitYmnl μ close τ m θ nlid 　 　 　 　 returnB ∨ bl ∧ Ymnlid σ l 　 　 match ′ τ mnclose τ m θ nid 　 　 matchcmnbimatch ′ c θ imin 　 　 match ′ c θ mn 　 　 　 　 　 　 foreachnnj 　 　 　 　 　 　 Bjclose τ m θ nj σ j 　 　 foreachnn ′ l 　 　 　 　 　 　 if 〈 mn ′ l 〉 Visited θ cemnthen 　 　 　 　 　 　 　 　 　 　 　 　 　 Visited θ cemn 〈 mn ′ l 〉 ∪ Visited θ cemn 　 　 　 　 　 　 　 　 　 　 　 　 　 emitY θ cemn ′ l μ match ′ c θ cemn ′ l 　 　 　 　 　 　 returnbj ∧ e θ e ′ j σ j ∧ Bj ∨ b ′ l ∧ Y θ cemn ′ lid σ ′ l 　 　 matchcmnbimatch ′ c θ ixmin 　 　 match ′ c θ xmn 　 　 　 　 foreachnnj 　 　 　 　 　 　 　 　 　 znewVar 　 　 　 　 　 　 　 　 　 B ′ jclose τ m θ ［ x → z ］ nj σ j ［ y → z ］ 　 　 　 　 　 　 　 　 　 BjB ′ j 　 　 　 　 foreachnn ′ l 　 　 　 　 　 　 　 　 　 if 〈 mn ′ l 〉 Visitedcxmnthen 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 Visitedcxmn 〈 mn ′ l 〉 ∪ Visited θ cxmn 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 emitYcxmnl μ match ′ c θ xmn ′ l 　 　 returnbj ∧ Bj ∨ b ′ l ∧ Ycxmn ′ lid σ ′ l 　 　 预备 定理 设 η 是 E 相对 于 ζ 的 最小 解 ， 若 ‖ YMn ‖ ［ ］ ζ η true ， M 形如 m 或 θ cem 或 cxm ［ y ］ ， 则 存在 n ′ 和 E 中等 式 YMn ′ Φ ′ ∨ bl ∧ YMnll 使得 n ［ ］ n ′ ［ ］ 且 ‖ Φ ‖ ［ ］ ζ η true 　 　 证明 ： 以 M ≡ m 为例 ， 其余 情形 类似 由题 设 条件 和 预备 定理 ， 有 lj ≤ jkk ≥ nln 和 E 中等 式 满足 lj ∈ jljj ≥ blj ［ ljlj ］ true η Ymnljljtrue ‖ Φ lk ‖ ［ lklk ］ ζ η truelljlj ［ ljlj ］ 又 由 函数 close τ 知 所以 nl ［ ］ nl ［ ll ］ nlk ［ lklk ］ 令 n ′ nlklklk Φ ′ Φ lk 即得 所欲 证 　 　 定理 设 E μ E 是 由 算法 产生 的 嵌套 谓词 等式 系 ， ζ 是 E μ E 的 解 ζ Xmntrue 当且 仅 当 m ［ ］ ～ n ［ ］ 其中 分别 是 m 和 n 的 自由 变量 　 　 证明 ： 令 Sm ［ ］ n ［ ］ ζ Xmntrue ， 往证 S 是 弱互 模拟 设 m ［ ］ n ［ ］ ∈ S 则 ζ Xmn ‖ Φ mn ‖ ［ ］ η ζ true 这里 η 是 E 相对 于 ［ ］ 和 ζ 的 最小 解 分别 考虑 从 m ［ ］ 出发 的 种 迁移 　 　 则 有 边 满足 bi ［ ］ trueei θ i ［ ］ vmim Φ mn 含一 合取 项 bi Φ i 由 bi ［ ］ true 得 ‖ Φ i ‖ ［ ］ η ζ true Φ i 形如 b ′ j ∧ ei θ ie ′ j σ j ∧ Bj ∨ b ″ l ∧ Y θ iceiminll 　 　 若有 j ‖ b ′ j ∧ ei θ je ′ j σ j ∧ Bj ‖ ［ ］ η ζ true 则 有 边 nnj σ jj 且 b ′ j ［ ］ truee ′ j σ j ［ ］ ei θ i ［ ］ v 从而 n ［ ］ nj ［ jj ］ jj ［ ］ 同时 ‖ Bj ‖ ［ ］ η ζ trueBj 形如 Xmjnjij ∨ bl ∧ Yminll 记 θ i ［ ii ］ i ［