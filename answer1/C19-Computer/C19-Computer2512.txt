软件 学报 JOURNALOFSOFTWARE 　 Vol 　 No 　 P 判断 两个 凸 多面体 是否 相交 的 一个 快速 算法 　 任世军 　 洪炳 熔 　 孟庆鑫 　 摘要 　 在 机器人 路径 规划 中 碰撞检测 算法 占有 十分 重要 的 地位 在 智能 机器人 仿真 系统 中 碰撞检测 耗用 的 时间 在 整个 路径 规划 过程 所用 时间 中 占有 相当 大 的 比例 于是 ， 如何 进一步提高 碰撞检测 的 速度 在 智能 机器人 路径 规划系统 中 就 起到 了 非常 关键 的 作用 而 碰撞检测 问题 最终 转化 为 判断 三维空间 中 两个 凸 多面体 是否 相交 的 问题 就 这 一 问题 给出 了 一种 新 的 算法 其 思想 是 取 一个 从 一个 凸 多面体 指向 另 一个 多面体 的 向量 根据 两个 多面体 中 的 面 与 这 一 向量 的 相对 位置 关系 来 寻找 相交 的 平面 即 有 两个 多面体 的 交点 位于 这一 平面 ， 若能 找到 一个 相交 平面 则 可以 断定 两个 多面体 相交 　 关键词 　 路径 规划 碰撞检测 机器人 线性 不等式 　 中图法 分类号 　 TPAFastAlgorithmtoDetermineWhethertheIntersectionofTwoConvexRegionsIsEmptyRENShijun （ DepartmentofComputerScienceandEngineering 　 HarbinInstituteofTechnology 　 Harbin 　 ） （ DepartmentofMechanicalEngineering 　 HarbinEngineeringUniversity 　 Harbin 　 ） HONGBingrong （ DepartmentofComputerScienceandEngineering 　 HarbinInstituteofTechnology 　 Harbin 　 ） MENGQingxin （ DepartmentofMechanicalEngineering 　 HarbinEngineeringUniversity 　 Harbin 　 ） Abstract 　 　 CollisiondetectionalgorithmsplayaveryimportantroleinthefieldofrobotpathplanningInasimulationsystemofintelligentrobotcollisiondetectiontakesupalargeportionofthetimefortherobottoplanacompletepathfromtheinitialpositiontothefinalpositionSohowtoreducethetimetherobotusestodetectcollisionbecomesakeyproblemButcollisiondetectionfinallywilltransformtoaproblemtodeterminewhethertheintersectionoftwoconvexregionsformedbylinearinequalitiesisemptyornotTheauthorspresentanewalgorithminthispaperFirstlyavectorpointingfromonepolyhedrontotheotherispickedThentheauthorsstarttofindanintersectionplaneofonepolyhedronbasedonthescalarproductofthenormvectoroftheplaneandthepickedvectorIfsuchaplaneisfoundtheintersectionofthetwoconvexpolyhedraisnotemptyKeywords 　 Pathplanningcollisiondetectionrobotlinearinequality 　 　 在 机器人 路径 规划 算法 中 ， 碰撞检测 占有 十分 重要 的 地位 而 在 机器人 的 工作 空间 中 往往 用 凸 多面体 来 模拟 机器 臂 、 障碍物 等等 在 机器人 路径 规划 中 往往 要 检测 机器 臂 与 障碍物 以及 机械 臂 与 机械 臂 之间 是否 相撞 这 就 需要 检测 两个 凸 多面体 形成 的 集合 之间 是否 有 交点 若有 交点 说明 机器 臂 与 障碍物 相撞 或者 机械 臂 与 机械 臂 自身 相撞 否则 说明 机器 臂 与 障碍物 并 不 相撞 以往 的 碰撞检测 算法 都 是从 空间 几何学 的 角度 ［ ］ 或 从 最优化 的 角度 ［ ］ 出发 这样 就 需要 大量 的 求交 运算 在 本文 中 ， 我们 给出 一种 算法 来 检测 空间 中 的 两个 凸 多面体 的 碰撞 问题 在 机器人 的 仿真 系统 中 ， 物体 包括 机械 臂 和 障碍物 的 建模 往往 采用 计算机 图形学 中 的 Brep 方式 ， 即 边界 表示 方式 一个 物体 由个 要素 组成 即点 、 棱和面 在 计算机 中 存储 这样 一个 物体 一般 是 存储 其 拓扑 结构 指点 、 棱和面 之间 的 关系 其 各个 顶点 及其 各个 面 的 方程 在 机械 臂 和 障碍物 的 运动 过程 中 都 要 实时 地 计算 其 每 一个 顶点 及其 各个 面 的 方程 ， 以 确定 该 物体 的 位置 　 　 设有 n 维空间 中 由 线性 不等式 围成 的 两个 凸 多面体 A 和 B 它们 分别 由式 和 式 给出 ， 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 设 pipipipinTririririnTxxxxnT 则 式 可 表示 为式 可 表示 为 　 算法 的 理论 基础 　 　 定理 设 ggggnT 为 集合 A 的 边界点 tA 并且 对于 α ＜ α ≤ ） 都 有 g ＋ α （ tg ） A 那么 一定 存在 i 使得 ≤ i ≤ mpTi 。 （ gt ） ＜ 并且 pTi 。 gqi 　 　 证明 由于 g 为 集合 A 的 边界点 且 A 为 凸 多面体 故有 g ∈ A 　 　 首先 我们 证明 一定 存在 i 使得 ≤ i ≤ m 并且 pTi 。 gqi 因为 若 不是 这样 即 对 i （ ≤ i ≤ m ） ， 都 有 pTi 。 g ＜ qi 设 由于 对于 i （ ≤ i ≤ m 和 任意 的 单位向量 e 我们 有 故 δ ＞ 对于 任意 的 向量 x 只要 ‖ xg ‖ ＜ δ 由于 pTi 。 xpTi 。 gpTi 。 xg 并且 pTi 。 xg ≤ ‖ pi ‖ 。 我们 取则 有 从而 pTi 。 x ＜ pTi 。 gqipTi 。 gqi 其中 ≤ i ≤ m 即 x ∈ A 从而 g 为 A 的 内点 矛盾 　 　 其次 我们 证明 对于 所有 满足 pTi 。 g ＝ qi 的 i 中 一定 存在 一个 i 使得 ≤ i ≤ m 并且 pTi 。 （ gt ） ＜ 设 I ＝ ｛ i ｜ pTi 。 g ＝ qi ， ≤ i ≤ m ｝ Ii ｜ iI ， ≤ i ≤ m ｝ 假设 对于 i ∈ I 都 有 pTi 。 （ gt ） ≥ 若 存在 i ∈ I 使得 pTi 。 （ gt ） ＜ 则 取 α 满足 否则 取 α 对于 i ∈ I 如果 pTi 。 （ tg ） ＞ 那么 如果 pTi 。 （ t － g ） ≤ 那么 pTi 。 ［ g ＋ α （ t － g ） ］ pTi 。 g α 。 pTi 。 （ t － g ） ≤ qi 由 假设 知对 i ∈ I 有 pTi 。 ［ g ＋ α （ t － g ） ］ pTi 。 g ＋ α 。 pTi 。 （ t － g ） ≤ pTi 。 g ＝ qi 所以 g ＋ α （ t － g ） ∈ A 与 定理 条件 相 矛盾 □ 　 　 定理 如果 存在 s ∈ At ∈ B 使得 sBtA 那么 若 A ∩ B ≠ Φ 则 一定 存在 i 使得 ≤ i ≤ mpTi 。 （ s － t ） ＜ 并且 A ∩ B ∩ ｛ x ｜ pTi 。 x ＝ qi ｝ ≠ Φ 也 一定 存在 i 使得 ≤ i ≤ nrTi 。 （ s － t ） ＞ 并且 A ∩ B ∩ ｛ x ｜ rTi 。 x ＝ si ｝ ≠ Φ 　 　 证明 设 A ∩ B ≠ Φ 我们 用 反证法 如果 对于 i （ ≤ i ≤ m ） 只要 pTi 。 （ s － t ） ＜ 就 有 A ∩ B ∩ ｛ x ｜ pTi 。 x ＝ qi ｝ ＝ Φ 亦 即 对于 集合 Α ∩ Β 约束 pTi 。 x ≤ qi 不起作用 那么 若设 A ＝ ｛ x ｜ pTi 。 x ≤ qi ， pTi 。 （ g － t ） ≥ ， ≤ i ≤ m ｝ 则 有 A ∩ B ＝ A ∩ B 　 　 若 存在 α 使得 ＜ α ＜ s ＋ α （ t － s ） ∈ A ∩ B 　 　 i 由于 t ∈ B 并且 B 是 凸集 所以 对于 α （ α ≤ α ≤ ） 都 有 s ＋ α （ t － s ） ∈ B 　 　 ii 对于 α （ α ≤ α ≤ ） i （ ≤ i ≤ m ） ， 若 pTi 。 （ s － t ） ≥ 则 由于 s ∈ A 故有 pTi 。 ［ s α （ t － s ） ］ ＝ pTi 。 s ＋ α pTi 。 （ t － s ） ≤ pTi 。 s ≤ qi 于是 对于 α （ α ≤ α ≤ ） 都 有 s ＋ α （ t － s ） ∈ A 　 　 由 i 和 ii 知 对于 α （ α ≤ α ≤ ） 都 有 s ＋ α （ t － s ） ∈ A ∩ B ＝ A ∩ BA 当 α ＝ 时 s ＋ α （ t － s ） ＝ s ＋ （ t － s ） ＝ t 所以 t ∈ A 矛盾 　 　 假设 对于 α （ ≤ α ≤ ） 都 有 s ＋ α （ ts ） A ∩ B 即 从 s 至 t 的 线段 中 没有 A ∩ B 的 点 由于 A ∩ B 是 凸集 两个 凸集 的 交集 仍为 凸 集且 非空 所以 可取 一点 g ∈ A ∩ B 使得 g 到 连接 s 至 t 的 直线 的 距离 最短设 α ＞ 在 空间 中取 一点 g ＋ α （ ts ） 因为 连接点 s 至 t 的 直线 与 连接点 g 与 g ＋ α （ t － s ） 的 直线 相互 平行 所以 s ， t ， g 和 g ＋ α （ ts ） 位于 同一个 平面 并且 连接 s ， t ， g ＋ α （ t － s ） ， g 的 线段 构成 一个 平行四边形 我们 说 g ＋ α （ t － s ） A 否则 ， 由于 s ∈ A ， 故 连接 s 和 g ＋ α （ t － s ） 的 线段 也 属于 A 同理 ， 连接 t 与 g 的 线段 属于 B 于是 上述 梯形 的 两条 对角线 的 交点 既 属于 A 又 属于 B ， 从而 属于 A ∩ B 但 这个 交点 到 连接 s 至 t 的 直线 的 距离 比 g 到 连接 s 至 t 的 直线 的 距离 更 短 矛盾 于是 ， 对于 α ＞ 都 有 g ＋ α （ t － s ） A 故 g 为 集合 A 的 边界点 根据 定理 可知 ， 一定 存在 i 使得 ≤ i ≤ mpTi 。 （ g － t ） ＜ 并且 pTi 。 g ＝ qi 于是 因为 s ∈ A 所以 pTi 。 （ s － t ） ＝ pTi 。 ［ （ s － g ） ＋ （ g － t ） ］ pTi 。 （ s － g ） ＋ pTi 。 （ g － t ） （ pTi 。 s － qi ） pTi 。 （ g － t ） ＜ 定理 证毕 □ 　 判断 空间 中 两个 凸 多面体 是否 相交 的 算法 　 　 在 我们 提出 的 算法 中 首先 要 用到 文献 ［ ］ 中 提出 的 向量 定位 算法 用以 判断 空间 中 由 一组 线性 不等式 围成 的 凸 空间 是否是 空集 若 不是 空集 则 返回 其中 的 一点 　 　 设 G 为 一个 动态 点 即 可以 是 一维 、 二维 以及 三维空间 中 的 任意 一点 A 为 一组 线性 不等式 用 xiangliangA 表示 判断 由 A 确定 的 集合 是否是 空集 的 向量 定位 算法 则 算法 可以 表示 如下 　 　 xiangliangA 　 　 ｛ 　 　 Step 若 A 中 含有 矛盾 常数 不等式 则 返回 NULL 　 　 Step 将 A 中 的 不等式 按照 第个 变量 的 系数 大于 、 等于 和 小于 的 原则 分成 个 集合 AA 和 A 　 　 Step 若 A ＝ Φ 并且 Α ＝ Φ 则 去掉 A 中 的 第个 变量 再次 调用 xiangliangA 设 GxiangliangA 将 G 与 相应 的 第个 变量 的 任一 实数 组合 在 一起 ， 令其为 G 返回 G 　 　 Step 若 A ＝ Φ 或者 Α ＝ Φ 则 将 A 中 的 第个 变量 去掉 设 GxiangliangA 若 A ＝ Φ 则 取 G 为 各个 分量 全是 的 零 向量 若 Α ＝ Φ 则 让 第个 变量 充分 大若 Α ＝ Φ 则 让 第个 变量 充分 小 这样 即可 求得 满足 所有 不等式 的 点将 得到 的 第个 变量 与 G 一起 构成 新 的 G ， 并 返回 G 　 　 Step 若 A 中 的 不等式 的 个数 小于 或者 等于 A 中 的 不等式 的 个数 则 依次 取 A 中 的 不等式 令其为 等式 设为 d 化简 其他 不等式 得到 新 的 不等式 组 使得 中 的 变量 个数 少于 A 中 的 变量 的 个数 设 Gxiangliang 若 GNULL 则 取下 一个 不等式 继续执行 否则 ， 用 G 和 d 可求 出 另外 一个 变量 与 G 一起 组成 新 的 G 返回 G 若 所有 不等式 都 取 完则 返回 NULL 　 　 Step 若 A 中 的 不等式 的 个数 大于 A 中 的 不等式 的 个数 则 依次 取 A 中 的 不等式 令其为 等式 设为 d 化简 其他 不等式 得到 新 的 不等式 组 使得 中 的 变量 个数 少于 A 中 的 变量 的 个数 设 Gxiangliang 若 GNULL 则 取下 一个 不等式 继续执行 否则 ， 用 G 和 d 可求 出 另外 一个 变量 与 G 一起 组成 新 的 G 返回 G 若 所有 不等式 都 取 完则 返回 NULL 　 　 ｝ 　 　 设 A 和 B 分别 表示 约束 空间 中 的 两个 凸 多面体 的 线性 不等式 组用 qiujiaoAB 表示 确定 AB 的 交集 是否是 空集 的 求交 算法 则 算法 可以 表示 如下 　 　 BOOLqiujiaoAB 　 　 ｛ 　 　 Step 若 约束 A 和 约束 B 的 不等式 均 为 常数 不等式 且 不 含 矛盾 不等式 ， 则 returnTRUE 　 　 Step 若 约束 A 和 约束 B 的 不等式 含有 矛盾 不等式 则 returnFALSE 　 　 StepsxiangliangAtxiangliangB 　 　 Step 若 sNULL 或 tNULL 则 returnFALSE 　 　 Step 若 s ∈ B 或 t ∈ A 则 returnTRUE 　 　 Step 如果 约束 A 的 不等式 的 个数 少于 约束 B 的 不等式 的 个数 那么 依次 选择 约束 A 的 不等式 ， 使得 该 不等式 的 法 向量 与 向量 （ t － s ） 的 数量 积 大于 用该 不等式 化简 约束 A 和 B 的 不等式 得到 不等式 组 A 和 B 使得 A 和 B 中 的 变量 个数 少于 A 和 B 中 变量 的 个数 重复 调用 这一 过程 若 qiujiaoA ， BTRUE 则 returnTRUE 否则 ， 继续执行 　 　 Step 如果 约束 B 的 不等式 的 个数 少于 约束 A 的 不等式 的 个数 那么 依次 选择 约束 B 的 不等式 ， 使得 该 不等式 的 法 向量 与 向量 （ t － s ） 的 数量 积 小于 用该 不等式 化简 约束 A 和 B 的 不等式 得到 不等式 组 A 和 B 使得 A 和 B 中 的 变量 个数 少于 A 和 B 中 变量 的 个数 重复 调用 这一 过程 若 qiujiaoABTRUE 则 returnTRUE 否则 ， 继续执行 　 　 StepreturnFALSE 　 　 ｝ 在 一个 实际 的 机器人 仿真 系统 中 可以 首先 判断 两个 物体 的 包围 盒 boundingbox 是否 相交 ， 若 不 相交 ， 则 这 两个 凸 多面体 也 不 相交 ； 否则 ， 进一步 用 上面 提出 的 算法 来 判定 这 两个 凸 多面体 是否 相交 这样 做 可以 提高 碰撞检测 的 效率 　 实例 　 　 例 设在 三维空间 中 给定 两个 凸 多面体 A 和 B ， 如图所示 FigTwointersectedpolyhedra 图 　 两 相交 的 凸面 体 FigTwopolyhedraintersectedononlyedgesnotvertex 图 　 两个 只有 棱 而 非点 相交 的 凸 多面体 　 　 这 两个 凸 多面体 的 平面 方程 分别 由 方程组 和 给出 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 由 向量 定位 算法 可以 求 出式 和 式 中 的 两个 点 和 由于 点 满足 式 所以 这 两个 凸 多面体 相交 　 　 例 设在 三维空间 中 给定 两个 凸 多面体 A 和 B ， 如图所示 　 　 这 两个 凸 多面体 的 平面 方程 分别 由 方程组 和 给出 ， 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 由 向量 定位 算法 可以 求 出式 和 式 中 的 两个 点 和 由于 式 中 的 不等式 的 个数 少于 式 中 的 不等式 的 个数 所以 取式 中 的 不等式 由于 此时 ts 只有 第个 不等式 相应 的 平面 方程 的 法 向量 与 ts 的 数量 积 大于 令其为 等式 则 式 和 式 化简 为 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 用 向量 定位 算法 分别 求 出式 和 式 中 的 两个 点 和 由于 满足 式 所以 式 与 式 的 交不空 从而 式 与 式 的 交 也 不空 　 实验 结果 　 　 我们 在 IBM 上 实现 了 我们 提出 的 算法 通过 大量 的 数据 对 算法 进行 了 测试 结果 见表 Table 　 ExperimentalresultsofthealgorithmExperimentedonIBM 表 　 算法 的 实验 结果 在 IBM 上 执行 Problemscale ① Executiontime ② sNoofAsconstraints ③ NoofBsconstraintsNoofinstance ④ maximum ⑤ minimum ⑥ average ⑦ ① 问题 规模 ② 执行 时间 秒 ③ 约束 数目 ④ 算 例数 ⑤ 最 多 执行 时间 ⑥ 最少 执行 时间 ⑦ 平均 执行 时间 　 　 从表 的 实验 结果 可以 看出 这个 算法 非常 有效 在 一个 实际 的 机器人 规划系统 中 执行 这一 算法 之前 ， 首先 判断 两个 凸 多面体 的 包围 盒 是否 相交 然后 再用 这 一 算法 进行 判断 这样 就 能够 进一步提高 规划系统 中 碰撞检测 的 效率 任世军 （ 哈尔滨工程大学 机电 工程学院 　 哈尔滨 　 ） （ 哈尔滨工业大学 计算机科学 与 工程系 　 哈尔滨 　 ） 　 洪炳 熔 （ 哈尔滨工业大学 计算机科学 与 工程系 　 哈尔滨 　 ） 　 孟庆鑫 （ 哈尔滨工程大学 机电 工程学院 　 哈尔滨 　 ） 参考文献 ， LiuLianfengWangYongxiAthreedimensionalalgorithmondetectingcollisionbetweenrobotanditsenvironmentRobot ～ 刘连峰 王泳喜 空间 路径 规划 中 一种 三维 物体 干涉 检测 算法 机器人 ～ ， ZeghloulSRambeaudPAfastalgorithmfordistancecalculationbetweenconvexobjectsusingtheoptimizationapproachRobotica ～ ， BobrowJEAdirectminimizationapproachforobtainingthedistanceconvexpolyhedraInternationalJournalofRoboticsResearch ～ ， RenShijunHongBingrongAfastalgorithmtodeterminewhetherconvexregionsboundedbymultiplelinearconstraintsareemptyChineseJournalofComputers ～ 任世军 洪炳 熔 判定 由 线性 不等式 围成 的 凸 空间 是否 为空 的 一个 快速 算法 计算机 学报 ～