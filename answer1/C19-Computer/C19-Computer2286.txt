计算机 应用 研究 APPLICATIONRESEARCHOFCOMPUTERS 　 Vol 　 No 　 P 采用 Windows 的 电子商务 设计 梁晋 　 施仁 　 梁峰 　 彭波 摘要 介绍 了 Windows 公钥 体系结构 及其 在 电子商务 中 的 应用 ， 公钥 体系结构 简称 PKI ， 它 是 在 公共 网络 环境 下 使用 公钥 密码 技术 进行 数字证书 、 证书 认证 等 的 系统 。 PKI 的 标准 在 不断 发展 ， 成为 电子商务 应用 的 必需 技术 。 Windows 的 PKI 体系 以其 新 特点 ， 将 成为 电子商务 的 理想 平台 。 关键词 公钥 体系 电子商务 引言 　 　 Windows 为 电子商务 提供 了 一个 理想 的 平台 ， 其 安全性 包括 证书 管理 、 CA 服务 、 公用 密钥 基本 体系 ， 保证 了 电子商务 的 开展 。 结合 Windows 的 IIS 服务 ， 可以 快速 创建 一个 网上 电子商务 的 平台 。 　 　 Windows 中有 两种 验证 协议 ， 即 Kerberos 和 公用 密钥 体制 PublicKeyInfrastructure ， PKI 。 这 两者 的 不同之处 在于 ： Kerberos 是 对称 密钥 ， 而 PKI 是 非对称 密钥 。 在 Internet 环境 中 ， 需要 使用 非对称 密钥 加密 。 即 每个 参与者 都 有 一对 密钥 ， 可以 分别 指定 为 公钥 PK 和 私钥 SK 。 一个 密钥 加密 的 消息 只有 另 一个 密钥 才能 解密 ， 而 从 一个 密钥 推断 不出 另 一个 密钥 。 公钥 可以 用来 加密 和 验证 签名 ； 私钥 可以 用来 解密 和 数字签名 ， 每个 人 都 可以 公开 自己 的 公钥 ， 以供 他人 向 自己 传输 信息 时 加密 之用 。 只有 拥有 私钥 的 本人 才能 解密 ， 保证 了 传输 过程 中 的 保密性 。 关键 是 需要 每个 人 保管 好 自己 的 私钥 。 同时 ， 为了 保证 信息 的 完整性 ， 还 可以 采用 数字签名 的 方法 。 接下来 的 问题 是 ， 如何 获得 通讯 对方 的 公钥 并且 相信 此公 钥是 由 某个 身份 确定 的 人 拥有 的 ， 这 就要 用到 电子 证书 。 电子 证书 是 由 大家 共同 信任 的 第三方 — 认证 中心 CertificateAuthority ， CA 颁发 的 ， 证书 包含 某人 的 身份 信息 、 公钥 和 CA 的 数字签名 。 任何 一个 信任 CA 的 通讯 一方 ， 都 可以 通过 验证 对方 电子 证书 上 的 CA 数字签名 来 建立 起 和 对方 的 信任 ， 并且 获得 对方 的 公钥 以备 使用 。 Windows 的 公用 密钥 基本 体系 　 　 如何 在 数字化 通信 中 建立 起 信任 关系 ， 是 电子商务 发展 的 重中之重 。 因此 ， 建立 认证 中心 CA 是 关键 的 一步 。 Windows 可以 作为 建立 CA 的 技术 方案 ， 其 内置 了 一整套 颁发 证书 和 管理 证书 的 基础 功能 。 WindowsServer 中有 一个 部件 是 证书 服务器 CertificateServer ， 是 原来 WindowsNT 的 选项 包 　 　 中 CertificateServer 的 升级 产品 。 通过 认证 服务器 ， 企业 可以 为 用户 颁发 各种 电子 证书 ， 比如 用于 网上 购物 的 安全 通道 协议 SSL 使用 的 证书 ， 用于 加密 本地 文件 EFS 的 证书 等等 。 认证 服务器 还 管理 证书 的 失效 ， 发布 失效 证书 列表 等 。 每个 用户 或 计算机 都 有 自己 的 一个 证书 管理器 ， 其中 既 放置 着 自己 从 CA 申请 获得 的 证书 ， 也 有 自己 所 信任 的 CA 的 根 证书 。 　 　 Windows 中 的 电子 证书 都 是 基于 X 协议 的 ， 保证 了 与 其它 系统 的 互操作性 。 国际标准 组织 CCITT 建议 以 X 作为 X 目录 检索 的 一个 组成部分 ， 提供 安全 目录 检索服务 。 X 是 CCITT 建议 的 ， 用于 分布 网络 中 存储用户 信息 的 数据库 的 目录 检索服务 的 协议 标准 。 X 是 采用 公钥 体系 实施 的 认证 协议 ， 对 通信 双方 按 所用 密码 体制 规定 了 几种 认证 识别方法 ， 它 发表 于 年 ， 经 多次 修改 ， 年 又 公布 了 新 的 版本 。 X 对 所用 具体 加密 、 数字签名 、 公用 密钥 以及 Hash 算法 未作 限制 ， 将会 有 广泛 的 应用 ， 已 纳入 PEMPrivacyEnhancedMail 系统 中 。 　 　 就 网上 购物 的 过程 来说 ， 目前 常用 的 是 SSL 安全 通道 协议 的 方式 ， 即 设置 IIS 就 某些 特定 的 文件 或 文件目录 需要 访问者 提供 客户端 证书 ； 除非 拥有 电子 证书及 相应 的 私钥 。 一个 访问者 的 浏览器 无法 获得 这些 文件 和 文件目录 。 SSL 的 方式 体现 在 浏览器 的 访问 栏上 ， 应该 是 Https 而 不是 普通 的 Http 。 通过 网站 验证 后 的 访问者 ， 可以 被 映射 为 活动 目录 中 的 用户 或者 用户组 ， 实现 合作伙伴 之间 外部 网 Extranet 的 应用 。 　 　 为了 安全 地 保管 私钥 和 电子 证书 ， 在 Windows 中 ， 微软 为 用户 还 提供 了 一套 智能卡 的 结构 。 智能卡 因其高 安全性 和 轻便 的 可 移动性 ， 势必 将 发展 成为 类似 鼠标 键盘 一般 的 计算机 的 标准 外设 。 微软 还 提供 了 一套 基于 位 Windows 平台 的 SmartCardforWindows 产品 ， 包括 API 和 开发工具 。 众多 的 智能卡 厂家 ， 如 Gemplus ， 只要 生产 符合国际 ISO 工业 标准 的 智能卡 产品 ， 就 可以 在 微软 的 SmartCard 软件平台 上 操作 。 　 　 当 用户 用 InternetExplorer 向 一个 认证 中心 申请 电子 证书 时 ， 就 会 有 一对 公钥 和 私钥 自动 产生 出来 ； 私钥 可以 存储 在 智能卡 中 ， 公钥 和 其它 身份 信息 比如 姓名 、 电子邮件 地址 等 发给 认证 中心 。 如果 认证 中心 批准 该 申请 ， 那么 包含 公钥 的 电子 证书 就 会 被 返回 来 ， 存储 在 智能卡 中 。 这种 电子 证书 的 申请 过程 也 可以 由 管理员 设定 的 批处理 方法 来 进行 ， 用户 还 可以 通过 LDAP 来 查询 CA 中 通讯 对方 的 公钥 ， 因为 Windows 的 认证 服务器 是 可以 与 活动 目录 相结合 的 ， 所以 这方面 的 查询 很 方便 。 　 　 智能卡 存储 私钥 和 电子 证书 的 做法 ： 给 最终用户 提供 了 对 自己 安全 信息 的 最大 的 控制 ， 可以 方便 地 从 一台 机器 携带 到 另一台 机器 使用 ； 可以 在 任何 一个 地点 使用 。 一般来说 ， 智能卡 还会用 一个 个人 密码 PIN 保护 起来 ， 在 要求 高 安全性 的 场合 ， PIN 可以 是 一些 生物 信息 ， 比如 指纹 等 。 智能卡 中 存储 的 信息 是 加密 的 ， 即使 破坏 了 智能卡 也 得不到 里面 的 内容 。 智能卡 的 阅读器 也 越来越 普遍 ， 有 US B型 的 ， 也 有 PC 卡型 的 ， 甚至 Windows 终端 上 也 会 有 智能卡 插槽 。 智能卡 正在 逐渐 走向 大众化 。 　 　 “ 公用 密钥 基本 体系 ” 通常 简称 为 PKIPublicKeyInfrastructure ， 是 一个 数字 认证 、 证书 授权 和 其它 注册 授权 系统 。 使用 公用 密钥 密码 检验 及 验证 电子商务 中 所 涉及 的 每个 机构 的 有效性 。 公用 密钥 基本 体系 的 标准 仍 处于 发展 阶段 ， 尽管 它们 作为 电子商务 的 一个 必要 组成部分 已 得到 广泛 使用 。 Windows 的 公用 密钥 体系 ， 其 核心 是 加密 服务 、 证书 管理 服务 ， 为 应用程序 的 开发 提供 了 加密 API 接口 CryptoAPI 。 Windows 的 公用 密钥 体系 具有 以下 特点 ： 　 　 牢靠 的 安全性 。 Windows 的 公用 密钥 体系 包括 采用 智能卡 的 牢靠 验证 ， 保持 公用 网 的 保密性 ， 以及 确保 传输数据 的 完整性 。 此外 ， 管理员 可 使用 Windows 安全 权限 指派 用户 证书 的 使用 。 　 　 简易 管理 。 Windows 的 公用 密钥 与 活动 目录 和 组策略 的 集成 ， 可以 对 管理 企业 内部 的 委托 关系 进行 调整 ， 还 提供 将 证书 直接 或经 InternetInformationServices 映射 到 活动 目录 中 用户 帐户 的 能力 。 　 　 新机遇 。 可以 安全 地 交换 诸如 Internet 等 公用 网上 的 文件 和 数据 ， 具有 实现 安全 EmailSMIME 的 能力 。 此外 ， 作为 电子商务 的 一个 重要 组成部分 ， 可以 利用 电子签名 建立 发送者 的 无法 否认 机制 。 Windows 公用 密钥 体系 组件 　 　 Windows 公用 密钥 基本 体系 的 组件 包括 下述 内容 ： 　 　 证书 。 证书 基本上 是 一个 由 权威 发布 的 电子 声明 ， 其 作用 在于 担保 证书 持有者 的 身份 。 证书 将 公用 密码 与 持有 相应 私有 密钥 的 个人 、 机器 或 服务 的 身份 绑定 在 一起 。 证书 由 各种 公用 密钥 安全 服务 和 应用程序 提供 ， 为 非 安全网 如 Internet 提供数据 验证 、 数据完整性 和 安全 通讯 。 Windows 基于 证书 的 过程 所 使用 的 标准 证书 格式 是 XV ， X 证书 包括 有关 证书 拥有 的 个人 或 实体 的 信息 及 证书 颁发 机构 的 可选 信息 。 实体 信息 包括 实体 名称 、 公用 密钥 、 公用 密钥 运算法 和 可选 的 唯一 主体 ID 。 版本 证书 的 标准 制定 了 以下 规定 ： 密钥 标识符 、 密钥 用法 、 证书 策略 、 替换 名称 和 属性 、 证书 路径 约束 以及 对 证书 撤销 原因 和 列表 分区 。 　 　 WindowsServer 证书 服务 是 Windows 中 的 组件 ， 用于 创建 和 管理 证书 颁发 机构 CA 。 证书 颁发 机构 负责 建立 和 担保 证书 持有者 的 身份 。 证书 颁发 机构 还会 在 证书 失效 时 ， 将 其 撤销 并 发布 证书 撤销 列表 ， 供 证书 检验 机构 使用 。 最 简单 的 公用 密钥 基本 体系 只有 一个 证书 颁发 机构 。 事实上 ， 大多数 配置 公用 密钥 基本 体系 的 组织 使用 多个 证书 颁发 机构 ， 并 将 其 有 组织 地 形成 证书 分层 结构 。 　 　 证书 服务 的 一个 单独 组件 是 证书 颁发 机构 的 Web 注册 页 。 这些 网页 是 在 安装 证书 颁发 机构 时 默认 安装 的 ， 它 允许 证书 请求者 使用 Web 浏览器 提出 证书 请求 。 此外 ， 证书 颁发 机构 网页 可以 安装 在 未 安装 证书 颁发 机构 的 Windows 服务器 上 。 在 这种 情况 下 ， 网页 用于 向 不 希望 直接 访问 证书 颁发 机构 的 用户服务 。 如果 选择 为 组织 创建 定制 网页 访问 CA ， 则 Windows 提供 的 网页 可 作为 示例 。 　 　 智能卡 支持 。 Windows 支持 采用 智能卡 内 证书 登录 ， 同时 还 支持 使用 智能卡 存储 用于 安全 Email 和 其它 与 公用 密钥 密码 活动 相关 的 证书 。 　 　 公用 密钥 策略 。 可 使用 Windows 的 组策略 向 计算机 自动 发布 证书 ， 建立 证书 信任 列表 和 委托 证书 颁发 机构 ， 此外 还 可以 管理 加密 文件系统 的 恢复 策略 。 邮政 邮购 系统 电子商务 设计 　 　 下面 是 采用 Windows 的 平台 设计 的 邮购 系统 ， 图 描述 了 采用 Windows 平台 建立 的 邮政 邮购 的 电子商务 网络图 。 邮政 部门 具有 开展 网上 邮购 的 优越 条件 ： 　 　 具有 连接 全国 各个 地方 的 投递 、 运输 渠道 。 　 　 具有 自己 的 金融机构 邮政储蓄 。 　 　 与 社会 上 一般 的 邮购 公司 相比 ， 具有 信誉 保证 。 　 　 邮政 邮购 是 邮政 部门 大力发展 的 业务 ， 如果 采用 电子商务 技术 ， 将会 如虎添翼 。 以前 由于 电子商务 的 平台 软件 过于 昂贵 等 其它 原因 ， 一直 没有 开展 采用 电子商务 的 邮政 邮购 。 Windows 系统 为 邮政 邮购 提供 了 一个 可行 的 平台 ， 该 方案 综合利用 了 Windows 的 证书 服务 、 网络连接 、 网络安全 等 功能 。 图 采用 Windows 平台 建立 的 邮政 邮购 的 电子商务 网络结构 　 　 图 的 网络 由 两 大部分 构成 ： 内部网 和 外部 网 ， 之间 通过 防火墙 隔离 。 外部 网 　 　 外部 网络 主要 指 Internet 网络 和 PSTN 电话网 ， 其中 采用 的 Windows 基于 TAPI 服务 连接 电话网 ， 为 用户 提供 通过 电话 定购 方式 ， 以及 邮政 部门 使用 IP电话 网关 、 远程 访问 等 功能 。 在 目前 我国 的 实际 情况 下 ， 上网 用户 太 少 ， 通过 电话 定购 商品 ， 是 可行 的 解决办法 。 　 　 Internet 上 涉及 的 电子商务 处理 对象 主要 有 下列 内容 ： 　 　 Internet 上 的 购买者 。 用户 通过 Internet 访问 邮政 网上 的 商店 ， 查询 或 购买 商品 。 　 　 商品 提供商 。 邮政 部门 本身 不 生产 邮购 商品 ， 需要 厂家 提供 ， 经常 需要 和 厂家 进行 数据 交流 ， 厂家 可以 通过 Internet 或 电话线 如果 需要 可以 采用 VPN 方式 连接 到 邮政 网络 。 　 　 银行 支付 网关 。 国内 一些 商业银行 已经 在 Internet 上 建立 了 本 银行 信用卡 的 支付 网关 ， 用户 在 购物 时 输入 自己 的 信用卡 帐户 信息 ， 邮政 邮购 系统 会 自动 访问 对应 的 银行 支付 网关 验证 用户 身份 ， 确认 后 完成 用户 指定 的 资金 支付 。 　 　 独立 的 CA 认证 中心 。 如果 用户 是 在 Internet 网络 上 一个 独立 的 CA 认证 中心 获得 的 证书 ， 并且 在 购物 时 输入 该 证书 ， 邮政 邮购 系统 会 连接 该 独立 的 CA 认证 中心 进行 确认 和 处理 。 邮政 网络 对外 部分 　 　 在 邮政 网络 和 Internet 之间 通过 防火墙 隔离 ， 为 加强 安全性 ， 将 位于 邮政 网络 需要 对 外界 开放 的 部分 与 内部 网络 再 隔离 ， 这部分 网络 对外 提供 以下 服务 ： 　 　 网上商店 。 网上商店 是 在 IIS 基础 上 开发 的 ， 也 可以 采用 其它 软件 如 微软 的 SiteServer ， 为 网络 Internet 或者 内部 网络 上 的 用户 提供 邮购 商品 的 查询 、 定购 处理 。 　 　 独立 CA 中心 。 采用 Windows 的 独立 CA 服务 ， 可以 面向 Internet 用户 ， 提供 独立 的 证书 服务 。 　 　 路由 和 远程 访问 。 采用 Windows 路由 和 远程 访问 以及 Internet 认证 服务 ， 提供 外部 用户 的 远程 访问 ， 以及 通过 VPN 安全 地 连接 。 　 　 电话 网关 和 呼叫 中心 。 采用 Windows ， 基于 TAPI 服务 连接 电话网 ， 可以 完成 多种 功能 ： 可以 为 用户 提供 通过 电话 的 定购 方式 ， 可以 作为 邮政 网络 的 IP电话 网关 等 。 邮政 内部 网络 　 　 邮政 内部 网络 涉及 电子商务 的 对象 有 ： 　 　 绿卡 支付 网关 。 绿卡 支付 网关 与 一个 普通 的 商业银行 的 支付 网关 类似 ， 只是 为了 安全 的 原因 ， 暂时 放到 了 邮政 网络 内部 以后 可以 连接 到 Internet ， 只有 通过 邮政 网络 才能 访问 。 绿卡 支付 网关 连接 邮政储蓄 的 计算机主机 系统 ， 其 功能 是 完成 邮政 内部 资金 结算 ， 并 为 普通 购物者 提供 结算 功能 。 当 一个 用户 在 Internet 上 访问 邮政 的 网上商店 时 ， 输入 其 邮政储蓄 卡 又称 绿卡 帐户 信息 ， 绿卡 支付 网关 访问 绿卡 的 主机 ， 确认 用户 完成 资金 支付 。 　 　 企业 内部 CA 中心 。 包括 根 CA 和 多个 子 CA ， 采用 Windows 的 证书 服务 ， 为 企业 内部 的 安全 处理 提供 证书 服务 。 邮购 用户 可以 直接 到 邮政 营业 窗口 的 柜台 定购 物品 ， 填写 购物单 ， 缴纳 货款 ， 营业员 将 用户 定购 信息 和 货款 信息 ， 利用 证书 加密传输 到 邮政 邮购 的 内部 处理 部门 。 如果 需要 资金 结算 ， 通过 绿卡 支付 网关 结算 。 所有 内部 处理 传输 都 需要 从 企业 的 CA 中心 取得 证书 。 　 　 邮政 营业 窗口 。 邮政 营业 窗口 处理 用户 的 邮购 商品 定单 ， 通过 邮政 内部网 向 邮购 部门 提交 定单 。 　 　 邮购 中心 部门 。 设立 一个 省 中心 及 各地 市中心 ， 集中处理 邮购 业务 。 结论 　 　 Windows 的 PKI 体系结构 为 网络安全 应用 打下 了 基础 ， 为 电子商务 应用 提供 了 一个 通用 、 开放 、 廉价 的 平台 。 由于 是 一个 新 功能 、 新 产品 ， 其 安全性 将 随着 应用 的 深入 不断 发展 。 对 大多数 计算机用户 来讲 ， 与 目前 现有 的 电子商务 平台 相比 ， Windows 将 成为 今后 电子商务 的 最大 平台 。 梁晋 西安交通大学 机械 学院 西安 施仁 西安交通大学 机械 学院 西安 梁峰 西安交通大学 机械 学院 西安 彭波 西安交通大学 机械 学院 西安 参考文献 ， 梁晋 中文版 WindowsServer 服务器版 实用 大全 西安 西安 电子科技 出版社 ， 梁晋 中文版 WindowsProfessional 专业版 实用 大全 西安 西安 电子科技 出版社 ， Microsoft 公司 wwwmicrosoftcomwindows 收稿 日期 ：