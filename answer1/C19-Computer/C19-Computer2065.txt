计算机 工程 COMPUTERENGINEERING 年 第卷 第期 VolNo 一种 新颖 的 菜单 设计 技术 邵明 摘要 介绍 一种 有 热键 响应 的 下拉菜单 设计 技术 ， 主要 介绍 了 其 设计 思想 及 实现 原理 。 具有 效率高 ， 美观大方 等 特点 。 关键词 下拉菜单 热键 BorlandCANewTechniqueforDesigningMenuShaoMing （ QingdaoArchitectureEngineeringInstitute ， MechanicalandElectricalEngineeringDepartmentQingdao ） AbstractThisessayintroducesthedesigningofpulldowmmenuwithhotkeystorespondto ， andputsemphasisonideasofhowtodisignitandprinciplesofhowtomakeitwork 。 Ithascharacteristicsofhighefficiency ， pleasingtotheeyeandsoon 。 KeywordsPulldowmmenu ； Hotkey ； BorlandC 　 　 在 应用程序 中 用户 最先 接触 到 的 就是 应用程序 中 的 菜单 系统 菜单 系统 设计 好坏 不但 反映 了 应用程序 中 的 功能模块 的 组织 水平 同时 也 反映 了 应用程序 的 用户 友善 性 。 而 目前 大多数 菜单 设计 技术支持 两种 对 菜单项 的 选择 一种 是 使用 键盘输入 一个 与 菜单项 相关 的 字母 或 数字键 称为 热键 另 一种 则 是 利用 光标键 或 其它 定位 设备 将 菜单 光标 移动 到 指定 菜单项 并 按 下 回车 或 鼠标 按钮 。 对 热键 的 响应 只 局限于 包含 该 菜单项 的 菜单 处于 活动 期间 才 可 使用 不能 响应 其它 子 菜单 中 的 热键 这 在 一定 程度 上 影响 菜单 选择 的 执行 效率 。 笔者 在 实际 应用 系统 开发 过程 中 设计 的 多级 下拉式 菜单 可 随时 响应 不同 级子 菜单 中 的 热键 大大提高 菜单 执行 效率 。 固定式 下拉菜单 　 　 本 菜单 系统 采用 的 是 固定式 下拉菜单 这是 一种 根 菜单 固定 显示 在 屏幕 顶部 其子 菜单 在 使用 时才 在 屏幕 上弹 出 的 一种 下拉菜单 。 若 一个 应用程序 的 命令 系统 需要 使用 一个 如图所示 的 二级 菜单 ， 每一 菜单 对 菜单项 的 选择 除 常用 的 选择 方法 之外 对 一些 常用 菜单项 设置 了 一些 热键 这样 无论 当前 菜单 光标 处于 哪 一级 子 菜单 中 都 可不 通过 菜单 层层 选择 而 直接 按 热键 来 选择 该 菜单项 。 对于 本 菜单 系统 设置 如下 热键 ： 图 菜单 示意图 　 　 ALTF 、 ALTE 、 ALTG 分别 选择 主 菜单 的 各 菜单项 ALTXFF 分别 选择 File 子 菜单 中 的 QuitSaveLoad 项 。 如何 实现 以上 热键 的 处理 是 菜单 设计 的 关键技术 。 菜单 设计 技术 设计 合理 的 数据结构 　 　 为了 描述 一个 菜单 必须 精心组织 一个 数据结构 其 内容 包括 菜单 内容 菜单 显示 属性 菜单 的 位置 和 大小 菜单 的 选择 属性 等 。 如图 菜单 结构 ， 笔者 进行 如下 设计 ： 　 　 设计 存放 每个 菜单 信息 的 结构 　 　 structscreen 　 　 unsignedcharlefttoprightbottom 菜单 显示 区域 左上角 右下角 坐标 　 　 charbarposition 　 　 　 　 　 ／ 当前 菜单项 在子 菜单 中 的 排列 序号 ／ 　 　 　 charmenumessage 　 　 　 菜单 内容 　 　 　 charmenuattr 　 　 　 　 　 ／ 菜单项 数 　 　 　 charcommands 　 　 　 　 　 　 ／ 本级 菜单 热键 字符串 ／ 　 　 intscreenbuff 　 　 　 　 ／ 记录 保存 菜单 覆盖 区 屏幕 信息 的 缓冲区 首址 　 　 每个 菜单 具体 设置 如下 ： structscreenmainmenupromptFEGNULL 　 filemenufilepromptLSWUOQNULL 　 　 　 editmenueditpromptUECNULL 　 　 　 graphmenugraphpromptLMBCNULLnullscreenNULLNULLNULL 　 　 其中 每一子 菜单 的 提示信息 为 ： charpromptFileEditGraphercharfilepromptLoadFSaveFWritetoQuitAltxchareditpromptUndoEraseCopychargraphpromptLineMoveBoxCircle 　 　 设置 如下 结构 描述 每一 菜单项 　 　 　 structnodeintupdownleftright 　 　 记录 父 菜单项 ， 子 菜单 第一 菜单项 ； 本 菜单 上 一个 ， 下 一个 菜单项 在 结构 数组 中 位置 　 　 structscreenownerscreen 该 菜单项 下级 子 菜单 的 描述 信息 ／ 　 　 intsubfunction ／ 选择 该 菜单项 时应 执行 的 函数 ／ 　 　 定义 一个 结构 数组 数组 每一 元素 存放 一个 菜单项 信息 　 　 structnodenodesmainmenuselectsubtask 　 　 File 项 　 　 filemenuselectsubtask 　 　 Edit 项 　 　 editmenuselectsubtask 　 　 Grapher 项 　 　 graphmenuselectsubtask 　 　 Load 项 　 　 nullscreenloadfile 　 　 Save 项 　 　 nullscreensavefile 　 　 Writeto 项 　 　 nullscreenNULL 　 　 Quit 项 　 　 nullscreenexitsystem 　 　 Undo 项 　 　 nullscreenNULL 　 　 Erase 项 　 　 nullscreenexitsystem 　 　 Copy 项 　 　 nullscreenNULL 　 　 Line 项 　 　 nullscreenNULL 　 　 Move 项 　 　 nullscreenNULL 　 　 Box 项 　 　 nullscreenNULL 　 　 Circle 项 　 　 nullscreenNULL 　 　 某 菜单项 若有 下级 子 菜单 则 选择 该 菜单项 时 执行 的 函数 是 菜单 管理 与 驱动程序 selectsubtask 该 函数 处理 用户 按键 若 是 光标 移动 键则 把 菜单 光标 移至 相应 的 菜单项 上 若 为 选择 则 返回 菜单项 在 菜单 中 的 排列 序号 若 按 ESC 键 函数 返回值 为 ； 否则 执行 该 菜单项 相关 函数 这些 函数 应 设置 返回值 为 以便 完成 该 功能 后退 到 上 一级 菜单 。 　 　 设置 一 堆栈 记录 菜单 选择 路径 便于 响应 某一 热键 或 按 Esc 键时 恢复 每一子 菜单 所 覆盖 的 区域 。 　 　 structscreenscreenstackccurrentmenu 堆栈 ， 当前 活动 菜单 　 　 intscreenspcurrentnode 堆栈 指针 及 当前 菜单项 在 结构 数组 中 的 位置 主要 函数 设计 技术 　 　 主 函数 　 　 　 main 　 　 　 intretcodeij 　 　 　 完成 初始化 界面 　 　 　 setjmpebuf 设置 函数 间 跳转 点 　 　 　 docurrentmenunodescurrentnodeownerscreen 　 　 　 　 pushscreencurrentmenu 　 　 　 retcodenodescurrentnodesubfunction 　 　 　 　 ifretcodepopscreencurrentmenu 　 　 　 　 　 　 currentnodenodescurrentnodeup 　 　 elsecurrentnodenodescurrentnodedownretcode 　 　 while 　 　 压栈 函数 把 当前 子 菜单 信息 压入 堆栈 并且 在 指定 位置 显示 该子 菜单 　 　 voidpushscreenstructscreensc 　 　 　 intijmode 　 　 　 forjjscreenspjifscscreenstackjreturn 　 　 　 screenspscreenstackscreenspsc 　 　 　 ifscnullscreenreturn 　 　 　 modescmainmenu 　 　 　 dispmenuscmode 显示 子 菜单 主 菜单 固定 在 屏幕 第一行 下拉菜单 垂直 显示 　 　 弹栈 函数 返回 上 一级 菜单 并且 恢复 菜单 履盖 区域 屏幕 信息 　 　 　 voidpopscreenstructscreensc 　 　 　 screensp 　 　 　 ifscnullscreenreturn 　 　 　 ifscmainmenudrawcursorbarmainmenumainmenubarposition 　 　 　 　 　 　 　 　 return 主 菜单 只须 重显 光带 点 　 　 　 puttextscleftsctopscrightscbottomscscreenbuffer 　 　 　 freescscreenbuffer 　 　 接受 输入 键值 函数 ： 接收 输入 键 ， 若 为 热键 ， 则 进行 热键 处理 　 　 intgetkeyvoid 　 　 inttemp 　 　 inhahxintxinout 　 　 tempouthalouthahouthal 　 　 switchtemp 　 caseFcaseFcaseALTFcaseALTEcaseALTG 　 　 　 caseALTXbreak 　 　 　 　 caseCURSORLEFT 　 　 　 　 　 caseCURSORRIGHTifcurrentnodecurrentnodebreak 　 　 　 　 elsereturntemp 　 　 　 　 defaultreturntemp 　 　 　 　 hotkeytemphotkeyhandle 　 　 其中 主 菜单 为 活动 时 左右 光标键 是 移 向下 一 菜单项 否则 为 热键 拉 下 其父 菜单 下 一 菜单项 的 子 菜单 。 　 　 热键 处理函数 　 　 inthotkeyhandle 　 　 　 intijtemptempspfatherhotnode 　 　 　 switchhotkey 　 　 　 caseFhotnodebreak 　 　 　 caseFhotnodebreak 　 　 　 caseCURSORLEFThotnodenodescurrentnodeleftbreak 　 　 　 caseCURSORRIGHThotnodenodescurrentnoderightbreak 　 　 　 caseALTFhotnodebreak 　 　 　 caseALTEhotnodebreak 　 　 　 caseALTGhotnodebreak 　 　 　 caseALTXhotnodebreakswitch 　 　 　 恢复 选择 路径 下 各子 菜单 覆盖 区 ， 退至根 结点 　 　 　 forjscreenspjjpopscreenscreenstackj 　 　 　 screenspcurrentnode 　 　 　 temp 纪录 的 是 热键 对应 的 菜单项 及父 菜单 中 相应 菜单项 在 各自 菜单 中 的 序号 　 　 　 fortempspjhotnodejcurrentnode 　 　 fathernodesjuptemptempspjnodesfatherdown 　 　 　 jfathertempsp 　 　 　 沿着 热键 选择 路径 ， 执行 到 热键 对应 菜单项 处 　 　 　 forjtempspjj 　 　 　 　 nodescurrentnodeownerscreenbarpositiontempj 　 　 　 　 pushscreennodescurrentnodeownerscreen 　 　 　 　 currentnodenodescurrentnodedowntempj 　 　 　 　 longjmpebuf 跳到 主程序 处 ， 执行 热键 对应 函数 结束语 　 　 鉴于 篇幅 所 限 ， 只 介绍 二级 下拉菜单 生成 技术 ， 若 要 设计 更 多层次 的 下拉菜单 ， 只 需 在 结构 数组 中 再 加上 每个 菜单 中 的 各 菜单项 描述 信息 即可 ， 本 程序 用 C语言 编写 ， 代码 效率高 ， 执行 速度 快 。 作者简介 ： 邵明 女 ， 女 ， 岁 ， 讲师 ， 主攻 数据库 及其 应用 ， 软件开发 作者 单位 ： 青岛 建工 学院 机电 系 青岛 收稿 日期 ： 修回 日期 ：