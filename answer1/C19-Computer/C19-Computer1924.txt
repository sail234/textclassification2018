微型机 与 应用 MICROCOMPUTERITSAPPLICATIONS 　 Vol 　 No 　 P 基于 IEEE 数字传输 的 内容 保护 方案 王挺 　 吕述 望 摘要 ： 技术 以及 Intel 等 公司 联合 提出 的 、 基于 IEEE 数字传输 系统 的 内容 保护 方案 的 工作 原理 和 基本 内容 。 关键词 ： IEEE 技术 数字传输 内容 保护 密码 技术 　 　 近来 ， 微软公司 的 “ 维纳斯 ” 计划 和 中国科学院 的 “ 女娲 ” 计划 在 国内 炒作 得 沸沸扬扬 。 但 不管怎样 ， 后 PC 时代 的 到来 ， 数字化 的 信息家电 将 成为 一个 发展趋势 ， 将 成为 数字 设备 的 一种 标准 配制 。 其中 ， 数字 媒体 的 版权保护 ， 特别 是 对 数字 媒体 在 各类 数字 设备 （ 信息家电 ） 间 传播 过程 的 保护 ， 将 成为 一个 非常 重大 的 课题 。 　 　 基于 技术 的 数字传输 内容 保护 系统 的 设计 与 实现 具有 极大 的 市场潜力 ， 毫无疑问 地会 吸引 企业界 和 学术界 的 高度重视 。 下面 就 对 其 有关 问题 做 简要 论述 。 技术 　 　 IEEE 是 电气 和 电子 工程师 协会 颁布 的 高速 串行 连接 标准 ， 它 使 各种 系统 和 设备 间 高速 、 可靠 和 便捷 地 传送 数字视频 和 音频 。 又称 作 iLink 或 FireWire ， 是 一种 便捷 的 I ／ O 接口 ， 不 需要 专门 的 硬件 设备 捕获 、 编辑 或 记录 视频 ， 允许 多达 种 数字 设备 （ 各类 信息家电 或 计算机 外设 ） 的 连接 ， 具有 可 伸缩 的 结构 和 “ 热拔 插 ” 功能 ， 设计者 和 用户 可 随时 对系统 或 设备 进行 剪裁 。 与 USB 有 类似之处 ， 但 适用 于 更 高速率 的 视频 领域 。 目前 标准 中 规定 的 传输率 为 ～ Mb ／ s ， 正在 研究 Mb ／ s 以上 的 速率 。 在 IEEE 标准 基础 上 ， 其 增强 版本 的 Pa 于 年末 由 IEEE 着手 审议 ， 后继 版本 Pb 也 已于 年 中期 递交 讨论 。 　 　 以往 ， 微机 （ PC ） 和 消费 电子产品 （ CE ） 分 属于 不同 的 领域 ， 二者 通常 是 采用 较 低 “ 品质 ” 的 模拟 连接器 进行 连接 。 如要 用 PC 制做 影视节目 ， 就 必须 采用 昂贵 的 模拟 视频 捕获 卡 以及 NTSC 制式 的 重放 设备 。 如果 采用 技术 ， 用户 就 可 通过 PC 直接 控制 CE 和 PC 外围设备 、 编辑 音频 ／ 视频 信息 、 将 外围设备 连入 Internet 网等 ， 并且 不会 发生 质量 上 的 损耗 。 市场 上 现已 有带 接口 的 数字 摄像机 、 数字 卫星 接收机 和 数字 录像机 等 产品 ， 预计 数字电视 、 数字 机顶盒 、 DVD 机及 扫描仪 、 打印机 等 也 很快 将 采用 技术 。 技术 将 对 未来 的 计算 、 消费 电子 和 通信 系统 产生 深远 的 影响 。 数字传输 系统 内容 保护 　 　 DTCP 要 实现 以下 目标 ： 　 　 能够 为 IEEE 总线 上 传输 的 版权 音频 ／ 视频 内容 提供 足够 的 安全 保护 ， 非法 设备 无法 发送 和 接收 有关 内容 ； 　 　 能够 构造 一个 高效 、 可靠 、 安全 的 系统 环境 ， 所有 的 PC 和 CE 设备 可以 正常 运转 。 附加 的 安全 设施 对 设备 性能 的 影响 尽可能 小 ， 且 尽可能 地 便宜 ； 　 　 能够 保证系统 的 灵活性 、 可扩展性 和 可 更新 性 ； 　 　 尽可能 地为 所有 合法 用户 提供方便 的 操作 ， 不 给 用户 增加 额外 的 负担 ； 　 　 所有 的 知识产权 都 需 经过 适当 的 方式 进行 审核 ； 　 　 所有 的 实现 方案 的 设备 能够 获得 进 ／ 出口 许可 ， 可以 在 市场 上 自由 买卖 。 为此 ， 该 方案 的 实现 是 建立 在 一定 强度 的 密码 技术 之上 的 。 所有 的 设备 在 生产 制造 时 都 附加 一个 唯一 的 密码 “ 部件 ” ， 实现 认证 机制 。 在 版权 内容 发送 和 接收 之前 首先 进行 认证 过程 ， 以 保证 设备 身份 的 合法性 ， 同时 进行 密钥 交换 。 发送 的 内容 经过 加密 处理 ， 防止 非法 拷贝 。 系统 的 使用 和 密钥 的 管理 都 经过 相应 机构 的 审核 。 系统 工作 流程 如图所示 。 图 系统 工作 流程 　 　 源 设备 首先 发出 初始 帧 ， 其中 的 加密 模式 批示 符 EMI 标记 内容 受 保护 状态 如 ： “ copyonce ” 、 “ copynever ” 或 “ nomorecopies ” ； 　 　 接收 设备 收到 初始 帧 后 ， 首先 查看 EMI 的 有关 内容 保护 标记 。 如果 是 “ Copynever ” ， 接收 设备 则 向源 设备 发送 请求 帧 ， 要求 完全 认证 和 密钥 交换 （ FullAKE ） 方案 ； 如果 是 “ copyonce ” 、 “ nomorecopies ” ， 则 可 根据 本地 设备 的 能力 要求 完全 认证 和 密钥 交换 方案 或 有限 认证 和 密钥 交换 方案 RestrictedAKE ； 如 已 认证 完毕 ， 可 直接 进行 第步 ； 　 　 源 设备 收到 认证 请求 帧 后 ， 决定 接收 设备 的 认证 类型 ； 　 　 启动 相应 认证 和 密钥 交换 进程 ， 获得 内容 密钥 （ ContentKey ） ， 用以 加密 随后 进行 的 内容 发送 。 　 　 从 上 可以 看到 ， 系统 涉及 以下 几个 方面 内容 ： 拷贝 控制 信息 Copycontrolinformation ； 认证 和 密钥 交换 AKE ； 内容 加密 Contentcipher ； 系统 更新 Systemrenewability 。 下面 分别 予以 介绍 。 拷贝 控制 信息 CCI 　 　 内容 的 所有者 可 决定 内容 的 拷贝 限制 CCI ： “ copyonce ” 、 “ copynever ” 或 “ copyfree ” 等 。 　 　 CCI 信息 嵌入 传输 内容 帧 中 ， 许多 信息格式 如 MPEGII 中有 字 段 指定 相应 的 CCI 。 CCI 信息 任何人 都 无法 修改 ， 同时 用 加密 模式 指示 符 EMI 表示 相应 的 CCI 信息 。 对于 IEEE ， EMI 设定 为 帧 头 同步 字段 的 最高 bit 。 这样 比特流 记录 设备 （ 如 数字 录像机 ） 可 直接 得到 CCI 信息 。 如果 EMI 被 改动 ， 发送 内容 无法 正常 恢复 。 认证 和 密钥 交换 AKE 完全 认证 和 密钥 交换 　 　 所有 设备 都 由 DTLA 发放 唯一 的 公 ／ 私 密钥 对 和 数字 设备 证书 。 私钥 存放 在 设备 中 ， 并 受到 严格 保护 ， 不得 泄露 。 数字 设备 证书 也 存放 在 设备 中 ， 在 认证 过程 中 使用 。 FullAKE 采用 基于 公钥 的 数字签名 标准 DSS 和 Diffie － Hellman 密钥 交换 算法 DH 。 DSS 用于 保证数据 的 完整性 。 DH 用于 传输 会话 密钥 ， 用于 二方 或 多方 生成 共享 密钥 。 　 　 安全 认证 由 接收 设备 首先 向源 设备 发出请求 ， 然后 交换 设备 证书 和 随机 challenge ； 之后 ， 双方 计算 DH 第一阶段 的 数值 。 最后 交换 包含 如下 内容 的 签名 信息 ： 对方 设备 发来 的 challenge 、 DH 第一阶段 的 值 、 设备 中 存储 的 系统 最新更新 信息 （ SRM ） 版本号 。 以上 认证 过程 很 简单 。 SRM 中 含有 被 取消 的 设备 证书 列表 ， 在 认证 过程 中 ， 设备 将 查询 列表 ， 确定 对方 的 合法性 。 这种 做法 ， 可 有效 防止 盗版 设备 的 非法 使用 。 全 认证 过程 如图所示 。 图全 认证 过程 有限 认证 和 密钥 交换 　 　 有限 认证 和 密钥 交换 用来 在 设备 间 交换 “ copyonce ” 、 “ copynomore ” 内容 。 如 数字 录像机 等 计算能力 有限 、 依赖于 共享 秘密 和 Hash 函数 作用 于 随机 challenge 。 有限 认证 由 接收 设备 首先 发出请求 ， 之后 源 设备 要求 对方 发送 设备 ID ； 源 设备 收到 ID 后 ， 生成 一串 随机 challenge 再 发送给 接收 设备 。 收到 challenge 后 ， 接收 设备 使用 相应 的 密钥 （ 由 DTLA 签发 的 服务 密钥 ， servicekey ） 计算 一个 对应 的 值 再 发送给 源 设备 。 此时 ， 源 设备 自身 的 服务 密钥 和 接收 方 的 设备 ID 对 challenge 也 计算 出个 相应 的 数值 ， 与 刚 收到 的 值 进行 比较 ， 如果 二者 符合 ， 则 完成 认证 。 之后 ， 源 设备 和 接收 设备 再 计算 出个 认证 密钥 AuthorizationKey 。 公共 密钥 生成 　 　 公共 密钥 生成 适用 于 以上 二种 认证 方式 。 源 设备 生成 个 随机 串 作为 交换 密钥 ， 并 使用 它 自己 计算 出 的 认证 密钥 加密 ， 发送给 接收 设备 。 接收 设备 收到 后 再 使用 它 自己 计算 出 的 认证 密钥 解密 ， 然后 得到 公共 密钥 ， 即 内容 加密 密钥 （ contentkey ） 用于 加密 版权 内容 信息流 。 内容 加密 　 　 密码 用来 加密 受 保护 的 内容 ， 不仅 需要 安全 高效 ， 而且 要 在 PC 和 CE 同时 实现 。 为 保证 互操作性 ， 所有 的 设备 必须 支持 基本 密码 方案 （ BaselineCipher ） ， 同时 也 可以 支持 其它 密码 。 密码 使用 C － CBC 工作 模式 ， 有效 防止 已知 明文 攻击 或 密钥 穷举 攻击 。 　 　 采用 M 和 改进 的 Blowfish 作为 基本 加密 密码 ， DES 等 作为 可 选 密码 。 系统 更新 　 　 支持 全 认证 的 设备 可以 接收 和 处理 SRMs 。 这种 系统 更新 能力 可 及时 废除 非法 的 设备 ID ， 可以 保证系统 长期 的 完整性 。 　 　 SRMs 可以 通过 许多 途径 进行 修改 。 由于 系统 是 通过 网络系统 连接 ， 并且 始终 是 运行 的 。 一个 有效 的 SRM 新 版本 会 很快 通知 到 所有 设备 。 SRM 主要 内容 包括 ： 　 　 不断 递增 的 系统 更新 版本号 ， 保证 始终 使用 最新 的 SRM ； 　 　 认证 废弃 表 （ CRL ） ， 记录 那些 不 安全 的 或 非法 的 设备 信息 。 对于 存储 能力 有限 的 设备 ， 应 首先 优先 记录 那些 可能 威胁 最大 的 设备 信息 ； 　 　 由 DTLA 对 以上 信息 的 数字签名 ， 保证 SRM 的 完整性 。 密码 技术 基于 椭圆 曲线 的 DSA 、 DH 　 　 方案 中 采用 了 基于 椭圆 曲线 的 DSA 、 DH ， 椭圆 曲线 密码 ECC 是 基于 过 椭圆 曲线 解 离散 对数 的 困难性 ， 与 其它 的 公钥 密码 体制 相比 ， 它 能 以 较 短 的 密钥 长度 提供 较 高 的 安全性 ； 同时 也 减少 了 资源 开销 。 系统 中 ， 有限 域 设为 GFp ， p 为 大 素数 。 过 素数 域 的 椭圆 曲线 设为 EFp ， 满足 以下 方程式 ： y ＾ ＝ x ＾ ＋ ax ＋ ba ， b ， x ， y ∈ Fp 　 　 基于 椭圆 曲线 的 DSA 、 DH ， 在 椭圆 曲线 上 选择 个 基点 G ， 公开密钥 Y 和 私有 密钥 Y － 满足 以下 关系 ： Y ＝ Y － GoverEFp 　 　 ECCDSA 和 ECCDH 的 具体 描述 可 参见 有关 规范 说明 。 基本 密码 和 C － CBC 模式 　 　 方案 采用 M 和 改进 的 Blowfish 作为 基本 加密 密码 。 M 是 一种 基于 伪 随机 置换 的 分组 加密算法 ， 它 已 被 日本 数字 卫星广播 系统 采纳 为 加密 标准 。 同 类型 的 算法 有 MD 和 SHA － 。 算法 的 基本操作 为 b 的 加法 、 异或 和 循环 移位 ， 可 取得 较 好 的 非线性 和 雪崩 效应 。 M 用 硬件 实现 非常简单 ， 规模 很小 。 M 算法 中 没有 采用 查询 表 ， 软件 实现 的 代码 量 也 极少 。 M 的 密钥 长度 可变 （ ～ b ） ， 主要 是 考虑 出口 限制 的 因素 。 　 　 Blowfish 也 是 一种 密钥 长度 可变 的 分组 加密算法 。 方案 中 对 该 算法 进行 了 改进 ， 提高 了 算法 在 PC 上 的 性能 ， 并 降低 了 复杂性 以 减少 在 CE 上 的 实现 成本 。 主要 体现 在 将 算法 的 轮数 降至 轮 ， S － 盒 减为 个 。 此外 还 考虑 采用 静态 S － 盒 ， 以 减少 密钥 调度 的 开销 。 以上 做法 对 安全性 的 影响 ， 目前 还 在 评估 之中 。 　 　 基本 密码 都 采用 如图所示 的 C － CBC 工作 模式 。 与 普通 的 CBC 模式 相比 ， 在 密文 反馈 上 增加 了 个 秘密 的 转换 函数 f ， 这样 可 隐藏 输入 ／ 输出 的 关系 ， 有效 对付 已知 明文 攻击 和 密钥 穷举 攻击 ， 增加 了 安全性 。 图 C － CBC 模式 结束语 　 　 通过 对 Intel 等 公司 提出 的 方案 分析 ， 可以 注意 到 以下 几个 问题 ： 　 　 没有 重新 设计 新 的 密码 算法 和 协议 ， 而是 采用 在 机要 部门 广泛应用 、 久经考验 的 、 比较 成熟 的 密码 方案 ， 这样 做 无疑 是 想 减少 风险 。 　 　 采用 基于 椭圆 曲线 的 密码 算法 。 用 较 短 的 密钥 长度 获得 较 高 的 安全性 ， 同时 ， 也 可 提高 性能 、 降低 设备 的 成本 。 　 　 基本 密码 用于 内容 加密 的 选择 或 改进 ， 在 突出 算法 效率 的 前提 下 ， 强调 软 ／ 硬件 实现 的 简洁性 。 　 　 通信协议 的 设计 有 相当 的 灵活性 和 可扩展性 。 　 　 可以 预料 ， 随着 数字化 技术 、 通信 技术 及 计算机技术 的 进一步 发展 ， 数字化 的 信息家电 将 溶入 我们 的 日常生活 之中 ， 将 成为 数字 设备 的 一种 标准 配制 。 基于 的 数字传输 内容 保护 方案 的 研究 与 设计 也 势必 成为 热点 课题 。 王挺 （ 中国科学院 信息安全 国家 重点 实验室 ） 吕述 望 （ 中国科学院 信息安全 国家 重点 实验室 ） 参考文献 ， TrawB ， SmyersS ． ContentProtectionforDigitalTransmissionSystem ． CCompromiseProposalVersion ． ， ； （ ） ， PearsonB ． DigitalContentProtection ： HowDoesItWork ﹖ ． MultimediaSystemDesign ， ； （ ） ， PearsonB ． ProtocolEnhancementsInPaAndWhyTheyareImportantFor ． DevicesInAPCEnvironment ， Rev ． ， ； （ ） ， LambertP ． EllipticCurveCryptographyDeliversHighPerformanceandSecurityforECommerce ． ComputerSecurityJournal ， ； （ ） ， TrawB ． － BaseddigitalContentProtectionanIntelproposal ． http ： ／ ／ www ． zettweb ． com ， PearsonB ． USBandlivingtogetherinharmony ． http ： ／ ／ www ． zettweb ． com 收稿 日期 ： － －