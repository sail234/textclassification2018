计算机 工程 COMPUTERENGINEERING 年 第卷 第期 volNoPB 环境 下 模拟 下 拉 列表框 显示 动态数据 胡 　 岩 　 王 宇航 　 何 　 慧 问题 的 提出 　 　 PBPowerBuilder 是 一种 面向对象 的 基于 客户机 ／ 服务器 方式 的 数据库 开发工具 ， 它 集成 了 大量 的 新 技术 并 成为 功能强大 、 高性能 的 开发 环境 。 它 采用 事件驱动 编程 方式 ， 在 可视化 开发 环境 中 ， 保证 数据安全 完整 的 前提 下 ， 使 开发人员 方便 灵活 的 制作 自己 的 产品 。 　 　 使用 过 PB 的 人 都 知道 ， 在 Window 对象 中 ， 提供 了 多种 可用 控件 。 它 是 人机 交换 信息 的 接口界面 ， 其他 的 应用程序 组件 都 是 通过 窗口 联系 起来 并 展现 给 用户 的 。 在 应用程序 中 只有 通过 控件 的 使用 ， 才能 发挥 其 功能 。 下拉式 列表框 控件 DropDownListBox 就是 其中 之一 ， 它 也 被 称为 组合 框 ， 因为 它 组合 了 单行 编辑器 和 列表框 的 特性 ， 可以 编辑 一行 文本 ， 在 一个 可以 滚动 的 矩形框 中 显示 多行 文本 ， 常用 于 双击 列表框 中 的 某项 时 触发 某些 操作 。 　 　 虽然 它 是 一个 非常 方便 的 控件 ， 可 它 提供 的 功能 是 有限 的 ， 在 列表框 中 显示 的 数据项 需在 定制 时 预先 输入 或 在 程序运行 时 添加 ， 因此 它 只 适合 于 少量 相对 固定 的 数据项 。 　 　 在 实际 应用 中 ， 例如 执行 查询 操作 时 ， 作为 查询 条件 的 数据 输入 方式 ， 常常 要 对 大量 动态数据 ， 尤其 是 来自 数据库 中 的 数据 ， 采用 下 拉 列表框 的 方式 提供 给 用户 选择 输入 ， 因此 ， 这时 仅用 下 拉 列表框 控件 本身 并 不能 满足要求 。 　 　 下面 介绍 一种 在 程序运行 时 动态 地 从 某 一表中 选取 数据项 来 模拟 下 拉 列表框 的 方法 。 问题 的 实现 定义数据 窗口 　 　 表是 一个 典型 的 数据 字典 表 。 它 只有 content 和 id 两个 字 段 ， content 是 所要 显示 的 数据项 ， id 是 其 对应 的 编码 。 表 典型 的 数据 字典 表 NameTypeWidthDecimalNullcontentchar 　 Noidchar 　 No 　 　 在 制作 管理信息系统 时 ， 为了 使 程序 规范 、 风格 统一 、 提高 代码 编程 效率 、 节省 数据库 存储空间 、 同时 又 能 方便 用户 操作 ， 经常 要 用到 这种 编码 表 。 如 学历 编码 、 性别 编码 、 省市区 县 编码 等 。 下面 以 学历 编码 表为 例作 详细 介绍 。 　 　 首先 建立 两个 数据 窗口 ： 　 　 建立 第一个 数据 窗口 deducation 　 　 进入 数据 窗口 描绘 器中 ， 从 数据源 中 选择 QuickSelect 选项 ， 从 显示 样式 中 选择 Grid 选项 ， 单击 OK 按纽后 ， 进入 QuickSelect 对话框 ， 在 Tables 中 选择 需要 使用 的 表名 ， 如 education 。 在 Columns 列表框 中 依次 选择 content ， id 数据项 ， 单击 OK 按纽 ， 这时 进入 了 PB 设计 好 的 数据 输入 屏幕 。 将 标题 头 Header 隐藏 ， 只 保留 Detail 项 ， 设计 好后 将 数据 窗口 命名 为 deducation 后 存盘 。 　 　 建立 第二个 数据 窗口 deducationdw 　 　 用 以上 相同 的 方法 进入 QuickSelect 对话框 ， 在 Tables 中 选择 需要 使用 的 表名 ， 如 education 。 在 Columns 列表框 中 依次 选择 content ， id 数据项 ， 单击 OK 按纽后 ， 将 标题 头 Header 隐藏 ， 只 保留 Detail 项 。 　 　 然后 编辑 content 项 属性 在 content 列 单击 鼠标 右键 ， 选择 Properties 命令 ， 在 显示 出 的 属性 栏上 选择 Edit 标签 ， 在 Style 中 选择 DropDownDW ， 在 Datawindow 中 选择 已建好 的 deducation ， 在 DisplayColumn 中 选择 content ， 在 DataColumn 中 选择 id ， 在 LinesinDropDown 中 输入 适当 的 下 拉 列表框 的 显示 行 数 。 　 　 选中 VScrollBar 属性 以便 在 数据项 超过 下 拉 列表框 边界 时 自动 显示 竖直 滚动条 ， 选中 AlwaysShowArrow 属性 以便 提示 这是 一个 下 拉 列表框 。 设计 好后 将 数据 窗口 命名 为 deducationdw 后 存盘 。 　 　 在 这里 ， 定义 第一个 数据 窗口 deducation 的 目的 是 ， 为了 定义 第二个 数据 窗口 deducationdw 。 在 数据 窗口 deducationdw 中 又 调用 另外 一个 数据 窗口 deducation ， 通过 两个 数据 窗口 的 嵌套 组合 方式 ， 达到 实现 模拟 下 拉 列表框 的 目的 ， 这 是 本 方法 的 关键所在 。 创建 窗口 及 控件 　 　 建立 一个 窗口 命名 为 wwindow ， 在 其 上 创建 一个 数据 窗口 控件 dw ， 关联 的 数据 窗口 对象 是 deducationdw ， 用于 模拟 下 拉 输入 列表框 。 　 　 然后 再 创建 一个 数据 窗口 控件 dw ， 用于 显示 数据 窗口 ， 与 dw 相关联 的 数据 窗口 对象 可以 选 自 个人 信息库 ， 其 用意 在于 根据 dw 中 选择 的 数据项 值 ， 来 检索 dw 中 的 数据 。 也 可以 说 dw 是 dw 的 查询 条件 输入 项 。 因此 为 dw 定义 一个 检索 参数 ， 这个 参数 与 建立 数据 窗口 对象 deducationdw 所 依据 的 表 有关 ， 如 学历 。 连接 数据库 与 数据 窗口 中 的 数据 　 　 窗口 及其 控件 创建 好 之后 ， 还 必须 进行 连接 数据库 操作 ， 否则 在 数据 窗口 中 无法 显示 数据库 中 的 数据 。 　 　 在 窗口 wwindow 的 open 事件 中 键入 下面 的 语句 ： 　 　 ConnectUsingSQLCA ； dwSetTransObjectSQLCA ； 　 　 dwRetrieve ； dwSetTransObjectSQLCA ； 　 　 dwRetrieve ； DisconnectUsingSQLCA ； 连接 dw 与 deducationdw 　 　 为了 在 数据 窗口 dw 中 ， 根据 下 拉 列表框 的 值 显示 相应 的 数据 ， 还 需要 定义 dw 与 dw 两个 控件 的 连接 。 　 　 在 dw 的 itemchanged 事件 键入 下面 的 语句 ： ConnectUsingSQLCA ； dwSetTransObjectSQLCAdwRetrievedata ； DisconnectUsingSQLCA 使用 效果 　 　 在 查询 数据 时 ， 根据 dw 中 用户 输入 的 选项 ， 相应 地 在 dw 窗口 中 显示 与 文化 程度 对应 的 数据 。 用 鼠标 在 输入框 中 单击 ， 就会弹 出中 定义 的 下 拉 列表框 ， 选择 其中 一项 数据 ， 如 本科 ， 则 dw 数据 窗口 立即 检索 出 相应 文化 程度 的 所有 数据 。 只要 dw 中 的 输入 数据项 一旦 发生变化 ， 就 会 触发 其 itemchanged 事件 ， dw 数据 窗口 马上 就 会 随之 相应 变化 。 结束语 　 　 在 实际 应用 中 ， 模拟 下 拉 列表框 动态显示 数据 并 不 局限于 某个 特定 结构 的 表 ， 它 可以 是 任 一个 表 的 任 一个 字 段 。 从 上述 过程 可以 得出结论 ， 在 程序运行 时 动态显示 选 自 数据库 中 的 数据 ， 模拟 下 拉 列表框 的 输入 方式 ， 是 完全 可行 的 ， 其 实现 方法 也 简便易行 ， 突破 了 系统 本身 提供 的 下 拉 列表框 功能 的 局限性 ， 扩展 了 系统 功能 ， 最终 方便 了 用户 。 在 已 投入 运行 的 管理信息系统 中 ， 经 多次 运用 此 方法 ， 获得 了 满意 的 效果 。 实践证明 本 方法 是 简便 有效 的 。 作者 单位 哈尔滨工业大学 网络 中心 哈尔滨 参考文献 美 HatfieldBPowerBuilder 应用 程序开发 指南 北京 ： 清华大学出版社 ，