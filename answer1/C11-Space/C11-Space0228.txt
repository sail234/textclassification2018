宇航学 报 JOURNALOFASTRONAUTICS 年 第期 　 No 数字 景象 图 的 计算机 模拟 生成 张天序 　 胡 　 礴 　 　 摘 　 要 　 数字 景象 图 在 飞行器 末 制导 中起 着 关键作用 。 在 特殊 情形 下 有 必要 用 计算机 模拟 生成 数字 景象 图 。 本文 在 分析 数字 景象 图成象 机理 的 基础 上 给出 了 一个 基于 数字 高程 图 模拟 生成 数字 景象 图 的 框架 分别 讨论 了 光照 模型 大气 模型 误差 模型 坐标系 和 视点 变换 等 关键步骤 。 文中 给出 了 模拟 生成 的 结果 。 　 　 主题词 　 导航 　 数字 高程 图 　 成 象 机理 　 图象 生成 DIGITALSCENEIMAGESYNTHESISZhangTianxuInstituteforPatternRecognitionandArtificialIntelligenceHuazhongUniversityofScienceandTechnologyWuhanHuBoKeyLabforImageProcessingIntelligentControlTheMinistryofEducationofChinaHuazhongUniversityofScienceandTechnologyWuhan 　 　 Abstract 　 DigitalsceneimageplaysanimportantroleinnavigationofaircraftInsomecircumstancesitisnecessarytosynthesizedigitalsceneimagesWeproposeasystemframeworkofsceneimagesynthesisusingdigitalelevationmapDEMafteranalyzingtheimagingmechanismKeypartsoftheframeworkasilluminationmodelatmospheremodelerrormodelcoordinatesandviewpointtransformationaregivenSimulationresultsarealsogiven 　 　 Keywords 　 NavigationDigitalelevationmapImagingmechanismImagesynthesis 　 引 　 言 　 　 在 飞行器 制导系统 研究 过程 中常 遇到 下列 情形 使得 模拟 生成 景象 图 非常 重要 。 　 　 　 受 客观条件 的 限制 没有 和 已知 地形 数据 对应 的 景象 图 可用 　 　 　 对 同一 区域 需要 获取 不同 视点 不同 季节 的 景象 图 　 　 　 飞行 平台 姿态 误差 是 可变 的 需要 进行 模拟 　 　 　 匹配 识别 算法 研究 和 算法 性能 分析 需要 大量 景象 图 ［ ］ ［ ］ ［ ］ 。 　 　 国内外 关于 这一 课题 的 成果 在 期刊 上 还 不多见 。 文献 ［ ］ 讨论 了 在 简化 的 光照 模型 下 单一 纹理 的 数字 景象 图 的 模拟 生成 其 应用 有 一定 的 局限性 。 文献 ［ ］ 着重 分析 了 成象 系统 的 硬件 组成 对 算法 涉及 较 少 。 本文 详细分析 了 成象 过程 的 每 一 步骤 综合 了 不同 研究 领域 的 一些 成果 提出 了 一个 基于 数字 高程 图 和 成象 机理 的 完整 的 可 直接 操作 的 模拟 生成 景象 图 框架 在 这 一 框架 的 基础 上 根据 特定 的 应用 背景 采用 繁简 不同 的 算法 可 得到 效果 不同 的 景象 图 。 最后 提出 以后 进一步 改进 的 途径 。 　 景象 模拟 生成 框架 　 　 景象 模拟 生成 系统 框图 如图所示 虚线 框内 是 需要 人机交互 的 功能模块 。 图 　 数字 景象 图 模拟 生成 框架 　 　 总 的 流程 为 　 　 读入 数字 高程 图 和 景象 类别 图 　 　 算 出 太阳 光源 位置 　 　 由 数字 高程 图 景象 类别 图 光源 利用 光照 模型 得到 表面 反射 矩阵 　 　 考虑 大气 影响 和 噪声 　 　 对 表面 反射 矩阵 使用 相机 模型 和 消隐 算法 通过 插值 和 量化 得到 景象 图 。 　 数字 高程 图 DEM 　 　 数字 高程 图有 多种 表示 形式 常用 的 规则 矩形网格 数字 高程 图可 表示 为 　 　 　 　 　 　 zfxy 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 z 为 高程 xy 为 平面坐标 。 在 我们 的 算法 中 假设 X 轴 由 西至东 Y 轴 由 南至北 Z 轴 指向 由 右手 系 决定 。 单位 为 米 。 　 光照 模型 　 　 为了 计算 景象 可 见面 的 亮度 值 需要 用到 光照 模型 。 现有 光照 模型 可 分为 全局 光照 模型 和 局部 光照 模型 。 局部 光照 模型 主要 有 朗伯 模型 Lambertianmodel 和 冯 模型 Phongsmodel 。 前者 只 考虑 漫反射 分量 后者 进一步 考虑 了 镜面反射 。 一般 的 当 景物 表面 为 山地 田野 等 粗糙 表面 时 可以 用 漫射 模型 。 我们 目前 生成 的 景物 只 限于 以上 类型 所以 只 考虑 使用 朗伯 模型 。 当 背景 是 水体 或 雪景 等 具有 镜面反射 特性 的 表面 时应 使用 冯 模型 。 图 　 Lambert 光照 模型 　 　 朗伯 模型 用 公式 表达 如下 它 指出 落 在表面上 的 光能 是 随着 光线 入射角 的 余弦 而 变化 的 参考 图 。 　 　 　 　 　 　 I α β γ ρ cos α Ed 　 　 　 　 　 　 　 　 　 　 　 　 I 表示 亮度 Ed 是 落 在 景物 上 的 漫射光 照 ρ 是 反射系数 取值 范围 是从 到 。 α β γ 意义 参见 图 。 Lambert 模型 考虑 的 是 漫射光 所以 I 与 β γ 都 无关 。 如果 入射角 α 超过 度则 对 光源 而言 该 表面 为 隐藏 面 此时 要 将 I 置 零 。 　 太阳 的 位置 　 　 为了 得到 式 中 的 cos α 首先 要 知道 光源 太阳 的 位置 ［ ］ 。 　 　 已知 景象 区域 的 地理 经纬度 摄取 景象 图 的 日期 和 时间 则 可 通过 计算 得到 太阳 的 位置 。 太阳 位置 由 两个 角 表示 高度 角 φ Elevationangle 是 太阳 与 地平 之间 的 夹角 方位角 θ （ azimuthangle 是 太阳 在 地 平面 上 的 投影 线 与 北向 的 夹角 逆时针 方向 。 下列 一组 公式 中 的 记号 意义 如下 　 　 DEC 　 　 　 　 　 　 　 太阳 偏向角 　 　 GHA 　 　 　 　 　 　 　 格林威治 时角 　 　 LHA 　 　 　 　 　 　 　 地理纬度 单位 度 　 　 UT 　 　 　 　 　 　 　 世界 时 　 　 YMD 　 　 　 　 　 　 年月日 　 　 hmiss 　 　 　 　 　 小 时分秒 首先 计算 太阳 偏向角 和 格林威治 时角 单位 度 　 　 　 　 　 　 DECtantan ε sin α 　 　 　 　 　 　 GHAUTBC α 　 　 　 　 　 　 ε t 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 tUTDm ［ y ］ 　 　 　 　 　 　 UThmins 上式 中 如果 M ＞ 则 yYmM 否则 yYmM 。 YMD 分别 是 拍摄 时 的 年月日 。 上面 一组 公式 中 的 中间 变量 计算 如下 各 公式 意义 参见 ［ ］ 。 　 　 　 　 　 　 α LsinLsinL 　 　 　 　 　 　 LtC 　 　 　 　 　 　 CsinGsinG 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 Gt 现在 φ θ 可 确定 如下 　 　 　 　 　 　 sin φ sinLATsinDECcosLATcosDECcosGHA 　 　 　 　 　 　 　 　 　 LAT 的 意义 参见 ［ ］ 。 　 亮度 值 的 确定 　 　 景物 表面 方程 用式 表达 我们 有 如下 推导 。 景物 表面 法 向量 为法 向量 为 ［ pq ］ pq 即 fxy 的 梯度 。 光源 太阳 的 方向 向量 为 ［ psqs ］ 则 式 中 cos α 可 由 向量 ［ pq ］ 和 ［ psqs ］ 的 归一化 内积 得出 。 式 又 可 写作 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 式 中 太阳 方向 向量 由下式 求出 　 　 　 　 　 　 pssin θ cos φ 　 　 　 　 　 　 qscos θ cos φ 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 对 数字 高程 图 的 每 一个 单元 面 xy 相应 的 p 和 q 可 估计 如下 　 　 　 　 　 其中 d 是 数字 高程 图 的 网格 间距 。 　 　 对应 于 每 一 xy 有 ρ xy 。 矩阵 ［ ρ ］ 即 景象 类别 图 。 ［ ρ ］ 可 随机 产生 。 图 　 大气 效应 　 大气 效应 　 　 考虑 大气 效应 ［ ］ 进入 相机 的 光 由 下面 三 部分 组成 　 　 　 　 　 　 IIIsId 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 I 是 没有 经过 地面 反射 而 直接 由于 大气 散射 进入 相机 的 。 它 与 景物 表面 反射 无关 只是 降低 图象 的 对比度 。 Is 是 太阳光 进入 大气 被 景物 表面 反射 再 进入 大气 最后 进入 相机 的 分量 。 这一 分量 反映 了 景物 表面 的 性质 是 我们 主要 关心 的 分量 。 Id 是 散射 分量 图 。 特别 的 对于 朗伯 模型 有 下式 成立 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 　 ρ 即式 中 的 反射系数 T 是 描述 大气 辐射 的 传输 函数 S 是 大气 反射系数 。 TS 的 取值 与 季节 地理位置 等 因素 有关 参考 ［ ］ 。 我们 在 实验 中取 为 常数 。 　 噪声 模型 　 　 按 以上 几步 得到 图像 亮度 后 还 可 考虑 传感器 的 散弹 噪声 和 热噪声 ［ ］ 。 下面 只 描述 生成 方法 。 令 nn 是 两个 标准 高斯分布 的 随机数 序列 u 是 服从 之间 的 均匀分布 的 随机数 序列 附有 噪声 的 图像 可 产生 如下 　 　 　 　 I ′ ij ［ Iij σ tnij σ snijIij ］ ［ σ cuij ］ 　 　 σ t σ s σ c 的 意义 和 取值 见 ［ ］ 。 　 相机 模型 和 坐标系 　 相机 模型 　 　 我们 采用 一般 的 针孔 相机 模型 。 并 认为 相机 内 参数 已知 焦距 f 可调 实验 中取 典型值 mmXY 方向 的 偏心 为 零 。 　 透视 变换 和 坐标系 　 　 本文 中 涉及 三个 坐标系 世界 坐标系 oxyz 观察 坐标系 OXYZ 和 屏幕 坐标系 O ′ X ′ Y ′ Z ′ 参见 图 。 世界 坐标系 与 DEM 坐标系 重合 所有 点 的 坐标 都 以 世界 坐标系 为 基准 。 观察 坐标系 中 的 原点 为 视点 Z 轴 与 相机 光轴 重合 。 屏幕 坐标系 的 XOY 面 与 成象面 重合 原点 是 相机 光轴 与 成象面 的 交点 。 透视 变换 的 过程 是 先 将 世界 坐标系 中 的 点 变换 成 观察 坐标系 中 的 点 再 将 观察 坐标系 下 的 点 变换 成 屏幕 坐标系 中 的 点 。 图 　 坐标系 　 　 我们 用 齐次 坐标 将 以上 变换 过程 表达 如下 　 　 　 　 ［ X ′ Y ′ Z ′ ］ ［ xyz ］ TRY ° RZ ° P 　 　 　 　 　 　 其中 T 为 平移变换 矩阵 RY ° 为 绕 Y 轴 逆时针 旋转 度 的 旋转变换 矩阵 RZ ° 为 绕 Z 轴 逆时针 旋转 度 的 旋转变换 矩阵 P 为 透视 变换 矩阵 。 算出 X ′ Y ′ 后 再 经过 插值 量化 和 消隐 最终 得到 景象 图 。 　 模拟 结果 　 　 本 实验 采用 位于 武汉 附近 东经 北纬 的 一块 大小 网格 大小 m 即 kmkm 的 数字 高程 图 图 。 图和图 是 模拟 产生 的 两幅 景象 图 。 图 　 本 实验 所用 数字 高程 图 点点 网格 大小 m 图 　 东经 北纬 年月日 北京 时间 噪声 σ t σ s σ c 相机 位置 mmm 相机 焦距 fm 图 　 东经 北纬 年月日 北京 时间 噪声 σ t σ s σ c 相机 位置 mmm 相机 焦距 fm 　 进一步 的 工作 　 　 模拟 产生 数字 图象 图是 一个 难度 大 需要 大量 基础 工作 的 课题 。 本文 给出 了 一种 模拟 生产 景象 图 的 完整 框架 和 完整 算法 实验 表明 方法 是 有效 的 。 进一步 的 工作 包括 　 　 本文 只用 到 局部 光照 模型 下 一步 工作 考虑 使用 一些 快速 的 全局 光照 模型 以 求得 更 高 的 真实感 。 　 　 利用 本文 提出 的 模型 反求 ρ 统计 出 不同 地物 ρ 的 取值 。 用 这些 ρ 值 进一步 生成 复杂 的 景象 图 。 　 　 作者 单位 ： 张天序 华中理工大学 图象识别 与 人工智能 研究所 武汉 ； 胡礴 华中理工大学 图象 信息处理 与 智能 控制 教育部 开放 实验室 武汉 参考文献 　 　 TianxuZhangWeixueLUJiaxiongPengAdaptiveImageMatchingviaSpatialVaryingGrayLevelCorrectionIEEETransComm 　 　 XianmingXieTianxuZhangNongSangGuoyouWangTextureSegmentationUsingVisualNonlinearityMachineVisionApplicationsArchitecturesandSystemsIntelligenceSPIE 　 　 YabinXieTianxuZhangWangqingZhangUsingPhaseCorrelationBasedonEdgeforSceneMatchingInternationalConferenceonNeuralNetworksandSignalProcessingNanjingChina 　 　 WoodhamRobertJUsingDigitalTerrainDatatoModelImageFormationinRemoteSensingSPIEImageProcessingforMissileGuidance 　 　 JPKerrkesetalSimulationofOpticalRemoteSensingSystemsIEEETransGRS 　 　 RCAngusetalSunPositionforDaylightModelPreciseAlgorithmsforDeterminationLightResTechnology 　 　 DALandgrebeandERMalaretNoiseinRemoteSensingSystemsTheEffectonClassificationerrorIEEETransGRS 　 　 AHStrahleretalOntheNetureofModelsinRemoteSensingRemoteSensingofEnvironment 　 　 TYLeeetalNonLambertianEffectsonRemoteSensingofSurfaceReflectanceandVefetationIndexIEEETransGRS 　 　 本 课题 得到 国防科工委 基金 的 资助 收稿 日期 年月日 修回 日期 年月日