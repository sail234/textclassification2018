计算机 工程 COMPUTERENGINEERING 年 第卷 第期 VolNo 一个 基于 IC卡 数据 采集 技术 的 区域 巡逻 监察 系统 伍卫国 　 王刊良 　 冯耕中 摘要 ： 在 保安 工作 中 ， 客观 及时 地 记录 巡逻 员工 的 工作 情况 ， 不公 有利于 对 其 工作 过程 进行 监督 ， 而且 也 有利于 管理人员 对 巡逻 员工 的 工作 绩效 作出 合理 的 评价 ， 这 对于 保安 工作 的 有效 进行 是 十分 重要 的 。 针对 一个 已经 研制成功 的 基于 IC卡 技术 的 区域 巡逻 监察 系统 ， 探讨 了 该类 系统 的 主要 作用 、 系统 的 总体设计 思路 和 目标 、 系统实施 的 技术 要点 以及 系统 的 特色 ， 同时 也 讨论 了 系统 的 应用领域 和 前景 。 关键词 ： IC卡 ； 单片机 ； 监察 系统 ； 数据 采集 ； 区域 巡逻 ARegionalPatrolMonitoringSystemBasedonICCardDataCollectionTechnologyWuWeiguoWangKanliangFengGengzhong （ ComputerDepartmentofXi ’ an ） 【 Abstract 】 ObjectivetimelyandpreciserecordingofemployeesprocessandperformanceforsecurityworkisappropriatenotonlyforthemonitoringofemployeeswordprocessbutalsofortherationalevaluationofpatrollingemployeesperformancebymanagementwhichiscrucialtotheeffectivesecurityworkThepresentpaperexploitedthemotivationsfunctionsmajordesignapproachandobjectivestechnicalknowhowinimplementationandfeaturesofsuchsysteminthecontextofadevelopedregionalpatrolmonitoringsystemPotentialaressofapplicationandfutureperspectivesweredisscussed 【 Keywords 】 ICcardSmartcardSinglechipmierocomputerMonitoringsystemDatacollectionRegionalpatroling 　 问题 的 提出 　 　 工业 制造 企业 、 货场 、 物业管理 公司 以及 其它 厂矿 等 组织 为了 对 自己 所 拥有 的 财物 进行 有效 的 保护 ， 防止 火灾 和 其它 事故 在 自己 组织 内 发生 从而 为 组织 带来 损失 ， 必须 采取有效 措施 对 所属 区域 进行 巡查 ， 监督 所属 区域 内 非正常 现象 并 进行 及时处理 。 从 这个 动机 出发 ， 大多数 有 一定 规模 的 厂家 、 货场 、 物业管理 公司 均 设置 有 保卫 部门 ， 这个 部门 的 主要职责 就是 监督 员工 是否 遵守 厂规 、 执行 防火 防盗 等 措施 ， 为 确保 正常 生产 服务 。 其中 一项 重要 的 日常 工作 是 在 厂 区内 进行 巡逻 ， 发现 不 正常 现象 并 进行 及时处理 。 但是 ， 如何 对 巡逻 员工 进行 考核 呢 ？ 尤其 是 夜间 巡逻 时 ， 若 没有 相应 的 指标 和 手段 进行 切实 考核 ， 只要 一段时间 “ 相安无事 ” ， 巡逻 员工 容易 产生 麻痹 心理 ， 无法 真正 达到 夜间 巡逻 的 目的 ； 另一方面 ， 对 主管 而言 也 很 难 正确 评价 每一 巡逻 员工 的 工作 质量 。 　 　 针对 上述 问题 ， 日本 曾经 开发 出 一种 称之为 “ 巡逻 卡钟 ” 的 便携 机械 装置 ， 其 原理 是 在 各 巡逻 要点 放置 标志 该点 的 钥匙 钥匙 上 有 两位 凸起 的 数字 编号 ， 如 “ ” ， “ 卡钟 ” 内 可 放入 一张 随 钟表 同步 转动 的 专用 纸片 上面 标有 小时 刻度 ； 巡逻 人员 持卡 钟到 厂区 各 要点 巡逻 时 ， 取下 各 要点 的 钥匙 ， 插入 卡钟 用力 转动 便 将 相应 位置 号 即 钥匙 上 的 数字 编号 记录 在 纸片 的 相应 时间 刻度 上 ； 第二天 取出 纸片 据 以 记录 巡逻 详细情况 。 上述 措施 有 许多 缺陷 ： 第一 ， 数据 记录 方式 原始 ， 需要 人工 将 原始 形式 数据 转换 为 可 阅读 的 表格 形式 ； 第二 ， 数据 记录 不 准确 ， 误差 大约 有 分钟 ； 第三 ， 规模 难以 扩展 ， 其 巡逻 要点 上限 为个 ； 第四 ， 卡钟 大约 有 kg ， 携带 起来 太重 ； 第五 ， 安全性 不好 ， 钥匙 容易 复制 ， 可能 出现 在 办公室 假 巡逻 的 情况 ； 第六 ， 该 系统 没有 设计 配套 的 上位 机 分析 处理软件 。 　 　 为了 克服 巡逻 卡钟 的 缺陷 并 达到 对 巡逻 员工 考核 管理 的 目的 ， 我们 采用 日臻成熟 的 IC卡 技术 、 单片机 技术 和 PC机 上 的 类 GIS 界面 技术开发 了 一个 区域 巡逻 监察 系统 。 　 系统 总体 分析 与 设计 系统 设计 目标 　 　 管理信息系统 MIS 的 主要 目的 在于 帮助 管理者 从 信息 方面 更 出色 地 完成 管理 的 各项任务 ， 提高 组织 的 效率 和 效能 。 巡逻 员工 监察 系统 的 设计 目标 则 是 通过 客观 地 提供 员工 工作 情况 ， 为 组织 的 “ 激励 系统 ” 提供 公正 的 、 可信 的 数据 ， 增进 上级 对 下级 的 了解 ， 进而 提高 巡逻 员工 的 积极性 、 改进 工作 态度 。 区域 巡逻 监察 系统 可 作为 对 巡逻 员工 的 “ 业绩考核 ” 工具 ， 按 考核 结果 可 科学 地 对 巡逻 员工 进行 经济 上 的 奖励 或 惩罚 、 加薪 或 晋升 等 。 因而 ， 对于 生性 懒惰 而 不 认真执行 巡逻 任务 的 员工 ， 利用 监察 系统 可 对 其 工作 过程 进行 事后 监督 ， 使 其 没有 多少 偷懒 的 机会 ； 对于 积极 认真执行 巡逻 工作 的 员工 而言 ， 该 系统 应 如实 反映 其 工作 业绩 ， 结合 激励 系统 ， 更 可 促进 其 工作 热情 和 积极性 。 总体设计 思路 和 运作 原理 　 　 系统 总体设计 思路 　 　 为了 对 巡逻 员工 尤其 是 夜间 进行 监察 ， 达到 确保 区域 安全 的 目的 ， 区域 巡逻 监察 系统 必须 准确 记录 如下 数据 ： 　 　 巡逻 员工 ， 是 甲 员工 而 不是 乙 员工 执行 巡逻 任务 ， 即 必须 核实 特定 巡逻 员工 的 身份 ； 　 　 位置 ， 巡逻 员工 途经 的 关键 位置 或 区域 要点 ； 　 　 时间 ， 巡逻 员工 什么 时候 到达 了 该 位置 ； 　 　 异常现象 ， 在 员工 巡逻 过程 中 随时 发现 的 异常情况 ， 如 漏水 、 裂缝 、 烟火 隐患 等 。 　 　 对于 巡逻 员工 的 身份 ， 采用 IC卡 进行 标识 ， 即 每 一 巡逻 员工 用 一张 IC卡 员工 卡 标识 身分 ； 而 每 一 关键 位置 也 设有 一张 IC卡 ， 称为 位置 卡 作用 同 “ 巡逻 卡钟 ” 的 钥匙 。 IC卡 具有 价格低 、 保密性 强 、 几乎 不 可能 复制 等 特点 ， 所以 ， 本 系统 采用 IC卡 进行 员工 标识 和 位置 标识 。 　 　 一般 地 讲 ， 区域 巡逻 监察 系统 应该 成为 ： 工作 指示器 ， 即 可以 由 管理人员 设定 巡岗 执勤 员工 和 巡岗 线路 ， 该 线路 是 不 固定 的 ， 每个 班次 可以 设置 不同 线路 ， 这样 有助于 杜绝 巡逻 执勤 员工 同 不法 人员 勾结 而 进行 违法活动 ， 在 工作 过程 中 ， 上岗 员工 和 巡岗 过程 都 要 按照 该项 工作 指示 来 进行 ； 工作 记录器 ， 每 到达 一个 关键 位置 ， 巡岗 员工 都 必须 及时 将 其 员工 卡 和 位置 卡 插入 便携式 数据 采集器 一种 数据 记录 设备 ， 其 作用 类似 于 巡逻 卡钟 ， 此时 到 岗 位置 、 到 岗 时间 便 自动记录 下来 ， 时间 来自 便携式 数据 采集器 的 实时 时钟 ， 同时 指定 巡岗 员工 必须 带 着 其 员工 卡 到达 各 巡岗 位置 ； 工作 考核 器 ， 巡岗 工作 结束 后 ， 管理人员 可以 依据 工作 指示 和 巡岗 员工 的 实际 工作 记录 进行 对比 分析 ， 检查 巡岗 员工 的 工作 和 区域 安全 情况 ， 这样 可以 客观 地 对 巡岗 员工 作出 业绩考核 ， 同时 杜绝 重大 隐患 问题 的 发生 。 　 　 系统 组成 及其 运作 原理 　 　 该 系统 由 两个 部分 组成 ： ① 上位 机 部分 ： 上位 机 运行 区域 巡逻 监察 系统软件 或称 上位 机软件 ； ② 硬件 部分 ： 称为 便携式 数据 采集器 或 称为 下位 机 。 　 　 ① 上位 机 部分 ： 上位 机软件 在 PC 硬件平台 上 Windows 环境 下 采用 面向对象 的 开发工具 Delphi 语言 进行 开发 。 它 一方面 提供 系统 设置 功能 ， 如 位置 点 的 设定 、 各 位置 点 检查 内容 的 设定 、 巡岗 线路 的 设定 、 异常情况 编码 的 设置 ， 同时 进行 工作 参数 如 时钟 、 每次 工作 前 的 巡岗 员工 和 巡岗 线路 的 设定 等 ； 另一方面 ， 各 关键 位置 到达 人次 情况 分析 、 员工 到达 各 关键 位置 次数 分析 、 异常情况 查询 、 员工 阶段 业绩 评价 等 。 　 　 ② 硬件 部分 ： 便携式 数据 采集器 是 一种 用 MCS 单片机 开发 的 低功耗 IC卡 读写 设备 ， 主要 功能 是 巡岗 过程 中向 员工 提供 工作 指示 并 进行 实际 工作 记录 ， 它 通过 RSC 与 上位 机 部分 相连 以 获取 工作 指示 参数 ， 并 向上 传输 实际 工作 记录 信息 ， 而 在 巡岗 过程 中 脱机 独立 使用 。 　 　 区域 巡逻 监察 系统 的 运作 过程 如图所示 。 图 区域 巡逻 监察 系统 的 运作 过程 示意图 　 　 运作 过程 说明 如下 。 　 　 · 上班 前 ， 管理人员 将 值班 巡逻 员工 、 巡逻 路线 等 参数 从 上位 机 PC机 利用 RSC 接口 设置 到 便携式 数据 采集器 中 ， 只有 管理人员 才能 有效 操作 该 数据 采集器 ； 　 　 · 上班 时 ， 值班 巡逻 员工 到 办公室 领取 一个 数据 采集器 ， 按 数据 采集器 提示 依次 到 各 巡逻 要点 巡查 ， 并 将 自己 的 员工 卡 和 相应 位置 卡 按 提示 插入 到 该 便携式 数据 采集器 中 进行 信息 记录 ； 　 　 · 下班 后 ， 巡逻 员工 将 便携式 数据 采集器 交回 办公室 管理人员 处 并 一同 拿到 上位 机 利用 RSC 将 巡逻 过程 数据 传到 上位 机以 进行 分析 和 处理 。 　 　 在 上位 机软件 设计 方面 ， 除了 考虑 同 下位 机 数据通信 之外 ， 更 重要 的 是 区域 巡逻 结构 的 设置 如 关键 位置 、 巡查 内容 、 巡逻 路线 等 以及 对 员工 巡逻 过程 数据 的 进一步 分析 处理 。 对 用户 而言 ， 该软件 的 一项 主要 指标 是 应 具备 良好 的 交互 能力 。 由于 该 系统 涉及 到 区域 上 的 点 和 线 ， 在 区域 平面图 上 进行 位置 点 和 线路 操作 并 进行 信息 对比 分析 是 有利于 用户 操作 的 ， 因此 采用 类 GIS 界面 技术 进行 系统 开发 是 十分必要 的 。 　 上位 机软件 的 实施 要点 　 　 上位 机软件 应有 较强 的 交互 能力 ， 必须 具有 类似 GIS 那样 的 交互式 界面 ， 基于 此 ， 采用 面向对象 的 Delphi 语言 开发 了 这样 一个 专用 的 类 GIS 界面 ， 界面 的 友好 性 表现 在 如下 几个 主要 方面 ： 　 　 菜单 和 快捷 按钮 均 可 提供 同等 效果 的 功能 ； 　 　 鼠标 点 一下 窗口 中 任一 对象 如 关键 位置 点 、 线路 中 的 线段 、 地图 等 均 可 给出 相应 对象 的 信息 ； 　 　 上下文 敏感 的 联机帮助 系统 ； 　 　 图形 信息 显示方式 和 表格 信息 显示方式 并存 ； 　 　 图形 分析 方式 下 查询 结果显示 在 相关 的 位置 点上 ， 便于 信息 的 对比 分析 。 　 　 该类 GIS 界面 实现 的 基本思路 是 ： 将 某 区域 平面图 的 BMP 文件 作为 窗口 的 背景 Image ， 关键 位置 和 线路 线段 作为 其中 的 对象 动态 生成 ， 位置 和 线路 由 专门 的 地理信息 表 存放 ， 从而 构成 了 区域 巡逻 系统 的 基本 框架 ， 无论是 设置 关键 位置 、 线路 等 还是 查询 巡逻 信息 均 可 只用 鼠标 在 区域 平面图 上 轻松 完成 。 在 上述 工作 的 实施 过程 中 ， 关键 解决 了 如下 个 问题 ： 　 　 利用 Delphi 开发 了 表示 巡逻 关键 位置 的 部件 称之为 位置 部件 ， 它 是 以 现有 的 TShape 部件 导出 ， 增加 了 CaptionFontBrush 等 属性 而成 。 　 　 利用 动态 数组 实现 了 动态 生成 位置 部件 的 功能 ， 在 生成 位置 部件 的 同时 ， 设置 该 部件 相应 的 事件处理 能力 。 　 　 利用 Delhpi 的 Canvas 画布 功能 实现 了 线路 的 方向 化 ， 给出 巡逻 路线 方向 的 标识 。 　 　 应用 图论 算法 对 所 设置 巡逻 路线 进行 有效性 检查 ， 经过 仔细分析 ， 发现 巡逻 路线 从 设置 和 实际 行走 方面 均 属 欧拉 图 ， 因而 在 实施 过程 中 利用 一 笔画 算法 对 所 设置 的 线路 线段 顺序 进行 排序 ， 从而 使 巡逻 线段 的 行走 顺序 同 设置 顺序 无关 。 　 　 用 Delphi 开发 了 字模 传输 程序 。 由于 便携式 数据 采集器 用作 工作 指示器 ， 用 编码 来 指示 巡逻 位置 难于 记忆 、 也 不 明确 ， 所以 采用 了 汉字 来 指示 。 但是 ， 下位 机 容量 十分 有限 ， 不 可能 存放 所有 甚至 是 常用 汉字 的 字模 。 因而 ， 在 设置 巡逻 路线 和 有关 参数 的 同时 ， 将 各 巡逻 位置 的 汉字 描述 的 汉字 字模 传输 到 下位 机 。 　 下位 机 的 实施 要点 　 　 下位 机 的 主要 功能 是 进行 数据 采集 。 在 数据 采集 过程 中 ， 第一 ， 它 必须 对 员工 身份 卡 进行 确认 ， 以便 确认 该 员工 是 上位 机所 设置 的 巡逻 员工 而 不是 其它 员工 ； 第二 ， 它 必须 阅读 位置 卡以 记录 相应 员工 到达 相应 位置 的 位置 编号 及 到达 时间 ； 第三 ， 为了 保证 巡逻 的 安全性 ， 巡逻 员工 不可 预先 知道 自己 确切 的 巡逻 路线 ， 因而 只 随时 提供 下一待 巡逻 位置 而 非 所有 巡逻 位置 的 汉字 描述 查询 ； 第四 ， 巡逻 员工 在 巡逻 过程 中 发现异常 要 能够 记录下来 。 此外 下位 机 还 包括 同 上位 机 的 通信 功能 ： 第一 ， 接收 上位 机 传送 来 的 巡逻 参数 ， 由于 下位 机 没有 硬 汉字 字库 ， 因而 有关 巡逻 描述 等 汉字 信息 要 传至 下位 机 ， 下位 机在 巡逻 位置 查询 时 显示 这些 点阵 汉字 ； 第二 ， 将 巡逻 过程 的 工作 记录 传 至上 位机 ， 这些 信息 包括 ： 巡逻 员工 、 到达 各 位置 的 位置 编号 和 时间 等 。 为了 满足 上述 功能 ， 我们 用 MCS 系列 单片机 开发 了 一个 低功耗 的 手持 数据 采集器 。 图 概括 了 下位 机 硬件 组成 ， 系统 包括 ATMEL 公司 的 内置 kFlash 的 ATC 单片机 、 程序 存储器 ATC 、 数据 存储器 选用 了 两片 韩国 高士达 公司 的 C 、 实时 时钟 NEC 公司 的 uPD 、 LCD 显示 模组 选用 了 新 日电 公司 的 模组 、 KEYPAD 接口 个键 、 IC卡 接口 可 读写 ATMEL 、 Simens 公司 的 各种 加密 IC卡 、 光笔 接口 能接 解码 、 未 解码 光笔 、 RSC 接口 、 电源 分配 及 检测 电路 等 。 在 硬件 设计 过程 中 关键 解决 了 如下 几个 问题 。 图 下位 机 硬件 组成 虚线 代表 各 模块 的 供电 回路 　 　 低功耗 ： 为了 获得 低功耗 特性 采取 了 如下 技术 ： 第一 ， 全部 采用 了 CMOS 的 芯片 ； 第二 ， 充分利用 了 芯片 提供 的 节电 功能 ， 最大 限度 地 利用 它们 的 维持 Standby 状态 ； 第三 、 采用 模块化 供电 ， 即 根据 工作 需要 接通 相应 功能模块 的 电源 。 例如 ， 进行 通信 操作 时 ， 才 给 RS 接口 接通 电源 ， 结束 通信 ， 立即 切断 电源 ； 第四 、 充分利用 单片机 提供 的 闲置 、 掉电 工作 方式 ； 第五 、 选用 较 低 频率 的 晶振 ， 经验 表明 ， 频率 降低 MHz ， 单片机 电流 可以 减少 mA 。 　 　 可靠性 ： 采用 两级 供电 ， 电源 异常 检测 等 措施 。 　 　 微型化 ： 所有 芯片 都 采用 表面 封装 元件 。 　 　 友好 性 ： 采用 点阵 液晶 显示器 显示 汉字 界面 ， 可 同时 显示 个 X 点阵 的 汉字 ； 由于 采用 了 软字库 技术 ， 故 可以 显示 简 、 繁体 汉字 和 特殊符号 。 　 　 可编程 ： 为了 方便 程序修改 和 提供 用户 二次开发 功能 ， 系统 采用 Flash 芯片 C 作为 用户 可编程 程序 存储器 部分 ， 核心 程序 部分 放在 单片机 ATC 中 。 　 　 可 扩展 ： 电路设计 时 预留 了 光笔 接口 模块 ， 使 数据 采集器 能 满足 基于 条形码 方面 的 数据 采集 。 　 结束语 　 　 本 系统 已 在 广东省 东莞市 几家 独资企业 正式 投入 运作 。 从 运行 效果 来看 ， 已 达到 最初 的 预期 效果 ， 劳资 各方 均 感到 比较满意 ， 该 区域 巡逻 监察 系统 对于 管理人员 来讲 ， 可 有效 地 帮助 其 监察 下属 员工 执行 巡逻 任务 的 过程 ； 对 执行 巡逻 任务 的 下属 而言 ， 可 如实 记录 其 工作 的 全程 ， 有利于 反映 其 工作 成果 。 另外 ， 该 系统 不同于 现场 监控 系统 ， 现场 监控 系统 利用 摄象 系统 将 员工 的 所有 工作 细节 记录下来 ， 有 干涉 员工 隐私 privacy 之 嫌 ， 从 人 的 社会性 方面 而言 是 不利 的 。 前者 为了 获取 可信 的 数据 则 是 利用 IC卡 技术 对 工作 过程 中 的 某些 关键点 进行 采样 ， 事后 进行 分析 处理 因而 没有 干涉 员工 的 私有 性 ， 所以 从 社会性 角度看 ， 也 是 没有 多少 弊端 的 。 虽然 该 系统 是 在 一 独资 制造 企业 开发 成功 并 投入 正常 运行 的 ， 但 由于 该 系统 具有 适用 面广 、 价格低廉 、 可靠性 高 、 使用方便 等 特点 ， 无疑 会 在 如下 领域 获得 广泛应用 ： 　 　 工业 制造 企业 的 厂区 巡逻 ； 　 　 码头 、 铁路 等 货场 的 巡逻 ； 　 　 物业管理 公司 的 区域 巡逻 ； 学校 及 军事基地 的 区域 巡逻 ， 等等 。 　 　 现实 世界 千变万化 ， 一个 产品 要 想 完全 满足 各方 用户 的 要求 是 非常 困难 的 。 为了 进一步提高 该 系统 的 适用性 ， 我们 拟 对 该 区域 巡逻 监察 系统 进行 如下 进一步 的 工作 ： 首先 ， 在 上位 机软件 方面 增加 更为 强有力 的 分析 功能 并 利用 GIS 工具 如 MAPINFO 实现 区域 分层 化 ； 其次 ， 在 硬件 方面 将 进一步 研制 微型化 的 便携式 数据 采集器 。 基金项目 ： 国家自然科学基金 青年 基金 （ ） 作者简介 ： 伍卫国 （ ～ ） ， 男 ， 在职 博士生 ， 主要 从事 计算机控制 、 计算机网络 方面 的 研究 开发 工作 作者 单位 ： 西安交通大学 电信 学院 计算机系 ， 西安 参考文献 黄种 杰 编著 管理学 基础 北京 ： 经济科学出版社 ， 周鸿伟 面向 企业 管理 超媒体 GIS 开发 平台 的 设计 与 实现 硕士学位 论文 西安 ： 西安交通大学 ， 张育荣 曾彦贺 编著 Delphi 从 入门 到 精通 北京 ： 清华大学出版社 费培 之 编著 图 和 网络 及其 应用 成都 ： 四川大学 出版 于 红军 赵冬艳 编著 智能 IC卡 技术 全书 北京 ： 电子 工业 出版社 收稿 日期 ：