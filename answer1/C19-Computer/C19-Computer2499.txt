软件 学报 JOURNALOFSOFTWARE 　 Vol 　 No 　 P 基于 Web 和 数据库 的 网络 管理系统 的 设计 与 实现 段海新 　 杨家 海 　 吴建平 　 摘要 　 提出 了 一个 基于 Web 和 关系数据库 的 网络 管理系统 的 管理 模型 并 描述 了 一个 基于 该 模型 的 网络 管理系统 — — SuperDomain 的 组成 结构 及其 具体 实现 机制 讨论 了 系统 实现 中 的 关键技术 问题 及其 解决 方法 其中 包括 管理 信息 的 存储 模型 、 数据 一致性 维护 、 基于 Web 的 实时 告警 机制 、 系统安全 机制 等 　 关键词 　 计算机网络 网络管理 Web 管理 信息 模型 安全 机制 　 中图法 分类号 　 TPDesignandImplementationofaNetworkManagementSystemBasedonWebandDatabaseDUANHaixin 　 YANGJiahai 　 WUJianping （ NetworkResearchCenterTsinghuaUniversityBeijing ） Abstract 　 　 AmanagementmodelisproposedforthenetworkmanagementsystembasedonWebandrelationaldatabaseinthispaperWiththismodelthecomponentsandimplementationofamanagementsystemSuperDomainaredescribedSomekeyproblemsandtheirsolutionswhichincludethestoragemodelofmanagementinformationthemaintenanceofdataconsistencythemechanismofrealtimealarmingbasedonWebandthemechanismofsystemsecurityarealsodiscussedKeywords 　 ComputernetworknetworkmanagementWebmanagementinformationmodelsecuritymechanism 　 　 计算机网络 的 复杂性 和 异构 性 使得 网络管理 问题 上升 到 网络 建设 的 战略性 地位 国内外 许多 学术 机构 、 企业 和 标准化 组织 在 网络管理 技术 方面 都 做 了 大量 的 工作 ［ ～ ］ Web 技术 的 发展 使 网络管理 模式 从 规模 系统 趋向 单元 结构 使得 直接 面向 应用 的 网络 管理系统 的 开发 已经 变得 相对 容易 而 传统 的 平台式 网络管理 厂商 的 优势 地位 不再 明显 基于 Web 的 网络管理 已经 成为 当前 技术 研究 和 产品开发 的 热点 如 Advent 公司 的 NetMonitor ［ ］ 和 IBM 公司 的 WebBin 系统 ［ ］ 但是 由于 基于 Web 管理模式 下 的 许多 问题 如 安全 问题 、 实时 告警 问题 等 未能 很 好 地 得到 解决 而且 受 传统 的 管理 平台 体系结构 的 制约 现有 的 商品化 管理系统 如 HPOpenViewIBMNetView 等 基于 Web 的 管理 能力 往往 仅限于 静态 信息 的 浏览 另外 平台式 网络管理 产品 中 往往 只 提供 网络 的 配置管理 、 故障 管理 和 性能 管理 功能 对于 我国 网络 建设 最为 迫切 的 计费 管理 和 安全 管理 功能 却 很少 实现 或 根本 没有 　 　 在 国家 “ 九五 ” 科技 攻关项目 “ 先进 网络管理 与 运行 技术 ” 的 资助 下 结合 中国 教育 与 科研 网络管理 中心 多年 的 运行 管理 经验 我们 研究 和 开发 了 一个 直接 面向 大规模 网络管理 应用 的 、 完全 基于 Web 和 数据库 的 网络 管理系统 — — SuperDomain 实现 了 网络 的 配置 、 性能 、 故障 、 安全 和 计费 的 基本 管理 功能 本文 介绍 该 系统 基于 Web 和 数据库 的 管理 模型 及其 总体 结构 并 着重 介绍 实现 中 的 关键技术 问题 及其 解决 方法 主要 包括 被 管 对象 管理 信息 的 存储 模型 和 数据库 一致性 维护 、 基于 Web 的 实时 告警 机制 和 安全 机制 等 最后 给出 该 系统 与 其他 网络 管理系统 相 比较 的 特点 　 系统 总体 结构 　 　 系统 总体 结构 如图所示 数据 采集 模块 读取 被 管 对象 路由器 、 交换机 、 主机 、 应用服务 等 状态 信息 和 各种 运行 参数 存储 在 关系数据库 中 由 各个 功能模块 共享 对象 操作 模块 通过 修改 被 管 对象 的 属性 来 控制 和 调整 网络 的 运行 系统配置 与 维护 模块 负责 整个 网络管理 服务器 系统 的 配置 包括 用户 管理 、 被 管 对象 的 界定 、 数据 采集 任务 的 管理 、 阈值 的 定义 等等 各 功能模块 之间 通过 内部 消息传递 机制 传递 控制 信息 通过 数据库 交换 数据 管理员 通过 Web 浏览器 访问 网络 管理系统 进而 监控 整个 网络 下面 简单 介绍 各个 模块 的 功能 及其 工作 方式 FigThearchitectureofSuperDomain 图 　 SuperDomain 网络 管理系统 总体 结构 　 　 配置管理 模块 配置管理 包括 以下 步骤 ： 自动 发现 被 管 对象 、 配置 信息 获取 与 查询 、 自动 构造 和 编辑 拓扑图 以及 配置 信息 的 修改 更新 配置管理 模块 首先 通过 自动 发现 初始化 数据库 中 的 被 管 对象 集合 收集 、 分析 配置 信息 如 接口 参数 、 路由表 等 并 以 结构化 的 形式 存储 在 数据库 中 然后 ， 根据 被 管 对象 的 配置 信息 特别 是 互连 设备 的 配置 构造 网络拓扑 图 由于 自动 布局 产生 的 拓扑图 极其 复杂 、 庞大 我们 实现 了 拓扑图 的 编辑 功能 可以 用 层次结构 来 组织 被 管 对象 系统 向 管理员 提供 被 管 对象 的 基本 配置 工具 如 配置 路由器 的 接口 参数 、 路由 协议 等 信息 保持 网络 管理系统 数据库 与 被 管 对象 配置 信息 的 一致性 是 对象 操作 需要 解决 的 关键问题 本文 在 第节 中 给出 了 一致性 问题 的 一种 解决办法 　 　 性能 管理 模块 性能 管理 模块 从 数据库系统 读取 被 管 对象 的 相关 数据 如 线路 的 流量 、 丢 包率 和 延迟 主机 或 路由器 的 负载 、 存储介质 的 利用率 等 对 超过 系统 性能 阈值 的 参数 向 管理员 告警 ； 对 各种 性能参数 系统生成 不同 时间 粒度 的 性能 曲线图 以 反映 网络 当前 的 使用 情况 和 历史 发展趋势 系统分析 网络流量 数据 用饼 形图 反映 网络 中 各种 应用服务 所 占 的 比例 用 直方图 反映 线路 流量 的 分布 和 通断 统计 情况 以 分析 网络 的 利用率 和 可用性 生成 性能 监测 报告 　 　 故障 管理 模块 故障 管理 模块 过滤 数据 采集 模块 转发 来 的 事件 并 根据 事件 之间 的 联系 归并到 故障 卡片 troubleticket 把 需要 处理 的 故障 向 管理员 告警 系统 提供 一整套 基于 Web 的 排错 工具 和 排错 向导 能够 使 管理员 有效 地 定位 和 排除故障 系统 自动记录 管理员 的 所有 排错 动作 使 事件 － 故障 － 处理 形成 一个 整体 流程 　 　 安全 管理 模块 安全 管理 模块 的 功能 体现 在 网络 管理系统 本身 的 安全 和 被 管 对象 的 安全 两个 方面 系统 提供 用户 认证 、 访问控制 、 数据传输 和 存储 的 保密 机制 并 通过 维护 系统日志 使 管理员 对系统 的 使用 和 对 被 管 对象 的 修改 有据可查 对于 被 管 对象 的 安全 管理 本 系统 实现 了 个 方面 的 功能 ： 一个 是 通过 管理 防火墙 或 网关 路由器 的 访问 来 控制 链表 控制 对 网络资源 的 访问 ； 另 一个 是 接收 与 被 管 对象 安全 相关 的 事件报告 如 SNMP 认证 失败 ； 再 一个 是 定期 探测系统 的 安全漏洞 ， 并 给出 补救 建议 　 　 计费 管理 模块 针对 计费 管理 的 需要 数据 采集 模块 本 系统 使用 了 一台 微机 在 网络 出口处 监听 、 记录 所有 进出 流量 归并 、 整理 后 存入 数据库 计费 管理 模块 计算 联网 用户 的 网络流量 根据 定义 的 计费 政策 计算 相应 的 网络 费用 并 通过 浏览器 向 联网 用户 提供 远程 查询 界面 SuperDomain 系统 可以 同时 输入 多套 计费 政策 管理员 可以 比较 同一 计费数据 在 不同 政策 下 的 计算结果 进而 为 计费 决策 提供 支持 　 管理 信息 的 存储 模型 及 数据 一致性 　 管理 信息 的 存储 模型 　 　 管理 信息结构 SMI ［ ］ 所 定义 的 树形 结构 的 管理 信息库 MIB 只是 逻辑 概念 上 的 数据库 各 被 管 对象 的 管理 信息库 在 内部 的 实现 和 存储 形式 对外 是 透明 的 要 完成 管理 信息 在 关系数据库 中 的 集中 存储 首先 要 解决 的 问题 是 存储 模型 的 转换 目前 可用 的 信息 模型 有 两种 一种 是 面向对象 模型 OO 另 一种 是 实体 关系 模型 ERSNMP 的 MIB 是 一个 逻辑 上 的 树形 结构 并 不是 面向对象 模型 因为 它 没有 类 的 概念 只是 以 层次结构 组织 的 变量 的 集合 实体 关系 模型 可以 很 好 地 表示 被 管 对象 之间 的 包容 containment 关系 而且 这种 模型 很 容易 在 目前 比较 成熟 的 关系 数据库系统 中 实现 由于 MIB 中 变量 的 标识符 只 在 一个 被 管 对象 中是 唯一 的 为 表示 不同 被 管 对象 的 某个 MIB 变量 还 需要 引入 一个 唯一 的 被 管 对象 标识符 objectID 　 　 对图 中 MIB 树形 结构 的 数据 我们 建立 如图所示 的 实体 关系 图子 树 subtree 如 system ， interface ， ip 等 下 的 标量 可以 作为 被 管 对象 的 属性 而 对于 向量 即 table 需要 另建 一种 实体 该 实体 与 被 管 对象 的 关系 由 objectID 来 联系 FigSUMPMIBtree 图 　 SUMPMIB 树 FigEntityRelationshipmodelofMIB 图 　 MIB 信息 实体 关系 模型 　 数据 一致性 的 维护 　 　 存储 在 网络管理 服务器 上 的 管理 信息 应该 与 相应 被 管 对象 的 状态 保持一致 当 被 管 对象 状态 或 配置 发生变化 时 必须 立即 更新 网络管理 数据库 然而 要 实现 严格 的 数据 一致性 是 很 困难 的 一方面 由于 网络 本身 的 延迟 同时 修改 数据库 和 被 管 对象 的 原语 操作 不 可能 实现 另一方面 无法 防止 管理员 不 经 网络 管理系统 而 直接 修改 被 管 对象 的 配置 这些 都 是 引起 数据 不一致性 的 主要 原因 我们 通过 两种 办法 来 解决 数据 的 一致性 问题 首先 网络 管理系统 修改 管理 信息 遵循 以下 步骤 ： 　 　 先 锁定 数据库 的 相关 字 段 这时 ， 如果 其他 进程 也 要 访问 同一 字段 就 必须 等待 ； 　 　 系统 修改 数据库 之后 触发 对象 操作 模块 形成 特定 对象 的 操作命令 序列 来 操作 被 管 对象 　 　 如果 对象 操作 模块 返回 失败 信息 则 恢复 对 数据库 的 修改 否则 直接 执行 步骤 ； 　 　 解锁 数据库 　 　 其次 系统 定期 轮询 被 管 对象 的 配置 信息 并 与 数据库 内容 相 比较 如果 发现 不 一致 之处 便 通知 管理员 由 管理员 决定 是 更新 数据库 还是 恢复 被 管 对象 的 配置 　 基于 Web 的 实时 告警 机制 　 　 Web 是 一种 以拉 pull 为主 的 技术 即 一般 只有 当 用户 主动 请求 服务器时 才能 返回 信息 但 网络管理 要求 对 网络 中 出现 的 各种 事件 的 实时 响应 需要 服务器 系统 在 发现 网络故障 后 主动 、 实时 地向 浏览器 上 的 管理员 发送 告警信息 HTTP 协议 本身 的 功能 对此 略显 不足 这 也 是 基于 Web 的 网络管理 的 主要 约束 之一 　 　 目前 实现 Web 服务器 主动 向 浏览器 发送数据 的 技术 主要 有种 ： ClientPullServerPush 和 JavaAppletClientPull 技术 由于 实现 简单 目前 使用 较为 普遍 浏览器 以 一定 的 周期 访问 服务器 用 检查 有无 新 事件 的 发生 如果 周期 太长 则 事件 的 延迟 太 大 ； 如果 周期 太短 则 不仅 会 给 系统 增加 负担 还会 增加 网络 开销 　 　 我们 在 实现 中 考察 了 后 两种 技术 ServerPush 是 一种 CGI 编程技术 由 Web 服务器 派生 一个 进程 执行 一个 NPHnonparseheader 的 CGI 程序 与 浏览器 建立 一个 TCP 连接 这样 各 功能模块 产生 的 告警信息 通过 内部 消息传递 、 广播 给 各 NPH 进程 由 这些 进程 Push 给 浏览器 ServerPush 实现 的 优点 是 NPH 进程 运行 在 服务器 对 客户 浏览器 的 要求 较 少 但是 因为 服务器 要 为 每个 浏览器 派生 一个 NPH 进程 这 就 加重 了 服务器 的 负担 　 　 JavaApplet 实现 的 告警 机制 可以 有效 地 平衡 客户 与 服务器之间 的 负载 因为 JavaApplet 运行 在 客户端 浏览器 上 每个 Applet 与 服务器 上 的 消息传递 守护 进程 建立 一个 TCP 连接 在 消息传递 进程 收到 各 功能模块 的 告警 事件 后 ， 通过 JavaApplet 向 管理员 报告 可以 看出 JavaApplet 的 实现 把 告警 事件 的 处理 交给 了 浏览器 其 缺点 是 要求 浏览器 必须 能够 支持 Java 　 　 为了 避免 由于 Java 版本升级 而 造成 的 版本 不 一致 问题 我们 在 系统 中 使用 了 ServerPush 技术 实践证明 这种 方式 由于 运行 效率高 而 实时性 更强 　 系统安全 机制 　 　 网络 管理系统 自身 的 安全可靠 对 网络 的 正常 运行 至关重要 因为 网络管理 服务器 存储 着 重要 的 管理 信息 和 强有力 的 管理工具 不幸 的 是 基于 Web 的 管理 给 网络管理 带来 了 新 的 不 安全 因素 因为 Web 应用 的 平台 独立性 和 地理 无关 性 使得 任何人 、 从 任何 地方 都 可能 访问 网络管理 服务器 为此 我们 利用 以下 安全 技术 来 保证 网络 管理系统 的 安全 ： 基于 证书 的 用户 认证 、 DES 数据 加密 存储 、 SNMPv 和 SSL 协议 数据 保密 传输 、 基于 用户组 和 访问控制 链表 的 访问控制 各种 机制 之间 的 关系 如图所示 FigSecuritymechanismsofSuperDomainsystem 图 　 系统安全 机制 　 　 Web 界面 是 网络 管理系统 唯一 的 访问 点 系统对 用户 的 认证 是 由 Web 服务器 完成 的 由于 用户名 口令 认证 机制 的 众所周知 的 弱点 我们 在 浏览器 与 服务器之间 使用 了 安全套 接字 协议 SSL 利用 SSL 基于 公开密钥 的 证书 来 认证 系统 用户 为此 我们 维护 一个 独立 的 CAcertificateauthority 为 网络管理 服务器 和 每个 用户 签发 证书 除了 认证 以外 SSL 还 保证 了 浏览器 与 服务器之间 数据传输 的 保密性 与 完整性 　 　 用户 即 管理员 按照 角色 的 不同 分成 不同 的 用户组 每个 用户组 中 的 用户 具有 相同 的 权限 ， 只有 具备 足够 权限 的 用户 才能 执行 相应 的 操作 如读 、 修改 、 增加 或 删除 用户 对 被 管 对象 的 操作 可用 以下 三元组 来 表示 ： 〈 用户组 GID 对象 OID 操作 模式 〉 系统 查找 用户 所在 的 用户组 然后 查找 系统 访问控制 表以 检索 用户 对 该 对象 的 操作 权限 来 决定 是否 允许 访问 　 　 对于 支持 SNMPv 的 设备 被 管 对象 与 网络管理 服务器之间 使用 SNMPv 通信协议 在 配置 了 party 和 认证 密钥 以后 SNMPv 利用 KeyedMD 来 认证 数据源 的 可靠性 和 数据完整性 防止 了 假冒 和 篡改 类型 的 攻击 其次 对于 采集 来 的 敏感 信息 我们 使用 DES 加密算法 加密 之后 存储 在 数据库 中 　 系统 应用 情况 及 特点 　 　 SuperDomain 网络 管理系统 在 年初 通过 了 由 科技部 委托 、 教育部 组织 的 技术鉴定 认为 该 系统 达到 同类 网络 管理系统 的 国际 先进 水平 目前 该 系统 在 CERNET 网络 运行 中心 NOC 长期 运行 管理 CERNET 国家 骨干 网络 多台 路由器 和 管理中心 台 服务器 与 我们 以前 使用 的 IBMNetView 版本 相比 该 系统 有 以下 优点 ： 　 　 全中文 的 Web 界面 集成 了 本 系统 所有 的 网络管理 功能 ； 　 　 实现 了 流量 计费 管理 功能 对 同一 流量 数据 可以 应用 多个 计费 策略 为 计费 决策 提供 支持 ； 　 　 实现 了 管理系统 本身 的 安全 机制 并 实现 了 部分 安全 管理 功能 ； 　 　 故障 管理 功能 融入 了 我们 的 运行 管理 经验 提供 了 从 故障 监测 到 故障 定位 和 故障 修复 全过程 的 半自动 管理 流程 并 提供 了 一般 故障 的 排错 向导 wizard 　 　 增强 了 环境 的 定制 能力 因为 系统 实现 以 CGI 技术 为主 增加 新 应用 只 需 开发 相应 的 CGI 模块 即可 无需 改动 整体 结构 和 其他 功能模块 　 今后 的 工作 　 　 由于 开发 时间 较 短 系统 还 存在 着 一些 不足 从 体系结构 上 看 下 一步 我们 计划 将 目前 的 集中式 管理 扩展 成多 管理者 的 分布式 管理 结构 以 增强 系统 的 可扩展性 在 故障 管理 中 我们 正在 引入 人工智能 技术 实现 故障 自动 定位 对于 安全 管理 我们 计划 增加 网络 入侵 检测 的 能力 实现 网络安全 控制 与 检测 的 结合 增强 系统对 安全事件 的 实时 响应 能力 段海新 （ 清华大学 信息网络 工程 研究 中心 　 北京 　 ） 　 杨家 海 （ 清华大学 信息网络 工程 研究 中心 　 北京 　 ） 　 吴建平 （ 清华大学 信息网络 工程 研究 中心 　 北京 　 ） 参考文献 ， CaseJDFedorMSchoffstallMLetalSimplenetworkmanagementprotocolSNMPRFChttpwwwietforgrfcrfctxt ， DavinJGalvinJMcCloghrieKSNMPadministrativemodelRFChttpwwwietforgrfcrfctxt ， BlackUNetworkManagementStandardsSNMPCMIPTMNMIBsandObjectLibrariesNewYorkMcGrawHill ， SunMicrosystemsIncJavamanagementAPIarchitectureTechnicalReporthttpjavasuncomproductsJavaManagementoverviewhtml ， ObjectManagementGroupTheCommonObjectRequestBrokerArchitectureandSpecificationftpftpomgorgpubdocsformalpdf ， AdventNetIncAdventNetNetMonitor — — abuildertooltocreateappletsthatmonitorandcontrolSNMPdevicesTechnicalReporthttpadventnetcomproductsnetmonitorindexhtml ， IBMIncWebbin — — aplatformindependentpluginforWebserversTechnicalReporthttpwwwalphaworksibmcomformulawebbin ， IETFSNMPvWorkingGroupStructureofmanagementinformationforSNMPvRFChttpwwwietforgrfcrfctxt