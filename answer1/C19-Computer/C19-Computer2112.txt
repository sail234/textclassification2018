计算机 工程 COMPUTERENGINEERING 年 第卷 第期 volNo 基于 动态 分割 与 合上 的 排样 算法 文贵华 　 丁 月华 　 　 如何 合理 地 在 原 矩形 板材 上 切割 给定 规格 的 矩形 零件 ， 以 提高 原 板材 的 利用率 是 一个 有 重大 经济 意义 的 课题 。 许多 工业 问题 如 钢板 、 玻璃 、 卷纸 等 的 切割 均 属 此类 矩形 件 排料 问题 ， 属 典型 的 组合 优化 问题 ， 具有 很 高 的 计算 复杂性 NP 完全 问题 。 因此 对 规模 较大 的 排料 ， 不但 手工 排样 不 可能 做到 真正 的 优化 ， 即使 采用 计算机 也 必须 开发 高效 的 算法 才能 实现 利用率 相对 高 的 优化 切割 。 目前 的 切割 算法 有多类 ， 如 早期 的 线性规划 算法 和 动态 规划 算法 ， 它们 存在 的 主要 问题 是 计算 时间 和 空间 呈 指数 增长 ， 并且 假定 供 排料 的 矩形 件 总数 是 无限 的 那么 实际上 算法 是 不可 用 的 。 启发式 算法 是 对 动态 规划 算法 的 改进 ， 其 效率 完全 依赖于 启发 函数 的 定义 ， 难以 调和 计算 时间 与 材料 利用率 之间 的 矛盾 。 具有 类比 学习 的 排料 算法 虽然 引入 了 重要 的 类比 学习 思想 ， 可 逐渐 减少 系统 的 排料 时间 。 但 系统 没有 自动 从 排料 经验 中 学习 的 能力 ， 系统 学习 是 通过 人机交互 式 完成 的 ， 模式 排料 的 利用率 极大 地 依赖于 专家 的 能力 ， 但是 对 规模 较大 的 排料 ， 专家 排样 本身 都 不 可能 做到 真正 的 优化 。 特别 是 这些 算法 都 只 实行 二维 切割 而 没有 进行 必要 的 余料 合并 ， 因此 会 产生 很多 分散 的 不能 排样 的 余料 碎片 ， 不但 大大降低 了 材料 的 利用率 ， 而且 极大 地 影响 了 切割 速度 。 因此 本文 提出 了 一种 基于 动态 分割 与 合一 的 优化 排样 算法 ， 优化 排样 的 目的 是 根据 给定 待排 零件 对 板材 进行 最优 切割 使得 板材 的 利用率 尽可能 的 高 。 排样 模型 　 　 假定 每次 排料 总是 将 零件 排 在 板材 LW 的 左上角 ， 并且 将 板材 和 零件 都 置于 一个 坐标 平面 ， 则 此 矩形 零件 liwi 在 板材 上 的 位置 可 由 其 左上角 坐标 xiyi 和 排料 方式 m 完全 确定 。 排样 过程 就是 根据 寻优 规则 ， 确定 每个 零件 在 板材 的 左上角 坐标 xiyi 、 排料 方式 mi 竖排 或 横排 以及 切割 方式 ci 竖切 或 横切 。 因此 排料 模式 S 有种 不同 的 组合 ， 再 加上 不排 所 选择 的 零件 ， 共类 模式 ， 如图 。 不同 模式 决定 了 板材 余料 的 坐标 和 后继 的 排料 效率 。 但 无论 哪 种 模式 ， 切割 后 的 余料 只有 两种 。 因此 排样 过程 就是 与 或 树 的 搜索 过程 。 此 与 或 树 或 结点 是 确定 排样 模式 ， 如图 的 N 结点 。 与 结点 是 某 排样 模式 的 余料 分割 如图 的 M 结点 。 而 排样 结果 则 是 一棵 典型 的 二叉树 如 NMKL 。 图 排样 与 或 树 　 　 与 或 树 搜索 过程 具有 很 高 的 复杂度 ， 属 NP 完全 问题 ， 因此 零件 及 排样 模式 的 选择 必须 采用 启发 算法 。 　 　 算法 零件 选择 算法 　 　 传统 算法 均 采用 零件 的 面积 为 排样 的 启发 信息 ， 即 越大越 优先 ， 这 比较 符合 直觉 ， 但 实际 应用 中 还 存在 着 一些 重要 件 要 优先 切割 ， 而且 面积 越大 不 一定 材料 利用率 就 越 高 。 实际 应用 零件 的 选取 应 遵循 这样 的 原则 ： 大件 、 重要 件 优先 ； 可望 取得 较 高 的 材料 利用率 。 因此 定义 如下 的 零件 选择 启发 函数 ： 　 　 fiGiGiiGikiSQiSK 　 　 fi 越大越 优先 。 其中 Gi 是 零件 Pi 单独 在 原 板材 上排 样时 的 利用率 。 SQi 是 Pi 面积 ， S 是 原 板材 面积 。 K 是 可选 参数 ， 初 定为 ， 以后 可 根据 实际 情况 修正 。 若 Pi 为 大件 、 重要 件 时 ， K ， 否则 K 。 　 　 fi 的 第二项 反映 Pi 排样 后 余料 利用率 的 期望值 e ， 当 K 选择 恰当 时 ， 它 服从 于 这样 的 统计 规律 ： 余料 越大 ， e 越大 。 因此 fi 的 前 两项 综合 反映 了 Pi 排样 时 材料 利用率 的 期望值 。 后 两项 则 确保 大件 、 重要 件 优先 下 料 。 　 　 因此 零件 选择 算法 主要 计算 每个 零件 Pi 的 fi 选取 满足 约束条件 并 具有 最大值 的 零件 Pi 排样 。 　 　 算法 模式 选择 算法 　 　 为了 确定 给定 零件 Pi 的 最佳 排样 方式 和 余料 的 切割 方式 ， 可 通过 计算 每种 模式 的 启发 信息 来 实现 。 共有 类 ： f 零件 Pi 横排 横切 、 f 零件 Pi 横排 竖切 、 f 零件 Pi 竖排 横切 、 f 零件 Pi 竖排 竖切 、 f 跳过 零件 Pi 。 于是 模式 选择 的 启发 函数 为 ： 　 　 FBXMSmaxfffff 　 　 ffiFAMSFBCMS 　 　 ffiFABMSFBCMS 　 　 ffiFEMSFFGMS 　 　 ffiFEFMSFGMS 　 　 fFBXMS 　 　 当 MS 或 LW 不能 排 零件 Pi 或 无 零件 可排 时 ， F 取值 为 。 排样 布局 算法 　 　 如果 只 对 板材 实行 二维 切割 而 不 进行 必要 的 余料 合并 ， 则 会 产生 很多 分散 的 不能 排样 的 余料 碎片 ， 这 不但 大大降低 了 材料 的 利用率 ， 而且 极大 地 影响 了 切割 速度 。 因此 在 分割 之后 ， 尽量 将 相邻 的 余料 合并 成 较大 的 余料 参与 下 一轮 排样 ， 优点 如下 ： 增加 排 大件 的 可能性 ； 可 多排 小件 ； 增加 排样 优化 的 机会 ； 可 充分利用 废料 ； 零件 之间 减少 空隙 余料 碎片 ， 从而 提高 切割 速度 。 　 　 布局 数据结构 　 　 排样 布局 是 一棵 二叉树 ， 其 结点 信息 如 NodeInfo 定义 存储 采用 线性表 实现 。 　 　 typedefstructNodeInfo 　 　 　 　 longcode 布局 编号 　 　 　 　 integergx 板材 坐标 　 　 　 　 integergylonggl 板材 尺寸 　 　 　 　 longgwlongsl 零件 尺寸 　 　 　 　 longswbytemi 排样 与 切割 方式 　 　 　 　 bytecilongaptr 指向 余料 A 　 　 　 　 longbptr 指向 余料 B 　 　 　 　 　 　 合一 算法 　 　 合一 算法 主要 将 相邻 的 余料 块 合并 成 更 大 的 块 ， 但是 简单 的 合并 并 不能 保证 合并 后 的 余料 是 矩形 。 因此 合一 是 有 条件 的 ， 是 启发式 的 。 下面 是 合一 算法 所 采用 的 几条 启发 规则 ： 　 　 若 余料 A 具有 很 高 的 材料 利用率 ， 则 不必 合一 ， 因为 更大 的 块 只是 增加 了 产生 更优 布局 的 机会 ， 但 并 不能 保证 会 产生 更优 的 布局 。 　 　 若 余料 A 不能 排样 任何 零件 ， 则 必须 合一 ， 且 允许 部分 参与 合一 。 　 　 若 余料 A 与 余料 B 合并 后 的 余料 不是 矩形 ， 并且 修整 成 矩形 的 损耗 小于 单独 排样 的 损耗 ， 则 进行 合一 。 　 　 排样 算法 算法 　 　 Open 为 堆栈 ， 用于 存放 尚未 切割 的 当前 板材 及其 余料 。 　 　 选取 板材 LW 放入 Open 表中 　 　 当 Open 表不为 空时且 零件 未排 完时 ， 循环 下列 步骤 　 　 ① 根据 合一 算法 合一 Open 表中 顶端 的 相邻 板材 块 　 　 ② 从 Open 表中 取出 板材 LW 　 　 ③ 根据 零件 选择 算法 选取 零件 Pi 　 　 ④ 根据 零件 单步 排样 算法 布局 零件 Pi 若能 布局 ， 则 将 相应 的 余料 A 和 B 入 Open 表 ， 否则 转 　 　 ⑤ 保留 此步 排样 布局 布局 树 　 　 若待排 零件 队列 和 板材 队列 不空 ， 转 　 　 全部排 完 ， 计算 板材 平均 利用率 ， 并 输出 排样 图 。 实现 与 结论 　 　 动态 分割 与 合一 优化 排样 算法 已 采用 VB 实现 ， 算例 表明 算法 是 成功 的 。 如图 左边 是 没有 合一 的 ， 不但 材料 利用率 不高 ， 而且 增加 了 切割 次数 、 降低 了 切割 效率 。 图 排样 实例 作者 单位 ： 华南理工大学 计算机所 ， 广州 参考文献 YanaseeHHTwodimensionalCuttingStockwithMultipleSizesJOpt ～ ChaunyFATwophraseHeuristicfortheTwodimensionalCuttingStockProblemJOptResSoc ～ 刘弘 曾 广周 林宗楷 具有 类比 学习 机制 的 优化 排料 系统 计算机辅助 设计 与 图形学 报 ： ～