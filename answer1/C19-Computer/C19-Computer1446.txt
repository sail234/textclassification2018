自动化 学报 ACTAAUTOMATICASINICA 年 　 第卷 　 第期 　 Vol 　 No 　 一类 FMS 的 最佳 活 Petri 网 模型 的 综合 邢科义 　 李俊民 　 胡保生 　 　 摘 　 要 　 利用 Petri 网为 一类 柔性制造系统 建模 ， 并 讨论 避免 系统 死锁 问题 通过 Petri 网 模型 的 结构 分析 ， 证明 了 系统 产生 死锁 的 一个 充分 必要条件 给出 了 避免 死锁 的 最佳 控制器 ， 它 可以 通过 给 系统 的 Petri 网 模型 增加 一些 新 的 位置 与 相应 的 弧来 实现 从而 导出 了 这类 制造 系统 的 最佳 活 Petri 网 模型 　 　 关键词 　 柔性制造系统 ， Petri 网 ， 避免 死锁 控制 SYNTHESISOFOPTIMALLIVEPETRINETMODELSFORACLASSOFFMSXINGKEYI 　 LIJUNMINGDeptofAppliedMathematicsXidianUniversityXi à n 　 HUBAOSHENGSystemsEngineeringInstituteXi à nJiaotongUniversityXi à n 　 Abstract 　 InthispaperthePetrinetmodelforaclassofflexiblemanufacturingsystemsisconstructedandthedeadlockprobleminFMSisdiscussedWeproveanecessaryandsufficientconditionforlivenessofsystemmodelandpresentandoptimaldeadlockavoidancecontrollerwhichisaPetrinetThecontrolledclosedloopsystemsmaybemodeledbylivePetrinetsKeywords 　 FMSPetrinetdeadlockavoidancecontrol 　 引言 　 　 在 柔性制造系统 FMS 中 ， 各种 工件 的 加工过程 是 并行 进行 的 ， 这些 并行 加工过程 竞相 利用 有限 的 系统资源 如不加 限制 ， 这种 竞争 关系 可能 会 导致系统 死锁 ， 使 某些 加工过程 永远 不会 进行 完毕 在 FMS 中 ， 死锁 是 应 首先 解决 的 问题 文 ［ － ］ 对 一类 FMS 进行 Petri 网 建模 ， 其中 文 ［ ， ］ 给出 了 避免 死锁 的 充分性 算法 ， 文 ［ ］ 给出 了 避免 死锁 的 最优控制 策略 文 ［ ］ 则 对 更 大 一类 FMS 的 Petri 网 模型 给出 了 一个 保守 的 避免 死锁 的 控制策略 本文 考虑 与 文 ［ ］ 相同 的 一类 FMS ， 用 Petri 网为 系统 建模 ， 给出 系统 死锁 的 充分 必要条件 ， 提出 一个 避免 死锁 的 最优控制 策略 这一 策略 可以 通过 在 Petri 网 模型 上 增加 一些 控制 位置 和 相应 的 弧来 实现 从而 给出 了 系统 活 的 Petri 网 模型 的 综合 方法 　 加工 系统 的 Petri 网 模型 　 　 Petri 网是 一个 三元组 GPTF 其中 P 为 位置 集 ， T 为 变迁 集 ， FP × T ∪ T × P 为 弧集 有关 Petri 网 的 定义 及 运行 规则 等 ， 请参阅 文 ［ ］ 设 x ∈ P ∪ T 令 · xy ∈ P ∪ T ｜ yx ∈ Fx · y ∈ P ∪ T ｜ xy ∈ F 具有 初始 标识 m 的 二元 对 G ， m 称为 标记 Petri 网 如果 mp ≥ p ∈ · t 记作 m ［ t ＞ ， 称 变迁 t ∈ T 在 标识 m 下 使 能 在 m 下 引发 t 后 产生 新 的 标识 m ′ ， 记作 m ［ t ＞ m ′ 用 RG ， m 表示 m 可达 标识 之集设 XP ， m ∈ RGm 令 mXmp 如果 在 RG ， m 中 不 存在 使 t 使能 的 标识 ， 称 变迁 t 在 标识 m 下 是 死 的 如果 在 每个 m ∈ RG ， m 下 ， t 都 不是 活 的 ， 称 t 是 死 的 如果 每个 变迁 都 是 活 的 ， 称 标记 网 G ， m 是 活 的 　 　 本文 讨论 的 FMS 是 具有 n 种 资源 r ， … ， rn ， 能 加工 k 种 工件 的 制造 系统 工件 的 一种 加工过程 是 由 一系列 操作 组成 ； 一种 工件 可以 有 几种 加工过程 ； 每个 操作 就是 资源 的 一次 利用 假设 每个 操作 仅 利用 一个 资源 ， 工件 的 加工过程 可用 Petri 网 建模 ， 即用 一个 位置 代表 一次 操作 ， 用 变迁 的 引发 表示 前 一 操作 的 结束 、 后 一 操作 的 开始 用 位置 pi 存放 要 加工 或 加工 完 的 第 i 种 工件 故 第 i 种 工件 的 加工 Petri 网是 一个 强 连通 状态机 NiPi ∪ piTiFi 其中 Pi ≠ 是 操作 位置 集 ， piPiNi 的 每个 有 向 圈 都 包含 pi 　 　 对 每种 资源 r 设置 一个 位置 ， 仍记 为 r 用 R 记 所有 资源 位置 之集 当 操作 p ∈ Pi 利用 资源 r 时 ， 增加 弧 rt ， t ∈ · p 和 tr ， t ∈ p · ， 则 系统 的 Petri 网 模型 为 GP ∪ P ∪ RTF ， 其中 PPiPpp … ， pkTTik 为 工件 种类 个数 ， F 为 所有 弧之集 　 　 例 　 在 具有 种 资源 rr … ， r 加工 两种 工件 的 系统 中 ， 第一种 工件 的 加工 资源 序为 rrrr 或 rrrr ， 第二种 工件 的 资源 序为 rrr 则 两种 工件 的 加工 Petri 网 与 系统 的 Petri 网 模型 可由图 abc 分别 表示 图 　 a ， b 为 两种 工件 加工过程 Petri 网 ， c 为 简单 加工 系统 Petri 网 　 　 设 系统 Petri 网 具有 可行 的 初始 标识 m ， 即当 p ∈ P ∪ R 时 mp ≥ ； 当 p ∈ P 时 ， mp 为 方便 计 ， 用 ptrttp 和 tr 分别 表示 · t ∩ P · t ∩ Rt · ∩ P 和 t · ∩ R 这些 记号 可 扩展 到 集 XT 上 ， 如 rXrt 等 　 系统 死锁 的 条件 　 　 设 m ∈ RGm 用 Dm 表示 在 m 下 所有 使 mpt ≥ 的 死变迁 t 的 集合 则 Dm ∩ · P 　 　 定理 设 GmP ∪ P ∪ RTFm 是 系统 标识 Petri 网 模型 ， m ∈ RGm 如果 Dm ≠ ， 则 存在 非 空集 DDm · P ∪ P · 使得 rDDrpD · D 而且 mpDmrD 　 　 证明 设 r ∈ rDm 则 存在 t ∈ Dm 使得 rtr ， 故 mr 令 Tt ∈ T ｜ mpt ≥ trr 则 mpTmrTDm 否则 必有 ti ∈ T ， m ′ ∈ RGm 使得 m ′ ［ ti ＞ m ″ 故 m ″ rm ″ ［ t ＞ ， 矛盾 由 ti ∈ T ≠ 知 rtri ∈ Dmr 故 rDmDmr 　 　 由 Dm ≠ 得 DDmP · ≠ 当 rDDr 时取 DD 现设 rD ≠ Dr 任取 r ∈ DrrD 令 DDt ∈ D ｜ trr 则 D ≠ 当 rD ≠ Dr 时 ， 再 重复 以上 过程 因 资源 有限 ， 则 存在 有限 非 空集 列 DkDk … DDm 使得 Di ≠ ， rDkDrk 取 DDk 由 Dm 的 定义 ， 有 mpDm ∩ p · rmrr ∈ rDm 设 r ∈ rDDrt ∈ Dmtrr 则 t ∈ DmpDmrD 　 　 现证 pD · D 设 t ∈ D 当 ｜ pt · ｜ 时 ， pt · t ∈ D 设 ｜ pt · ｜ ≥ trrt ≠ tt ∈ pt · 则 t ∈ Dm 否则 ， 有 m ′ ∈ RGm 使得 m ′ ［ t ＞ m ″ m ″ r 故有 t ′ ∈ Drt ′ rm ″ ［ t ′ ＞ ， 矛盾 由 t ∈ Dm 得 mrt 设 rtr 则 存在 t ∈ Dmtrrrtr 而且 mpDm ∩ p · rmr 类似 地 ， 存在 t ∈ Dmtrrrtr 使得 mpDm ∩ p · rmr … 重复 分析 ， 得 Dm 中 的 变迁 列 tt ， … ， 使得 tririrtirimpDm ∩ p · rimri 则 存在 整数 klk ＞ lrkrl 于是 ri ∈ rDm ∩ Dmrti ∈ D 故 pD · D 　 　 令 VGDT · P ∪ P · ｜ rDDrpD · D 　 　 在 图 c 所示 的 Petri 网中 ， VGDDDDD 其中 DttD ｛ tt ｝ ， DtttttttDttttttDttttt 　 　 推论 系统 标记 Petri 网 模型 Gm 是 活 的 充要条件 为 mpD ≤ mrDm ∈ RGmD ∈ VG 　 　 设 D ∈ VG 令 ID · pDDHD · DppD ∩ D 称 V ｛ D … ， Dn ｝ VG 为 W 链 ； 若 Dk ∈ V 存在 DiDj ∈ Vtitj ∈ T 使得 ti ∈ Di ∩ IDktj ∈ IDj ∩ Dk 并称 rID ∩ … ∩ rIDn 中 的 资源 为 关键 资源 　 避免 系统 死锁 的 Petri 网 控制器 　 　 考虑 可能 出现 死锁 的 系统 标记 Petri 网 Gm 这里 要 为 系统 设计 一个 控制器 ， 以 保证 在 受控系统 中 不会 出现 死锁 由 推论 知 ， 必须 使得 对 任何 D ∈ VG 和 任何 可 达 标识 m 都 有 mpD ≤ mrD 这是 受控系统 活 的 必要条件 ， 但 不是 充分 的 当 DD ∈ VGDDrDrD 时 ， mpD ≤ mrD 意味着 mpD ≤ mrD 令 V ′ D ∈ VG ｜ 存在 D ∈ VGDDrDrD 如果 DD ∈ VGDDDDr ∩ rD 则 mpD ≤ mrD 意味着 mpD ≤ mrD 令 V ″ D ∈ VG ｜ 存在 D ∈ VGDD 使得 DDr ∩ rD ｝ GVGV ′ ∪ V ″ 　 　 情形 A 每种 关键 资源 至少 有 两个 资源 　 　 定义 　 设 Gm 是 系统 标记 Petri 网 模型 控制器 C 是 一个 标记 Petri 网 CPcTFcmc ， 其中 PcpD ｜ D ∈ GFcpDt ｜ t ∈ IDD ∈ G ∪ tpD ｜ t ∈ HDD ∈ GmcpDmrD 　 　 受控系统 是 C 和 Gm 的 合成 网 ， 记作 GcmcoP ∪ P ∪ R ∪ PcTF ∪ Fcmco 其中 mcopmpp ∈ P ∪ P ∪ Rmcopmcpp ∈ Pc 在 Gcmco 中 ， 用 ct 和 tc 分别 记 · t ∩ Pc 和 t · ∩ Pc 设 m ∈ RGcmco 令 Dcmt ∈ T ｜ t 在 m 下 是 死 的 而且 mpt ≥ 　 　 引理 设 m ∈ RGcmco 如果 Dcm ≠ ， 则 存在 t ∈ Dcmrtr 及 pD ∈ ct 使得 mr ≥ mpD 证明 从略 　 　 定理 设在 系统 Petri 网 Gm 中 ， 对 每种 关键 资源 rmr ≥ 则 C 是 避免 系统 死锁 的 最优控制 器 ， 即 C 对 Gm 的 限制 是 最小 的 从而 Gcmco 是 系统 的 最佳 活 的 Petri 网 模型 　 　 证明 对 每个 D ∈ G 限制 pD 中托 肯数 不 超过 mrD 是 保证 Gcmco 活 的 必要条件 而 C 仅 使 这 一 必要条件 成立 ， 故若 Gcmco 是 活 的 ， 则 C 就是 最小 限制 的 避免 死锁 控制器 因此 这里 仅 需 证明 Gcmco 是 活 的 　 　 设 m ∈ RGcmco 使 Dcm ≠ ， 则 由 引理 ， 存在 t ∈ Dcm 及 pD ∈ ct 使得 mrt ≥ mpD 设 rtr 则 mpDmDrSrt ∈ D ｜ rtr ≠ 注意 tD 则 可 证明 存在 t ∈ Sr 使得 mpt ≥ ； 否则 ， 在 DSr ∪ S 中有 D ∈ VG 使得 DDmpDmrD 其中 St ∈ IDp · ｜ trr 这 是 不 可能 的 由 mpt ≥ mrtmr ≥ 及 t ∈ Dcm 知 ， 有 D ∈ G 使得 t ∈ IDmpDmrD 类似 从 t 和 D 导出 t 和 D ， 可 从 t 和 D 导出 t 和 D ， 使得 t ∈ IDmpDmrD 重复 分析 得到 G 的 一个 序列 DD ， … ， 使得 rrti ∈ rIDii … 则 在 DD … ， 中必 存在 W 链 ， 设为 VD … Dkr 是 关键 资源 ， mr ≥ 故 存在 u ∈ D 使得 urrmpu ≥ u ∈ Dii … ， k ， rur ∈ Dr ∩ … ∩ Drkmr 若 u ∈ Durrmpu ＞ 则 u ∈ Dii … ， k 因 r ∈ Dr 存在 资源 列 rr … rlr 和 变迁 列 tt … tl 使得 ritrirtirimpti ≥ 故 DrDr ∩ … Drlt ∈ D ｜ mpt ≥ D ∩ … Dl 同理 ， DriDr ∩ … ∩ Dri ∩ Dri ∩ … ∩ Drlt ∈ Di ｜ mpt ≥ D ∩ … ∩ Di ∩ Di ∩ … ∩ Dl 但 t ∈ Dt ∈ IDmpt ＞ tD 矛盾 表明 DcmGcmco 是 活 的 　 　 情形 B 有 关键 资源 rmr 　 　 称 D ∈ G 与 W 链 D … Dl 无关 ， 如果 D ∩ DirD ∩ rDii … l 于是 G 可 分为 两 部分 ， 即 D ∈ G ｜ D 与 任何 W 链 无关 和 G 　 　 定义 设 Gm 是 系统 标记 Petri 网 模型 ， 定义 控制器 C ′ 为 一 标记 Petri 网 C ′ PcTFcmc ， 其中 PcpD ｜ D ∈ G 是 控制 位置 集 ， FcpDt ｜ t ∈ IDD ∈ G ∪ tpD ｜ t ∈ HDD ∈ GmcpD 定义 为 当 D ∈ 时 ， mcpDmrD 令 LDmrD 在 上 ， mc 是 递归 定义 的 当 D ∈ 不是 中 两个 元素 的 并 时 ， mcpDLDLDmrD 当 DDiDi ∈ l ≥ mcpDi 已有 定义 时 ， mcpDLD 其中 LDpD 是 Gm 的 一个 使 LD 取得 最大值 而 满足 pDi ≤ LDii … l 的 可达 标识 　 　 受控系统 是 C ′ 和 Gm 的 合成 网 G ′ cm ′ coP ∪ P ∪ R ∪ PcTF ∪ Fcm ′ co 其中 m ′ copmpP ∈ P ∪ P ∪ Rm ′ copmcpp ∈ Pc 　 　 定理 设 Gm 是 系统 标记 Petri 网 模型 ， 则 G ′ cm ′ co 是 活 的 证明 与 定理 类似 ， 从略 　 　 例 考虑 图 c 所示 的 Petri 网 G ， 取 初始 标识 mpp ∈ Rmpp ∈ P 及 mpp ∈ PVGD … DDDrDrDDDDDr ∩ rD 故 GDDD 避免 系统 死锁 的 最佳 控制器 是 如图所示 的 标记 Petri 网图 　 Petri 网 控制器 　 结论 　 　 本文 基于 Petri 网 模型 讨论 在 一类 FMS 中 避免 死锁 的 问题 给出 了 系统 死锁 的 充分 必要条件 提出 了 一种 基于 Petri 网 模型 综合 避免 系统 死锁 控制器 的 新 方法 所 得到 的 控制器 不仅 保证 了 受控系统 的 活性 ， 而且 允许 系统资源 的 极大 利用 这种 控制器 的 另 一 特点 是 它 可以 通过 给 系统 的 Petri 网 模型 增加 一些 控制 位置 和 相应 弧来 实现 ， 从而 受控系统 具有 活 的 Petri 网 模型 虽然 综合 控制器 算法 的 复杂性 与 G 有关 ， 但 这种 综合 过程 是 离线 进行 的 ， 而且 仅 进行 一次 ， 故 复杂性 问题 并 不是 本文 方法 的 障碍 国家自然科学基金 和 西安交通大学 机械制造 系统工程 国家 重点 实验室 基金 资助 课题 作者简介 ： 邢科义 　 年 出生 ， 年 毕业 于 西北大学 ， 年 在 西安交通大学 获 博士学位 现为 西安电子科技大学 副教授 研究 方向 为 离散 事件 动态 系统 理论 、 Petri 网 理论 与 应用 　 　 　 　 　 李俊民 　 年 出生 ， 年 在 西安电子科技大学 获 硕士学位 现为 西安交通大学 博士 研究生 主要 研究 方向 为 自 适应控制 、 动态 系统优化 控制 与 智能 控制 　 　 　 　 　 胡保生 　 西安交通大学 教授 、 博士生 导师 ， 机械制造 系统工程 国家 重点 实验室 学术 委员会 主任 ， IEEE 高级 会员 ， 《 MathematicalReview 》 评论员 作者 单位 ： 邢科义 、 李俊民 ： 西安电子科技大学 应用 数学系 　 西安 　 　 　 　 　 　 胡保生 ： 西安交通大学 系统工程 研究所 　 西安 　 参考文献 ［ ］ 　 BanaszakZAKroghBDeadlockavoidanceinflexiblemanufacturingsystemswithconcurrentlycompetingprocessflowsIEEETransRoboticsandAutomation ［ ］ 　 HsiehFSChangSCDispatchingdrivendeadlockavoidancecontrollersynthesisforFMSIEEETransRoboticsandAutomation ［ ］ 　 XingKY ， HuBSChenHXDeadlockavoidancepolicyforFMSinPetrinetsinflexibleandagileautomationMCZhouEdBostonKluwerAcademic ［ ］ 　 EzpeletaJColomJMMartinezJAPetrinetbaseddeadlockpreventionpolicyforflexiblemanufacturingsystemsIEEETransRoboticsandAutomation ［ ］ 　 PetersonJLPetri 网 理论 与 系统模拟 ， 吴哲辉 译 徐州 ： 中国矿业大学 出版社 ， 收稿 日期 　