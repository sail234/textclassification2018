计算机 应用 研究 APPLICATIONRESEARCHOFCOMPUTERS 　 Vol 　 No 　 P 利用 ASPADO 访问 站点 数据库 毕潜 　 李飞 摘要 该文 较为 系统地 介绍 了 利用 ASP 访问 站点 数据库 的 方法 和 技巧 ， 并 给出 实例 加以 说明 。 关键词 ASPADO 站点 数据库 ASP 的 认识 　 　 ActiveServerPages 动态 服务器 主页 ， 简称 ASP ， 内含 于 InternetInformationServerIIS 当中 ， 提供 一个 服务器端 Serverside 的 Scripting 环境 ， 产生 和 执行 动态 、 交互式 、 高效率 的 站点 服务器 的 应用程序 ， 并 使 站点 服务器 自动 将 ActiveServerPages 的 程序 码 解释 为 标准 HTML 格式 的 内容 ， 送到 用户 端的 浏览器 上 显示 出来 。 用户端 只要 使用 常规 可 执行 HTML 码 的 浏览器 ， 即可 浏览 ActiveServerPages 所 设计 的 主页 内容 。 　 　 ASP 的 特点 是 ： 　 　 集成 于 HTML 中 ， 无需 编译 即可 执行 ； 　 　 使用 常规 文本编辑 器 ， 如 Windows 的 记事本 ， 即可 设计 ； 　 　 与 浏览器 无关 BrowserIndependence ， 用户端 只要 使用 常规 的 可 执行 HTML 码 的 浏览器 ， 即可 浏览 ASP 所 设计 的 主页 内容 ， Script 语言 VBscript ， Jscript 是 在 站点 服务器 Server 端 执行 ， 用户 不 需要 执行 这些 Script 语言 ； 　 　 面向对象 ObjectOrient ； 　 　 可 通过 ActiveXServerComponentsActiveX 服务器 组件 来 扩充 功能 。 ActiveXServercomponents 可 使用 VisualBasic 、 Java 、 VisualC 、 COBOL 等 语言 来 实现 ； 　 　 ASP 与 任何 ActiveXScripting 语言 兼容 。 除了 可 使用 VBscript 或 Jscript 语言 来 设计 外 ， 还 可 通过 Plugin 的 方式 ， 使用 由 第三方 所 提供 的 其它 譬如 REXX ， Perl ， Tcl 等 Scripting 语言 。 Script 引擎 是 处理 Script 的 COMComponentObjectModel 对象 ； 　 　 ASP 的 源程序 代码 ， 不会 传到 用户 的 浏览器 ， 因此 可以 保护 辛辛苦苦 写 出来 的 源程序 。 传到 用户 浏览器 的 是 ASP 执行 结果 的 常规 HTML 码 ； 　 　 使用 服务端 Script 产生 客户端 Script 。 可以 使用 ASP 程序 码 ， 在 站点 服务器 执行 Script 语言 VBscript 或 Jscript ， 来 产生 或 更改 在 客户端 执行 的 Script 语言 。 　 　 ASP 提供 下面 五个 内置 的 “ 对象 ” Object 可以 直接 调用 ： 　 　 ① Request ： 取得 用户 信息 ； 　 　 ② Response ： 传送 信息 给 用户 ； 　 　 ③ Server ： 提供 访问 服务器 的 方法 methods 和 属性 properties 的 功能 ； 　 　 ④ Application ： 一个 应用程序 ， 可以 在 多个 主页 之间 保留 和 使用 一些 共同 的 信息 ； 　 　 ⑤ Session ： 一个 用户 ， 可以 在 多个 主页 之间 保留 和 使用 一些 共同 的 信息 。 　 　 ASP 文件 的 扩展名 是 asp ， 它 是 一个 文本文件 。 在 ASP 文件 中 包括 ： HTML 标记 tags 、 VBscript 或 Jscript 语言 的 程序 码 、 ASP 语法 。 　 　 ASP 并 不是 一个 Script 语言 ， 而是 提供 一个 可以 集成 Script 语言 VBscript 或 Jscript 到 HTML 主页 的 环境 。 HTML 标记 tags 使用 “ ” 将 HTML 程序 码 包含 起来 ， 以 与 常规 的 文本 区分 开来 ； 而 ASP 使用 “ ” 将 ASP 的 Script 程序 码 包含 起来 。 ASPADO 访问 站点 数据库 的 步骤 　 　 ADO 是 微软 提供 的 最新 站点 数据库 访问 技术 ， 它 是 ASP 的 一个 组件 ， 通过 ODBC 驱动程序 连接 相应 的 数据库 。 ASP 访问 数据库 的 过程 是 ： 当 浏览器 向 Web 服务器 申请 访问 一个 ASP 文件 时 ， Web 服务器 调用 ASP 文件 ， 然后 解释 执行 每 一条 脚本 语句 ， 用 ADO 组件 通过 ODBC 访问 数据库 ， 再 把 执行 的 结果 生成 HTML 文件 传给 客户端 。 　 　 ADO 数据库 设计 步骤 ： 　 　 设定 ODBC 与 数据库 的 连接 。 在 NT 服务器 上 执行 “ 控制面板 ” 上 的 “ ODBC ” ， 选择 “ 系统 DSN ” ， 按 “ 添加 ” 按钮 ， 选择 数据源 驱动程序 ， 如 选择 “ SQLServer ” ， 然后 填好 数据源 名称 DSN 及 数据库 名称 。 　 　 使用 “ Servercreateobject ” 建立 连接 的 对象 ， 并 使用 “ Open ” 打开 待 访问 查询 的 数据库 。 setconnservercreateobject ＂ adodbconnection ＂ connopen ＂ 数据库 名称 ＂ 　 　 数据库 名称 即 为 在 “ ODBC ” 设定 的 “ 数据 来源 名称 ” 。 　 　 设定 SQL 命令 ， 使用 “ Execute ” 命令 ， 开始 执行 访问 查询数据库 的 动作 。 setrsconnexecuteSQL 命令 　 　 使用 如下 recordsets 对象 的 命令 ， 显示 查询 的 结果 。 rsfieldscountrecords 的 字 段数 rsiname 第 i 指针 个 字段名 ， i 由算 起到 rsfieldscountrsi 读取 第 i 指针 个 字 段 的 记录 ， i 由算 起到 rsfieldscountrs ＂ 字段名 quot 读取 指定 的 字 段 的 记录 rseof 是 true 否 false 已 指定 最 末笔 rsmovenext 将 指针 移到 下 一笔 rsmoveprev 将 指针 移到 上 一笔 rsmovefirst 将 指针 移 到 第一笔 rsmovelast 将 指针 移到 最 末笔 rsgetrows 将 查询 结果 存于 数组 当中 ， 如 vrsgetgows ， 再 读取 数组 vcolrow 的 值 即 为 查询 的 记录 rspropertiescount 得到 ADO 的 Connection 或 Resultset 的 属性 总数 rspropertiesitemname 得到 ADO 的 Connection 或 Resultset 的 属性 名称 rspropertiesitem 得到 ADO 的 Connection 或 Resultset 的 属性 值 。 　 　 最后 ， 使用 如下 的 命令 ， 关闭 数据库 。 rscloseconnclose 一个 查询 系统 的 设计 　 　 在 searchasp 文件 中 利用 Form 表单 形成 一个 查询 入口 如图所示 。 当 用户 选择 了 查询 条件 后 ， 按下 “ 提交 ” 按钮 ， 将 变量 送到 processasp 中 ， processasp 根据 变量 的 值 ， 利用 SQL 语句 在 服务器端 完成 数据库 表 文件 的 查询 ， 最后 将 查询 结果 送回 浏览器 端 如图所示 。 图 图 　 　 searchasp 程序 源代码 ： htmlheadtitletitlemetacontenttexthtmlcharsetgbhttpequivContentTypestylebodyfontsizeptbackgroundattachmentfixedtablefontsizeptstylescriptlanguagevbscript 　 subback 　 　 　 historyback 　 endsub 　 subforward 　 　 　 historyforward 　 endsubscriptheadbodyaLinkFFbackgroundImagenabkgndjpgbgColorfffffflinkFFtextvLinkFFdivaligncenterfontsizeface 隶书 colorFFFF 级新生 情况 查询 fontdivformmethodPostactionProcessaspnamenewstudenttablewidthbordertrtdwidth 姓名 inputtypetextnamesnametdtdwidth 性别 inputtyperadionamessexvalue 所有 checked 所有 inputtyperadionamessexvalue 男 男 inputtyperadionamessexvalue 女女 tdtdwidthrowspanvaligntop 专业 selectnamesdpmoptionvalue 所有 selected 所有 optionoptionvalue 电信 工程 电信 工程 optionoptionvalue 国际 商务 国际 商务 optionoptionvalue 环境工程 环境工程 optionoptionvalue 会计学 会计学 optionoptionvalue 计算机科学 计算机科学 optionoptionvalue 金融 与 保险 金融 与 保险 optionoptionvalue 通讯 工程 通讯 工程 optionselecttdtrtrtdwidthrowspan 毕业 学校 inputtypetextnamesschooltdtdwidthrowspan 地方 inputtypetextnamesareatdtrtrtdwidthvaligntop 籍贯 inputtypetextnamesbelongtdtrtabledivaligncentertablewidthbordertrtddivaligncenterinputtypesubmitvalue 提交 divtdtddivaligncenterinputtyperesetvalue 清除 divtdtrtabledivformbrbrbrdivaligncentertablewidthtrtdwidthalignleftimgsrcImagebackgifaltbackborderonclickbacktdtdwidthaligncenterahrefindexhtmlstartpagequotimgsrcImagehomegifalthomeborderwidthheightatdtdwidthalignrightimgsrcImageforwardgifaltforwardonclickforwardwidthheighttdtrtabledivbodyhtml 　 　 processasp 程序 源代码 htmlheadtitletitlemetacontenttexthtmlcharsetgbhttpequivContentTypestylebodyfontsizeptbackgroundattachmentfixedtablefontsizeptstylescriptlanguagevbscript 　 subback 　 　 　 historyback 　 endsub 　 subforward 　 　 　 historyforward 　 endsubscript 　 Subcombinesqlpsql 　 　 　 bsql 　 　 　 ifrequestformsnamethen 　 　 　 　 　 ifbsqlthen 　 　 　 　 　 　 bsqlbsqland 　 　 　 　 　 endif 　 　 　 　 　 bsqlbsql 姓名 requestformsname 　 　 Endif 　 　 ifrequestformssex 所有 Then 　 　 　 　 ifbsqlthen 　 　 　 　 　 　 bsqlbsqland 　 　 　 　 endif 　 　 　 　 bsqlbsql 性别 requestformssex 　 endif 　 ifrequestformsdpm 所有 then 　 　 　 　 ifbsqlthen 　 　 　 　 　 　 bsqlbsqland 　 　 　 　 endif 　 　 　 　 bsqlbsql 专业 likerequestform 　 　 　 　 　 　 sdpm 　 　 Endif 　 　 ifrequestformsschollthen 　 　 　 　 ifbsqlthen 　 　 　 　 　 　 bsqlbsqland 　 　 　 　 endif 　 　 　 　 bsqlbsql 毕业 学校 likerequestform 　 　 　 　 　 　 　 sscholl 　 endif 　 ifrequestformsareathen 　 　 　 　 ifbsqlthen 　 　 　 　 　 　 　 bsqlbsqland 　 　 　 　 endif 　 　 　 　 bsqlbsql 地方 likerequestform 　 　 　 　 　 　 　 sarea 　 endif 　 ifrequestformsbelongthen 　 　 　 　 ifbsqlthen 　 　 　 　 　 　 　 bsqlbsqland 　 　 　 　 endif 　 　 　 　 bsqlbsql 籍贯 likerequestform 　 　 　 　 　 　 　 sbelong 　 endif 　 ifbsqlthen 　 　 　 　 psqlpsqlwherebsql 　 　 　 　 endifEndSubheadbodyaLinkFFbackgroundImagenabkgndjpgbgcolorfffffflinkFFtextvLinkFFfontface 仿宋 GBsizecolorFF 查询 结果 　 fontbr 　 setdbfservercreateobjectadodbconnection 　 dbfopenstud 　 sqlselectfrom 学院 级新生 dbf 　 callcombinesqlsql 　 responsewrite 查询 条件 sqlbrhr 　 setrsdbfexecutesql 　 ifrseofthenresponsewriteNobodywasfoundFONTCOLORREDTRY 　 AGAINFONTbrhr 　 else 　 　 responsewrite 共查 到 rsrecordcount 条 记录 tablewidthborderdowhilenotrseoftrtdwidth 考号 responsewriters 考号 td 　 tdwidth 姓名 responsewriters 姓名 td 　 tdwidth 性别 responsewriters 性别 td 　 tdwidth 民族 responsewriters 民族 td 　 tdwidth 出生日期 responsewriters 出生日期 td 　 tdwidth 身高 responsewriters 身高 tdtrtrtdwidth 专业 responsewriters 专业 td 　 tdwidth 层次 responsewriters 层次 td 　 tdwidth 籍贯 responsewriters 籍贯 td 　 tdwidthcolspan 地方 responsewriters 地方 tdtrtrtdwidthcolspan 毕业 学校 responsewrite 　 rs 毕业 学校 td 　 tdwidthcolspan 家庭 住址 responsewrite 　 rs 家庭 住址 tdtr 　 trtdwidthcolspanhrtdtrrsmovenext 　 loop 　 rsclose 　 dbfclose 　 endiftablebodyhtml 结束语 　 　 通过 上面 的 实例 ， 说明 ASPADO 访问 站点 数据库 的 技术 是 非常 易学 易用 的 ， 并且 具有 高效 、 快速 、 安全性 ， 是 一种 极具 发展潜力 的 新 技术 。 毕潜 成都 科技 大学 出版社 成都 李飞 成都 气象 学院 计算机系 成都 参考文献 ， 蔡丹媚 纪春姣 利用 ASP 轻松 实现 Web 的 动态 交互 访问 计算机 应用 研究 第期 ～ ， httpwwwswmcomcnyingyongrjyyyyyhtm 收稿 日期 ：