航空 计测 技术 AVIATIONMETROLOGYMEASUREMENTTECHNOLOGY 年 　 第卷 　 第期 　 Vol 　 No 　 IMPS 网络接口 通信 可靠性 的 改进 沈辉 中 　 　 摘要 　 由于 在 S 网络 上 的 IMPS 网络接口 在 线路 上 存在 自身 的 缺陷 ， 住 往 使 其 与 主控 计算机 之间 的 通信 受阻 。 本文 从 线路 上 改进 了 IMPS 网络接口 ， 从而 使 通信 更加 稳定 、 可靠 。 　 　 关键词 　 IMPS 网络接口 　 缺陷 　 主控 计算机 　 通信 　 改进 ImprovementofIMPSNetInterfaceCommunicationShenHuizhong 　 　 Abstract 　 OwingtotheIMPSnetinterfaceontheSnetworkexistsadefectuponitselfinthecircuitthecommunicationbetweenIMPandhostcomputerwillbebaffiedfrequentlyInthispapertheIMPSnetinterfaceisimprovedonthecircuitthusthecommunicationcanbestableandreliable 　 　 Keywords 　 IMPSNetinterfaceDefectHostcomputerCommunicationImprovement 　 　 IMPIsolatedMeasurementPod 数据 采集器 是 微机 监控 技术 应用 于 工业 现场 的 一种 新 产品 ， 由输力 强 仪器 公司 所 研制 。 它 综合 了 数据 转换 和 通信 技术 与 IBMPC 系列 INTEL 系列 及 PDP 等 各种 微型机 组成 分布式 数据 采集 与 控制系统 。 实现 了 远程 数据 采集 处理 和 过程 控制 。 　 　 IMP 在 现场 应用 中 可 分散 安装 ， 并 特别 适应 恶劣 的 现场 环境 ， 系统 组成 简单 ， 测量 精度高 ， 抗干扰性 能强 ， 使用方便 ， 因此 在 国内 已 得到 了 广泛应用 。 但 有 少部分 用户 使用 中 的 IMP 工作站 出现 了 主控 计算机 与 工作站 联机 不通 的 问题 ， 本人 在 维修 工作 中 发现 ， 这种 情况 并非 是 软件 问题 ， 也 不是 硬件 损坏 ， 而是 网络 本身 的 缺陷 所致 ； 改进 了 S 网络接口 部分 线路 后 ， 主机 S 网络接口 与 工作站 S 网络接口 联机 通畅 ， 通信 更加 稳定 、 可靠 。 　 　 下面 介绍 IMP 通信 网络 — — S 网络 及 笔者 在 线路 上 的 一点 改进 。 　 IMP 的 通信 网络 　 　 在 分布式 数据 采集 与 控制系统 之间 采用 了 串行 通信 结构 ， 见图 在 IMP 与 主控 计算机 之间 的 联系 仅仅 采用 了 一根 双 绞 电缆 为 通信 介质 所 构成 的 网络 ， 这种 网络 称为 S 网络 。 网络 中 的 这根 双绞线 不仅 用来 传送数据 ， 也 用来 作 IMP 的 供电 电线 。 图 　 主机 中 S 网络适配器 与 IMP 中 的 S 网络接口 的 连接 　 　 IMP 的 通信 网络 是 总线 式 结构 连接 ， 采用 主从 方式 进行 工作 ， 由 一台 计算机 对 整个 网络 中 的 工作站 进行 控制 ， 其 基本 结构 如图 ， 一台 主控 计算机 最多 可 连接 控制 个 IMP 工作站 。 图 　 　 S 网络 的 通信 　 S 网络通信 可 分为 两个 部分 　 　 用户 和 主机 之间 的 交互作用 所 需 的 软件 部分 ， 这部分 软件 也 可 由 用户 编写 。 　 　 主机 和 IMP 之间 字符 序列 的 传送 部分 。 　 　 这部分 碰到 的 问题 是 对 主机 传送 出 的 信息 ， IMP 工作站 没有 反应 ， 主机 显示 IMP 工作站 没有 找到 ， 下面 先 简单 介绍 一下 S 网络通信 的 基本 情况 。 　 　 上面 已经 说 过 ， S 网络 中 采用 的 通信 方式 是 以 串行 结构 方式 进行 的 ， 主机 和 IMP 之间 互相 传送 的 是 由位 字 构成 的 字符串 ， 由 若干 字符串 组成 一个 字符 序列 。 在 S 网络 中 采用 了 三种 类型 的 字符 序列 ， 即 信息 序列 、 轮询 序列 和 非 确认 序列 。 　 　 a 信息 序列 。 由 主控 计算机 向 IMP 工作站 发送 命令 ， 或 各 工作站 向 主机 传送 测量 数据 。 信息 序列 的 结构 如图 ． 图 　 　 　 b 轮询 系列 。 轮询 序列 是 由 主控 计算机 启动 某 一块 IMP 发送数据 ， 依次 查询 各块 IMP 工作站 。 并 依次 显示 在 屏幕 上 。 字符 序列 结构 如图 ． 图 　 　 　 c 非 确认 序列 。 如果 IMP 被 启动 发送数据 ， 但 数据 尚未 准备 好 ， 则 用 非 确认 序列 进行 回答 。 字符 序列 结构 如图 ． 图 　 　 S 网络通信 序列 结构 　 　 S 网络通信 序列 结构 见图 。 图 　 　 　 每个 序列 都 是从 地址 的 第一个 地址 字节 开始 ， 多于 个 工作站 时 就 为 两个 地址 字节 。 按 下来 是 确定 字符 序列 性质 的 控制字符 ， 是 信息 序列 还是 轮询 序列 、 或非 确认 序列 。 然后 是 命令 或是 测量 的 数据 均 作为 信息 序列 。 信息 序列 最多 可 传送 个字符 ， 在 最后 一个 信息 序列 传送 后 ， 使用 文本 结束 控制字符 来 结束 信息 序列 。 最后 是 出错 校验 。 　 字符 格式 　 　 通过 序列 发送 的 每个 字符 均 由位 组成 ： 个 开始 位 ， 个 数据位 ， 个 控制 位和个 停止 位见 图 。 图 　 字符 传送 的 格式 　 S 网络 的 数据传输 　 　 在 S 网络 的 数据传输 中 “ ” 是 个 bit 输送 周期 出现 的 一个 双向 脉冲 的 表示 ， 这个 双向 脉冲 只 占 半个 周期 ， 如 图示 。 图 　 主控 计算机 向 IMP 发出 的 一个 bit 数据 序列 　 　 之所以 S 网络 要 用 双向 脉冲 ， 是因为 正 脉冲 所 积累 起来 的 电荷 在 负向 脉冲 到来 时 得到 部分 消除 ， 再有 后 半个 周期 的 延时 能 使 积累 的 电荷 充分 泄放 。 　 　 数据 “ ” 是 在 这个 bit 周期 内 无 脉冲 出现 。 　 　 如果 IMP 工作站 向 主控 计算机 发出 的 脉冲序列 为 负向 脉冲 在 前 ， 正向 脉冲 在 后 ， 如 图示 。 图 　 由 IMP 传送 到 主控 计算机 的 一个 bit 数据 序列 　 　 在 S 网络 上 传送 的 各种 信息 ， 都 是 由 一串 位 的 二进制码 组成 ， 其中 第位 总是 ； 第 ～ 位为 数据位 ； 第位 为 控制 位 ； 第 ～ 位是 停止 位 。 　 S 网络 的 电源 传输 　 　 S 网络 中 的 双 绞 电缆 不仅 用于 数据通信 ， 又 用作 IMP 供电 电缆 。 在 IMP 内部 大部分 器件 采用 CMOS 器件 ， 功耗 低 ， 即 每块 只有 ～ W ， 一般 直接 由 主机 电源 供电 ， 当 IMP 多 线路 长时 ， 也 可 外部 供电 。 　 S 网络 的 主要 特点 及 不足之处 　 　 S 网络 是 异步 双向通信 网络 ， 最长 通信 距离 可达 m ， 以 kb ／ s 的 传送 速率 传送 信息 ， 对于 个 通道 的 数据 可 在 s 内 完成 测量 和 传送 。 任何 一种 类型 的 IMP 可挂 在 网 的 任何 地方 ， 适应性 强 。 　 　 由于 S 网络 处于 长距离 的 高速率 输送 。 传输线 路上 的 分布电容 不可 忽视 ， 虽然 S 网络 数据 输送 上 采取 了 双向 脉冲 的 输送 序列 ， 双向 脉冲 相对 地 抵消 了 一部分 由 分布电容 引起 的 电荷 积累 ， 一旦 分布电容 引起 的 电荷 积累 不能 完全 充分 泄放 ， 就 会 造成 失真 ， 引起 通信 终断 ， 联机 不通 。 这种 情况 曾多次 出现 ， 用户 送来 的 故障 板 ， 经 检查 硬件 未损坏 ， 和 主机 接口 联机 后 ， 没有 任何 改变 ， 偶然 会 联通 一次 ， 工作 正常 ， 但 大多 情况 联 不通 。 　 　 下 面试 分析 一下 出现 这种 情况 的 原因 　 　 IMP 工作站 中 S 网络接口 实际 电路图 如图 。 图 　 IMP 工作站 中 S 网络接口 图 C 电容 是 改进 后 增加 上去 的 　 　 由 主控 计算机 传送 到 工作站 S 网络接口 的 双向 脉冲 ， 经过 比较 器 IC 译码 成 TTL 脉冲 ， 这个 TTL 脉冲 是 工作站 中 ULA 电路 所 认可 的 ， 对 其它 任何 脉冲 ULA 一概 不 理睬 见图 。 图 　 　 　 如果 主控 计算机 传送 进来 的 双向 脉冲 ， 经过 传送 产生 畸变 ， 如图 。 这种 畸变 的 输入脉冲 ， 根本无法 被 比较 器 译码 或者 即使 比较 器能 输出 一个 同样 的 畸变 信号 ， 但 工作站 中 ULA 不能 认定 ， 同样 不 确认 。 所以 出现 了 主控 计算机 与 工作站 联机 不通 的 情况 。 屏幕 信息 为 IMPS 没 找到 。 图 　 　 　 为了 解决 这个 问题 ， 笔者 在 IC 的 第三 和 第六 脚到 V 之间 加上 一只 ～ pf 的 小 电容 情况 立即 得到 改善 ， 主控 计算机 与 工作站 通信 得到 恢复 ， 从 示波器 上 看 ， 畸变 的 脉冲 正常 了 。 　 　 实践证明 ， 加上 电容 后 对 原来 能 正常 工作 的 工作站 没有 影响 。 而 加上 了 这个 电容 之后 ， 传输 情况 之所以 会 得到 改善 ， 是因为 未 加 电容 前 ， 电容 C 只是 起到 耦合 作用 ， 它 仅仅 是 一只 耦合 电容 ， 只是 把 主控 计算机 传送 来 的 字符串 耦合 到 比较 器 IC 的 输入 端 进行 译码 ， 同时 也 起到 隔 直流 作用 。 加上 电容 C 后 ， 等于 C 串联 了 电容 C 到 地 。 如图所示 。 图 　 　 　 很 容易 看出 ， 这个 等效电路 已 构成 了 一个 积分电路 ， C 是 这个 积分电路 中 的 一部分 。 这样 从 性质 上 改变 了 C 的 作用 。 由于 C 是 与 C 串联 ， 因此 电容 值要 比 原来 小 ， 此 积分电路 对 传送 来 的 字符串 起到 加速 作用 。 而 对 畸变 了 的 字符串 脉冲 ， 由于 积分电路 的 加速 作用 ， 使 它 的 脉冲前沿 变得 陡峭 。 如图 。 图 　 　 　 畸变 了 的 字符串 信号 得到 了 恢复 。 从而 使 字符串 能 顺利 地被 比较 器 译码 。 　 　 再者 ， 原来 线路 的 C 只是 把 传送 来 的 字符串 耦合 到 比较 器 的 输入 端 ， 这个 输入 端的 信号 并 不 稳定 。 现在 ， C 和 C 构成 一个 分压 电路 ， 传送 到 比较 器 输入 端的 信号 是 C 和 C 的 分压 见 图 ， 相对 稳定 了 比较 器 的 输入 。 图 　 　 　 因此 ， 在 IMP 网络 中 加上 了 电容 C 后 ， 能 使 S 网络 的 工作 更加 稳定 可靠 。 作者简介 沈辉 中岁 　 男 　 高级 工程师 作者 单位 北京 长城 计量 测试 研究所 ， 北京市 信箱 ，