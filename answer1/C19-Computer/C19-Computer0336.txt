计算机 应用 ComputerApplications 年 第卷 　 第期 Vol 　 NoVB 实现 所见即 所得 的 报表 打印 一例 高欣婷 　 潘书军 　 　 摘 　 要 　 通过 对 利用 VB 实现 报表 打印 的 几种 方法 的 概要 分析 ， 本文 提供 了 一种 VB 环境 下 完全 意义 上 的 所见即 所得 打印 功能 的 实现 方法 。 　 　 关键词 　 VisualBasic 报表 打印 　 　 VisualBasic 是 一个 可视性 极强 的 面向 事件 及 对象 的 编程 工具 ， 因 其 简单 高效 ， 易学 易用 而 具有 极其 广泛 的 用户 基础 。 利用 VB 实现 所见即 所得 的 功能 ， 根据 用户 要求 亦 有 多种 实现 方法 。 　 　 由于 VB 中 的 窗体 及 图像 框 皆 可 做 为 其他 对象 的 容器 ， 并且 可 将 自身 直接 输出 至 打印机 ， 所以 一方面 我们 可以 在 窗体 上 加上 一个 图像 框 ， 利用 图像 框 的 Print 、 Circle 等 方法 ， 在 图像 框上 实现 用户 报表 的 输出 ， 然后 再 利用 图像 框 的 Paintpicture 方法 实现 报表 的 打印 ； 另一方面 ， 我们 可以 将 一个 窗体 设置 为 无 边框 无 控制 象 标的 样式 ， 然后 再 利用 其 Print 、 Circle 等 方法 在 其 上 输出 文字 和 简单 的 几何图形 ， 亦可 放上 Label 、 Image 等 控件 ， 引入 文字 或 图像 ， 还 可 利用 VB 的 网格 控件 实现 用户 要求 的 报表 ， 然后 利用 窗体 的 Printform 方法 实现 所 编辑 报表 至 打印机 的 输出 。 　 　 但是 由于 图像 框 的 显示 及 窗体 的 打印 仅仅 局限于 屏幕显示 范围 内 的 内容 ， 不能 实现 真正 意义 上 的 所 见 及 所得 的 功能 。 对于 图像 框 ， 我们 必须 结合 水平 和 垂直 滚动条 ， 实现 有限 视区 的 超 屏幕 内容 的 浏览 ， 其 缺点 是 无法 打印 放置 于 其 上 的 Label 、 Grid 等 对象 ； 对于 待 打印 窗体 ， 我们 必须 设置 一 缩放 因子 ， 将 窗体 及其 上 的 内容 按照 打印 比例 进行 缩小 后 在 屏幕 上 显示 出来 ， 其 缺点 是 无法 对待 打印 报表 进行 的 全真 预览 。 　 　 笔者 在 工作 实践 中 ， 摸索 出 了 一种 方法 ， 集中 了 以上 所 介绍 的 两种 方法 的 优点 ， 实现 了 完全 意义 上 的 所 见 及 所得 的 功能 ， 现 介绍 给 广大读者 ， 希望 能 对 大家 有所 裨益 。 　 方法 概述 　 　 为了 在 屏幕 上 模拟 打印 效果 ， 我们 仍然 利用 VB 的 一个 窗体 模拟 打印纸 。 但 为了 能 让 此 窗体 显示 为 打印纸 的 实际 大小 ， 我们 还 得 在 项目 中 加入 一个 父 窗体 ， 以 之 作为 被 打印 窗体 的 容器 。 将 被 打印 窗体 设为子 窗体 ， 其 大小 设 为 打印纸 大小 ， 这样 即可 利用 父 窗体 的 水平 和 垂直 滚动条 实现 待 打印 对象 的 的 预览 。 具体步骤 为 ： 　 　 新建 一 项目 ， 在 其中 插入 一父 窗体 　 　 将子 窗体 设为 无 边框 无 控制 象 标的 形式 ， 从 Windows 打印 管理器 中 取得 打印纸 的 大小 ， 并 将 此 尺寸 设为子 窗体 的 尺寸 ； 　 　 在 模拟 纸张 上 ， 使用 print 、 circle 、 line 等 方法 输出 文字 和 图形 ， 亦可 利用 图形 框 、 图像 框 、 网格 控制 及 统计图表 等 ， 生成 符合 用户 要求 的 报表 ； 　 　 利用 printform 方法 将 生成 的 报表 输出 至 打印机 。 　 程序实现 　 　 下面 以 实现 以下 报表 为例 ， 讲述 程序 的 具体 编制 。 雇员 情况 一览表 　 员工 编号 姓名 性别 出生年月 职称 工龄 制表 人 ： 　 　 　 新建 一 项目 并 在 项目 中 插入 一父 窗体 Mdiform ， 在 Form 上 加入 一个 网格 及 三个 标签 ， 按照 下表 设置 各 对象 的 属性 。 对 　 象 NameCaptionMdiformmdifrm 报表 打印 Formfrmprint 　 Grddispgrddisp 　 Labellblheading 雇员 情况 一览表 Labellbldata 　 Labellblsigne 制表 人 ： 　 　 此外 ， 将 frmprint 的 Borderstyle 设为 None 、 Controlbox 设为 False 、 caption 设为 空 、 Mdichild 设为 True ； 将 mdifrm 的 Windowstate 设为 Maximized 。 附 源程序 如下 ： PrivateSubMDIForm — LoadfrmprintShowEndSubPrivateSubForm — DblClickfrmprintPrintFormUnloadfrmprintEndSubPrivateSubForm — LoadRem 变量 high 、 leftsize 、 jiange 用以 定位 DimhighleftsizejiangeiAsIntegerjAsIntegerDimgrdhighAsIntegergrdwideAsInteger ′ 分别 表示 网格 的 高 、 宽 jiange ： high ： grdhigh ： grdwideRem 确定 网格 的 大小 GrddispCols ： GrddispRowsRem 设置 窗体 大小 为 打印纸 宽度 frmprintWidthPrinterWidth ： frmprintHeightPrinterHeightfrmprintLeft ： frmprintToplblheadingFontSize ： lblheadingFontBoldlblheadingToplblheadingLeftfrmprintScaleWidthTextWidthlblheadingCaptionhighlblheadingTopTextHeightlblheadingCaptionlbldataTophighjiangelbldataCaptionFormatNowyyyymmddhighlbldataTopTextHeightlbldataCaption … ′ 在 此 进行 行高 、 列宽 以及 对齐 方式 等 项 的 设置 ForiToGrddispColsgrdwidegrdwideGrddispColWidthiScreenTwipsPerPixelXNextiForiToGrddispRowsgrdhighgrdhighGrddispRowHeightiScreenTwipsPerPixelYNextigrdwidegrdwideScreenTwipsPerPixelXgrdhighgrdhighScreenTwipsPerPixelYGrddispWidthgrdwide ： GrddispHeightgrdhighGrddispTophighjiangeGrddispLeftfrmprintScaleWidthGrddispWidthlbldataLeftfrmprintScaleWidthGrddispWidthTextWidthlbldataCaptionhighhighGrddispHeightjiange … ′ 在 此 进行 字体 、 字号 设置 及 网格 内容 的 填充 lblsigntophighjiangelblsignLeftfrmprintScaleWidthGrddispWidthTextWidthlblsignCaptionEndSub 　 　 本文 程序 在 简体中文 Windows 、 Windowsx 下 调试 通过 。 所用 VB 版本 为 ： VisualBasic 专业版 。 　 　 　 作者简介 ： 高欣婷 　 助理 工程师 。 从事 数字 存储 示波器 等 的 计量 检定 工作 。 　 潘书军 　 助理 工程 　 　 　 　 　 　 从事 热电偶 的 计量 检定 及 开发 工作 。 作者 单位 ： 高欣婷 　 潘书军 　 长城 计量 测试 技术 研究所 　 北京 ） 收稿 日期