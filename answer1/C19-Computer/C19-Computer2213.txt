计算机 应用 研究 APPLICATIONRESEARCHOFCOMPUTERSVolNoPMPLS 中 VC 合并 技术 综述 李珂 　 朱康辛 　 顾尚杰 　 诸鸿 文摘 　 要 ： VC 合并 是 MPLS （ MultiprotocolLabelSwitching ： 多 协议 标记 交换 ） 中 的 一项 关键技术 。 介绍 了 不同 的 实现 方案 ， 对 它们 进行 了 较 详细 地 分析 和 比较 ， 给出 了 现有 方案 的 不足 ， 并 对 今后 还 需要 改进 的 方面 进行 了 论述 。 关键词 ： 多 协议 标记 交换 VC 合并 SEAMVP 合并 DIDAAALX 　 引言 　 　 MPLS （ MultiprotocolLabelSwitching ： 多 协议 标记 交换 ） 作为 一种 新 的 IP 与 ATM 综合 的 技术 正在 快速 发展 ， 目前 正由 IETF 的 MPLS 工作组 进行 标准化 工作 。 MPLS 通过 以下 两种 方法 将 网络 的 连接数 从 On 降到 On ， 从而 极大 地 增加 网络 的 可扩展性 。 　 　 ． 对 标记 不同 粗细 程度 的 分类 ； 　 　 ． 流 合并 （ Streammerging ） 。 　 　 MPLS 中 LSP 是 多 点到点 连接 树 （ Mpttopttree ） ， 同 属于 一个 FEC 而 从 不同 入口 节点 来 的 流 在 到达 同一个 出口 节点 的 过程 将 在 某些 节点 处 汇合 ， 这样 不同 的 上游 流在 这些 地方 合并 成 同一个 流 。 支持 流 合并 的 MPLS 节点 产生 On 个 交换 路径 ， 以 提供 到 n 个 目的地 的 通信 。 n 取决于 标记 分类 的 方法 ， 如果 用 网络地址 前缀 分类 ， 则 MPLS 与 现有 IP 网络 的 扩展性 一样 ， 如果 以 出口 路由器 分类 ， 则 扩展性 大大提高 。 流 合并 对于 MPLS 来说 非常 关键 。 如果 不 支持 流 合并 ， 那么 LSP 相当于 点到点 路径 ， 同一个 出口 节点 ， 要 分别 建立 每个 入口 节点 的 LSP 并 分配 不同 的 标记 ， 而且 这种 情况 下 不能 使用 下游 分配 标记 方式 ， 而 只能 用 下游 按需分配 方式 ， 因为 下游 节点 无法 知道 到底 有 多少 上游 节点 要 建立 LSP 。 这 不但 大大降低 了 MPLS 的 扩展性 ， 而且 减慢 了 它 建立 LSP 的 速度 。 　 　 当 MPLS 运行 在 基于 帧 的 媒质 上时 ， 流 合并 很 简单 ， 所要 做 的 仅仅 是 要求 节点 将 多个 上游 标记 对应 到 同一个 下游 标记 ， 这 也 称为 帧 合并 。 但是 在 ATM 上 就 会 产生 问题 。 在 ATM 中 ， MPLS 的 标记 对应 于 ATM 信元 中 的 VPIVCI 域 ， 因此 流 合并 意味着 VPIVCI 合并 。 但是 标准 的 ATM 交换机 不 支持 VC 合并 ， 因为 会 产生 信元 交错 问题 。 在 ATM 上 传送数据 和 多媒体业务 一般 都 采用 AAL 进行 封装 ， 相 比较 于 AAL ， AAL 减少 了 传输 高层 分组 所 带来 的 开销 ， 它 对 同一个 分组 进行 封装 时 ， 没有 机制 来 分辨 不同 的 信元 ， 只是 在 分组 的 最后 一个 信元 中 加入 结束 标志 （ 此信 元 也 称为 EOM 信元 ） ， 它 依赖于 ATM 网络 能 顺序 连贯 地 传送 此 分组 的 所有 信元 ， 接收 方 通过 最后 一个 信元 的 结束 标志 来 重组 分组 。 因此 ， 如果 直接 将 不同 的 VC 合并 成 同一个 出口 VC ， 不同 分组 的 信元 就 会 交错 在 一起 ， 而且 接收 方 没有 办法 能 分辨 出来 。 针对 如何 让 ATM 交换机 支持 VC 合并 这个 问题 ， 已 提出 几种 方案 ， 本文 将 对 这些 方案 进行 详细 地 分析 和 比较 。 　 SEAM 　 　 最 简单 的 方法 是 利用 AAL 对 信元 进行 重组 ， 等 一个 分组 的 所有 信元 都 到达 了 以后 ， 再 一起 发送 出去 。 这样 做 相当于 传统 IP 网络 中 路由器 的 存储转发 （ Storeandfoward ） ， 丢弃 了 信元 交换 的 所有 优点 。 为了 不再 需要 AAL 重组 分组 ， MGrossglauser 等 人 提出 了 SEAM 机制 （ SimpleandEfficientATMMulticast ） 。 SEAM 交换机 对 来自 不同 VC 的 分组 在 输入 队列 中 进行 缓存 ， 只 将 其中 一个 分组 的 信元 交换 至 输出 VC ， 当 这个 分组 的 EOM 信元 也 交换 完毕 后 ， 再 在 输入 队列 中 选择 要 到 同一个 输出 VC 的 另 一个 分组 开始 传输 。 相对 于 第一种 方法 ， SEAM 的 优点 是 不 需要 AAL 对 分组 进行 重组 ， 而且 在 传输 一个 分组 的 信元时 ， 不必 等 此 分组 所有 的 信元 都 到 了 输入 队列 中才 进行 交换 ， 当 输出 VC 被 占用 的 时候 ， 信元 进行 存储 ， 当 输出 VC 空闲 的 时候 ， 它们 可以 立即 传输 。 这种 机制 存在 以下 缺点 和 需要 优化 的 问题 ： 　 　 ① 对 输入 缓存 需求 很大 ； 　 　 ② 当 正在 传输 的 分组 丢失 了 EOM 信元时 ， 其它 等待 的 VC 中 的 信元 将 被 阻塞 。 解决 的 办法 是 设定 一个 时间 期限 的 参数 。 这个 参数 的 大小 由 链路 的 容量 、 当前 VC 的 带宽 和 网络 当时 的 负载 大小 决定 。 如何 具体 设定 这个 参数 的 值 非常 重要 ， 因为 它 对 输入 缓存 的 需求 以及 交换机 的 性能 有 非常 大 的 影响 ； 　 　 ③ 一个 分组 的 信元 由于 输出 VC 忙 ， 而 在 输入 队列 中 等待 时 ， 将 可能 会 影响 此 输入 端口 其它 无 冲突 的 信元 的 交换 。 　 VP 合并 　 　 一种 方法 是 采用 VP 合并 （ VPMerging ） ， 不同 的 流 使用 不同 的 VCI ， 利用 交换机 的 VP 合并 能力 ， 这样 既 不 需要 额外 的 缓存 ， 也 不 引入 额外 的 时延 。 到达 交换机 的 来自 不同 流 的 信元 可以 直接 进行 交换 ， 因为 它们 的 VCI 不同 ， 不会 有 信元 交错 的 问题 产生 。 这种 方式 也 存在 以下 问题 ： 　 　 ① 如何 分配 VCI 空间 以 保证 VCI 的 唯一性 。 已经 提出 几种 可能 的 方案 ： 预先 配置 ； 在 ATM 交换机 中 扩展 硬件 ， 通过 动态 改变 避免 冲突 来 保证 VCI 的 唯一性 ； 制定 一种 新 的 协议 机制 来 实现 等等 。 具体 选用 其中 的 一种 或 几种 还有 待 进一步 研究 ； 　 　 ② VPIVCI 的 使用 效率 很 低 ， 限制 了 网络 的 可扩展性 ； 　 　 ③ 在 不 支持 SVP 的 公用 ATM 网络 中 无法 实现 。 　 　 ATM 论坛 的 Venkateswaran 等 人 提出 了 一种 改进 的 VP 交换 和 合并 机制 （ ImprovedVPSwitchingandMerging ） 。 主要 原理 没有 什么 变化 ， 针对 原有 VP 合并 机制 中 VP 空间 太小 ， 在 保证 ATM 信元 中 VPIVCI 总长度 不变 的 情况 下 ， 将 VPI 域 变为 bits ， 而 VCI 域 减少 到 bits 。 这种 机制 在 增加 网络 支持 的 VP 数 的 同时 ， 使得 使用 同一个 VP 的 发送 方 数目 限制 在 之内 ， 除此之外 没有 解决 任何 问题 ， 而且 需要 改动 ATM 交换机 的 硬件 以 支持 新 的 VPIVCI 编码方式 。 　 DIDA 　 　 ATM 论坛 的 Calvigance 等 人 还 提出 了 一种 很 类似 的 机制 ： 动态分配 标识符 机制 （ DIDA ： DynamicIdentifierAssignment ） 。 DIDA 不 需要 对 VCI 进行 全局性 分配 ， 对 每 一个 到来 的 分组 ， DIDA 在 其 VCI 域 插入 一个 局部 唯一 的 标识符 。 在 其它 实现 VP 合并 的 机制 中 ， VCI 都 是 表示 分组 的 来源 （ 即 ： 对于 同一个 目的地 ， 一个 源 发送 的 所有 分组 的 VCI 都 是 相同 的 ） ， 而 DIDA 中 却 用 它 来 表示 一个 分组 （ 即 ： 一个 源 发送 的 不同 分组 可以 有 不同 的 标识符 ） 。 DIDA 的 优点 是 不 存在 对 VCI 空间 分配 的 问题 ， 只 需 对 正在 传送 的 分组 分配 标识符 ， 当 此 分组 传送 完毕 后 ， 该 标识符 可以 回收 再 分配 。 缺点 是 需要 修改 ATM 交换机 的 硬件 ， 要 改变 进来 的 每个 信元 的 VCI 值 ， 并 要 有 专门 的 算法 来 管理 和 分配 局部 标识符 。 同时 由于 没有 修改 VPI 的 长度 ， 所以 能 同时 支持 合并 的 数目 在 之内 。 　 阱 树 机制 　 　 Cohen 等 人 提出 一种 阱 树 机制 （ TheSinkTreeParadigm ） ， 主要 面向 ATM 局域网 。 在 ATM 局域网 中 ， 所有 的 ATM 交换机 用 某种 交织 的 形式 互连 ， 每个 交换机 连 着 一些 主机 。 当 主机 之间 互传 分组 时 ， 通过 在 VPIVCI 域 中 同时 携带 源 目的 交换机 标识符 和 目的 主机 标识符 ， 来 保证 在 信元 交错 的 情况 下 可以 进行 分组 重组 。 由于 所有 的 信息 都 在 VPIVCI 域 中 ， 因此 可用 空间 很少 ， 扩展性 很差 。 实际上 ， 交换机 标识符 为 bits ， 主机 标识符 为 bits ， 这 就 意味着 局域网 中 最 多 可以 有个 交换机 ， 每个 交换机 可以 连接 个 主机 ， 这 对于 局域网 而言 已经 足够 ， 但 无法 扩展 到 大型 网络 中 去 。 另外 ， 此 方法 还 需要 完全 改变 ATM 的 前 传 规则 ， 通过 对 目的 交换机 标识符 来前 传信 元 ， 而 不是 简单 的 标记 交换 。 　 AALX 　 　 Baldi 等 人 从 另 一个 角度 来 看待 VC 合并 这个 问题 ， 标准 的 AAL 没有 提供 如何 分辨 同一 分组 中 不同 信元 的 机制 ， 他们 则 通过 扩展 AAL （ AALX ： ATMAdaptationLayereXtension ） 使 它 能 提供 某种 识别 机制 。 主要 的 改变 是 在 SAR 子层 （ SegmentationAndReassembly ） 加入 个 字节 的 MID （ MessageIDentifier ） 域 ， 对于 同一个 分组 （ 即 同一个 CPCSPDU ） 而言 ， 通过 SAR 子层 而 形成 的 信元 的 MID 值 都 是 一样 的 ， 这个 值 由 SAR 子层 随机 决定 ， 范围 是 ～ 。 即使 在 中间 ATM 节点 处 发生 了 信元 交错 ， 接收 方 的 AALX 的 SAR 也 可以 通过 MID 来 缓存 不同 分组 的 信元 ， 直到 相应 MID 的 EOM 信元 到达 。 当 某个 分组 的 EOM 信元 丢失 时 ， 接收 方将 无法 回收 此 分组 先前 到达 的 信元 所 占用 的 缓存 ， 通过 设定 一个 时间 间隔 参数 ， 如果 超过 这 段时间 还 未有 信元 到达 ， 则 将 此 MID 所 占用 的 缓存 释放 。 由此 机制 可以 看出 ， 原则上 AAL 也 可以 用于 VC 合并 ， 但是 AAL 的 MID 域 只有 bits ， 用于 随机 分配 的 空间 太小 ， 而且 AAL 的 MID 用来 区分 同一个 源 （ 而 不是 不同 的 源 ） 同一个 VC 的 多种不同 的 流量 。 这种 机制 的 优点 是 对 网络 中 的 ATM 交换机 不 需要 任何 修改 ， 既 不 需要 扩展 硬件 ， 增加 缓存 ， 也 不 需要 改变 ATM 的 前 传 规则 。 交换 网络 不 引入 额外 的 时延 ， 但 也 存在 以下 缺点 和 需要 进一步 研究 的 问题 ： 　 　 ① 需要 修改 发送 方 和 接收 方 的 AAL 层 的 发送 和 接收 机制 ， 一般来说 是 网络 边界 设备 或 直接 连 到 网络 上 的 主机 ； 　 　 ② MID 占用 了 个 字节 ， 使 AAL 的 传输 效率 有所 下降 ； 　 　 ③ 原有 AAL 可以 正好 用 一个 信元 传输 TCP 控制 消息 ， 如 确认 信息 （ IP 头 字节 ， TCP 头 字节 以及 AALCSPDU 尾部 个 字节 ） ， 但 AALX 的 有效 负荷 仅 字节 ， 因此 传输 TCP 的 控制 信息 时 ， 效率 下降 了 一半 ； 　 　 ④ MID 为 随机 分配 ， 因此 有 可能 不同 发送 方 的 不同 分组 采用 相同 的 MID 值 ， 此时 AALX 无法 分辨 ， 这 称为 MID 冲突 （ MIDCollision ） 。 基于 简单化 ， 文献 未 提出 防止 MID 冲突 的 机制 ， 因此 这 将 造成 分组 丢失 ； 　 　 ⑤ 为 有效 回收 缓存 而 设定 的 时间 间隔 参数 对 性能 和 缓存 需求 影响 很大 ， 这 类似 于 SEAM 机制 中 的 时间 间隔 参数 。 这个 参数 至少 不能 小于 网络 最大 传输 时延 抖动 ， 否则 有 可能 信元 并未 丢失 而仅 因为 时延 而 被 抛弃 。 文献 对此 参数 的 研究 还 不 完善 ， 如 并 没有 研究 当 参数 小于 网络 最大 时延 抖动 时 对 网络 的 影响 如何 ； 　 　 ⑥ 接收 方 需要 极大 的 缓存 。 需要 对 每个 到来 的 MID 设置 不同 的 缓存 队列 ， 每个 队列 要 能 缓存 整个 CPCSPDU ， 而 CPCSPDU 的 理论 最大值 为 字节 。 即使 在 IPoverATM 环境 中 ， 最大 传输 单元 （ MTU ） 为 字节 ， 文献 研究 表明 ， 当 发送 方为 时 ， 需 M 缓存 。 因此 ， 限制 了 它 在 大型 网络 中 的 应用 。 　 IETF 的 方案 　 　 根据 MPLS 的 需求 可知 ， MPLS 面向 的 是 Internet 的 主干网 ， 在 ATM 中 对流 合并 的 基本 要求 是 扩展性 好 ， 对 VPIVCI 利用率 高 ， 不 改变 ATM 的 前 传 规则 ， 特别 是 不能 修改 VPIVCI 的 结构 和 语义 ， 前面 几种 机制 均 不能 完全 满足 这些 要求 。 因此 IETF 工作组 在 年 月 推出 的 草案 中 提出 了 一种 机制 ， 并 初步 研究 了 它 的 性能 。 它 不 像 SEAM 那样 在 输入 端 缓存 分组 ， 而是 在 输出 端 缓存 ， 这样 就 不再 要求 ATM 交换机 必须 对 一个 分组 的 所有 信元以 一种 原子 方式 （ AtomicManner ） 处理 ， 并 避免 了 排头 阻塞 的 问题 。 它 允许 ATM 交换机 独立 地 交换 每个 信元 ， 通过 在 输出 端 加入 几 部分 扩展 的 硬件 （ 重组 缓存 、 合并 单元 和 输出 缓存 ） ， 来 完成 VC 合并 ， 并且 完全 独立 于 ATM 交换机 的 交换 部分 。 这样 做 的 优点 是 不 修改 ATM 的 前 传 规则 、 不 修改 VPIVCI 结构 、 不 修改 AAL ， 初步 研究 结果表明 ， 与 大多数 人 期望 相反 ， 对 缓存 的 要求 很小 。 其 存在 的 不足 是 ： 　 　 ① 文献 只 给出 了 一个 比较简单 的 输出 缓存 模型 ， 而且 研究 的 重点 只 放在 VC 合并 和 非 VC 合并 之间 的 性能 比较 上 ， 其 性能 研究 并 不 完善 ； ② ATM 中有 业务 成形 （ TrafficShaping ） 的 功能 ， 它 使 每个 VCI 中 的 信元 不是 相互 紧接着 传送 ， 而是 让 信元 之间 有 间隔 ， 以便 ATM 交换机 有 时间 进行 缓存 的 分配 和 调度 。 VP 合并 保留 了 这个 优点 ， 但 由于 在 文献 中 需要 一个 分组 （ 或 一个 AAL 帧 ） 的 信元 全部 到达 才能 开始 发送 ， 这 就 造成 了 两者 的 冲突 。 今后 还 需 改进 的 地方 　 　 除此之外 还 存在 一些 别的 问题 ： 　 　 ① VC 合并 中 如何 对 QoS 进行 支持 ， 当 VC 合并 后 ， 不是 对 某个 VC 进行 QoS 的 支持 ， 而是 对 一组 VC 的 QoS 的 支持 ； 　 　 ② MPLS 工作组 认为 在 直接 路由 LPSs 中 是否 支持 流 合并 还有 待 进一步 研究 ； 　 　 ③ 如何 支持 VP 合并 、 VC 合并 以及 非 合并 LSRs 间 的 互操作性 ， 这 主要 涉及 到 采用 不同 方法 的 节点 对 标记 分配 的 需求量 不 一样 ； 　 　 ④ MPLS 允许 LSRs 不 支持 流 合并 ， 问题 是 此类 LSR 如何 进行 标记 分配 ， 因为 对于 某个 特定 的 FEC ， 它 无法 知道 上游 （ Upstream ） 有 多少 节点 ， 一种 可行 的 方法 是 采用 下游 按需分配 的 方式 ； 　 　 ⑤ 不 支持 VC 合并 的 ATM 交换机 必须 提供 某种 防止 和 检测 路由 环 的 机制 ， 否则 会 造成 螺旋线 现象 ， 极大 地 消耗 标记 ， 因为 环中 的 流 无法 合并 。 　 　 VC 合并 技术 是 MPLS 中 的 一项 关键技术 ， 极大 地 影响 着 网络 的 可扩展性 和 整体 性能 。 目前 VC 合并 技术 还 远 未 发展 成熟 ， 还有 许多 问题 需要 进一步 的 研究 。 李珂 （ 上海交通大学 电子 工程系 上海 ） 朱康辛 （ 上海交通大学 电子 工程系 上海 ） 顾尚杰 （ 上海交通大学 电子 工程系 上海 ） 诸 鸿文 （ 上海交通大学 电子 工程系 上海 ） 参考文献 MGrossglauseretalSEAMScalableandEfficientATMMulticastInfocomAprilRVenkateswaranetalSupportforMultiwayCommunicationsinATMNetworksATMForumContributionMayJCalvignacetalDynamicIdentifierAssignmentDIDAforMergedATMConnectionsATMForumContributionJulyRCohenetalTheSinkTreeParadigmConnectionlessTrafficSupportonATMLANsIEEETransactionsonNetworkingVolNoJuneMBaldietalAALXATMAdaptationLayereXtensionforEfficientVCMergingoverATMNetworkshttpwwwpolitoit ～ bergamadpublicationshtmlIWidjajaetalPerformanceIssuesinVCMergeCapableMPLSSwitchingInternetDraftOctIWidjajaetalStudyofImplicationsofVCMerginginMultiprotocolLabelSwitchinghttpcmbelllabscomcmmswhoanwarpubhtml 收稿 日期 ： 年月日