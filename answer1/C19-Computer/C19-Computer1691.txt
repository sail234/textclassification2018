软件 学报 JOURNALOFSOFTWARE 　 Vol 　 No 　 P 基于 形式化 方法 的 因特网 路由 协议 的 一致性 测试 毕军 　 吴建平 摘要 　 并发 数表 组合 表述 法 并发 TTCN 是 可以 描述 并发 测试 行为 的 测试 表述 法 该文 提出 一种 基于 并发 TTCN 的 分布式 路由 协议 的 测试方法 首先 讨论 路由 协议 实体 的 测试 结构 ， 然后 给出 基于 并发 TTCN 测试 系统 的 设计 最后 介绍 了 测试 集 的 设计 关键词 　 一致 行 测试 ， 分布式系统 ， 路由 协议 ， 因特网 ， 并发 数表 组合 表述 法 中图法 分类号 　 TP 　 AFormalApproachtoConformanceTestingofInternetRoutingProtocolsBIJun 　 WUJianping 　 （ DepartmentofComputerScienceandTechnology 　 TsinghuaUniversity 　 Beijing 　 ） 　 Abstract 　 　 ConcurrentTTCNtreeandtabularcombinednotationisatestnotationthatcanhandleconcurrenttestbehaviorsThispaperproposesanapproachtotheconformancetestingofdistributedroutingprotocolsbasedonconcurrentTTCNItfirstdiscussesthetestarchitecturefortheroutingprotocolentityandthentheconcurrentTTCNbasedtestsystemdesignispresentedFinallythispaperintroducesthetestsuitedesign 　 Keywords 　 ConformancetestingdistributedsystemroutingprotocolinternetconcurrentTTCN 　 　 OSPFnowisthemostimportantroutingprotocolandiswidelyusedintheInternetThequalityoftheOSPFproductswouldinfluencethestabilityofnetworksanditisreallynecessarytogivetheconformancetestassessmentofOSPFroutersHowevertheroutingfunctionsarerealizedbythecooperationofdistributedroutersThenhowtoformallyspecifyandtesttheconcurrentbehaviorsofOSPFrouterisachallengetothetraditionalprotocoltestmethodsandtestsystemsInRefssomeproblemsofconformancetestingindistributedsystemswerestudiedTheentityindistributedsystemsismorecomplexandgeneralthantraditionalpeertopeerprotocolentityAnentityindistributedsystemsisassociatedwithasetofinteractionpointsandasetofconcurrentbehaviorsattheseinteractionpointsInthispaperwepresentaspecificationmodelcalledconcurrentexternalbehaviorexpressionCEBEtospecifytheentityCEBEcoulddirectlyspecifytheconcurrentexternalbehaviorsatdifferentinteractionpointsofanentityandreducetheinternalstatesactionsanddataThereforeitisanidealmodeltoformallyspecifytheentityinacomplexdistributedsystemandtogenerateconcurrentTTCNCTTCNtestsuiteMoreoverweformallydefinetestsystembasedonCTTCNoperationalsemanticsTheabovemethodshavebeenputintopracticebyusinganintegratedtestsystemPITSandanautomatictestgenerationtoolTUGENtotestCISCOrouter 　 　 TherestofthispaperisorganizedasfollowsInSectionwegiveouttheabstracttestarchitectureThenwediscussthetestsystemdesignandtestsuitegenerationinSectionsandrespectivelyFinallyweconcludethispaperinSection 　 AbstractTestArchitecture 　 　 TheTreeandTabularCombinedNotationTTCNisrecommendedbyISOtodescribeabstracttestsuiteCTTCNisanextensionofTTCNthatallowsthetestsystemtoexecuteatestcasebyseveraltestcomponentsTCsrunninginparallelAtesterconsistsofexactlyonemaintestcomponentMTCandanynumberofparalleltestcomponentsPTCsTCsarelinkedbycoordinationpointsCPscapableofconveyingcoordinationmessagesCMsCommunicationsofTCswiththeenvironmentarethroughthepointsofcontrolandobservationPCOsCTTCNisverysuitableforthespecificationofasystemconsistingofseveraltesterswhilethisisthecommoncaseinroutingtestingThetestarchitectureisadescriptionoftheenvironmentinwhichIUTImplementationunderTestistestedForarouterentitytherearekconcurrentbehaviorswhichhappenatinteractionpointsIfandonlyifallthesebehaviorsconformtothebehaviorsofitsspecificationitisaconformanceimplementationThenthetestarchitectureshoulddealwiththeseconcurrentbehaviorsatseveralinteractionpointsWeconstructtheabstracttestarchitectureaccordingtothisfeatureItconsistsofatestsystemanentityundertestatestcontextseveralPCOsandseveralinteractionpointsThetestsystemistheimplementationofatestsuitewritteninCTTCNItcarriesouttheexperimentsbyexecutingtestcasesandobservingresultsTheinteractionsoftheIUTwithitsenvironmenttakeplaceatinteractionpointsIPsThetestsystemcommunicateswiththeIUTindirectlythroughthetestcontextThepointswherethetestercommunicateswiththetestcontextandinthiswayindirectlycontrolsandobservestheIUTarecalledthePointsofControlandObservationPCOsExecutionofatestcasestartswiththeexecutionofMTCItistheconcernofMTCtosetupallPTCsandtomanageallPCOsandCPstobeconnectedtoPTCscanbecreatedbyMTCondemandA ‘ create ’ operationassociatesaPTCwithabehaviortreeThenewlycreatedPTCstartsexecutionofitsassignedbehaviortreeconcurrentlywithMTCMTCmayexplicitlyterminateaPTCbyexecutinga ‘ down ’ operation 　 CTTCNBasedTestSystem 　 Preliminaries 　 　 DefinitionALabeledTransitionSystemLTSisatuple 〈 SLTs 〉 SisacountablenonemptysetofstatesLisacountablesetofobservableeventsTS × L ∪ τ × Sisasetoftransitionswhere τ denotesanunobservableeventElementsus ′ inTcanalsobewrittenaswheress ′ ∈ Su ∈ L ∪ τ s ∈ Sistheinitialstate 　 　 WeuseLTSsLtodenotethesetofallpossiblelabeledtransitionsystemsoverLTraceisacommonconceptinLTSDefinitiongivesoutitsdefinitionandsomeusefulnotationDefinitionLet 〈 SLTs 〉 beanLTTSL ′ L ∪ τ containsallobservableandunobservableeventsss ′ sssnsn ∈ Suuun ∈ L ′ Let σ u 。 u 。 ． ． ． 。 unbeasequenceoflabelsinL ′ ‘ 。 ’ denotesconcatenationthen σ issaidtobeatraceoverL ′ L ′ denotesthesetofallpossibletracesoverL ′ Wefurtherhavethefollowingnotations 　 　 。 　 　 。 ifistheconcatenationofzeroormore τ 　 　 　 　 InLTSmodeleventsinLaretreatedinthesamewaynomatterwhattheymeanInordertodistinguishinputeventsfromoutputeventsakindofLTScalledinputoutputtransitionsystemisintroducedDefinitionAnInputOutputTransitionSystemIOTSpisanLTSinwhichthesetofeventsLispartitionedintoinputeventsLiandoutputeventsLowhereelementsinLiareeventsacceptedbythisLTSfromitsenvironmentandelementsinLoareeventssenttoitsenvironmentbythisLTSIOTSpsatisfiesp ∈ LTSsLLLi ∪ LoandLi ∩ Lo Φ IOTSsLiLorepresentsthesetofallpossibleinputoutputlabeledtransitionsystemsoverinputeventsLiandoutputeventsLoIOTSsLiLoLTSsLi ∪ Lo 　 　 DefinitionInputqueueoperatorisaunaryoperator ［ 。 ］ σ iIOTSsLiLo → IOTSsLiLowhere σ i ∈ LiLetTS ∈ IOTSsLiLothen ［ TS ］ σ iisdefinedbytheaxiomAandinferencerulesIIandI 　 　 WewillnameS σ iastheInputBufferedTransitionSystemIBTSForacommoncommunicationsystemwecanmodelitsbehaviorbyonlyoneInputBufferedTransitionSystemWhileconsideringcommunicationsystemwhosefunctionisperformedbyseveralconcurrentspartsweneedagroupofIBTSstomodelitsbeheviorsThenweintroduceaformaldefinitionofcommunicationsystemintehfollowingDefinitionAcommunicationsystemconsistingofnconcurrententitiescanbemodeledbyanIOTS Σ 〈 S Σ Ext × N × L Σ i ∪ N × Ext × L Σ oTrs Σ 〉 whereS Σ isthestatesetofthisIOTSelementinS Σ canberepresentedby 〈 sssn 〉 where ≤ i ≤ nsiisthestateofithIBTSthatisdefinedoverinputactionsID × ID × LiandoutputactionsID × ID × LoIDExtnL Σ iL Σ oarethesetofinputactionsandthesetofoutputactionsofthiscommunicationsystemrespectivelyExtistheidentificationoftheoutsideenvironmentofthiscommunicationsystemNneachnumberinNrepresentsanIBTSs Σ istheinitialstates Σ 〈 sssn 〉 siistheinitialstateofithIBTSTransitionssetTrisinferredfromthefollowingaxiomandrules 　 TheCTTCNbasedtestsystemdesign 　 　 Wewilluse “ communicationsystem ” indefinitiontoformallydescribetheinteractionbetweentestsystemandIUTTodesigntheCTTCNbasedtestsystemweshouldstudytheoperationalsemanticsofCTTCNfirstInaCTTCNtestcasethebehaviorofeachtestcomponentisexpressedwithaTestBehaviorTreeTBEwhichisatreelikepresentationoftemporalrelationsbetweentestevents 　 　 DefinitionTBEBdefstopexitidaBidyBB ［ ］ BBB ［ q ］ BIvalBBstarttidvalBcanceltidB ｜ timeouttidBcreateidBdoneid 　 　 DefinitionATestComponentTCisavirtualmachinethatcanperformtheevaluationoftestbehaviorexpressionsItcanbemodeledbyanIBTS ［ ctl ， sto ］ σ ictlisaTBEspecifyingthebehaviorsofthisTCstoisthetestcontextofthistestcomponentstoiviv ∈ MEMIdent × ValueIdentandValuearethesetsofidentifiersandvaluesrespectivelyElementsinstoarepairsofidentifierandvalueeachelementcorrespondstoavariableorconstantintestsuiteanditsvalue σ iistheinputbufferedqueueofthistestcomponentTheinitialstateofthisTCisTC ［ TBETCsto ］ ε whereTBETCisthecompletebehaviorspecificationofthisTCstodenotestheinitialsituationofthetestcontextand ε representsthattheinputbufferedqueueisempty 　 　 DefinitionATestSystemTSisasystemthatcanperformtheevaluationofatestcasespecifiedinCTTCNItcontainsonemaintestcomponentandzeroormoreoptionalparalleltestcomponentsItsrunningcanbemodeledbyacommunicationsystem 〈 STSExt ∪ Tim × N × LTSi ∪ N × Ext ∪ Tim × LTSoTransTS 〉 wherethestateofTSinSTSisthecombinationofthestatesofntestcomponents 〈 TCTCTCn 〉 TCirepresentsthestateoftestcomponentiTCi ［ TBEisto ］ σ isTSistheinitialstateofthisTSsTS 〈 TCi ≤ i ≤ n 〉 whereTCiistheinitialstateoftestcomponentithesetofinputactionsofthisTSisExt ∪ Tim × N × LTSiandthesetofoutputactionsisN × Ext ∪ Tim × LTSoidentifierExtrepresentstheoutsideenvironmentofthistestsystemTimrepresentsthetimingsystemNisthesetofnaturalnumbernwhichisusedtoidentifyeachtestcomponentand τ denotesunobservableactionsTranisthesetoftransitionsthataredefinedbythefollowingaxiomsandreferencerules 　 　 FortheconvenienceofdiscussionwesupposethatsystemsundertestcanalsobemodeledbyacommunicationsystemWhentestingitconsistsofmanyinterfacesconnectedtothetestsystemDefinitionThesystemundertestSUTisacommunicationsystem Σ thatconsistsoflotsofInputBufferedTransitionSystems Σ isdenotedby 〈 SSIUTExt × N × LTSo ∪ N × Ext × LTSiTransSUT 〉 wherethestateof Σ isobtainedfromthestatesoftwoIBTSssSUT 〈 sIUTsIUTsIUTn 〉 wheresIUTsIUTsIUTnarethestatesofthebehaviorsateachinteractionpointrespectivelytheinitialstateof Σ issSUT 〈 sIUTsIUTsIUTn 〉 wheresIUTsIUTsIUTnaretheinitialstatesofthebehaviorsateachinteractionpointrespectivelythesetofinputactionsto Σ isExt × n × LTSocorrespondingtotheoutputactionsfromTSthesetofoutputactionsfrom Σ isn × Ext × LTSicorrespondingtotheinputactiontoTS τ isanunobservableactionTranisthesameasindefinition 　 　 ThetestingprocesscanbedescribedbysynchronouscommunicationsbetweenTSandSUTWeuseasynchronousoperator ‘ ‖ ’ toexpressthatwhenTSorSUTsendsoutanactionSUTorTSwillreceiveitatthesametimetheyaresynchronousatthisactionWecanusesTS ‖ sSUTtodescribethewholetestexecutionprocessThesynchronousoperationcanberepresentedasfollows 　 　 Theresultoftestexecutionisatrace σ ofsTS ‖ sSUTthatsatisfiestheaboveoperationrulesGivenatestcasettheexecutionresultoftinaTSdefinedaboveisatrace σ RuntSUTs σ where 　 　 Thefinaltestverdictofthiscasetisbasedonthecorrespondingverdictoftheistrace σ 　 CTTCNTestSuiteGeneration 　 BasicdefinitionsofCEBE 　 　 InthissectionweproposeanentityspecificationmodelCEBEItisanextensionofEBEpresentedinRefTheessenceofbothEBEandCEBEistodescribethedatainadditiontothecontrolbehaviorfromtheviewpointoutsidethesystemByeliminatingtheinternalactionsthespecificationofCEBEcouldbeobtainedfromETStheextensionofETSpresentedinRefwhichcouldbetranslatedfromLOTOSandEstelleThereforetheCEBEmaybetranslatedfromthestandardFDTsDefinitionACEBEisatuple 〈 SG Σ ARsv 〉 whereSisafinitesetofexternalstateswhoseelementsarepausestatesofinteractionsexchangedbetweentheentityanditsexternalenvironmentGisasetofgatesoverwhichaCEBEcancommunicate Σ isthesetofdataonCEBEseebelowAisasetofexternalactionsonCEBEseebelowRisasetoflogicrelationsoftransitionsbetweenexternalstatesseebelows ∈ Sistheinitialstateoftheentitywhichrepresentstheinitialexternalstatevisthesetofinitialassignmentsinitialvaluesofallvariablesandtimersof Σ 　 　 Definition Σ IO ∪ VAR ∪ CONS ∪ TIMER ∪ PARAisasetofdataonCEBEwhereIOisthesetofinputoroutputeventsietheASPsandPDUsVARisthesetofvariablesthetypeofvariablesincludesintegerbooleanoctetstringbitstringandsoonCONSisthesetofconstantsthetypeofconstantsincludesintegerbooleanoctetstringbitstringandsoonTIMERisthesetoftimerssecondandmicrosecondPARAisthesetofparametersofeventsinIOForanevente ∈ IOtheparameterspppnaredenotedasepepepneisdenotedaseepepepn 　 　 DefinitionAbehaviorbiselementsgofGwithalistofinputandoutputeventsandtheirvaluedeclarationThenthesetofbisdenotedasB 〈 giriripripripnsisipsipsipn 〉 gi ∈ Grisi ∈ IOripisipi ∈ PARAwheresymbol “ ” indicatestheoutputofaneventsitoexternalenvironmentandsymbol “ ” indicatestheinputofaneventriTheabsenceofriorsicouldbedenotedassymbol “ ” forexampleb 〈 giriripripripn 〉 Herewegivesomenotationsbbbnthebehaviorsaresequentialb ［ ］ b ［ ］ ［ ］ bnthebehaviorsareequallyvalidalternativeschoiceb ‖ b ‖ ‖ bnthebehaviorsareparallel 　 　 DefinitionActionsAarethesetofconcurrentbehaviorsAaiai ∈ Aaidefbj ∈ Bai ［ ］ aiaiaiai ‖ aiaiwheretheoperatorprecedenceis ‘ ’ ‘ ［ ］ ’ ‘ ’ ‘ ’ DefinitionTransitionrelationRS × A × S × P × PowerSetO × PowerSetFisthesetoftransitionrelationswhereAisthesetofactionsSisthesetofstatesoftheCEBEP Σ PowerSet Σ → TRUEFALSEisthesetofpredicatefunctions ≥ ≤ ∧ ∨ ┐ TimeoutetcO Σ PowerSet Σ → PowerSet Σ isthesetofoperationfunctionsStartTimerCancelTimeretcF Σ PowerSet Σ → PowerSet Σ isthesetoffunctionsiemaxminetc 　 　 Theintuitivemeaningofatransitionr ∈ RisthatifCEBEisinstatesandtheenablingactionaisofferedthentheenablingpredicatepisevaluatedonthecurrentassignmentofvariablesWhenpistrueCEBEwillgointoanewstates ′ andtheenvironmentisupdatedbytheoperationoandfunctionfTheabsenceofpredicatecouldbedenotedasTRUEabsenceofoperationorfunctioncouldbedenotedasNIL 　 CEBEbasedtestsequencederivation 　 　 ThetestsequencederivationstrategyisdefinedastwostepsStepIdentifyallpossiblevalidIPsinteractionpathAnIPistheexternallyobservabletrackonwhichasequenceofinteractionsbetweentheentityanditsexternalenvironmentoccursstartingfromtheinitialexternalstatesandendingatthesamestateAnyinteractionlooporcycleinanIPistraveledonlyonceInteractionpathwithloopisaninteractionpathinwhichoneormoreloopinteractionsexist 　 　 StepGenerateSIPsIOSubpathfromtheaboveIPsbycheckingthedependenciesbetweentransitionsineachIPAnSIPistheexternallyobservabletrackrrkinanIPwherer 〈 srars ′ rprOrFr 〉 isthefirsttransitionrelationwhichsatisfiesaapredicatepr Σ prandor 　 　 basetofoperationsori Σ oriandor 　 　 casetoffunctionsfri Σ fri 　 　 rk 〈 srkarks ′ rkprkOrkFrk 〉 isobtainedwhenlogicalrelationssatisfy 　 　 　 　 bapredicatepk Σ prkandor 　 　 casetofoperationsokj Σ orkjandor 　 　 dasetoffunctionsfkj Σ frkj 　 TheCTTCNtestsuitegeneration 　 　 BasedontheSIPatesttreewiththecorrectnessnondeterminsticanddefensebranchescanbederivedandthreekindsofverdictsPASSFAILandINCONCareassignedtoeachleafofthetesttreeThetesttreecanbemappedtoatestcaseinCTTCNFinallythesetestcasesaregroupedaccordingtosomerulesandaremappedtoacompletetestsuiteinCTTCNTounderstandthealgorithmhereweuseTBEtodescribetherulesforCTTCNgenerationRuleEachSIPismappedtooneCTTCNtestcaseRuleInoneSIPifthereareseveralrelationsrrrnthenattachtreeitotreei 　 　 TBEMrrrn 　 　 RuleInactionaofrelationrifbbbnthenbbbnarebehaviorsanditissuccessfullycompletedifbihappensimmediatelyafterthesuccessfulcompletionofbiin 　 　 TBEM ： createPTBEstarttCPCMdownPstoptimeouttstopTBE ： bbbnCPiCMistopRuleInactionaofrelationrifb ［ ］ b ［ ］ ［ ］ bnthenanalternativeismatchedifthebehaviorbicorrespondingtothealternativehappensfirst 　 　 TBEM ： createPTBEstarttCPCMdownPstoptimeouttstopTBE ： bCPiCMistopbCPiCMistopbnCPiCMistopRuleInactionaofrelationrifb ‖ b ‖ ‖ bnthenbbbnarestartedinparallelandtheparalleltreecompletesonlyifbbbncomplete 　 　 TBEM ： createPTBEcreatePnTBEnstarttCPCMdownPstarttCPnCMndonePnstoptimeouttnstoptimeouttstopCPnCMndownPnstartttimeouttstoptimeouttstop 　 　 TBEi ： biCPiCMistop 　 　 RuleIneachbehaviorbofactionainarelationrthereexists 〈 giriripripripnsisipsipsipn 〉 then 　 　 TBEigirigisiCPCMstopRuleInthedeclarationpartthetimervariableandconstantcouldbemappedfromTIMERVARandCONSwiththeinitialvaluefromv 　 　 RuleIndeclarationpartASPPDUcouldbemappedfromIOwithparametersPARAfortheevents 　 　 RuleInconstraintpartthetimervariableASPandPDUcouldbemappedfromeacheventeieipeipeipninbwiththevaluesofparameters 　 Conclusions 　 　 InthispaperweuseCTTCNtomeettheneedsofOSPFroutingprotocoltestingTherealtestingisaccomplishedbyanintegratedtestsystemPITSoverSunworkstationandwithSolarisoperatingsystemPITSisageneralsystemwithCTTCNoperationalschematicsbasedtestexecutionInfuturewewouldperformmorerealteststoverifyourmethodstestgenerationtoolandtestsystemTheCEBEandCTTCNbasedconceptsandmethodinthispapermaybefurtherusedintheareaofconformancetestingindistributedsystemsForexampleCEBEcouldbeusedtomodelmostentitiesinOSITCPIPandODP 毕军 （ 清华大学 计算机科学 与 技术 系 北京 ） 　 吴建平 （ 清华大学 计算机科学 与 技术 系 北京 ） References ， PickinSetalAnapproachtothevalidationofopenobjectbaseddistributedapplicationsInBaumgartenBedTestingofCommunicatingSystemsLondonKluwerAcademicPublisher ～ ， WongACYChansonSTCheungSCetalAframeworkfordistributedobjectorientedtestingInHigashinoTedFormalDescriptionTechniquesLondonKluwerAcademicPublisher ～ ， WuJChansonSTTestingsequencederivationbasedonexternalbehaviorexpressionInChansonSTedIFIPInternationalWorkshoponProtocolTestSystemsNorhHollanChapHall ， WuJChansonSTTranslationfromLOTOSandEstellespecificationstoextendedtransitionsystemanditsverificationInHogrefeDedIFIPInternationalConferenceonFormalDescriptionTechniquesforDistributedSystemsNorthHollandChapHall