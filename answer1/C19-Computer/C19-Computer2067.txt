计算机 工程 COMPUTERENGINEERING 年 第卷 第期 VolNo 基于 Intranet 的 图书馆 Web 检索系统 的 开发 贾 美英 摘要 主要 分析 了 游览 ， Web 服务器 与 外部 应用程序 的 两种 接口方式 CGI 和 ISAP 以及 ISAPI 的 工作 流程 。 在 此基础 上 介绍 了 作者 开发 的 本 单位 Intranet 网上 的 图书馆 Web 信息检索 系统 。 关键词 通用 网关 接口 Intranet 服务器应用程序 接口 Intranet 信息 服务器 TheDevelopmentofWebRetrievalInformationSystemBasedonIntranetJiaMeiying （ BeijingGraphicsResearchInstituteBeijing ） AbstractThispapergivesacomparisonofCGIandISAPIwhichareinterfacesbetweenexplorer ， Webserverandexecutiveprograms ， thenanalyzesthetheoryofISAPI ， atlast ， introducesaWebretrievalinformationsystemontheIntranetprogrammedbyauthor 。 KeywordsCGI ； ISAPI ； IIS 　 　 本 单位 Intranet 网上 的 图书馆 Web 信息检索 系统 ， 主要 目的 是 实现 本 单位 馆藏 图书 和 情报信息 的 方便 、 快速 查询 和 高效 利用 。 该 系统 采用 ClientServer 结构 ， 用 WindowsNT 作为 主 服务器 ， 其 内置 的 InternetInformationServerIIS 作为 Web 服务器 ， 数据库系统 采用 Oracle ， ODBC 应 至少 选用 版本 ， 客户端 采用 Windows 和 FrontPage 作为 开发 环境 。 两种 接口 规范 的 选择 　 　 客户 通过 浏览器 向 Web 服务器 发出 的 服务 请求 有 两种 ： 一种 是 要求 返回 一个 MIME 类型 的 文档 ， 这 类 请求 由 Web 服务器 直接 处理 并 返回 结果 ； 另一类 请求 是 要求 执行 应用程序 或 脚本 代码 。 对于 这种 请求 ， Web 服务器 本身 并 不 处理 ， 而是 将 它 递交 给 应用程序 或 脚本 处理 。 应用程序 或 脚本 的 执行 结果 以 标准 输出 的 方式 传回 给 服务器程序 。 服务器 收到 结果 后 ， 将 其以 MIME 实体 的 形式 返回 给 客户端 浏览器 。 　 　 IIS 具有 的 优秀 性能 之一 就是 开发 应用程序 或 脚本 的 能力 。 几乎 可以 使用 任何 位 编程语言 编写 交互式 应用程序 。 当 编写 应用程序 或 脚本 时 ， 可 使用 IIS 的 ISAPI 或 通用 网关 接口 CGICommonGatewayInterface 这 两种 支持 界面 的 一种 。 ISAPI 和 CGI 都 是 客户端 浏览器 、 Web 服务器 、 外部 应用程序 之间 交互 的 一组 规范 。 通过 填写 HTML 表单 或 单击 Web 服务器 上 的 HTML 页面 中 的 链接 ， Web 客户 浏览器 可 启动 CGI 脚本 或 ISAPI 应用程序 。 CGI 脚本 或 ISAPI 应用程序 可 获取 客户 Web 浏览器 提供 的 信息 ， 并且 做 事先 编程 的 事情 ， 然后 返回 HTML 页面 中 应用程序 的 结果 ， 或 将 信息 传递 到 数据库 。 两者 的 区别 在于 ISAPI 在 Web 服务器 上 创建 可 运行 为 DLL 的 应用程序 ， 应用程序 在 服务器 运行 时 已 被 装入 内存 ； 而 CGI 脚本 是 典型 的 独立 可执行程序 ， 每个 请求 都 单独 启动 一个 进程 ， 系统 开销 大 。 　 　 针对 CGI 和 ISAPI 的 以上 特点 ， 设计 WebServer 时 选用 ISAPI 作为 Web 页面 同 数据库 的 接口方式 。 同时 ， 应用 MSFrontPage 软件 ， 制作 主页 及 开发 WebServer 。 通过 ISAPI 访问 数据库 原理 　 　 IIS 提供 一个 称为 数据库 连接器 IDC 的 ISAPI 应用软件 httpodbcdll ， 使用 ODBCAPI 在 SQLServer 和 Internet 间 发送 和 检索 信息 。 Httpodbcdll 使用 两类 文件 idc 文件 和 htx 文件 来 控制 对 数据库 的 访问 和 输出 Web 页面 的 构造 。 这些 文件 是 Internet 数据库 连接器 idc 文件 和 HTML 扩展名 htx 文件 。 idc 文件 包括 ODBC 数据源 的 有关 信息 和 执行 SQL 语句 所 必需 的 信息 ， 同时 包含 html 扩展 文件 的 位置 和 名称 htx ， htx 文件 是 利用 数据库 返回 结果 的 构造 返回 html 文件 的 样板 文件 。 HTML 扩展 文件 是 实际 HTML 文档 的 模板 ， HTML 文档 用 IDC 取得 数据库 信息 ， 并入 其中 之后 返回 Web 浏览器 。 其 工作 原理 如图所示 。 图 ISAPI 工作 原理 ISAPI 工作 的 主要 流程 如下 ： IIS 接收 URL ； IIS 装载 httpodbcdll ； httpodbcdll 读取 IDC 文件 ； IDC 连接 到 ODBC 数据源 ， 并 执行 SQL 语句 ； IDC 从 数据库 中 取出 数据 ， 并 将 其 合并 到 HTML 扩展 文件 ； IDC 将 合并 成 文档 发送 回 IIS ， 并 返回 到 客户 。 图书馆 Web 信息检索 系统 的 实现 　 　 基于 以上 介绍 的 Web 与 数据库 接口 原理 ， 作者 开发 了 本 单位 Intranet 网上 的 图书馆 Web 信息检索 系统 。 该 检索系统 主要 完成 大 功能 ： 查询 馆藏 图书 ； 查询 读者 本人 流通 信息 ； 软件 下载 及 系统 信息 发布 。 本 检索系统 建立 在 已有 Oracle 数据库 的 基础 上 ， 其中 主要 对 该 数据库 的 馆藏 图书 流通 表 进行 多种手段 的 检索 。 查询 馆藏 图书 主要 包括 按 主题词 、 书名 、 作者 、 国地 号 查询 ； 用户 还 可 随时 浏览 到达 本 图书馆 半年 以内 的 新书 信息 ； 读者 可以 根据 自己 的 借书证 条码 查询 自己 的 流通 信息 ； 用户 还 可以 从 我们 的 软件开发 中心 下载 自己 需要 的 新版 软件 ； 系统 信息 发布页 发布 系统 更新 情况 和 注意事项 等 。 我们 用 按 书名 查询 举例说明 基本 检索 实现 过程 。 　 　 由于 IDC 只能 通过 系统 数据源 访问 数据库 ， 因此 首先 利用 ODBC 建立 一个 系统 数据源 ， 名为 zljweb ， 数据库 连接 串 定义 为 zlj ， 每个 数据库 连接 串 对应 唯一 的 数据库 用户 ， 通过 该 用户 的 权限 访问 数据库 ； 第二步 建立 一个 按 书名 查询 的 界面 页 书名 查询 htm 、 书名 查询 idc 和 书名 查询 结果 htx ， 其中 idc 文件 与 对应 的 htx 文件 缺一不可 。 书名 查询 htm 用于 用户 选择 查询 方式 和 接收 用户 输入 参数 ， 并 调用 书名 查询 idc ， 开始 查询 命令 。 书名 查询 htm 　 　 书名 查询 htm 界面 如图所示 。 图书 名 查询 htm 界面 　 　 书名 查询 界面 标题栏 ： 主要 提供 了 可 选择 的 查询 方式 。 　 　 到 书 起始 日期 、 到 书 结束 日期 输入框 ： 用户 输入 所 要 查询 资料 到达 本 资料库 的 日期 范围 。 　 　 书名 匹配 词 输入框 ： 用户 输入 所 要 查询 的 书名 匹配 词 。 　 　 前 匹配 、 后 匹配 复选框 ： 用户 选择 书名 查询 的 匹配 模式 。 其中 前 匹配 是 指 用户 所 输入 的 查询 匹配 词是 所 查找 内容 的 最 前面 几个 字 ； 后 匹配 指 用户 所 输入 的 查询 匹配 词是 所 查找 内容 的 最后 面 几个 字 。 如果 这 两个 复选框 都 选中 ， 则 指 双向 匹配 ， 及 用户 所 输入 的 查询 匹配 词是 所 查找 内容 的 任意 位置 的 几个 字 。 提供 这 几种 匹配 模式 主要 为了 提高 查询 速度 。 　 　 查询 按钮 ： 接收 用户 输入 的 书名 匹配 词 ， 按 选定 匹配 模式 调用 书名 查询 idc 进行 查询 。 Web 服务器 在 接收 到 查询 命令 后 ， 通过 环境变量 和 标准 输入输出 方式 与 ISAPI 程序 传递信息 。 　 　 重置 按钮 ： 清空 书名 匹配 词 输入框 ， 准备 接收 新 的 匹配 词 。 书名 查询 idc 　 　 Datasourcezljweb 　 　 SQLStatementselectbookidsubstrchinesenameaschinesename 　 　 substrnameasname 　 　 fromzljdbazcatalogue 　 　 wherenameparalike 　 　 upperleftparanamerightpara 　 　 andarrivaldatetodatebeginyearbeginmonthbeginday 　 　 yyyymmdd 　 　 andarrivaldatetodateendyearendmonthendday 　 　 yyyymmdd 　 　 orderbychinesenameASCnameASC 　 　 Template 初步 查询 结果 htx 　 　 Usernamezlj 　 　 Passwordzlj 　 　 ODBCOptionsSQLMAXROWS 初步 查询 结果 htx 　 　 显示 按 书名 查询 的 初步 查询 结果 。 该 模块 界面设计 见图 。 图书 名 查询 htx 界面 主要 HTML 语句 如下 ： begindetailoptionvaluebookidchinesenamenameoptionoptionvaluebookidoptionenddetail 系统 的 安全 保证 　 　 利用 Oracle 数据库 自身 保护 信息 的 方法 与 NTFS 提供 的 数据文件 安全性 和 访问控制 机制 保证系统 数据 的 安全性 。 数据库 建立 了 专门 的 浏览器 用户 以及 数据库 视图 。 视图 只 包括 用户 可 访问信息 ， 而且 用户 只能 查询 视图 中 的 信息 ， 不能 进行 修改 ， 杜绝 了 破坏 数据 的 可能性 。 对于 通过 远程 拨号上网 的 用户 ， 验证 其 拨号 权限 。 拨号 授权 用户 只能 对 特定 文件 和 目录 进行 访问 ， 且 拨号 属性 设置 为 回拨 ， 这样 有效 地 限制 了 拨号 的 电话 和 计算机 ， 最大 限度 地 保护 数据 资源 。 　 　 该 系统 目前 已 在 Intranet 网上 发布 ， 大大提高 了 读者 和 图书馆 管理人员 的 工作效率 ， 同时 也 提高 了 图书 情报 的 利用率 ， 实现 了 图书 情报资料 快速 查询 、 高效 利用 和 共享 的 目的 。 作者简介 ： 贾 美英 女 ， 岁 ， 助工 ， 主要 研究 数据库 作者 单位 ： 北京市 图形 研究所 北京 参考文献 俞盘祥 编著 ORACLE 数据库系统 基础 北京 ： 清华大学出版社 JasonGarms 著 郭漫雪 王应 波夏文 等 译 WindowsNTServer 大全 北京 ： 机械 工业 出版社 郑 人杰 著 实用 软件工程 北京 ： 清华大学出版社 收稿 日期 ：