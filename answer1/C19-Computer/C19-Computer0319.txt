计算机 应用 ComputerApplications 年 第卷 第期 VolNo 用 OpenGL 开发 虚拟 制造 环境 （ 二 ） ＊ 周杰 韩 　 杜润生 　 吴 　 波 　 　 摘 　 要 　 本文 介绍 了 OpenGLD 图形处理 的 管道 过程 ， 从 建立 模型 坐标 、 视 平面坐标 到 设备 视区 变换 。 论述 了 OpenGL 在 虚拟 制造 环境 开发 实践 中 的 应用 。 　 　 关键词 　 虚拟 制造 ， 对象 建模 ， 坐标 变换 　 　 DEVELOPINGVIRTUALMANUFACTURINGENVIRONMENTBYUSINGOPENGL Ⅱ ZhouJiehan 　 DuRunsheng 　 WuBoMachineryScienceandEngineeringCollegeHuazhongUniversityofTechnologyHubeiWuhan 　 　 Abstract 　 TheOpenGLgraphicstransformationpipelineisintroducedinthethesisAndthesetransformationfrommodelingcoordinatesviewingcoordinatestofinaldevicecoordinatesarediscussedinvirtualmanufacturingdevelopment 　 　 Keywords 　 VirtualmanufacturingObjectmodelingCoordinatestransformation 　 OpenGL 简介 　 　 OpenGL 是 SGI 公司 的 IRISGL 图形工作站 的 分支 。 与 位 Windows 图形 设备 接口 GDI 的 简单 图形 编程 相比 ， OpenGL 能 进行 高级 的 三维 图形 编程 并 能 满足 图形 光照 、 纹理 等 特殊效果 的 要求 。 目前 由 OpenGL 体系结构 考察组 OpenGLARB 控制 OpenGL 的 语言 标准 。 该 组织 成员 有 SGI 、 Microsoft 、 IBM 、 Intel 与 DEC 公司 等 。 OpenGL 本身 与 硬件 及 操作系统 的 底层 软件 无关 ， 因此 可 将 OpenGL 程序 从 一个 系统 方便 地 移植 到 另 一个 系统 。 OpenGL 在 CADCAM 等 需要 高级 三维 对象 可视化 和 图形 绘制 的 领域 内 被 广泛应用 。 许多 计算机系统 如 UNIX ， WindowsNT 都 支持 OpenGL 标准 。 OpenGL 通过 各个 平面 的 一系列 顶点 表示 几何体 。 定义 几何体 是 按照 用户 画 几何体 的 顺序 。 OpenGL 通过 光栅 化 （ 将 向量 图形 转换成 由 像素 组成 的 图像 的 过程 ） 来 处理 几何体 对象 。 光栅 化 的 结果 以 像素 的 形式 存于 帧 缓冲区 中 。 并 通过 多种 模式 变换 控制 输出 。 　 　 　 OpenGLD 图形 变换 　 三维 投影 中 的 坐标系 　 　 OpenGL 物体 坐标系 采用 左手 坐标系 。 投影 三维 物体 的 二维 平面 称为 投影 平面 ， 视 平面 坐标系 附在 投影 平面 上 。 物体 坐标系 描述 物体 的 模型 。 取景 参考点 为 物体 建模 参考点 ， 一般 将 物体 坐标系 原点 取为 建模 参考点 。 视 平面 坐标系 原点 为 取景 参考点 在 投影 平面 上 的 投影 点 ， 即 平行 于 投影 平面 法线 且 通过 取景 参考点 的 直线 与 投影 平面 的 交点 。 确定 视 平面 坐标系 向上 方向 的 向量 称为 取景 上 方向 量 。 取景 上 方向 量 确定 视 平面 坐标系 绕 取景 参考点 与视 平面 坐标系 原点 连线 旋转 的 角度 。 观察点 或 视点 是 观察者 眼睛 所在 的 位置 。 以上 概念 如图所示 。 图 　 三维 投影 中 的 坐标系 　 OpenGL 图形处理 的 管道 过程 　 　 绘画 时 ， OpenGL 通过 建模 与 取景 变换 设置 物体 坐标系 中 对象 的 每个 顶点 ， 然后 由 投影变换 指定 的 取景 体积 对 顶点 进行 剪切 ， 最后 把 这些 顶点 映射 到 视区 上 。 其 图形处理 的 管道 过程 如图所示 。 　 OpenGL 图形处理 过程 与 照相 过程 对比 　 　 设想 物体 坐标系 画 在 支持 物体 的 地板 上 ， 那么 视 平面 坐标系 就 在 相机 的 胶卷 上 。 OpenGL 图形处理 过程 与 相机 成相 过程 对比 如下 ： 　 　 把 相机 指向 画面 （ 取景 变换 ） ； 　 　 摆好 物体 使得 画面 被 照进 （ 建模 变换 ） ； 　 　 选择 相机 透镜 或 调整 焦距 感光 （ 投影变换 ） ； 　 　 冲洗 底片 决定 相片 最终 大小 （ 视区 变换 ） 。 　 　 图 　 OpenGL 图形处理 的 管道 过程 　 OpenGL 物体 模型 绘制 与 图形 变换 　 OpenGL 绘制 物体 模型 与 画 几何体 的 顺序 　 　 利用 OpenGL 图元 功能 如线 、 多边形 等 功能 绘制 物体 模型 。 所有 图 元 最终 都 以 一组 顶点 坐标 来 描述 。 OpenGL 使用 glVertex 命令 定义 顶点 坐标 ， 使用 glColor 命令 定义 顶点 颜色 。 定义 点 的 定义 顺序 是 按照 用户 画 几何体 的 顺序 。 定义 立方体 的 点 顺序 如图所示 。 定义 物体 模型 可以 在 glBegin 和 glEnd 命令 对 之间 给出 顶点 的 坐标 。 glBegin 命令 的 参数 决定 如何 绘制 几何 图 元 。 其 参数值 的 含义 如下 所示 ： 　 GL — POINTS ： 单独 的 点 ； 　 GL — LINES ： 一队 顶点 组成 一 单独 的 线段 ； 　 GL — POLYGON ： 一 简单 凸多边形 的 边界 轮廓 ； 　 GL — TRIANGLES ： 三个 顶点 组成 三角形 ； 　 GL — QUADS ： 四个 顶点 组成 四边形 ； 　 GL — LINE — STRIP ： 一组 首尾相连 的 线段 ； 　 GL — LINE — LOOP ： 一组 首尾相连 的 线段 ， 且 起始 点 相连 ； 　 GL — TRIANGLE — STRIP ： 相连 的 三角形 ； 　 GL — TRIANGLE — FAN ： 扇形 三角形 ； 　 GL — QUAD — STRIP ： 相连 的 四边形 。 图 　 　 　 建模 变换 与 取景 变换 　 　 建模 变换 用来 放置 模型 与 确定 模型 的 取景 上 方向 量 。 建模 变换 包括 移动 、 旋转 或 缩放 ， 也 可以 是 三者 的 联合操作 。 OpenGL 分别 用 glTranslate 命令 和 glRotate 命令 来 移动 与 旋转 物体 。 glTranslate 命令 移动 物体 到 某 新 位置 ， 其 参数 指定 新 位置 的 坐标 。 glRotate 命令 旋转 物体 使 其 取景 上 方向 量 为 新 方向 ， 其 参数 为 一个 旋转轴 向量 与 旋转 角度 。 glScale 为 比例变换 命令 ， 其 参数 指定 物体 沿着 三个 坐标轴 进行 缩放 的 比例 。 建模 变换 是 变换 物体 的 位置 与 方向 。 而 取景 变换 是 变换 视 平面 的 位置 与 方向 。 物体 与视 平面 的 运动 是 相对运动 ， 因此 也 可以 用 改变 视 平面 位置 与 取景 上 方向 的 取景 变换 来 代替 建模 变换 。 OpenGL 默认 物体 的 取景 参考点 与视 平面 的 原点 为 物体 坐标系 原点 ， 取景 上 方向 量 与 y 轴 一致 。 OpenGL 使用 glMatrixMode 改变 模式 矩阵 命令 来 启动 建模 与 取景 变换 。 由于 建模 与 取景 变换 本质 上 的 一致性 ， 在 变换 应用 之前 ， 建模 与 取景 变换 被 连接 为 建模 取景 矩阵 。 GlMatrixMode 的 参数 必须 设置 为 GL — MODELVIEW 。 　 透视 投影变换 　 　 现实生活 中 的 景物 ， 由于 距离 远近 不同 ， 方位 不同 ， 在 视觉 中 引起 不同 反映 的 现象 就是 透视 现象 。 OpenGL 透视 投影 利用 去 角锥 的 截头 体 作为 取景 体积 。 取景 体积 决定 物体 投影 的 可视 部分 ， 而且 满足 透视 投影 的 远大 近小 规则 。 OpenGL 用 gluPerspective 命令 指定 的 透视 取景 体积 如图所示 ， 视点 放置 在 角锥 的 顶点 。 其 参数 fovy 为 y — z 平面 上 取景 域 的 角度 ， aspect 为 截头 体 x （ 宽度 ） 与 y （ 高度 ） 的 比值 ， zNear 与 zFar 分别 为 视点 与 前后 剪切 面 的 距离 ， 二者 总为 正值 。 进行 透视 投影变换 前 ， 必须 用 glMatrixMode 将 参数设置 为 投影 模式 GL — PROJECT ， 用 glLoadIdentity 置 恒等 矩阵 命令 清除 过去 矩阵 的 影响 ， 同时 用 gluPerspective 命令 指定 取景 体积 进行 透视 投影 。 图 　 gluPerspective 建立 的 取景 体积 　 视区 变换 　 　 对比 于 照相 过程 ， 投影变换 对应 于 胶卷 底片 感光 阶段 。 视区 变换 则 对应 于 选择 照片 大小 阶段 。 视区 变换 决定 物体 图像 在 显示 设备 的 最终 尺寸 与 位置 。 OpenGL 图形系统 默认 视区 为 窗口 客户 区域 。 使用 glViewport 命令 可以 选择 一个 视区 。 其 参数 （ x ， y ） 指定 视区 的 左下角 位置 ， width 与 height 指定 视区 矩形 的 大小 。 在 MFC 窗口 视 结构 中 ， 视区 尺寸 通常 不是 绝对 尺寸 ， 而是 响应窗口 宽度 与 高度 的 变化 而 变化 。 　 　 　 虚拟 制造 环境 下 绘制 加工 中心 　 　 加工 中心 是 虚拟 制造 环境 中 重要 的 加工 设备 之一 。 在 创建 三维 仿真 虚拟 车间 的 实践 中 ， 选取 Windows 操作系统 与 MFC 作为 OpenGL 图形 应用程序 的 开发 环境 。 加工 中心 的 物体 坐标 设定 如图所示 。 图 　 OpenGL 环境 下 加工 中心 物体 模型 　 　 投影 平面 与 yz 平面 平行 。 取景 参考点 设在 物体 坐标系 的 原点 。 视 平面 离 物体 坐标系 原点 的 距离 为 mfDistence 。 取景 体积 的 前后 剪切 面 距离 视点 （ 计算机 前 观者 的 眼睛 ） 分别 为 fNearPlane 与 fFarPlane 。 视 窗口 大小 设定 客户 区域 ， 并 随 客户 区 大小 变化 而 变化 。 　 　 周杰 韩 　 博士 研究生 高级 程序员 。 研究 方向 虚拟 制造 、 系统 仿真 、 面向对象 技术 。 　 　 国家教委 博士点 基金 资助 。 　 　 作者 单位 ： 周杰 韩 　 杜润生 　 吴 　 波 （ 华中理工大学 机械 科学 与 工程学院 　 湖北 ． 武汉 参考文献 ［ ］ 　 DonaldHearnMPaulineBakerComputerGraphicssecondeditionPrenticeHallInternationalInc ［ ］ 　 MicrosoftDeveloperStudioGraphicsandMultimediaServicesMicrosoftCorporation ［ ］ 　 SHarrington 著 计算机 图形学 高福文 ， 译 北京 北京师范大学 出版社 ， ［ ］ 　 KevinJGoodman ， 著 如何 开发 Windows 应用程序 郭 　 勇译 清华大学出版社 ， ［ ］ 　 周杰 韩 吴 　 波 ， 左 朝晖 虚拟 制造 环境 面向对象 建模 武汉 ： 华中理工大学 学报 ； （ ） ： 收稿 日期 修改稿