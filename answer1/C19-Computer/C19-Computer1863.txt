微型机 与 应用 MICROCOMPUTERITSAPPLICATIONSVolNoP 多层 交换 技术 分析 鄂 大伟 　 　 摘 　 要 ： 多 层交换机 是 一种 综合 交换机 速度 和 路由器 流量 控制 功能 于 一体 的 、 新 的 网络 互连 设备 。 本文 分析 了 多层 交换 技术 出现 的 原因 为 以上 问题 的 解决 提供 了 良好 的 方案 。 　 　 关键词 ： 多层 交换 交换 技术 路由 技术 为什么 要 采用 多层 交换 　 　 在 世纪 年代 中期 为 实现 计算机网络 的 标准化 国际标准化组织 （ ISO ） 提出 了 开放系统 互连 （ OSI ） 参考模型 。 OSI 参考模型 采用 个 层次 的 体系结构 并 为 每个 层次 的 划分 建立 了 个 标准 的 框架 用于 描述 规定 每个 层次 中 的 服务 定义 的 协议 规范 时至今日 OSI 模型 仍 被 认为 是 新一代 计算机 网络体系结构 的 基础 。 这里 所 讨论 的 “ 多层 交换 ” 实际 就是指 在 OSI 参考 的 数据 链路层 、 网络层 和 传输层 上 实现 的 交换 技术 。 　 　 在 网络应用 初期 大部分 用户 使用 局域网 并 采用 网段 交换 的 方式 将 局域网 进行 桥接 。 网络 之间 连接 的 带宽 矛盾 并 不 突出 作为 一种 简便易行 的 网络共享 式 网络 大行其道 。 连接 设备 是 大家 熟知 的 共享 式 集线器 。 随着 对 网络带宽 的 进一步 需求 工作组 交换机 替代 了 共享 式 集线器 随之 也 出现 了 LAN 交换机 即 第 层交换机 。 第层 交换 技术 在 数据 链路层 中 进行 操作 这 就 说明 在 LAN 交换机 中帧 的 传输 是 基于 以太网 、 令牌环 网 或 FDDIMAC 的 地址 LAN 交换机 对 网络协议 诸如 Internet 协议 （ IP ） 或 Novell 的 IPX 协议 来说 是 透明 的 。 因此 第 层交换机 产品 大多数 是 基于 端口 的 交换 其 交换机 的 接口 模块 都 是 通过 高速 背板 总线 交换 数据 的 速率 可以 达到 每秒 几十 Gb 。 　 　 然而 LAN 交换 技术 并 没为 大规模 的 LAN 建设 提供 一个 完整 、 普遍 的 解决方案 。 这 主要 是 由于 传统 的 LAN 交换 技术 不是 完全 可以 扩充 的 。 进入 年代 以来 互联网络 成为 应用 焦点 利用 路由器 通过 WAN 连接 不同 类型 的 局域网络 已 成为 网络应用 的 主流 。 在 大部分 实际 运行 的 网络 中 LAN 交换机 必须 与 路由器 相结合 。 路由器 的 过滤 和 防火墙 功能 使 控制 广播 域 变得 更 容易 从而 达到抑制 广播 风暴 和 增强 安全性 的 目的 。 路由器 能够 智能 地 确定 最佳 传输 路径 并 支持 冗余 连接 提高 网络 性能 和 可靠性 但是 路由器 的 端口 价格 及 延迟 是 较 严重 的 问题 。 今天 即使 是 最 高档 的 主干 路由器 也 难以 应付 由于 VLAN 、 Intranet 以及 其它 基于 IP 的 应用 所 带来 的 迅猛 增长 的 数据 流量 。 怎样 减少 网络 堵塞 、 优化 网络结构 、 提高 网络 性能 且 扩大 网络 吞吐量 是 网络管理员 必须 考虑 的 问题 。 　 　 随着 交换 技术 的 发展 目前 出现 了 第层 和 第层 的 交换 技术 。 第层 交换 是 一种 综合 第层 交换 和 路由器 流量 控制 功能 于 一体 的 交换 技术 而 第层 交换 技术 是 把 原来 用于 TCP 和 UDP 端口 级 控制 的 传统 路由器 提升 到 一个 新 的 高度 。 这些 新 的 交换 技术 的 出现 为 网络应用 提供 了 新 的 解决方案 。 第层 交换 （ LayerSwitching ） 的 不足 　 　 第层 交换 实际上 是 面向 局域网 的 交换 技术 。 LAN 交换 是 解决 网络 堵塞 、 扩展 网络带宽 的 主要 选择 之一 。 LAN 交换机 中 具有 一定 数量 的 物理 端口 用来 连接 LAN 网段 通常 为 ～ 个 。 这些 端口 通过 提取 每个 发送到 交换机 的 数据包 的 源 MAC 地址 得到 MAC 的 目的 地址 及 与 接收 该 数据包 的 端口地址 进而 得知 端口 与 MAC 目的 地址 之间 的 关系 。 由于 LAN 交换机 大多数 都 是 自动 配置 的 所以 较易 安装 、 构造 和 管理 。 　 　 第层 网络 交换 技术 的 不足之处 是 明显 的 它 极大 地 扩展 了 网络 但 它 使 网络 又 恢复 到 了 网桥 的 平铺 拓扑 结构 容易 形成 广播 风暴 。 为 网络 提供 容错 技术 的 生成 树 （ SpanningTree ） 导致 在 数据 路径 使用 上 的 低效率 对 异种 网络 之间 互联 的 限制 、 安全性 等 。 在 数年 前 这些 因素 使 路由器 的 使用 成为 必须 。 路由器 的 低效率 和 大 时延 是 使 用户 设法 减少 路由器 数量 的 原因 。 因此 促使 人们 在 更 高 的 网络 层次 上 采用 新 的 交换 技术 或 设备 。 第层 交换 （ LayerSwitching ） 　 　 网络层 是 OSI 参考模型 的 第层 它 作为 通信子网 的 最高层 负责 将 数据 从 物理 连接 的 一端 传送 到 另一端 包括 寻址 、 路由 选择 、 连接 的 建立 、 保持 和 终止 等 。 基于 OSI 的 第层 交换 是 指 在 交换机 内部 完成 不同 子网 间 和 虚拟 网间 的 互连 从而 改变 了 传统 网络 解决方案 中 由 交换机 外接 路由器 来 完成 局域网 中 不同 IP 子网 、 IPX 子网 和 虚拟 子网 的 互连 。 这样 可 大大减少 原来 采用 路由器 连接 不同 子网 所 带来 的 延迟 、 瓶颈 等 弊病 。 　 　 从 原理 上 讲 第层 交换 技术 是 将 第 层交换机 和 第层 路由器 的 优势 结合 成 一个 灵活 的 解决方案 可 在 各个 层次 提供 线速 性能 。 尽管 目前 似乎 对 第层 交换 这一 术语 的 解释 不尽相同 但 实际 的 做法 就是 在 原有 的 第 层交换机 内 加入 最新 的 ASIC （ 专用 集成电路 芯片 ） 的 路由 模块 即 把 与 路由器 有关 的 第层 路由 硬件 模块 插接 在 交换机 的 高速 背板 总线 上 使 路由 从 软件 之中 移出 并 移入 ASIC 之中 其 成本 远 低于 传统 路由器 的 成本 。 个 真正 的 第 层交换机 并 不是 简单 地 将 传统 路由器 加入 到 第 层交换机 中 的 产品 它 要 使得 路由 模块 可以 与 需要 路由 的 其它 模块 间 高速 交换 数据 使 路由 模块 能 真正 达到 线速 的 路由 能力 。 这 不仅仅 是 硬件 上 的 改变 还 表现 在 软件 的 服务质量 方面 以及 能 提供 极强 的 对 网络流量 的 控制能力 。 　 　 第 层交换机 根据 定义 都 是 属于 存储转发 设备 况且 还要 承担 路由 功能 然而 却 达到 了 与 第 层交换机 同样 的 包 处理速度 。 在 以往 采用 存储转发 方式 的 第 层交换机 产品 中 很少 有 延时 能 达到 小于 μ s 的 。 在 一些 对 第 层交换机 性能 所 进行 的 测试 中 记录 到 的 最低 延时 与 传统 的 主干 路由器 相比 几乎 低 了 个 数量级 实际 应用 中 这种 差距 会 更 明显 。 　 　 作为 目前 网络 交换 技术 的 热点 已 出现 较为 成熟 的 各种 基于 第层 交换 的 交换机 产品 。 例如 CoreBuilder 第 层高 功能 交换机 依赖于 成熟 的 第三代 ASIC 技术 提供 了 线速 的 第层 和 第层 通信 能力 大幅度 地 提高 了 高端 交换 设备 和 路由 设备 的 性能 和 性能 价格比 。 同时 由于 使用 了 先进 的 基于 策略 的 服务 机制 该 交换机 可以 支持 实时 的 多媒体 网络通信 。 加上 对 虚拟 网 、 组播 、 多 协议 路由 和 网络管理 的 支持 （ 包括 RMON 和 巡回 分析 端口 ） 。 CoreBuilder 第 层高 功能 交换机 可 用作 主干 局域网络 由 设备 来 提供 第层 的 转发 功能 从而 取代 局域网 中 的 传统 路由器 。 同样 地 它 也 可以 作为 接入 千兆 以太网 或 ATM 网 的 边缘 设备 。 第层 交换 （ LayerSwitching ） 　 　 OSI 模型 的 第层 是 传输层 它 的 作用 是 利用 下面 层 所 提供 的 服务 向 高层 提供 可靠 的 端 到 端的 透明 数据传输 主要 任务 是 提供 进程 间通信 机制 和 保证 数据传输 的 可靠性 。 传输层 也 是 TCP （ 传输控制协议 ） 和 UDP （ 用户 数据 报 协议 ） 所在 的 协议 层 。 TCP 协议 是 目前 在 Internet 上 广泛 使用 的 一种 协议 而 UDP 协议 则 是 一种 在 目标 计算机 描述 信息 如何 到达 应用软件 的 协议 。 　 　 第层 交换 概念 可定义 为 它 是 一种 功能 它 决定 传输 不仅仅 依据 MAC 地址 （ 第层 网桥 ） 或源 目标 IP地址 （ 第层 路由 ） 而且 依据 TCPUDP （ 第层 ） 应用 端口号 。 在 协议 层 的 应用 中 网络 可以 通过 监听 协议 所 使用 的 端口 来 确定 所 接收 到 的 IP 包 的 类型 而 端口号 和 设备 IP地址 的 组合 通常 称作 “ 套 接字 （ socket ） ” 。 既然 第层 交换 使用 了 与 特定 应用 有关 的 信息 （ 端口号 ） 利用 这个 信息 可以 完成 大量 的 服务 。 例如 通过 查询 其所 接受 的 每个 包内 诸如 TCP 端口号 之类 的 应用 级 信息 第 层交换机 可以 做出 比 第层 和 第 层交换机 更为 明智 的 发送 决策 。 　 　 根据 第层 交换 的 定义 第层 交换 应 具有 以下 特性 　 　 许多 路由器 被 用于 建立 基于 包 过滤 式 的 防火墙 第层 交换 也 具有 这种 能力 它 对 包 的 过滤 能力 是 在 ASIC 中 实现 的 。 第 层交换机 允许 用户 以 LAN 速度 对 通信量 和 防火墙 功能 进行 优先 考虑 。 它 可 消除 与 防火墙 认证 有关 的 延迟 可以 在 所有 端口 以全 介质 速度 操作 即使 在 千兆 以太网 连接 上 也 是 如此 而 其它 交换机 则 会 出现 此类 延迟 。 如果 用户 计划 在 自己 的 网络 上 支持 没有 延迟 的 防火墙 安全性 那么 采用 第 层交换机 是 值得 考虑 的 。 　 　 如果 没有 第层 交换 网络 的 服务质量 服务 级别 必然 受制于 第层 和 第层 提供 的 信息 。 当因 缺乏 第层 信息 而 受到 妨碍 时 紧急 应用 的 优先权 就 无从谈起 。 借助于 第层 交换 TCP 和 UDP 协议 端口号 告诉 交换器 生成 传输流 的 应用程序 的 类型 然后 交换器 则 可以 将 此 数据包 分类 映射 到 服务质量 保证 中 。 对 关键 应用 流量 可以 设定 与 基于 HTTP 的 Internet 流量 不同 的 发送 规则 以 区分 优先级 于是 紧急 的 应用 可以 获得 网络 的 高级别 服务 。 　 　 提供 附加 的 硬件 手段 以 每 端口 为 基础 收集 应用层 流量 统计 。 管理员 使用 第层 交换 支持 的 统计 特性 能够 获得 丰富 网管 信息 。 管理员 不仅 可以 跟踪 服务器 和 客户 之间 的 数据 也 可以 很 好 地 跟踪 某个 应用服务 在 工作 、 服务器 上 的 活动 和 被 打开 的 对话 数等 。 　 　 简而言之 多层 交换 技术 正是 交换 和 路由 技术 智能化 的 组合 它 为 各种 结构 的 LAN 提供 了 一个 完整 、 集成 的 解决方案 。 这 就是 越来越 多 的 网络 设计者 把 视线 转到 LAN 中 的 多层 交换 技术 的 原因 。 鄂 大伟 （ 厦门 集美 大学 计算机系 ） 收稿 日期 ：