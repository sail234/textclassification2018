自动化 学报 ACTAAUTOMATICASINICA 年 第卷 第期 volNo 一种 新 的 基于 顶点 聚类 的 网格 简化 算法 周 　 昆 　 潘志庚 　 石教英 摘 　 要 　 在 计算机 图形学 中 ， 经常 采用 多边形 网格 来 描述 物体 模型 由于 绘制 时间 和 存储量 与 多边形 的 数量 成正比 ， 过于 庞大 的 物体 网格 模型 通常 是 不 实用 的 模型简化 在 计算机 动画 、 虚拟现实 和 交互式 可视化 等 计算机 图形 应用领域 有着 广阔 的 应用 前景 为此 提出 一种 新 的 基于 顶点 聚类 的 网格 简化 算法 该 算法 利用 八叉树 对 网格 进行 自 适应 划分 ， 给出 了 一种 基于 点到 平面 距离 的 有效 的 误差 控制 方法 ， 并 能 在 用户 指定 的 误差 范围 内 通过 使 原始 网格 中 的 顶点 聚类 达到 大量 简化 的 目的 该 算法 实现 简单 ， 速度 快且 能 很 好 地 保持 边界 特征 给出 的 一组 图例 说明 了 该 算法 的 有效性 关键词 　 多边形 网格 ， 网格 简化 ， 顶点 聚类 ， 细节 层次 ANEWMESHSIMPLIFICATIONALGORITHMBASEDONVERTEXCLUSTERINGZHOUKunPANZhigengSHIJiaoyingStateKeyLabofCADCGZhejiangUniversityHangzhou 　 Abstract 　 IncomputergraphicsmodelsareoftendiscribedbypolygonalmeshesBecausetherenderingandstoragecostisproportionaltothenumberofpolygonstoolargemodelsarenotpracticalModelsimplificationtechniquesarewidelyusedincomputergraphicsfieldssuchascomputeranimationvirtualrealityandinteractivescientificvisualizationInthispaperanewalgorithmofmeshsimplificationbasedonvertexclusteringispresentedThealgorithmadoptsoctreestructuretosubdividethemeshmodeladaptivelyAnewerrorcontrolmethodisalsopresentedTheimplementationofthealgorithmissimpleanditrunsveryfastExamplesillustratetheefficiencyofthealgorithmKeywords 　 Polygonalmeshmeshsimplificationvertexclusterlevelofdetail 　 引 　 言 　 　 在 计算机 图形学 应用领域 ， 经常 采用 多边形 网格 来 描述 物体 模型 使用 激光 扫描 系统 可以 获得 各种 复杂 的 网格 ， 另外 ， 由 三维 模型 重构 方法 得到 的 多边形 网格 模型 通常 由 上万个 、 几十万个 、 甚至 几百万个 多边形 面片 组成 由于 绘制 时间 和 存储量 与 多边形 的 数量 成正比 ， 过于 庞大 的 物体 网格 模型 通常 是 不 实用 的 另一方面 ， 在 虚拟环境 中 ， 通常 并不需要 对 物体 的 细节 刻划 得 很 详细 的 模型 ， 我们 可以 为 每个 物体 构造 若干个 不同 细节 层次 的 模型 ， 根据 需要 选用 某种 模型 为 满足 计算机 分析 、 显示 与 存储 的 要求 ， 必须 对 这类 复杂 的 模型 进行 简化 模型简化 在 计算机 动画 、 虚拟现实 和 交互式 可视化 等 计算机 图形 应用领域 有着 广阔 的 应用 前景 　 　 国外 对 模型简化 的 研究 已有 一系列 成果 Schroeder ［ ］ 提出 了 基于 顶点 删除 的 网格 删减 方法 ； Turk ［ ］ 给出 了 基于 重新 划分 的 多边形 网格 模型简化 方法 ； Hoppe ［ ］ 采用 能量 函数 最优化 的 网格 简化 方法 ； Rossignac ［ ］ 提出 了 一种 基于 顶点 聚类 的 网格 简化 方法 ； Eck ［ ］ 将 小波 技术 用于 模型简化 ； Cohen ［ ］ 通过 构造 包络 网格 来 控制 网格 简化 的 全局 误差 ； Garland ［ ］ 利用 二次 误差 方法 来 控制 网格 简化 误差 国内 在 这方面 也 开展 了 一些 卓有成效 的 研究 工作 ［ ， ， ］ 　 　 在 以上 方法 中 ， Rossignac ［ ］ 所 提出 的 方法 简单明了 ， 速度 最快 其 基本 思想 是 ： 用 一个 包围 盒 把 原 网格 模型 包围起来 ， 通过 等 分 包围 盒 的 各棱边 将 包围 盒 等 分成 若干个 小 的 长方体 ， 这样 原 模型 的 所有 顶点 就 分别 落 在 这些 长方体 内 ； 扫描 这些 长方体 ， 如果 某个 长方体 内有 顶点 ， 则 把 该 长方体 内 的 所有 顶点 删除 并 生成 一个 新 顶点 ， 这个 新 顶点 是 被 删除 的 原 顶点 的 加权 平均 这种 方法 存在 着 三个 局限性 ： 首先 ， 由于 原 网格 模型 上 的 点 在 空间 的 分布 是 未知 的 ， 这种 方法 对 包围 盒 进行 等 分 ， 可能 导致 等 分后 某些 区域 的 长方体 内 包含 很多 的 顶点 ， 而 某些 区域 的 长方体 内 没有 或 只有 很少 的 顶点 ， 这 一方面 造成 空间 和 时间 的 浪费 ， 另一方面 造成 模型 的 某些 部分 过分 简化 ； 其次 ， 生成 某个 长方体 内 的 新 顶点 时 ， 这种 方法 只是 取 简单 的 加权 平均 而 并 没有 给出 一种 较 好 的 误差 控制 方法 ； 再次 ， 当原 网格 模型 比较 特殊 时 ， 落 在 某些 长方体 内 的 顶点 可能 属于 原 模型 的 差别 较大 的 部分 ， 如果 这些 顶点 聚类 成 一个 顶点 就 会 造成 很大 的 变形 图 就是 一个 例子 ， 其中 实线 表示 网格 ， 虚线 表示 对 网格 包围 盒 的 划分 线图 a 是 原始 网格 ， 图 b 是 Rossignac ［ ］ 方法 得到 的 简化 ； 不难看出 ， 这种 简化 的 变形 太 大 　 　 　 　 　 　 （ a ） 原始 网格 　 　 　 b 顶点 聚类 后 生成 的 简化 网格 图 　 Rossignac 算法 对 特殊 网格 造成 的 变形 　 　 本文 提出 了 一种 新 的 基于 顶点 聚类 的 网格 简化 算法 ， 该 算法 利用 八叉树 给出 了 网格 包围 盒 的 自 适应 划分 ， 同时 给出 了 控制顶点 聚类 误差 的 有效 方法 ， 与 Rossignac ［ ］ 提出 的 算法 相比 ， 具有 速度 相当 、 效果 更好 且 适用范围 更广 的 优点 ， 文中 给出 的 一组 图例 说明 了 该 算法 的 有效性 由于 多边形 网格 中 最 常见 的 是 三角形 网格 ， 且 任何 多边形 网格 都 可 转化 为 三角形 网格 ， 下面 所指 的 网格 都 是 三角形 网格 　 算法 描述 　 　 为 叙述 方便 和 清楚 起 见 参考文献 ［ ］ ， 首先 引入 一些 基本概念 　 基本概念 　 　 定义 空间 中 一组 三角形 ， 沿 公共 边及 在 顶点 处 相邻 接 ， 把 这样 的 一组 三角形 定义 为 三角形 网格 TM ， TM 可 由 顶点 集 Vvv … ， vn 和 三角形 集合 Ttt … tm 所 组成 的 二元 组 V ， T 来 表示 　 　 定义 对 TM 中任 一条 边 ， 如果 该边 只 为 一个 三角形 所 享有 ， 则 称 该 边 为 边界 边 ， 该边 的 两个 顶点 被 称为 边界 顶点 ， 该边 所在 的 三角形 被 称为 边界 三角形 　 　 定义 对 TM 中 任一 顶点 vi 所有 以 vi 为 一个 顶点 的 三角形 Tik 构成 的 集合 ， 称为 与 顶点 vi 相关 的 三角形 集合 Pi 　 　 定义 对 TM 中 一个 顶点 集 Vsvv … vk ， 与 Vs 中 的 每个 顶点 相关 的 三角形 集合 的 并 集 ， 称为 与 顶点 集合 Vs 相关 的 三角形 集合 TsVs ， 即 　 顶点 聚类 的 新 顶点 的 生成 和 误差 的 度量 　 　 首先 考虑 ， 如果 一些 顶点 落 在 一个 长方体 内时 ， 删除 这些 顶点 后 ， 如何 生成 一个 新 顶点 以及 用该 新 顶点 代替 被 删除 的 顶点 所 产生 的 误差 是 多少 这 就 有 一个 选择 误差 标准 的 问题 ， 本文 算法 以点 到 平面 的 距离 ［ ］ 为 误差 标准 　 　 假设 落 在 每个 长方体 内 顶点 和 边 所 构成 的 图 是 连通 的 ， 在 节中 我们 将 讨论 算法 是 如何 保证 这 一点 的 有 了 这个 前提 ， 现在 来 考虑 一个 顶点 集合 Vsvv … vk 落 在 一个 长方体 内时 ， 如何 求新 顶点 和 简化 误差 我们 可以 先 得到 与 顶点 集合 Vs 相关 的 三角形 集合 TsVs ， 由 前面 的 假设 不难 发现 ， 这个 三角形 集合 构成 了 原 网格 模型 上 的 一个 区域 图 就是 一个 简单 的 例子 ， 顶点 集合 为 ｛ vvvv ｝ ， 聚类 为 v 如果 顶点 集合 Vs 聚类 为 顶点 vi ［ xi 　 yi 　 zi 　 ］ T ， 定义 这个 聚类 带来 的 误差 ε Vs 为 vi 到 三角形 集合 TsVs 中 每个 三角形 所在 平面 的 距离 平方 之 和 ε i 加上 Vs 中 的 顶点 到 每个 与 vi 相关 的 三角形 所在 平面 的 距离 平方 之 和 ε i 即 ε Vs ε i ε i 为了 使 ε Vs 尽可能 小 ， 可以 对式 中 的 xiyi 和 zi 求偏 导数 ， 并令 其 为 零 ， 即令 p ［ a 　 b 　 c 　 d ］ T 为 每个 与 顶点 集合 Vs 相关 的 三角形 集合 TsVs 中 的 三角形 所在 的 平面 的 平面 方程 axbyczd 且 有 abc ε i 可 表示 为 其中 Mp 是 × 的 对称 矩阵 TsVs 　 　 由于 vi 的 位置 和 与 vi 相关 的 三角形 所在 平面 的 方程 未知 ， 所以 ε i 的 计算 比较复杂 如图所示 ， 我们 先 计算 点 vi 到 三角形 ｛ vivivi ｝ 所在 平面 的 距离 的 平方 d 令 vi ［ xi 　 yi 　 zi 　 ］ T 　 vi ［ xi 　 yi 　 zi 　 ］ T 　 vi ［ xi 　 yi 　 zi 　 ］ T 则 三角形 ｛ vivivi ｝ 所在 平面 的 方程 为 图 　 顶点 聚类 示意图 设则 有 　 　 vivi 和 vi 已知 ， 令 p ［ a 　 b 　 c 　 d ］ T 表示 三角形 ｛ vivivi ｝ 所在 平面 方程 axbyczd 且 有 abc 令 MpppT ， 同时 令 就 不难 得到 vi 到 三角形 ｛ vivivi ｝ 所在 平面 的 距离 的 平方 为 由式 ， 式 可以 推导 出 　 　 由于 vivi 和 vi 已知 ， Mp 只 与 vi 的 位置 有关 我们 再 考虑 vi 到 其它 与 vi 相关 的 三角形 所在 平面 的 距离 平方 以及 Vs 中 的 其余 顶点 到 与 vi 相关 的 三角形 所在 平面 的 距离 平方 ， 并 对 这些 距离 平方 求和 就 可以 得到 Qi 只 与 vi 的 位置 有关 ， vi 未知 ， 所以 Qi 也 未知 ； 求 vi 的 过程 实际上 也 就是 求 Qi 的 过程 对此 我们 采用 迭代法 来 求解 ： 首先 赋给 Qi 以 迭代 初值 零 矩阵 得到 Qi 的 初值 Qi ， 由式 求得 vi 的 近似值 vi 再 由 vi 的 近似值 vi 求得 Qi 的 近似值 Qi ， 然后 求得 vi 的 下 一个 近似值 vi 这个 迭代 过程 一直 继续 到 vi 的 前后 两个 近似值 之间 的 差别 小于 某个 控制精度 至于 这种 迭代法 的 收敛性 ， 由于 初值 选择 得 较 好 ， 收敛 得 相当 快 ， 实验 证明 迭代 次数 到 三次 时 ， 结果 已经 很 好 了 这样 我们 就 可以 求得 每次 边 折叠 操作 新 生成 的 点 的 位置 和 该 操作 带来 的 误差 　 　 如果 顶点 集合 Vs 中 含有 边界 顶点 ， 为了 保持 原 网格 模型 的 边界 特征 ， 我们 在 三角形 集合 TsVs 的 每条 边界 边上 作 一个 通过 该 边界 边 并 与 该 边界 边 所在 的 边界 三角形 垂直 的 平面 在 计算误差 矩阵 时 把 这些 平面 也 考虑 在内 实践证明 这种 方法 对 保持 原始 网格 的 边界 特征 是 非常 有效 的 　 网格 模型 的 自适应性 划分 　 　 现在 来 考虑 如何 对原 网格 模型 的 包围 盒 进行 划分 我们 的 基本 工具 是 八叉树原 网格 模型 的 包围 盒 作为 八叉树 的 根 节点 ， 然后 按 顺序 把 原 网格 的 所有 顶点 插入 八叉树 本文 算法 是 通过 控制 八叉树 每个 叶子 节点 的 性质 来 实现 网格 模型 的 自适应性 划分 　 　 当 一个 顶点 插入 八叉树 的 某 一 叶子 节点 时 ， 如果 该 叶子 节点 内 还 不 包含 顶点 ， 则 把 该 顶点 直接 放入 该 节点 ， 不用 做 其它 操作 ； 如果 该 叶子 节点 内 已经 含有 顶点 ， 那 就要 判断 该 叶子 节点 所 表示 的 长方体 的 尺寸 是否 大于 用户 指定 的 每个 长方体 的 最大 尺寸 以及 该 节点 所 包含 的 顶点 数目 是否 大于 用户 指定 的 每个 长方体 最多能 包含 的 顶点 数目 ， 如果 是 ， 则 需要 分裂 该 节点 并 把 该 节点 包含 的 顶点 分配 到 其子 节点 中 去 ； 否则 ， 为了 保证 节中 提到 的 每个 长方体 内 的 顶点 和 边 所 构成 的 图 是 连通 的 条件 和 避免 图 所示 的 变形 过大 的 聚类 ， 算法 还要 判断 在 把 该 顶点 放入 该 长方体 后 ， 会 不会 导致 与 新 顶点 集合 相关 的 三角形 集合 中 某些 三角形 的 朝向 法 向量 相反 ， 如果 会 ， 该 节点 也 要 被 分裂 　 　 正是 通过 上面 构造 八叉树 的 过程 ， 算法 实现 了 网格 模型 的 自适应性 划分 ， 也 使得 节中 描述 的 误差 控制 方法 更为 有效 图是 我们 的 自 适应 划分 对图 所示 的 特殊 网格 划分 聚类 后 的 效果 ， 实线 表示 网格 ， 虚线 表示 划分 线 注意 到 图 b 所示 的 简化 基本 保持 了 图 a 所示 的 原 网格 的 形状 图 　 本文 算法 对 特殊 网格 的 简化 　 算法 总结 　 　 本文 提出 的 基于 顶点 聚类 的 网格 简化 算法 可以 用 下面 的 算法 来 描述 ： 　 　 算法 基于 顶点 聚类 的 网格 简化 算法 　 　 步骤 对 原始 网格 按节 描述 的 方法 建立 初始 八叉树 划分 　 　 步骤 对 上 一步 建立 的 八叉树 的 每个 非空 叶子 节点 ， 计算 该 节点 表示 的 长方体 中 包含 的 顶点 集合 的 误差 矩阵 和 聚类 生成 的 新点 的 坐标 以及 带来 得 误差 如果 该 误差 在 用户 指定 的 范围 内 ， 则 进行 聚类 ； 否则 ， 对 该 节点 再 进行 分裂 ， 直到 满足 误差 要求 再 执行 聚类 　 　 步骤 结束 　 数据结构 与 实验 结果 　 数据结构 　 　 由于 算法 要 处理 的 网格 含有 大量 的 三角形 ， 因此 要 设计 合理 的 数据结构 ， 使得 算法 能 处理 数据量 大 的 模型 ， 而且 要 有 较 快 的 速度 本 算法 所用 到 的 数据结构 有 ： a 顶点 表 ； b 三角形 表 ； c 划分 网格 模型 的 八叉树 对于 每次 聚类 得到 的 新点 坐标 可以 直接 放入 原 顶点 表 ， 覆盖 原来 的 表项 ， 节省 空间 　 实验 结果 　 　 该 算法 已 在 IBMPowerPC 上 实现 ， 图 ， ， 是 一组 实例 实践 表明 ， 该 算法 对 较 光滑 和 不 光滑 的 模型 数据 都 是 比较 有效 的 在 图 中 ， 兔子 的 模型 在 简化 之后 与 原 模型 还 很 接近 ， 当 简化 率为 时 ， 所 得到 的 简化 模型 还是 可 接受 的 图 中 的 人头 网格 模型 ， 最大 简化 率 只有 ， 这是 由于 原始 网格 数据量 不大 的 缘故 另外 ， 本文 算法 也 特别 适用 于 三角 化 的 地形模型 ， 如图 图 a 给出 的 是 一个 地形 的 原 网格 模型 ， 图 b ， c ， d 分别 是 其 简化 、 、 后 的 简化 模型 ， 注意 到 地形 的 边界 特征 保持 得 很 好 　 　 图是 Rossignac ［ ］ 算法 对 兔子 模型 所 做 的 简化 ， 注意 到 图 b 的 简化 模型 已有 很大 的 变形 另外 ， 本文 算法 中 的 误差 控制 方法 与 Garland ［ ］ 所 给出 二次 误差 类似 Garland ［ ］ 提出 的 算法 对 网格 进行 简化 的 基本操作 是 顶点 对 折叠 ， 即 让 原 网格 中 构成 一条 边 的 顶点 对 或者 距离 较近 的 顶点 对 合并 成 一个 顶点 实际上 ， 这是 本文 算法 的 一个 特例 ， 我们 只要 对 网格 模型 的 八叉树 划分 做 更 严格 的 限制 ， 同时 对 相邻 的 八叉树 节点 也 进行 聚类 操作 就 可 实现 Garland ［ ］ 算法 与 该 算法 相比 ， 本文 算法 的 速度 要 快得多 ， 而 效果 相当 图是 用 Garland ［ ］ 算法 对 地形 数据 所 做 的 简化 表 给出 了 三种 算法 的 速度 对比 所有 的 数据 都 是 在 IBMPowerPC 上测 得 的 图 　 本文 算法 对 兔子 模型 的 简化 图 　 算法 对 人头 模型 的 简化 图 　 本文 算法 对 地形模型 的 简化 采用 了 Gouraud 明暗 处理 图 　 Rossignac 算法 对 兔子 模型 的 简化 　 图 　 Garland 算法 对 地形模型 的 简化 采用 了 Gourand 明暗 处理表 　 三种 算法 运行 时间 对比 原 模型 三角形 数 简化 模型 三角形 数 Rossignac 算法 所用 时间 sGarland 算法 所用 时间 s 本文 算法 所用 时间 s 人头 地形 兔子 　 结束语 　 　 本文 提出 的 新 的 基于 顶点 聚类 的 网格 简化 算法 简单明了 、 速度 快且 效果 好 当 网格 模型 为 多边形 模型 时 ， 该 算法 不 受 影响 因而 该 算法 可 用于 虚拟现实 和 交互式 可视化 中 的 多 细节 层次 场景 的 自动 生成 　 　 本文 算法 比起 文献 ［ ］ 中 的 算法 ， 给出 了 一种 误差 控制 方法 从而 能 有效 的 控制 简化 网格 与 原始 网格 之间 的 误差 ， 同时 能 对 网格 模型 进行 有效 的 自适应性 划分 ； 具有 简化 率高 ， 简化 效果 好且 速度 相当 的 优点 　 　 今后 的 研究 主要 是 两个 方面 ： 研究 更 有效 的 误差 控制 方法 ； 研究 顶点 聚类 操作 的 逆 操作 顶点 分裂 ， 以 构造 递进 网格 另外 ， 我们 还 想 把 该 算法 与 视点 和 绘制 算法 结合 起来 ， 形成 与 视点 相关 的 实时 简化 算法 因为 该 算法 对 网格 模型 建立 了 八叉树 划分 ， 我们 可以 根据 视点 的 位置 ， 对 网格 模型 的 不同 部分 采用 不同 的 简化 误差 ， 得到 更快 的 处理速度 　 　 本 课题 得到 国家 自然科学 重点 基金项目 “ 真实感图形 实时 生成 和 显示 技术 ” 和 国家自然科学基金 项目 “ 虚拟现实 中 动态 连续 细节 层次 技术 研究 ” 共同 资助 作者 单位 浙江大学 CADCG 国家 重点 实验室 　 杭州 　 　 　 周 　 昆 　 男 ， 年 出生 ， 现为 浙江大学 CADCG 国家 重点 实验室 硕士 研究生 研究 方向 为 虚拟现实 、 科学计算 可视化 　 　 潘志庚 　 男 ， 年 出生 ， 博士 ， 现为 浙江大学 CADCG 国家 重点 实验室 研究员 研究 方向 为 分布式计算 、 虚拟现实 、 多媒体技术 参考文献 　 　 SchroederWJZargeJAetalDecimationoftrianglemeshesComputerGraphics — 　 　 TurkGRetilingpolygonalsurfaceComputerGraphics — 　 　 HoppeHDeRoseTetalMeshoptimizationComputerGraphicsSIGGRAPH — 　 　 RossignacJBorrelPMultiresolutionDapproximationforrenderingcomplexscenesInFalcidienoBKuniiTeditorsGeometricModelinginComputerGraphicsNewYorkSpringerVerlag — 　 　 EckMDeRoseTetalMultiresolutionanalysisofarbirtarymeshesComputerGraphicsSIGGRAPH — 　 　 CohenJVarshneyAManochaDetalSimplificationenvelopesComputerGraphicsSIGGRAPH — 　 　 GarlandMHeckbertPSSurfacesimplificationusingquadricerrormetricsComputerGraphicsSIGGRAPH ： — 　 　 潘志庚 ， 马小虎 ， 石教英 虚拟环境 中多 细节 层次模型 自动 生成 算法 软件 学报 ， ， ： — 　 　 周晓云 ， 刘慎权 基于 特征 角 准则 的 多面体 模型简化 方法 计算机 学报 增刊 ， ， ： — 　 　 陶志良 ， 潘志庚 ， 石教英 基于 能量 优化 的 网格 简化 算法 及其 应用软件 学报 ， ， ： — 收稿 日期 　 　 收到 修改稿 日期 　