微型机 与 应用 MICROCOMPUTERITSAPPLICATIONSVolNoPJavaBeans 组件 模型 的 分布式 扩展 机制 刘启文 　 傅韶勇 　 杨利 　 　 摘 　 要 ： 结合 JavaBeans 技术 和 JavaRMI 技术 提出 了 JavaBeans 组件 模型 的 分布式 扩展 机制 并 在 此基础 上 实现 了 基于 JavaBeans 的 组件 化 分布式应用 运行 平台 。 　 　 关键词 ： Java 语言 JavaBeans 组件 模型 JavaRMI 分布式 处理 　 　 随着 软件 的 规模 逐渐 庞大 化 软件 的 可靠性 、 维护性 等 问题 深深 困扰 着 软件 开发人员 和 用户 。 而且 对于 企业级 应用 而言 由于 企业 业务 处于 经常 的 变动 之中 目前 的 应用软件 较难 快速 适应 这种 改变 。 　 　 组件 技术 为 整个 软件 行业 带来 了 新 的 生命力 组件 的 可 重用 性 、 可管理性 和 可 替代性 大大 改善 了 软件 本身 的 结构特征 能够 有效 地 解决 软件 规模 日益 庞大 所 带来 的 种种 问题 。 针对 当前 企业级 应用 的 特点 开发 了 基于 JavaBeans 组件 模型 的 组件 化 分布式应用 运行 平台 为 企业 系统管理 提供 了 一个 灵活 的 、 可 扩展 的 、 集成 的 分布式 组件 框架 。 在 此 平台 之上 应用 系统 中 的 各 功能 组件 根据 商业 规则 的 驱动 在 分布式计算 环境 中 动态 地 组合 起来 并 具有 组件 动态 升级 和 组件 之间 的 动态 业务 重组 等 关键 特性 支持 企业 业务 变化 需求 驱动 下 的 系统 快速 重组 和 进化 。 开发 背景 　 　 本文 介绍 的 平台 是 东北大学 软件 中心 承担 的 “ 九五 ” 国家 科技 攻关项目 — — “ 基于 组件 技术 的 应用软件 开发 环境 ” 的 部分 研究 内容 。 CADRE 系统 （ ComponentbasedApplicationDevelopmentRuntimeEnvironment ） 支持软件 从 设计 、 开发 、 分发 、 运行 直至 管理 的 各个 阶段 整体 分为 大部分 组件 库 管理系统 CLMS 、 基于 组件 的 分布式应用 图形化 建模 工具 ArchDesigner 和 组件 化 分布式应用 运行 平台 CLAS 。 　 　 组件 化 分布式应用 运行 平台 是 ArchDesigner 开发 环境 基于 的 目标 运行 平台 其中 该 平台 最 重要 的 特征 是 支持 了 事件驱动 的 软件体系结构 风格 以及 “ 业务 逻辑 与 功能 实现 相 分离 ” 的 思想 。 　 　 事件 是 组件 模型 的 三大 基本 元素 之一 在 事件驱动 的 软件体系结构 风格 中 组件 禁止 直接 操纵 其它 任何 组件 事件 被 规定 为 组件 主动 与 外界 交互 的 唯一 途径 这 提供 了 一种 隐含 调用 （ ImplicateInvocation ） 的 机制 降低 了 组件 之间 的 耦合度 大大 改善 了 组件 化 软件 的 系统结构 。 　 　 在 一般 的 软件开发 模式 下 系统 业务 逻辑 都 是 硬 编码 并 被 分割 在 系统 的 具体 功能 实现 代码 之中 运行 时刻 系统 业务 逻辑 不可 发现 系统 在 业务 变化 需求 下 无法 实现 动态 升级 。 将 业务 逻辑 从 功能 实现 中 分离出来 各 功能 组件 独立 存在 通过 业务 逻辑 中 所 提供 的 接口 拼装 在 一起 形成 完整 的 系统 。 系统 运行 时刻 各 功能 组件 通过 各自 的 接口 根据 业务 逻辑 的 描述 进行 交互 因此 各 组件 不 依赖 其它 组件 而 存在 而且 能够 非常 方便 地被 其它 具有 相同 接口 的 组件 所 替换 。 　 　 由于 本 平台 是 分布式计算 环境 下 的 组件 化 应用 平台 企业 业务 逻辑 装载 在 服务器端 由 规则 虚拟机 解释 执行 功能 组件 分布 在 各 客户端 运行 通过 分布式 对象 总线 与 服务器端 的 业务 逻辑 中 的 相应 接口 实现 动态 联编 各 组件 通过 各自 的 接口 在 分布式 对象 总线 上 实现 透明 地互 通信 和 互操作 。 而且 服务器 作为 本 系统 的 控制中心 需要 管理 整个 分布式 网络 环境 中 的 所有 JavaBeans 组件 包括 组件 监控 、 配置 、 访问控制 和 组件 升级 等 这些 功能 保证 了 整个 企业应用 具有 良好 的 可管理性 。 　 　 针对 以上 的 系统 功能 需求 平台 中 的 组件 载体 必须 支持 事件 在 分布式 范围 内 的 传播 以 触发 分布式 环境 中 其它 组件 的 相应 动作 而且 组件 能够 提供 远程 调用 接口 使得 服务器 能够 进行 统一 的 、 有序 的 、 合理 的 管理 这样 可以 使 系统 中 所有 组件 都 运行 在 个 虚拟 的 统一 地址 空间 中 。 由于 JavaBeans 是 局限于 单个 Java 虚拟机 地址 空间 的 组件 模型 不 具有 分布式 处理 的 能力 这 就 要求 我们 在 不 修改 JavaBeans 标准 组件 模型 的 前提 下 对 其 进行 外部 扩展 使之能 适合 分布式应用 的 需要 。 组件 模型 分布式 扩展 的 实现 分布式 扩展 方案 　 　 JavaBeans 组件 模型 基本上 是 一个 静态 模型 它 的 基本 思想 是 通过 对 程序 的 标准 封装 来 实现 可视化 使用 从而 快速 构造 应用 。 每个 JavaBeans 都 附带 了 标准 而且 详细 的 说明 类 （ BeanInfo ） 描述 了 整个 组件 所有 可 暴露 的 属性 、 方法 和 事件 因此 组件 框架 能够 正确 地 得到 这些 接口 信息 并 依此 有效 地 管理 和 操纵 组件 。 此外 JavaBeans 独特 的 事件 监听 模型 使得 不同 组件 可以 动态 、 灵活 地 组装 起来 组件 之间 的 耦合度 得到 大大降低 。 　 　 但是 JavaBeans 模型 在 个 方面 无法 适应 本 平台 分布式应用 的 需求 ① JavaBeans 事件 模型 是 在 单个 虚拟机 地址 空间 中 实现 组件 之间 的 同步 交互 操作 对于 其它 支持 事件 的 组件 模型 也 同样 如此 （ 如 ActiveX ） ② JavaBeans 规范 并 不 要求 具有 分布式 对象 的 特征 JavaBeans 组件 仅能 在 本地 地址 空间 被 调用 除非 该 组件 同时 实现 为个 分布式 对象 但 这 又 限制 了 JavaBeans 组件 的 通用性 和 标准 性 。 因此 本 系统对 JavaBeans 组件 模型 设计 了 如下 基本 扩展 方案 　 　 业务 逻辑 采用 脚本语言 进行 编写 系统 的 所有 组件 采用 用户名 组件 名 实例 编号 三元 组件 为 组件 逻辑 句柄 唯一 标识 服务器端 的 脚本语言 使用 组件 句柄 操作 运行 在 各地 的 功能 组件 。 　 　 各个 JavaBeans 组件 运行 在 各自 JVM 的 组件 容器 之中 各 组件 容器 实现 为 所 管理 组件 的 监听器 能够 捕获 所有 组件 的 事件 并 负责 将 其 发布 在 分布式 范围 之内 。 　 　 脚本语言 支持 组件 的 事件 监听器 注册 语法 能够 将 不同 地址 空间 的 组件 按照 事件 监听 关系 在 分布式 环境 中 组装 起来 。 　 　 业务 逻辑 管理 着 系统 中 所有 组件 的 逻辑 句柄 并 使用 逻辑 句柄 通过 各地 的 组件 容器 操作 实际 的 组件 实例 。 　 　 事件 的 网络 发布 以及 组件 的 远程 操作 都 使用 JavaRMI 分布式 对象 技术 实现 保证 事件 对象 和 方法 调用 参数 通过 分布式 对象 技术 被 正确 地 在 分布式 环境 中 传递 由于 服务器端 和 客户端 在 交互 中 都 具有 主动性 双方 都 需 实现 为 远程 对象 供 对方 主动 传送数据 。 分布式 扩展 实现 　 　 在 本 系统 各 分布 结点 在 某 一 时刻 代表 着 特定 的 用户 身份 组件 容器 通过 组件 名 和 组件 实例 编号 管理 运行 在 该 容器 中 的 所有 组件 的 实际 句柄 并 向 其它 分布 结点 提供 名字 服务 其它 结点 能够 远程 地 访问 容器 中 的 任意 组件 。 在 业务 逻辑 中 组件 逻辑 句柄 BeanHandle 用户名 组件 名 组件 实例 编号 系统 利用 组件 逻辑 句柄 把 分布式 运行 的 组件 对象 重新 定位 到 统一 的 虚拟地址 空间 中 进行 集中管理 。 在 业务 逻辑 语法 中 JavaBeans 组件 的 接口 和 使用 语法 与 在 Java 语言 中 基本 保持一致 但 语义 实现 却 有 许多 不同 。 　 　 方法 调用 。 方法 调用 的 语法 形式 为 BeanHandle 方法 名 （ 参数 列表 ） 规则 虚拟机 在 解释 运行 该 语句 时 通过 BeanHandle 中 的 用户名 确定 该 组件 所在 的 客户端 得到 该 客户端 的 远程 对象 句柄 通过 该 远程 对象 将 组件 名 、 组件 实例 编号 、 方法 名 、 参数 列表 发送到 客户端 组件 容器 的 名字 服务 由此 查找 到 实际 组件 的 实例 句柄 最后 使用 ReflectionAPI 动态 启动 对 组件 的 实际操作 方法 如下 　 　 publicbooleanInvokeMethod （ 组件 逻辑 句柄 方法 名 参数 列表 ） 　 　 另外 组件 实例 创建 的 语法 如下 　 　 组件 名 BeanInstancenew 组件 名 （ 用户名 参数 列表 ） 　 　 由于 服务器端 管理 着 整个 系统 的 所有 组件 逻辑 句柄 该 操作 能够 为 新 的 组件 实例 生成 个 实例 编号 与 用户名 、 组件 名 形成 唯一 的 组件 逻辑 句柄 最后 该 信息 远程 传输 到 相应 客户端 进行 实际 组件 实例 的 创建 。 　 　 事件 的 包装 和 发送 。 事件 的 包装 在 客户端 进行 。 由于 客户端 中 执行 的 组件 是 不可 预知 的 而且 组件 发出 的 事件 各有不同 因此 客户端 的 事件 捕获 功能 必须 具有 通用性 。 组件 容器 在 装载 运行 个 组件 时 解析 该 组件 并 为 该 组件 动态 地 创建 个 临时 事件 监听器 。 该 临时 监听器 捕获 到 组件 事件 后 对 事件 作 如下 包装 　 　 用户名 组件 名 组件 实例 编号 事件 对象 监听器 名称 触发 监听器 方法 名称 使用 服务器端 的 远程 对象 将 包装 后 的 事件 通过 RMI 转发 到 服务器 业务 逻辑 于是 触发 该 组件 的 所有 监听器 下面 给出 了 具体操作 。 　 　 事件 监听器 的 注册 和 注销 。 在 业务 逻辑 语法 中 事件 监听器 的 语法 与 在 Java 语言 中 完全相同 如 目前 存在 组件 EventSource 和 其 监听器 Listener 则 其 注册 和 注销 方法 如下 　 　 EventSourceHandleaddXXXListener （ ListenerHandle ） 　 　 EventSourceHandleremoveXXXListener （ ListenerHandle ） 　 　 规则 虚拟机 在 解释 这个 语句 时 组件 之间 的 事件 监听 关系 将 存储 在 个 监听 表 之中 监听 表 的 内容 包括 　 　 事件 源 逻辑 句柄 监听器 逻辑 句柄 监听器 类型 名称 　 　 当 客户端 经 包装 后 的 事件 转发 到 服务器 后 服务器 将 其 解包 按照 事件 源 逻辑 句柄 和 监听器 名称 查找 监听 表 获得 所有 的 监听器 组件 后 根据 包装 事件 中 的 触发 监听器 方法 名 和 事件 对象 远程 操作 实际 组件 等价 方法 如下 　 　 ListenerHandle 监听器 方法 名称 （ 事件 对象 ） 分布式 组件 框架 　 　 基于 扩展 后 的 JavaBeans 组件 模型 相应 地 实现 了 在 平台 中 的 分布式 组件 框架 。 图 所示 为 整个 平台 的 系统 结构图 规则 引擎 是 整个 应用 系统 的 控制中心 客户 代理 实现 了 “ 零 管理 ” 应用 系统 的 所有 功能 组件 都 存储 在 服务器端 在 需要 时 动态 、 即时 地 加载 到 客户 代理 端 运行 。 当然 在 服务器端 也 能 运行 无 UI 界面 的 功能 组件 从而 提高 整个 系统 的 运行 速度 。 在 业务 逻辑 的 驱动 下 运行 于 各地 的 分布 组件 在 服务器 与 客户端 之间 建立 的 分布式 总线 上 进行 透明 的 互操作 。 　 　 图 所示 的 分布式 总线 是 使用 JavaRMI 技术 实现 的 该 总线 支持 扩展 后 JavaBeans 组件 模型 的 事件 传递 、 监听器 触发 以及 组件 远程 调用 整个 平台 的 功能 大致 可以 分为 以下 步图 组件 化 分布式应用 运行 平台 系统 结构图 ［ 注 ］ α 事件 通道 β 组件 操作 通道 γ 组件 分发 通道 　 　 第一步 客户 代理 的 组件 处理器 接收 远程 组件 调用 操作 并 解释 执行 该 调用 操作 。 对于 创建 组件 实例 操作 需 首先 通过 γ 通道 从 规则 引擎 中 下载 所 需 的 组件 （ 即 JAR 文件 ） 并 安装 在 本地 。 　 　 第二步 客户 代理 中 的 组件 容器 解析 组件 的 JAR 文件 获得 组件 接口 信息 据此 为 该 组件 生成 临时 事件 监听器 。 　 　 第三步 系统 运行 过程 中 临时 事件 监听器 监听 到 相应 组件 的 特定 事件 后 事件 监听器 将 事件 包装 成 标准 的 扩展 事件 形式 通过 α 通道 转发给 规则 引擎 。 　 　 第四步 规则 引擎 端的 事件 监听器 收到 扩展 事件 后 对 该 事件 进行 解包 由 规则 虚拟机 中 运行 的 业务 逻辑 确定 下 一步 的 操作 。 　 　 第五步 规则 引擎 中 的 组件 处理器 得到 规则 虚拟机 解释 执行 中 触发 的 组件 操作 信息 包装 成 组件 标准 的 扩展 操作 形式 通过 β 通道 传送 到 指定 的 客户 代理 。 　 　 以上 介绍 的 组件 运行 平台 为 企业 管理 提供 了 一个 开放 的 、 集成 的 、 灵活 的 、 可 扩展 的 分布式计算 环境 。 该 平台 实现 采用 了 Java 、 JavaBeans 组件 模型 和 JavaRMI 分布式 对象 技术 为 使 软件 组件 能够 灵活 组装 在 一起 进行 协同工作 设计 了 一种 类似 硬件 总线 式 的 软件 总线 。 对于 各种 共享 重用 的 组件 采用 延迟 绑定 的 动态 连接 方式 运行 保证 了 组件 动态 、 快速 升级 的 特性 。 在 这 其中 我们 研究 了 Java 平台 上 的 组件 模型 JavaBeans 并 对 其 进行 了 逻辑 上 的 扩展 使 其 满足 组件 化 分布式应用 运行 平台 下 分布式 操作 的 需求 。 刘启文 （ 沈阳 宝钢 东软 集团 软件 中心 ） 傅韶勇 （ 沈阳 宝钢 东软 集团 软件 中心 ） 杨利 （ 沈阳 宝钢 东软 集团 软件 中心 ） 参考文献 ， SchmideRConceptsforDevelopingComponentBasedSystemsInternationalWorkshoponComponentBasedSoftwareEngineering ， 徐征 刘晓铭 刘积仁 一种 构件 化 的 动态 软件系统 模型 小型 微型 计算机系统 ， 麦中 凡 基于 分布式 对象 的 软件 构件 计算机科学 收稿 日期 ：